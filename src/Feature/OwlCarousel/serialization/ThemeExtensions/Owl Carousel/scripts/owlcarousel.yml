---
ID: "d7ce1ad9-85bc-4725-ab95-8d4a437ebd76"
Parent: "b3d3f187-5d56-4360-b321-250750fa5dae"
Template: "962b53c4-f93b-4df9-9821-415c867b8903"
Path: /sitecore/media library/Extension Themes/Owl Carousel/scripts/owlcarousel
DB: master
SharedFields:
- ID: "06d5295c-ed2f-4a54-9bf2-26228d113318"
  Hint: __Icon
  Value: "-/media/D7CE1AD985BC4725AB958D4A437EBD76.ashx?h=16&thn=1&w=16"
- ID: "40e50ed9-ba07-4702-992e-a912738d32dc"
  Hint: Blob
  BlobID: "e96b1444-7f22-4c97-a068-8fc463778ab5"
  Value: 77u/LyoNCiAqICBqUXVlcnkgT3dsQ2Fyb3VzZWwgdjEuMy4zDQogKg0KICogIENvcHlyaWdodCAoYykgMjAxMyBCYXJ0b3N6IFdvamNpZWNob3dza2kNCiAqICBodHRwOi8vd3d3Lm93bGdyYXBoaWMuY29tL293bGNhcm91c2VsLw0KICoNCiAqICBMaWNlbnNlZCB1bmRlciBNSVQNCiAqDQogKi8NCg0KLypKUyBMaW50IGhlbHBlcnM6ICovDQovKmdsb2JhbCBkcmFnTW92ZTogZmFsc2UsIGRyYWdFbmQ6IGZhbHNlLCAkLCBqUXVlcnksIGFsZXJ0LCB3aW5kb3csIGRvY3VtZW50ICovDQovKmpzbGludCBub21lbjogdHJ1ZSwgY29udGludWU6dHJ1ZSAqLw0KDQppZiAodHlwZW9mIE9iamVjdC5jcmVhdGUgIT09ICJmdW5jdGlvbiIpIHsNCiAgICBPYmplY3QuY3JlYXRlID0gZnVuY3Rpb24gKG9iaikgew0KICAgICAgICBmdW5jdGlvbiBGKCkgeyB9DQogICAgICAgIEYucHJvdG90eXBlID0gb2JqOw0KICAgICAgICByZXR1cm4gbmV3IEYoKTsNCiAgICB9Ow0KfQ0KKGZ1bmN0aW9uICgkLCB3aW5kb3csIGRvY3VtZW50KSB7DQoNCiAgICB2YXIgQ2Fyb3VzZWwgPSB7DQogICAgICAgIGluaXQ6IGZ1bmN0aW9uIChvcHRpb25zLCBlbCkgew0KICAgICAgICAgICAgdmFyIGJhc2UgPSB0aGlzOw0KDQogICAgICAgICAgICBiYXNlLiRlbGVtID0gJChlbCk7DQogICAgICAgICAgICBiYXNlLm9wdGlvbnMgPSAkLmV4dGVuZCh7fSwgJC5mbi5vd2xDYXJvdXNlbC5vcHRpb25zLCBiYXNlLiRlbGVtLmRhdGEoKSwgb3B0aW9ucyk7DQoNCiAgICAgICAgICAgIGJhc2UudXNlck9wdGlvbnMgPSBvcHRpb25zOw0KICAgICAgICAgICAgYmFzZS5sb2FkQ29udGVudCgpOw0KICAgICAgICB9LA0KDQogICAgICAgIGxvYWRDb250ZW50OiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICB2YXIgYmFzZSA9IHRoaXMsIHVybDsNCg0KICAgICAgICAgICAgZnVuY3Rpb24gZ2V0RGF0YShkYXRhKSB7DQogICAgICAgICAgICAgICAgdmFyIGksIGNvbnRlbnQgPSAiIjsNCiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGJhc2Uub3B0aW9ucy5qc29uU3VjY2VzcyA9PT0gImZ1bmN0aW9uIikgew0KICAgICAgICAgICAgICAgICAgICBiYXNlLm9wdGlvbnMuanNvblN1Y2Nlc3MuYXBwbHkodGhpcywgW2RhdGFdKTsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBmb3IgKGkgaW4gZGF0YS5vd2wpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLm93bC5oYXNPd25Qcm9wZXJ0eShpKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQgKz0gZGF0YS5vd2xbaV0uaXRlbTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBiYXNlLiRlbGVtLmh0bWwoY29udGVudCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGJhc2UubG9nSW4oKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYgKHR5cGVvZiBiYXNlLm9wdGlvbnMuYmVmb3JlSW5pdCA9PT0gImZ1bmN0aW9uIikgew0KICAgICAgICAgICAgICAgIGJhc2Uub3B0aW9ucy5iZWZvcmVJbml0LmFwcGx5KHRoaXMsIFtiYXNlLiRlbGVtXSk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmICh0eXBlb2YgYmFzZS5vcHRpb25zLmpzb25QYXRoID09PSAic3RyaW5nIikgew0KICAgICAgICAgICAgICAgIHVybCA9IGJhc2Uub3B0aW9ucy5qc29uUGF0aDsNCiAgICAgICAgICAgICAgICAkLmdldEpTT04odXJsLCBnZXREYXRhKTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgYmFzZS5sb2dJbigpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9LA0KDQogICAgICAgIGxvZ0luOiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICB2YXIgYmFzZSA9IHRoaXM7DQoNCiAgICAgICAgICAgIGJhc2UuJGVsZW0uZGF0YSgib3dsLW9yaWdpbmFsU3R5bGVzIiwgYmFzZS4kZWxlbS5hdHRyKCJzdHlsZSIpKTsNCiAgICAgICAgICAgIGJhc2UuJGVsZW0uZGF0YSgib3dsLW9yaWdpbmFsQ2xhc3NlcyIsIGJhc2UuJGVsZW0uYXR0cigiY2xhc3MiKSk7DQoNCiAgICAgICAgICAgIGJhc2UuJGVsZW0uY3NzKHsgb3BhY2l0eTogMCB9KTsNCiAgICAgICAgICAgIGJhc2Uub3JpZ25hbEl0ZW1zID0gYmFzZS5vcHRpb25zLml0ZW1zOw0KICAgICAgICAgICAgYmFzZS5jaGVja0Jyb3dzZXIoKTsNCiAgICAgICAgICAgIGJhc2Uud3JhcHBlcldpZHRoID0gMDsNCiAgICAgICAgICAgIGJhc2UuY2hlY2tWaXNpYmxlID0gbnVsbDsNCiAgICAgICAgICAgIGJhc2Uuc2V0VmFycygpOw0KICAgICAgICB9LA0KDQogICAgICAgIHNldFZhcnM6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIHZhciBiYXNlID0gdGhpczsNCiAgICAgICAgICAgIGlmIChiYXNlLiRlbGVtLmNoaWxkcmVuKCkubGVuZ3RoID09PSAwKSB7IHJldHVybiBmYWxzZTsgfQ0KICAgICAgICAgICAgYmFzZS5iYXNlQ2xhc3MoKTsNCiAgICAgICAgICAgIGJhc2UuZXZlbnRUeXBlcygpOw0KICAgICAgICAgICAgYmFzZS4kdXNlckl0ZW1zID0gYmFzZS4kZWxlbS5jaGlsZHJlbigpOw0KICAgICAgICAgICAgYmFzZS5pdGVtc0Ftb3VudCA9IGJhc2UuJHVzZXJJdGVtcy5sZW5ndGg7DQogICAgICAgICAgICBiYXNlLndyYXBJdGVtcygpOw0KICAgICAgICAgICAgYmFzZS4kb3dsSXRlbXMgPSBiYXNlLiRlbGVtLmZpbmQoIi5vd2wtaXRlbSIpOw0KICAgICAgICAgICAgYmFzZS4kb3dsV3JhcHBlciA9IGJhc2UuJGVsZW0uZmluZCgiLm93bC13cmFwcGVyIik7DQogICAgICAgICAgICBiYXNlLnBsYXlEaXJlY3Rpb24gPSAibmV4dCI7DQogICAgICAgICAgICBiYXNlLnByZXZJdGVtID0gMDsNCiAgICAgICAgICAgIGJhc2UucHJldkFyciA9IFswXTsNCiAgICAgICAgICAgIGJhc2UuY3VycmVudEl0ZW0gPSAwOw0KICAgICAgICAgICAgYmFzZS5jdXN0b21FdmVudHMoKTsNCiAgICAgICAgICAgIGJhc2Uub25TdGFydHVwKCk7DQogICAgICAgIH0sDQoNCiAgICAgICAgb25TdGFydHVwOiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICB2YXIgYmFzZSA9IHRoaXM7DQogICAgICAgICAgICBiYXNlLnVwZGF0ZUl0ZW1zKCk7DQogICAgICAgICAgICBiYXNlLmNhbGN1bGF0ZUFsbCgpOw0KICAgICAgICAgICAgYmFzZS5idWlsZENvbnRyb2xzKCk7DQogICAgICAgICAgICBiYXNlLnVwZGF0ZUNvbnRyb2xzKCk7DQogICAgICAgICAgICBiYXNlLnJlc3BvbnNlKCk7DQogICAgICAgICAgICBiYXNlLm1vdmVFdmVudHMoKTsNCiAgICAgICAgICAgIGJhc2Uuc3RvcE9uSG92ZXIoKTsNCiAgICAgICAgICAgIGJhc2Uub3dsU3RhdHVzKCk7DQoNCiAgICAgICAgICAgIGlmIChiYXNlLm9wdGlvbnMudHJhbnNpdGlvblN0eWxlICE9PSBmYWxzZSkgew0KICAgICAgICAgICAgICAgIGJhc2UudHJhbnNpdGlvblR5cGVzKGJhc2Uub3B0aW9ucy50cmFuc2l0aW9uU3R5bGUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKGJhc2Uub3B0aW9ucy5hdXRvUGxheSA9PT0gdHJ1ZSkgew0KICAgICAgICAgICAgICAgIGJhc2Uub3B0aW9ucy5hdXRvUGxheSA9IDUwMDA7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBiYXNlLnBsYXkoKTsNCg0KICAgICAgICAgICAgYmFzZS4kZWxlbS5maW5kKCIub3dsLXdyYXBwZXIiKS5jc3MoImRpc3BsYXkiLCAiYmxvY2siKTsNCg0KICAgICAgICAgICAgaWYgKCFiYXNlLiRlbGVtLmlzKCI6dmlzaWJsZSIpKSB7DQogICAgICAgICAgICAgICAgYmFzZS53YXRjaFZpc2liaWxpdHkoKTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgYmFzZS4kZWxlbS5jc3MoIm9wYWNpdHkiLCAxKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGJhc2Uub25zdGFydHVwID0gZmFsc2U7DQogICAgICAgICAgICBiYXNlLmVhY2hNb3ZlVXBkYXRlKCk7DQogICAgICAgICAgICBpZiAodHlwZW9mIGJhc2Uub3B0aW9ucy5hZnRlckluaXQgPT09ICJmdW5jdGlvbiIpIHsNCiAgICAgICAgICAgICAgICBiYXNlLm9wdGlvbnMuYWZ0ZXJJbml0LmFwcGx5KHRoaXMsIFtiYXNlLiRlbGVtXSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0sDQoNCiAgICAgICAgZWFjaE1vdmVVcGRhdGU6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIHZhciBiYXNlID0gdGhpczsNCg0KICAgICAgICAgICAgaWYgKGJhc2Uub3B0aW9ucy5sYXp5TG9hZCA9PT0gdHJ1ZSkgew0KICAgICAgICAgICAgICAgIGJhc2UubGF6eUxvYWQoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChiYXNlLm9wdGlvbnMuYXV0b0hlaWdodCA9PT0gdHJ1ZSkgew0KICAgICAgICAgICAgICAgIGJhc2UuYXV0b0hlaWdodCgpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgYmFzZS5vblZpc2libGVJdGVtcygpOw0KDQogICAgICAgICAgICBpZiAodHlwZW9mIGJhc2Uub3B0aW9ucy5hZnRlckFjdGlvbiA9PT0gImZ1bmN0aW9uIikgew0KICAgICAgICAgICAgICAgIGJhc2Uub3B0aW9ucy5hZnRlckFjdGlvbi5hcHBseSh0aGlzLCBbYmFzZS4kZWxlbV0pOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9LA0KDQogICAgICAgIHVwZGF0ZVZhcnM6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIHZhciBiYXNlID0gdGhpczsNCiAgICAgICAgICAgIGlmICh0eXBlb2YgYmFzZS5vcHRpb25zLmJlZm9yZVVwZGF0ZSA9PT0gImZ1bmN0aW9uIikgew0KICAgICAgICAgICAgICAgIGJhc2Uub3B0aW9ucy5iZWZvcmVVcGRhdGUuYXBwbHkodGhpcywgW2Jhc2UuJGVsZW1dKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGJhc2Uud2F0Y2hWaXNpYmlsaXR5KCk7DQogICAgICAgICAgICBiYXNlLnVwZGF0ZUl0ZW1zKCk7DQogICAgICAgICAgICBiYXNlLmNhbGN1bGF0ZUFsbCgpOw0KICAgICAgICAgICAgYmFzZS51cGRhdGVQb3NpdGlvbigpOw0KICAgICAgICAgICAgYmFzZS51cGRhdGVDb250cm9scygpOw0KICAgICAgICAgICAgYmFzZS5lYWNoTW92ZVVwZGF0ZSgpOw0KICAgICAgICAgICAgaWYgKHR5cGVvZiBiYXNlLm9wdGlvbnMuYWZ0ZXJVcGRhdGUgPT09ICJmdW5jdGlvbiIpIHsNCiAgICAgICAgICAgICAgICBiYXNlLm9wdGlvbnMuYWZ0ZXJVcGRhdGUuYXBwbHkodGhpcywgW2Jhc2UuJGVsZW1dKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSwNCg0KICAgICAgICByZWxvYWQ6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIHZhciBiYXNlID0gdGhpczsNCiAgICAgICAgICAgIHdpbmRvdy5zZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICBiYXNlLnVwZGF0ZVZhcnMoKTsNCiAgICAgICAgICAgIH0sIDApOw0KICAgICAgICB9LA0KDQogICAgICAgIHdhdGNoVmlzaWJpbGl0eTogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgdmFyIGJhc2UgPSB0aGlzOw0KDQogICAgICAgICAgICBpZiAoYmFzZS4kZWxlbS5pcygiOnZpc2libGUiKSA9PT0gZmFsc2UpIHsNCiAgICAgICAgICAgICAgICBiYXNlLiRlbGVtLmNzcyh7IG9wYWNpdHk6IDAgfSk7DQogICAgICAgICAgICAgICAgd2luZG93LmNsZWFySW50ZXJ2YWwoYmFzZS5hdXRvUGxheUludGVydmFsKTsNCiAgICAgICAgICAgICAgICB3aW5kb3cuY2xlYXJJbnRlcnZhbChiYXNlLmNoZWNrVmlzaWJsZSk7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGJhc2UuY2hlY2tWaXNpYmxlID0gd2luZG93LnNldEludGVydmFsKGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICBpZiAoYmFzZS4kZWxlbS5pcygiOnZpc2libGUiKSkgew0KICAgICAgICAgICAgICAgICAgICBiYXNlLnJlbG9hZCgpOw0KICAgICAgICAgICAgICAgICAgICBiYXNlLiRlbGVtLmFuaW1hdGUoeyBvcGFjaXR5OiAxIH0sIDIwMCk7DQogICAgICAgICAgICAgICAgICAgIHdpbmRvdy5jbGVhckludGVydmFsKGJhc2UuY2hlY2tWaXNpYmxlKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9LCA1MDApOw0KICAgICAgICB9LA0KDQogICAgICAgIHdyYXBJdGVtczogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgdmFyIGJhc2UgPSB0aGlzOw0KICAgICAgICAgICAgYmFzZS4kdXNlckl0ZW1zLndyYXBBbGwoIjxkaXYgY2xhc3M9XCJvd2wtd3JhcHBlclwiPiIpLndyYXAoIjxkaXYgY2xhc3M9XCJvd2wtaXRlbVwiPjwvZGl2PiIpOw0KICAgICAgICAgICAgYmFzZS4kZWxlbS5maW5kKCIub3dsLXdyYXBwZXIiKS53cmFwKCI8ZGl2IGNsYXNzPVwib3dsLXdyYXBwZXItb3V0ZXJcIj4iKTsNCiAgICAgICAgICAgIGJhc2Uud3JhcHBlck91dGVyID0gYmFzZS4kZWxlbS5maW5kKCIub3dsLXdyYXBwZXItb3V0ZXIiKTsNCiAgICAgICAgICAgIGJhc2UuJGVsZW0uY3NzKCJkaXNwbGF5IiwgImJsb2NrIik7DQogICAgICAgIH0sDQoNCiAgICAgICAgYmFzZUNsYXNzOiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICB2YXIgYmFzZSA9IHRoaXMsDQogICAgICAgICAgICAgICAgaGFzQmFzZUNsYXNzID0gYmFzZS4kZWxlbS5oYXNDbGFzcyhiYXNlLm9wdGlvbnMuYmFzZUNsYXNzKSwNCiAgICAgICAgICAgICAgICBoYXNUaGVtZUNsYXNzID0gYmFzZS4kZWxlbS5oYXNDbGFzcyhiYXNlLm9wdGlvbnMudGhlbWUpOw0KDQogICAgICAgICAgICBpZiAoIWhhc0Jhc2VDbGFzcykgew0KICAgICAgICAgICAgICAgIGJhc2UuJGVsZW0uYWRkQ2xhc3MoYmFzZS5vcHRpb25zLmJhc2VDbGFzcyk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmICghaGFzVGhlbWVDbGFzcykgew0KICAgICAgICAgICAgICAgIGJhc2UuJGVsZW0uYWRkQ2xhc3MoYmFzZS5vcHRpb25zLnRoZW1lKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSwNCg0KICAgICAgICB1cGRhdGVJdGVtczogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgdmFyIGJhc2UgPSB0aGlzLCB3aWR0aCwgaTsNCg0KICAgICAgICAgICAgaWYgKGJhc2Uub3B0aW9ucy5yZXNwb25zaXZlID09PSBmYWxzZSkgew0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChiYXNlLm9wdGlvbnMuc2luZ2xlSXRlbSA9PT0gdHJ1ZSkgew0KICAgICAgICAgICAgICAgIGJhc2Uub3B0aW9ucy5pdGVtcyA9IGJhc2Uub3JpZ25hbEl0ZW1zID0gMTsNCiAgICAgICAgICAgICAgICBiYXNlLm9wdGlvbnMuaXRlbXNDdXN0b20gPSBmYWxzZTsNCiAgICAgICAgICAgICAgICBiYXNlLm9wdGlvbnMuaXRlbXNEZXNrdG9wID0gZmFsc2U7DQogICAgICAgICAgICAgICAgYmFzZS5vcHRpb25zLml0ZW1zRGVza3RvcFNtYWxsID0gZmFsc2U7DQogICAgICAgICAgICAgICAgYmFzZS5vcHRpb25zLml0ZW1zVGFibGV0ID0gZmFsc2U7DQogICAgICAgICAgICAgICAgYmFzZS5vcHRpb25zLml0ZW1zVGFibGV0U21hbGwgPSBmYWxzZTsNCiAgICAgICAgICAgICAgICBiYXNlLm9wdGlvbnMuaXRlbXNNb2JpbGUgPSBmYWxzZTsNCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHdpZHRoID0gJChiYXNlLm9wdGlvbnMucmVzcG9uc2l2ZUJhc2VXaWR0aCkud2lkdGgoKTsNCg0KICAgICAgICAgICAgaWYgKHdpZHRoID4gKGJhc2Uub3B0aW9ucy5pdGVtc0Rlc2t0b3BbMF0gfHwgYmFzZS5vcmlnbmFsSXRlbXMpKSB7DQogICAgICAgICAgICAgICAgYmFzZS5vcHRpb25zLml0ZW1zID0gYmFzZS5vcmlnbmFsSXRlbXM7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoYmFzZS5vcHRpb25zLml0ZW1zQ3VzdG9tICE9PSBmYWxzZSkgew0KICAgICAgICAgICAgICAgIC8vUmVvcmRlciBhcnJheSBieSBzY3JlZW4gc2l6ZQ0KICAgICAgICAgICAgICAgIGJhc2Uub3B0aW9ucy5pdGVtc0N1c3RvbS5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7IHJldHVybiBhWzBdIC0gYlswXTsgfSk7DQoNCiAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgYmFzZS5vcHRpb25zLml0ZW1zQ3VzdG9tLmxlbmd0aDsgaSArPSAxKSB7DQogICAgICAgICAgICAgICAgICAgIGlmIChiYXNlLm9wdGlvbnMuaXRlbXNDdXN0b21baV1bMF0gPD0gd2lkdGgpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJhc2Uub3B0aW9ucy5pdGVtcyA9IGJhc2Uub3B0aW9ucy5pdGVtc0N1c3RvbVtpXVsxXTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgfSBlbHNlIHsNCg0KICAgICAgICAgICAgICAgIGlmICh3aWR0aCA8PSBiYXNlLm9wdGlvbnMuaXRlbXNEZXNrdG9wWzBdICYmIGJhc2Uub3B0aW9ucy5pdGVtc0Rlc2t0b3AgIT09IGZhbHNlKSB7DQogICAgICAgICAgICAgICAgICAgIGJhc2Uub3B0aW9ucy5pdGVtcyA9IGJhc2Uub3B0aW9ucy5pdGVtc0Rlc2t0b3BbMV07DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgaWYgKHdpZHRoIDw9IGJhc2Uub3B0aW9ucy5pdGVtc0Rlc2t0b3BTbWFsbFswXSAmJiBiYXNlLm9wdGlvbnMuaXRlbXNEZXNrdG9wU21hbGwgIT09IGZhbHNlKSB7DQogICAgICAgICAgICAgICAgICAgIGJhc2Uub3B0aW9ucy5pdGVtcyA9IGJhc2Uub3B0aW9ucy5pdGVtc0Rlc2t0b3BTbWFsbFsxXTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICBpZiAod2lkdGggPD0gYmFzZS5vcHRpb25zLml0ZW1zVGFibGV0WzBdICYmIGJhc2Uub3B0aW9ucy5pdGVtc1RhYmxldCAhPT0gZmFsc2UpIHsNCiAgICAgICAgICAgICAgICAgICAgYmFzZS5vcHRpb25zLml0ZW1zID0gYmFzZS5vcHRpb25zLml0ZW1zVGFibGV0WzFdOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIGlmICh3aWR0aCA8PSBiYXNlLm9wdGlvbnMuaXRlbXNUYWJsZXRTbWFsbFswXSAmJiBiYXNlLm9wdGlvbnMuaXRlbXNUYWJsZXRTbWFsbCAhPT0gZmFsc2UpIHsNCiAgICAgICAgICAgICAgICAgICAgYmFzZS5vcHRpb25zLml0ZW1zID0gYmFzZS5vcHRpb25zLml0ZW1zVGFibGV0U21hbGxbMV07DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgaWYgKHdpZHRoIDw9IGJhc2Uub3B0aW9ucy5pdGVtc01vYmlsZVswXSAmJiBiYXNlLm9wdGlvbnMuaXRlbXNNb2JpbGUgIT09IGZhbHNlKSB7DQogICAgICAgICAgICAgICAgICAgIGJhc2Uub3B0aW9ucy5pdGVtcyA9IGJhc2Uub3B0aW9ucy5pdGVtc01vYmlsZVsxXTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8vaWYgbnVtYmVyIG9mIGl0ZW1zIGlzIGxlc3MgdGhhbiBkZWNsYXJlZA0KICAgICAgICAgICAgaWYgKGJhc2Uub3B0aW9ucy5pdGVtcyA+IGJhc2UuaXRlbXNBbW91bnQgJiYgYmFzZS5vcHRpb25zLml0ZW1zU2NhbGVVcCA9PT0gdHJ1ZSkgew0KICAgICAgICAgICAgICAgIGJhc2Uub3B0aW9ucy5pdGVtcyA9IGJhc2UuaXRlbXNBbW91bnQ7DQogICAgICAgICAgICB9DQogICAgICAgIH0sDQoNCiAgICAgICAgcmVzcG9uc2U6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIHZhciBiYXNlID0gdGhpcywNCiAgICAgICAgICAgICAgICBzbWFsbERlbGF5LA0KICAgICAgICAgICAgICAgIGxhc3RXaW5kb3dXaWR0aDsNCg0KICAgICAgICAgICAgaWYgKGJhc2Uub3B0aW9ucy5yZXNwb25zaXZlICE9PSB0cnVlKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgbGFzdFdpbmRvd1dpZHRoID0gJCh3aW5kb3cpLndpZHRoKCk7DQoNCiAgICAgICAgICAgIGJhc2UucmVzaXplciA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICBpZiAoJCh3aW5kb3cpLndpZHRoKCkgIT09IGxhc3RXaW5kb3dXaWR0aCkgew0KICAgICAgICAgICAgICAgICAgICBpZiAoYmFzZS5vcHRpb25zLmF1dG9QbGF5ICE9PSBmYWxzZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmNsZWFySW50ZXJ2YWwoYmFzZS5hdXRvUGxheUludGVydmFsKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB3aW5kb3cuY2xlYXJUaW1lb3V0KHNtYWxsRGVsYXkpOw0KICAgICAgICAgICAgICAgICAgICBzbWFsbERlbGF5ID0gd2luZG93LnNldFRpbWVvdXQoZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgbGFzdFdpbmRvd1dpZHRoID0gJCh3aW5kb3cpLndpZHRoKCk7DQogICAgICAgICAgICAgICAgICAgICAgICBiYXNlLnVwZGF0ZVZhcnMoKTsNCiAgICAgICAgICAgICAgICAgICAgfSwgYmFzZS5vcHRpb25zLnJlc3BvbnNpdmVSZWZyZXNoUmF0ZSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICQod2luZG93KS5yZXNpemUoYmFzZS5yZXNpemVyKTsNCiAgICAgICAgfSwNCg0KICAgICAgICB1cGRhdGVQb3NpdGlvbjogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgdmFyIGJhc2UgPSB0aGlzOw0KICAgICAgICAgICAgYmFzZS5qdW1wVG8oYmFzZS5jdXJyZW50SXRlbSk7DQogICAgICAgICAgICBpZiAoYmFzZS5vcHRpb25zLmF1dG9QbGF5ICE9PSBmYWxzZSkgew0KICAgICAgICAgICAgICAgIGJhc2UuY2hlY2tBcCgpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9LA0KDQogICAgICAgIGFwcGVuZEl0ZW1zU2l6ZXM6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIHZhciBiYXNlID0gdGhpcywNCiAgICAgICAgICAgICAgICByb3VuZFBhZ2VzID0gMCwNCiAgICAgICAgICAgICAgICBsYXN0SXRlbSA9IGJhc2UuaXRlbXNBbW91bnQgLSBiYXNlLm9wdGlvbnMuaXRlbXM7DQoNCiAgICAgICAgICAgIGJhc2UuJG93bEl0ZW1zLmVhY2goZnVuY3Rpb24gKGluZGV4KSB7DQogICAgICAgICAgICAgICAgdmFyICR0aGlzID0gJCh0aGlzKTsNCiAgICAgICAgICAgICAgICAkdGhpcw0KICAgICAgICAgICAgICAgICAgICAuY3NzKHsgIndpZHRoIjogYmFzZS5pdGVtV2lkdGggfSkNCiAgICAgICAgICAgICAgICAgICAgLmRhdGEoIm93bC1pdGVtIiwgTnVtYmVyKGluZGV4KSk7DQoNCiAgICAgICAgICAgICAgICBpZiAoaW5kZXggJSBiYXNlLm9wdGlvbnMuaXRlbXMgPT09IDAgfHwgaW5kZXggPT09IGxhc3RJdGVtKSB7DQogICAgICAgICAgICAgICAgICAgIGlmICghKGluZGV4ID4gbGFzdEl0ZW0pKSB7DQogICAgICAgICAgICAgICAgICAgICAgICByb3VuZFBhZ2VzICs9IDE7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgJHRoaXMuZGF0YSgib3dsLXJvdW5kUGFnZXMiLCByb3VuZFBhZ2VzKTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9LA0KDQogICAgICAgIGFwcGVuZFdyYXBwZXJTaXplczogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgdmFyIGJhc2UgPSB0aGlzLA0KICAgICAgICAgICAgICAgIHdpZHRoID0gYmFzZS4kb3dsSXRlbXMubGVuZ3RoICogYmFzZS5pdGVtV2lkdGg7DQoNCiAgICAgICAgICAgIGJhc2UuJG93bFdyYXBwZXIuY3NzKHsNCiAgICAgICAgICAgICAgICAid2lkdGgiOiB3aWR0aCAqIDIsDQogICAgICAgICAgICAgICAgImxlZnQiOiAwDQogICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIGJhc2UuYXBwZW5kSXRlbXNTaXplcygpOw0KICAgICAgICB9LA0KDQogICAgICAgIGNhbGN1bGF0ZUFsbDogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgdmFyIGJhc2UgPSB0aGlzOw0KICAgICAgICAgICAgYmFzZS5jYWxjdWxhdGVXaWR0aCgpOw0KICAgICAgICAgICAgYmFzZS5hcHBlbmRXcmFwcGVyU2l6ZXMoKTsNCiAgICAgICAgICAgIGJhc2UubG9vcHMoKTsNCiAgICAgICAgICAgIGJhc2UubWF4KCk7DQogICAgICAgIH0sDQoNCiAgICAgICAgY2FsY3VsYXRlV2lkdGg6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIHZhciBiYXNlID0gdGhpczsNCiAgICAgICAgICAgIGJhc2UuaXRlbVdpZHRoID0gTWF0aC5yb3VuZChiYXNlLiRlbGVtLndpZHRoKCkgLyBiYXNlLm9wdGlvbnMuaXRlbXMpOw0KICAgICAgICB9LA0KDQogICAgICAgIG1heDogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgdmFyIGJhc2UgPSB0aGlzLA0KICAgICAgICAgICAgICAgIG1heGltdW0gPSAoKGJhc2UuaXRlbXNBbW91bnQgKiBiYXNlLml0ZW1XaWR0aCkgLSBiYXNlLm9wdGlvbnMuaXRlbXMgKiBiYXNlLml0ZW1XaWR0aCkgKiAtMTsNCiAgICAgICAgICAgIGlmIChiYXNlLm9wdGlvbnMuaXRlbXMgPiBiYXNlLml0ZW1zQW1vdW50KSB7DQogICAgICAgICAgICAgICAgYmFzZS5tYXhpbXVtSXRlbSA9IDA7DQogICAgICAgICAgICAgICAgbWF4aW11bSA9IDA7DQogICAgICAgICAgICAgICAgYmFzZS5tYXhpbXVtUGl4ZWxzID0gMDsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgYmFzZS5tYXhpbXVtSXRlbSA9IGJhc2UuaXRlbXNBbW91bnQgLSBiYXNlLm9wdGlvbnMuaXRlbXM7DQogICAgICAgICAgICAgICAgYmFzZS5tYXhpbXVtUGl4ZWxzID0gbWF4aW11bTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBtYXhpbXVtOw0KICAgICAgICB9LA0KDQogICAgICAgIG1pbjogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgcmV0dXJuIDA7DQogICAgICAgIH0sDQoNCiAgICAgICAgbG9vcHM6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIHZhciBiYXNlID0gdGhpcywNCiAgICAgICAgICAgICAgICBwcmV2ID0gMCwNCiAgICAgICAgICAgICAgICBlbFdpZHRoID0gMCwNCiAgICAgICAgICAgICAgICBpLA0KICAgICAgICAgICAgICAgIGl0ZW0sDQogICAgICAgICAgICAgICAgcm91bmRQYWdlTnVtOw0KDQogICAgICAgICAgICBiYXNlLnBvc2l0aW9uc0luQXJyYXkgPSBbMF07DQogICAgICAgICAgICBiYXNlLnBhZ2VzSW5BcnJheSA9IFtdOw0KDQogICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgYmFzZS5pdGVtc0Ftb3VudDsgaSArPSAxKSB7DQogICAgICAgICAgICAgICAgZWxXaWR0aCArPSBiYXNlLml0ZW1XaWR0aDsNCiAgICAgICAgICAgICAgICBiYXNlLnBvc2l0aW9uc0luQXJyYXkucHVzaCgtZWxXaWR0aCk7DQoNCiAgICAgICAgICAgICAgICBpZiAoYmFzZS5vcHRpb25zLnNjcm9sbFBlclBhZ2UgPT09IHRydWUpIHsNCiAgICAgICAgICAgICAgICAgICAgaXRlbSA9ICQoYmFzZS4kb3dsSXRlbXNbaV0pOw0KICAgICAgICAgICAgICAgICAgICByb3VuZFBhZ2VOdW0gPSBpdGVtLmRhdGEoIm93bC1yb3VuZFBhZ2VzIik7DQogICAgICAgICAgICAgICAgICAgIGlmIChyb3VuZFBhZ2VOdW0gIT09IHByZXYpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJhc2UucGFnZXNJbkFycmF5W3ByZXZdID0gYmFzZS5wb3NpdGlvbnNJbkFycmF5W2ldOw0KICAgICAgICAgICAgICAgICAgICAgICAgcHJldiA9IHJvdW5kUGFnZU51bTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfSwNCg0KICAgICAgICBidWlsZENvbnRyb2xzOiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICB2YXIgYmFzZSA9IHRoaXM7DQogICAgICAgICAgICBpZiAoYmFzZS5vcHRpb25zLm5hdmlnYXRpb24gPT09IHRydWUgfHwgYmFzZS5vcHRpb25zLnBhZ2luYXRpb24gPT09IHRydWUpIHsNCiAgICAgICAgICAgICAgICBiYXNlLm93bENvbnRyb2xzID0gJCgiPGRpdiBjbGFzcz1cIm93bC1jb250cm9sc1wiLz4iKS50b2dnbGVDbGFzcygiY2xpY2thYmxlIiwgIWJhc2UuYnJvd3Nlci5pc1RvdWNoKS5hcHBlbmRUbyhiYXNlLiRlbGVtKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChiYXNlLm9wdGlvbnMucGFnaW5hdGlvbiA9PT0gdHJ1ZSkgew0KICAgICAgICAgICAgICAgIGJhc2UuYnVpbGRQYWdpbmF0aW9uKCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoYmFzZS5vcHRpb25zLm5hdmlnYXRpb24gPT09IHRydWUpIHsNCiAgICAgICAgICAgICAgICBiYXNlLmJ1aWxkQnV0dG9ucygpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9LA0KDQogICAgICAgIGJ1aWxkQnV0dG9uczogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgdmFyIGJhc2UgPSB0aGlzLA0KICAgICAgICAgICAgICAgIGJ1dHRvbnNXcmFwcGVyID0gJCgiPGRpdiBjbGFzcz1cIm93bC1idXR0b25zXCIvPiIpOw0KICAgICAgICAgICAgYmFzZS5vd2xDb250cm9scy5hcHBlbmQoYnV0dG9uc1dyYXBwZXIpOw0KDQogICAgICAgICAgICBiYXNlLmJ1dHRvblByZXYgPSAkKCI8ZGl2Lz4iLCB7DQogICAgICAgICAgICAgICAgImNsYXNzIjogIm93bC1wcmV2IiwNCiAgICAgICAgICAgICAgICAiaHRtbCI6IGJhc2Uub3B0aW9ucy5uYXZpZ2F0aW9uVGV4dFswXSB8fCAiIg0KICAgICAgICAgICAgfSk7DQoNCiAgICAgICAgICAgIGJhc2UuYnV0dG9uTmV4dCA9ICQoIjxkaXYvPiIsIHsNCiAgICAgICAgICAgICAgICAiY2xhc3MiOiAib3dsLW5leHQiLA0KICAgICAgICAgICAgICAgICJodG1sIjogYmFzZS5vcHRpb25zLm5hdmlnYXRpb25UZXh0WzFdIHx8ICIiDQogICAgICAgICAgICB9KTsNCg0KICAgICAgICAgICAgYnV0dG9uc1dyYXBwZXINCiAgICAgICAgICAgICAgICAuYXBwZW5kKGJhc2UuYnV0dG9uUHJldikNCiAgICAgICAgICAgICAgICAuYXBwZW5kKGJhc2UuYnV0dG9uTmV4dCk7DQoNCiAgICAgICAgICAgIGJ1dHRvbnNXcmFwcGVyLm9uKCJ0b3VjaHN0YXJ0Lm93bENvbnRyb2xzIG1vdXNlZG93bi5vd2xDb250cm9scyIsICJkaXZbY2xhc3NePVwib3dsXCJdIiwgZnVuY3Rpb24gKGV2ZW50KSB7DQogICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsNCiAgICAgICAgICAgIH0pOw0KDQogICAgICAgICAgICBidXR0b25zV3JhcHBlci5vbigidG91Y2hlbmQub3dsQ29udHJvbHMgbW91c2V1cC5vd2xDb250cm9scyIsICJkaXZbY2xhc3NePVwib3dsXCJdIiwgZnVuY3Rpb24gKGV2ZW50KSB7DQogICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsNCiAgICAgICAgICAgICAgICBpZiAoJCh0aGlzKS5oYXNDbGFzcygib3dsLW5leHQiKSkgew0KICAgICAgICAgICAgICAgICAgICBiYXNlLm5leHQoKTsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBiYXNlLnByZXYoKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfSwNCg0KICAgICAgICBidWlsZFBhZ2luYXRpb246IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIHZhciBiYXNlID0gdGhpczsNCg0KICAgICAgICAgICAgYmFzZS5wYWdpbmF0aW9uV3JhcHBlciA9ICQoIjxkaXYgY2xhc3M9XCJvd2wtcGFnaW5hdGlvblwiLz4iKTsNCiAgICAgICAgICAgIGJhc2Uub3dsQ29udHJvbHMuYXBwZW5kKGJhc2UucGFnaW5hdGlvbldyYXBwZXIpOw0KDQogICAgICAgICAgICBiYXNlLnBhZ2luYXRpb25XcmFwcGVyLm9uKCJ0b3VjaGVuZC5vd2xDb250cm9scyBtb3VzZXVwLm93bENvbnRyb2xzIiwgIi5vd2wtcGFnZSIsIGZ1bmN0aW9uIChldmVudCkgew0KICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7DQogICAgICAgICAgICAgICAgaWYgKE51bWJlcigkKHRoaXMpLmRhdGEoIm93bC1wYWdlIikpICE9PSBiYXNlLmN1cnJlbnRJdGVtKSB7DQogICAgICAgICAgICAgICAgICAgIGJhc2UuZ29UbyhOdW1iZXIoJCh0aGlzKS5kYXRhKCJvd2wtcGFnZSIpKSwgdHJ1ZSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0sDQoNCiAgICAgICAgdXBkYXRlUGFnaW5hdGlvbjogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgdmFyIGJhc2UgPSB0aGlzLA0KICAgICAgICAgICAgICAgIGNvdW50ZXIsDQogICAgICAgICAgICAgICAgbGFzdFBhZ2UsDQogICAgICAgICAgICAgICAgbGFzdEl0ZW0sDQogICAgICAgICAgICAgICAgaSwNCiAgICAgICAgICAgICAgICBwYWdpbmF0aW9uQnV0dG9uLA0KICAgICAgICAgICAgICAgIHBhZ2luYXRpb25CdXR0b25Jbm5lcjsNCg0KICAgICAgICAgICAgaWYgKGJhc2Uub3B0aW9ucy5wYWdpbmF0aW9uID09PSBmYWxzZSkgew0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgYmFzZS5wYWdpbmF0aW9uV3JhcHBlci5odG1sKCIiKTsNCg0KICAgICAgICAgICAgY291bnRlciA9IDA7DQogICAgICAgICAgICBsYXN0UGFnZSA9IGJhc2UuaXRlbXNBbW91bnQgLSBiYXNlLml0ZW1zQW1vdW50ICUgYmFzZS5vcHRpb25zLml0ZW1zOw0KDQogICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgYmFzZS5pdGVtc0Ftb3VudDsgaSArPSAxKSB7DQogICAgICAgICAgICAgICAgaWYgKGkgJSBiYXNlLm9wdGlvbnMuaXRlbXMgPT09IDApIHsNCiAgICAgICAgICAgICAgICAgICAgY291bnRlciArPSAxOw0KICAgICAgICAgICAgICAgICAgICBpZiAobGFzdFBhZ2UgPT09IGkpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RJdGVtID0gYmFzZS5pdGVtc0Ftb3VudCAtIGJhc2Uub3B0aW9ucy5pdGVtczsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBwYWdpbmF0aW9uQnV0dG9uID0gJCgiPGRpdi8+Iiwgew0KICAgICAgICAgICAgICAgICAgICAgICAgImNsYXNzIjogIm93bC1wYWdlIg0KICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICAgICAgcGFnaW5hdGlvbkJ1dHRvbklubmVyID0gJCgiPHNwYW4+PC9zcGFuPiIsIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICJ0ZXh0IjogYmFzZS5vcHRpb25zLnBhZ2luYXRpb25OdW1iZXJzID09PSB0cnVlID8gY291bnRlciA6ICIiLA0KICAgICAgICAgICAgICAgICAgICAgICAgImNsYXNzIjogYmFzZS5vcHRpb25zLnBhZ2luYXRpb25OdW1iZXJzID09PSB0cnVlID8gIm93bC1udW1iZXJzIiA6ICIiDQogICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgICAgICBwYWdpbmF0aW9uQnV0dG9uLmFwcGVuZChwYWdpbmF0aW9uQnV0dG9uSW5uZXIpOw0KDQogICAgICAgICAgICAgICAgICAgIHBhZ2luYXRpb25CdXR0b24uZGF0YSgib3dsLXBhZ2UiLCBsYXN0UGFnZSA9PT0gaSA/IGxhc3RJdGVtIDogaSk7DQogICAgICAgICAgICAgICAgICAgIHBhZ2luYXRpb25CdXR0b24uZGF0YSgib3dsLXJvdW5kUGFnZXMiLCBjb3VudGVyKTsNCg0KICAgICAgICAgICAgICAgICAgICBiYXNlLnBhZ2luYXRpb25XcmFwcGVyLmFwcGVuZChwYWdpbmF0aW9uQnV0dG9uKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBiYXNlLmNoZWNrUGFnaW5hdGlvbigpOw0KICAgICAgICB9LA0KICAgICAgICBjaGVja1BhZ2luYXRpb246IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIHZhciBiYXNlID0gdGhpczsNCiAgICAgICAgICAgIGlmIChiYXNlLm9wdGlvbnMucGFnaW5hdGlvbiA9PT0gZmFsc2UpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBiYXNlLnBhZ2luYXRpb25XcmFwcGVyLmZpbmQoIi5vd2wtcGFnZSIpLmVhY2goZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgIGlmICgkKHRoaXMpLmRhdGEoIm93bC1yb3VuZFBhZ2VzIikgPT09ICQoYmFzZS4kb3dsSXRlbXNbYmFzZS5jdXJyZW50SXRlbV0pLmRhdGEoIm93bC1yb3VuZFBhZ2VzIikpIHsNCiAgICAgICAgICAgICAgICAgICAgYmFzZS5wYWdpbmF0aW9uV3JhcHBlcg0KICAgICAgICAgICAgICAgICAgICAgICAgLmZpbmQoIi5vd2wtcGFnZSIpDQogICAgICAgICAgICAgICAgICAgICAgICAucmVtb3ZlQ2xhc3MoImFjdGl2ZSIpOw0KICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLmFkZENsYXNzKCJhY3RpdmUiKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfSwNCg0KICAgICAgICBjaGVja05hdmlnYXRpb246IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIHZhciBiYXNlID0gdGhpczsNCg0KICAgICAgICAgICAgaWYgKGJhc2Uub3B0aW9ucy5uYXZpZ2F0aW9uID09PSBmYWxzZSkgew0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChiYXNlLm9wdGlvbnMucmV3aW5kTmF2ID09PSBmYWxzZSkgew0KICAgICAgICAgICAgICAgIGlmIChiYXNlLmN1cnJlbnRJdGVtID09PSAwICYmIGJhc2UubWF4aW11bUl0ZW0gPT09IDApIHsNCiAgICAgICAgICAgICAgICAgICAgYmFzZS5idXR0b25QcmV2LmFkZENsYXNzKCJkaXNhYmxlZCIpOw0KICAgICAgICAgICAgICAgICAgICBiYXNlLmJ1dHRvbk5leHQuYWRkQ2xhc3MoImRpc2FibGVkIik7DQogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChiYXNlLmN1cnJlbnRJdGVtID09PSAwICYmIGJhc2UubWF4aW11bUl0ZW0gIT09IDApIHsNCiAgICAgICAgICAgICAgICAgICAgYmFzZS5idXR0b25QcmV2LmFkZENsYXNzKCJkaXNhYmxlZCIpOw0KICAgICAgICAgICAgICAgICAgICBiYXNlLmJ1dHRvbk5leHQucmVtb3ZlQ2xhc3MoImRpc2FibGVkIik7DQogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChiYXNlLmN1cnJlbnRJdGVtID09PSBiYXNlLm1heGltdW1JdGVtKSB7DQogICAgICAgICAgICAgICAgICAgIGJhc2UuYnV0dG9uUHJldi5yZW1vdmVDbGFzcygiZGlzYWJsZWQiKTsNCiAgICAgICAgICAgICAgICAgICAgYmFzZS5idXR0b25OZXh0LmFkZENsYXNzKCJkaXNhYmxlZCIpOw0KICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoYmFzZS5jdXJyZW50SXRlbSAhPT0gMCAmJiBiYXNlLmN1cnJlbnRJdGVtICE9PSBiYXNlLm1heGltdW1JdGVtKSB7DQogICAgICAgICAgICAgICAgICAgIGJhc2UuYnV0dG9uUHJldi5yZW1vdmVDbGFzcygiZGlzYWJsZWQiKTsNCiAgICAgICAgICAgICAgICAgICAgYmFzZS5idXR0b25OZXh0LnJlbW92ZUNsYXNzKCJkaXNhYmxlZCIpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfSwNCg0KICAgICAgICB1cGRhdGVDb250cm9sczogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgdmFyIGJhc2UgPSB0aGlzOw0KICAgICAgICAgICAgYmFzZS51cGRhdGVQYWdpbmF0aW9uKCk7DQogICAgICAgICAgICBiYXNlLmNoZWNrTmF2aWdhdGlvbigpOw0KICAgICAgICAgICAgaWYgKGJhc2Uub3dsQ29udHJvbHMpIHsNCiAgICAgICAgICAgICAgICBpZiAoYmFzZS5vcHRpb25zLml0ZW1zID49IGJhc2UuaXRlbXNBbW91bnQpIHsNCiAgICAgICAgICAgICAgICAgICAgYmFzZS5vd2xDb250cm9scy5oaWRlKCk7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgYmFzZS5vd2xDb250cm9scy5zaG93KCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9LA0KDQogICAgICAgIGRlc3Ryb3lDb250cm9sczogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgdmFyIGJhc2UgPSB0aGlzOw0KICAgICAgICAgICAgaWYgKGJhc2Uub3dsQ29udHJvbHMpIHsNCiAgICAgICAgICAgICAgICBiYXNlLm93bENvbnRyb2xzLnJlbW92ZSgpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9LA0KDQogICAgICAgIG5leHQ6IGZ1bmN0aW9uIChzcGVlZCkgew0KICAgICAgICAgICAgdmFyIGJhc2UgPSB0aGlzOw0KDQogICAgICAgICAgICBpZiAoYmFzZS5pc1RyYW5zaXRpb24pIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGJhc2UuY3VycmVudEl0ZW0gKz0gYmFzZS5vcHRpb25zLnNjcm9sbFBlclBhZ2UgPT09IHRydWUgPyBiYXNlLm9wdGlvbnMuaXRlbXMgOiAxOw0KICAgICAgICAgICAgaWYgKGJhc2UuY3VycmVudEl0ZW0gPiBiYXNlLm1heGltdW1JdGVtICsgKGJhc2Uub3B0aW9ucy5zY3JvbGxQZXJQYWdlID09PSB0cnVlID8gKGJhc2Uub3B0aW9ucy5pdGVtcyAtIDEpIDogMCkpIHsNCiAgICAgICAgICAgICAgICBpZiAoYmFzZS5vcHRpb25zLnJld2luZE5hdiA9PT0gdHJ1ZSkgew0KICAgICAgICAgICAgICAgICAgICBiYXNlLmN1cnJlbnRJdGVtID0gMDsNCiAgICAgICAgICAgICAgICAgICAgc3BlZWQgPSAicmV3aW5kIjsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBiYXNlLmN1cnJlbnRJdGVtID0gYmFzZS5tYXhpbXVtSXRlbTsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGJhc2UuZ29UbyhiYXNlLmN1cnJlbnRJdGVtLCBzcGVlZCk7DQogICAgICAgIH0sDQoNCiAgICAgICAgcHJldjogZnVuY3Rpb24gKHNwZWVkKSB7DQogICAgICAgICAgICB2YXIgYmFzZSA9IHRoaXM7DQoNCiAgICAgICAgICAgIGlmIChiYXNlLmlzVHJhbnNpdGlvbikgew0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYgKGJhc2Uub3B0aW9ucy5zY3JvbGxQZXJQYWdlID09PSB0cnVlICYmIGJhc2UuY3VycmVudEl0ZW0gPiAwICYmIGJhc2UuY3VycmVudEl0ZW0gPCBiYXNlLm9wdGlvbnMuaXRlbXMpIHsNCiAgICAgICAgICAgICAgICBiYXNlLmN1cnJlbnRJdGVtID0gMDsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgYmFzZS5jdXJyZW50SXRlbSAtPSBiYXNlLm9wdGlvbnMuc2Nyb2xsUGVyUGFnZSA9PT0gdHJ1ZSA/IGJhc2Uub3B0aW9ucy5pdGVtcyA6IDE7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoYmFzZS5jdXJyZW50SXRlbSA8IDApIHsNCiAgICAgICAgICAgICAgICBpZiAoYmFzZS5vcHRpb25zLnJld2luZE5hdiA9PT0gdHJ1ZSkgew0KICAgICAgICAgICAgICAgICAgICBiYXNlLmN1cnJlbnRJdGVtID0gYmFzZS5tYXhpbXVtSXRlbTsNCiAgICAgICAgICAgICAgICAgICAgc3BlZWQgPSAicmV3aW5kIjsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBiYXNlLmN1cnJlbnRJdGVtID0gMDsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGJhc2UuZ29UbyhiYXNlLmN1cnJlbnRJdGVtLCBzcGVlZCk7DQogICAgICAgIH0sDQoNCiAgICAgICAgZ29UbzogZnVuY3Rpb24gKHBvc2l0aW9uLCBzcGVlZCwgZHJhZykgew0KICAgICAgICAgICAgdmFyIGJhc2UgPSB0aGlzLA0KICAgICAgICAgICAgICAgIGdvVG9QaXhlbDsNCg0KICAgICAgICAgICAgaWYgKGJhc2UuaXNUcmFuc2l0aW9uKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKHR5cGVvZiBiYXNlLm9wdGlvbnMuYmVmb3JlTW92ZSA9PT0gImZ1bmN0aW9uIikgew0KICAgICAgICAgICAgICAgIGJhc2Uub3B0aW9ucy5iZWZvcmVNb3ZlLmFwcGx5KHRoaXMsIFtiYXNlLiRlbGVtXSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAocG9zaXRpb24gPj0gYmFzZS5tYXhpbXVtSXRlbSkgew0KICAgICAgICAgICAgICAgIHBvc2l0aW9uID0gYmFzZS5tYXhpbXVtSXRlbTsNCiAgICAgICAgICAgIH0gZWxzZSBpZiAocG9zaXRpb24gPD0gMCkgew0KICAgICAgICAgICAgICAgIHBvc2l0aW9uID0gMDsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgYmFzZS5jdXJyZW50SXRlbSA9IGJhc2Uub3dsLmN1cnJlbnRJdGVtID0gcG9zaXRpb247DQogICAgICAgICAgICBpZiAoYmFzZS5vcHRpb25zLnRyYW5zaXRpb25TdHlsZSAhPT0gZmFsc2UgJiYgZHJhZyAhPT0gImRyYWciICYmIGJhc2Uub3B0aW9ucy5pdGVtcyA9PT0gMSAmJiBiYXNlLmJyb3dzZXIuc3VwcG9ydDNkID09PSB0cnVlKSB7DQogICAgICAgICAgICAgICAgYmFzZS5zd2FwU3BlZWQoMCk7DQogICAgICAgICAgICAgICAgaWYgKGJhc2UuYnJvd3Nlci5zdXBwb3J0M2QgPT09IHRydWUpIHsNCiAgICAgICAgICAgICAgICAgICAgYmFzZS50cmFuc2l0aW9uM2QoYmFzZS5wb3NpdGlvbnNJbkFycmF5W3Bvc2l0aW9uXSk7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgYmFzZS5jc3Myc2xpZGUoYmFzZS5wb3NpdGlvbnNJbkFycmF5W3Bvc2l0aW9uXSwgMSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGJhc2UuYWZ0ZXJHbygpOw0KICAgICAgICAgICAgICAgIGJhc2Uuc2luZ2xlSXRlbVRyYW5zaXRpb24oKTsNCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBnb1RvUGl4ZWwgPSBiYXNlLnBvc2l0aW9uc0luQXJyYXlbcG9zaXRpb25dOw0KDQogICAgICAgICAgICBpZiAoYmFzZS5icm93c2VyLnN1cHBvcnQzZCA9PT0gdHJ1ZSkgew0KICAgICAgICAgICAgICAgIGJhc2UuaXNDc3MzRmluaXNoID0gZmFsc2U7DQoNCiAgICAgICAgICAgICAgICBpZiAoc3BlZWQgPT09IHRydWUpIHsNCiAgICAgICAgICAgICAgICAgICAgYmFzZS5zd2FwU3BlZWQoInBhZ2luYXRpb25TcGVlZCIpOw0KICAgICAgICAgICAgICAgICAgICB3aW5kb3cuc2V0VGltZW91dChmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBiYXNlLmlzQ3NzM0ZpbmlzaCA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgIH0sIGJhc2Uub3B0aW9ucy5wYWdpbmF0aW9uU3BlZWQpOw0KDQogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChzcGVlZCA9PT0gInJld2luZCIpIHsNCiAgICAgICAgICAgICAgICAgICAgYmFzZS5zd2FwU3BlZWQoYmFzZS5vcHRpb25zLnJld2luZFNwZWVkKTsNCiAgICAgICAgICAgICAgICAgICAgd2luZG93LnNldFRpbWVvdXQoZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgYmFzZS5pc0NzczNGaW5pc2ggPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICB9LCBiYXNlLm9wdGlvbnMucmV3aW5kU3BlZWQpOw0KDQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgYmFzZS5zd2FwU3BlZWQoInNsaWRlU3BlZWQiKTsNCiAgICAgICAgICAgICAgICAgICAgd2luZG93LnNldFRpbWVvdXQoZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgYmFzZS5pc0NzczNGaW5pc2ggPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICB9LCBiYXNlLm9wdGlvbnMuc2xpZGVTcGVlZCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGJhc2UudHJhbnNpdGlvbjNkKGdvVG9QaXhlbCk7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIGlmIChzcGVlZCA9PT0gdHJ1ZSkgew0KICAgICAgICAgICAgICAgICAgICBiYXNlLmNzczJzbGlkZShnb1RvUGl4ZWwsIGJhc2Uub3B0aW9ucy5wYWdpbmF0aW9uU3BlZWQpOw0KICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoc3BlZWQgPT09ICJyZXdpbmQiKSB7DQogICAgICAgICAgICAgICAgICAgIGJhc2UuY3NzMnNsaWRlKGdvVG9QaXhlbCwgYmFzZS5vcHRpb25zLnJld2luZFNwZWVkKTsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBiYXNlLmNzczJzbGlkZShnb1RvUGl4ZWwsIGJhc2Uub3B0aW9ucy5zbGlkZVNwZWVkKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBiYXNlLmFmdGVyR28oKTsNCiAgICAgICAgfSwNCg0KICAgICAgICBqdW1wVG86IGZ1bmN0aW9uIChwb3NpdGlvbikgew0KICAgICAgICAgICAgdmFyIGJhc2UgPSB0aGlzOw0KICAgICAgICAgICAgaWYgKHR5cGVvZiBiYXNlLm9wdGlvbnMuYmVmb3JlTW92ZSA9PT0gImZ1bmN0aW9uIikgew0KICAgICAgICAgICAgICAgIGJhc2Uub3B0aW9ucy5iZWZvcmVNb3ZlLmFwcGx5KHRoaXMsIFtiYXNlLiRlbGVtXSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAocG9zaXRpb24gPj0gYmFzZS5tYXhpbXVtSXRlbSB8fCBwb3NpdGlvbiA9PT0gLTEpIHsNCiAgICAgICAgICAgICAgICBwb3NpdGlvbiA9IGJhc2UubWF4aW11bUl0ZW07DQogICAgICAgICAgICB9IGVsc2UgaWYgKHBvc2l0aW9uIDw9IDApIHsNCiAgICAgICAgICAgICAgICBwb3NpdGlvbiA9IDA7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBiYXNlLnN3YXBTcGVlZCgwKTsNCiAgICAgICAgICAgIGlmIChiYXNlLmJyb3dzZXIuc3VwcG9ydDNkID09PSB0cnVlKSB7DQogICAgICAgICAgICAgICAgYmFzZS50cmFuc2l0aW9uM2QoYmFzZS5wb3NpdGlvbnNJbkFycmF5W3Bvc2l0aW9uXSk7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIGJhc2UuY3NzMnNsaWRlKGJhc2UucG9zaXRpb25zSW5BcnJheVtwb3NpdGlvbl0sIDEpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgYmFzZS5jdXJyZW50SXRlbSA9IGJhc2Uub3dsLmN1cnJlbnRJdGVtID0gcG9zaXRpb247DQogICAgICAgICAgICBiYXNlLmFmdGVyR28oKTsNCiAgICAgICAgfSwNCg0KICAgICAgICBhZnRlckdvOiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICB2YXIgYmFzZSA9IHRoaXM7DQoNCiAgICAgICAgICAgIGJhc2UucHJldkFyci5wdXNoKGJhc2UuY3VycmVudEl0ZW0pOw0KICAgICAgICAgICAgYmFzZS5wcmV2SXRlbSA9IGJhc2Uub3dsLnByZXZJdGVtID0gYmFzZS5wcmV2QXJyW2Jhc2UucHJldkFyci5sZW5ndGggLSAyXTsNCiAgICAgICAgICAgIGJhc2UucHJldkFyci5zaGlmdCgwKTsNCg0KICAgICAgICAgICAgaWYgKGJhc2UucHJldkl0ZW0gIT09IGJhc2UuY3VycmVudEl0ZW0pIHsNCiAgICAgICAgICAgICAgICBiYXNlLmNoZWNrUGFnaW5hdGlvbigpOw0KICAgICAgICAgICAgICAgIGJhc2UuY2hlY2tOYXZpZ2F0aW9uKCk7DQogICAgICAgICAgICAgICAgYmFzZS5lYWNoTW92ZVVwZGF0ZSgpOw0KDQogICAgICAgICAgICAgICAgaWYgKGJhc2Uub3B0aW9ucy5hdXRvUGxheSAhPT0gZmFsc2UpIHsNCiAgICAgICAgICAgICAgICAgICAgYmFzZS5jaGVja0FwKCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKHR5cGVvZiBiYXNlLm9wdGlvbnMuYWZ0ZXJNb3ZlID09PSAiZnVuY3Rpb24iICYmIGJhc2UucHJldkl0ZW0gIT09IGJhc2UuY3VycmVudEl0ZW0pIHsNCiAgICAgICAgICAgICAgICBiYXNlLm9wdGlvbnMuYWZ0ZXJNb3ZlLmFwcGx5KHRoaXMsIFtiYXNlLiRlbGVtXSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0sDQoNCiAgICAgICAgc3RvcDogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgdmFyIGJhc2UgPSB0aGlzOw0KICAgICAgICAgICAgYmFzZS5hcFN0YXR1cyA9ICJzdG9wIjsNCiAgICAgICAgICAgIHdpbmRvdy5jbGVhckludGVydmFsKGJhc2UuYXV0b1BsYXlJbnRlcnZhbCk7DQogICAgICAgIH0sDQoNCiAgICAgICAgY2hlY2tBcDogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgdmFyIGJhc2UgPSB0aGlzOw0KICAgICAgICAgICAgaWYgKGJhc2UuYXBTdGF0dXMgIT09ICJzdG9wIikgew0KICAgICAgICAgICAgICAgIGJhc2UucGxheSgpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9LA0KDQogICAgICAgIHBsYXk6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIHZhciBiYXNlID0gdGhpczsNCiAgICAgICAgICAgIGJhc2UuYXBTdGF0dXMgPSAicGxheSI7DQogICAgICAgICAgICBpZiAoYmFzZS5vcHRpb25zLmF1dG9QbGF5ID09PSBmYWxzZSkgew0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHdpbmRvdy5jbGVhckludGVydmFsKGJhc2UuYXV0b1BsYXlJbnRlcnZhbCk7DQogICAgICAgICAgICBiYXNlLmF1dG9QbGF5SW50ZXJ2YWwgPSB3aW5kb3cuc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgIGJhc2UubmV4dCh0cnVlKTsNCiAgICAgICAgICAgIH0sIGJhc2Uub3B0aW9ucy5hdXRvUGxheSk7DQogICAgICAgIH0sDQoNCiAgICAgICAgc3dhcFNwZWVkOiBmdW5jdGlvbiAoYWN0aW9uKSB7DQogICAgICAgICAgICB2YXIgYmFzZSA9IHRoaXM7DQogICAgICAgICAgICBpZiAoYWN0aW9uID09PSAic2xpZGVTcGVlZCIpIHsNCiAgICAgICAgICAgICAgICBiYXNlLiRvd2xXcmFwcGVyLmNzcyhiYXNlLmFkZENzc1NwZWVkKGJhc2Uub3B0aW9ucy5zbGlkZVNwZWVkKSk7DQogICAgICAgICAgICB9IGVsc2UgaWYgKGFjdGlvbiA9PT0gInBhZ2luYXRpb25TcGVlZCIpIHsNCiAgICAgICAgICAgICAgICBiYXNlLiRvd2xXcmFwcGVyLmNzcyhiYXNlLmFkZENzc1NwZWVkKGJhc2Uub3B0aW9ucy5wYWdpbmF0aW9uU3BlZWQpKTsNCiAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGFjdGlvbiAhPT0gInN0cmluZyIpIHsNCiAgICAgICAgICAgICAgICBiYXNlLiRvd2xXcmFwcGVyLmNzcyhiYXNlLmFkZENzc1NwZWVkKGFjdGlvbikpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9LA0KDQogICAgICAgIGFkZENzc1NwZWVkOiBmdW5jdGlvbiAoc3BlZWQpIHsNCiAgICAgICAgICAgIHJldHVybiB7DQogICAgICAgICAgICAgICAgIi13ZWJraXQtdHJhbnNpdGlvbiI6ICJhbGwgIiArIHNwZWVkICsgIm1zIGVhc2UiLA0KICAgICAgICAgICAgICAgICItbW96LXRyYW5zaXRpb24iOiAiYWxsICIgKyBzcGVlZCArICJtcyBlYXNlIiwNCiAgICAgICAgICAgICAgICAiLW8tdHJhbnNpdGlvbiI6ICJhbGwgIiArIHNwZWVkICsgIm1zIGVhc2UiLA0KICAgICAgICAgICAgICAgICJ0cmFuc2l0aW9uIjogImFsbCAiICsgc3BlZWQgKyAibXMgZWFzZSINCiAgICAgICAgICAgIH07DQogICAgICAgIH0sDQoNCiAgICAgICAgcmVtb3ZlVHJhbnNpdGlvbjogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICAgICAgICAiLXdlYmtpdC10cmFuc2l0aW9uIjogIiIsDQogICAgICAgICAgICAgICAgIi1tb3otdHJhbnNpdGlvbiI6ICIiLA0KICAgICAgICAgICAgICAgICItby10cmFuc2l0aW9uIjogIiIsDQogICAgICAgICAgICAgICAgInRyYW5zaXRpb24iOiAiIg0KICAgICAgICAgICAgfTsNCiAgICAgICAgfSwNCg0KICAgICAgICBkb1RyYW5zbGF0ZTogZnVuY3Rpb24gKHBpeGVscykgew0KICAgICAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICAgICAgICAiLXdlYmtpdC10cmFuc2Zvcm0iOiAidHJhbnNsYXRlM2QoIiArIHBpeGVscyArICJweCwgMHB4LCAwcHgpIiwNCiAgICAgICAgICAgICAgICAiLW1vei10cmFuc2Zvcm0iOiAidHJhbnNsYXRlM2QoIiArIHBpeGVscyArICJweCwgMHB4LCAwcHgpIiwNCiAgICAgICAgICAgICAgICAiLW8tdHJhbnNmb3JtIjogInRyYW5zbGF0ZTNkKCIgKyBwaXhlbHMgKyAicHgsIDBweCwgMHB4KSIsDQogICAgICAgICAgICAgICAgIi1tcy10cmFuc2Zvcm0iOiAidHJhbnNsYXRlM2QoIiArIHBpeGVscyArICJweCwgMHB4LCAwcHgpIiwNCiAgICAgICAgICAgICAgICAidHJhbnNmb3JtIjogInRyYW5zbGF0ZTNkKCIgKyBwaXhlbHMgKyAicHgsIDBweCwwcHgpIg0KICAgICAgICAgICAgfTsNCiAgICAgICAgfSwNCg0KICAgICAgICB0cmFuc2l0aW9uM2Q6IGZ1bmN0aW9uICh2YWx1ZSkgew0KICAgICAgICAgICAgdmFyIGJhc2UgPSB0aGlzOw0KICAgICAgICAgICAgYmFzZS4kb3dsV3JhcHBlci5jc3MoYmFzZS5kb1RyYW5zbGF0ZSh2YWx1ZSkpOw0KICAgICAgICB9LA0KDQogICAgICAgIGNzczJtb3ZlOiBmdW5jdGlvbiAodmFsdWUpIHsNCiAgICAgICAgICAgIHZhciBiYXNlID0gdGhpczsNCiAgICAgICAgICAgIGJhc2UuJG93bFdyYXBwZXIuY3NzKHsgImxlZnQiOiB2YWx1ZSB9KTsNCiAgICAgICAgfSwNCg0KICAgICAgICBjc3Myc2xpZGU6IGZ1bmN0aW9uICh2YWx1ZSwgc3BlZWQpIHsNCiAgICAgICAgICAgIHZhciBiYXNlID0gdGhpczsNCg0KICAgICAgICAgICAgYmFzZS5pc0Nzc0ZpbmlzaCA9IGZhbHNlOw0KICAgICAgICAgICAgYmFzZS4kb3dsV3JhcHBlci5zdG9wKHRydWUsIHRydWUpLmFuaW1hdGUoew0KICAgICAgICAgICAgICAgICJsZWZ0IjogdmFsdWUNCiAgICAgICAgICAgIH0sIHsNCiAgICAgICAgICAgICAgICBkdXJhdGlvbjogc3BlZWQgfHwgYmFzZS5vcHRpb25zLnNsaWRlU3BlZWQsDQogICAgICAgICAgICAgICAgY29tcGxldGU6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICAgICAgYmFzZS5pc0Nzc0ZpbmlzaCA9IHRydWU7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0sDQoNCiAgICAgICAgY2hlY2tCcm93c2VyOiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICB2YXIgYmFzZSA9IHRoaXMsDQogICAgICAgICAgICAgICAgdHJhbnNsYXRlM0QgPSAidHJhbnNsYXRlM2QoMHB4LCAwcHgsIDBweCkiLA0KICAgICAgICAgICAgICAgIHRlbXBFbGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IiksDQogICAgICAgICAgICAgICAgcmVnZXgsDQogICAgICAgICAgICAgICAgYXNTdXBwb3J0LA0KICAgICAgICAgICAgICAgIHN1cHBvcnQzZCwNCiAgICAgICAgICAgICAgICBpc1RvdWNoOw0KDQogICAgICAgICAgICB0ZW1wRWxlbS5zdHlsZS5jc3NUZXh0ID0gIiAgLW1vei10cmFuc2Zvcm06IiArIHRyYW5zbGF0ZTNEICsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiOyAtbXMtdHJhbnNmb3JtOiIgKyB0cmFuc2xhdGUzRCArDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIjsgLW8tdHJhbnNmb3JtOiIgKyB0cmFuc2xhdGUzRCArDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIjsgLXdlYmtpdC10cmFuc2Zvcm06IiArIHRyYW5zbGF0ZTNEICsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiOyB0cmFuc2Zvcm06IiArIHRyYW5zbGF0ZTNEOw0KICAgICAgICAgICAgcmVnZXggPSAvdHJhbnNsYXRlM2RcKDBweCwgMHB4LCAwcHhcKS9nOw0KICAgICAgICAgICAgYXNTdXBwb3J0ID0gdGVtcEVsZW0uc3R5bGUuY3NzVGV4dC5tYXRjaChyZWdleCk7DQogICAgICAgICAgICBzdXBwb3J0M2QgPSAoYXNTdXBwb3J0ICE9PSBudWxsICYmIGFzU3VwcG9ydC5sZW5ndGggPT09IDEpOw0KDQogICAgICAgICAgICBpc1RvdWNoID0gIm9udG91Y2hzdGFydCIgaW4gd2luZG93IHx8IHdpbmRvdy5uYXZpZ2F0b3IubXNNYXhUb3VjaFBvaW50czsNCg0KICAgICAgICAgICAgYmFzZS5icm93c2VyID0gew0KICAgICAgICAgICAgICAgICJzdXBwb3J0M2QiOiBzdXBwb3J0M2QsDQogICAgICAgICAgICAgICAgImlzVG91Y2giOiBpc1RvdWNoDQogICAgICAgICAgICB9Ow0KICAgICAgICB9LA0KDQogICAgICAgIG1vdmVFdmVudHM6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIHZhciBiYXNlID0gdGhpczsNCiAgICAgICAgICAgIGlmIChiYXNlLm9wdGlvbnMubW91c2VEcmFnICE9PSBmYWxzZSB8fCBiYXNlLm9wdGlvbnMudG91Y2hEcmFnICE9PSBmYWxzZSkgew0KICAgICAgICAgICAgICAgIGJhc2UuZ2VzdHVyZXMoKTsNCiAgICAgICAgICAgICAgICBiYXNlLmRpc2FibGVkRXZlbnRzKCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0sDQoNCiAgICAgICAgZXZlbnRUeXBlczogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgdmFyIGJhc2UgPSB0aGlzLA0KICAgICAgICAgICAgICAgIHR5cGVzID0gWyJzIiwgImUiLCAieCJdOw0KDQogICAgICAgICAgICBiYXNlLmV2X3R5cGVzID0ge307DQoNCiAgICAgICAgICAgIGlmIChiYXNlLm9wdGlvbnMubW91c2VEcmFnID09PSB0cnVlICYmIGJhc2Uub3B0aW9ucy50b3VjaERyYWcgPT09IHRydWUpIHsNCiAgICAgICAgICAgICAgICB0eXBlcyA9IFsNCiAgICAgICAgICAgICAgICAgICAgInRvdWNoc3RhcnQub3dsIG1vdXNlZG93bi5vd2wiLA0KICAgICAgICAgICAgICAgICAgICAidG91Y2htb3ZlLm93bCBtb3VzZW1vdmUub3dsIiwNCiAgICAgICAgICAgICAgICAgICAgInRvdWNoZW5kLm93bCB0b3VjaGNhbmNlbC5vd2wgbW91c2V1cC5vd2wiDQogICAgICAgICAgICAgICAgXTsNCiAgICAgICAgICAgIH0gZWxzZSBpZiAoYmFzZS5vcHRpb25zLm1vdXNlRHJhZyA9PT0gZmFsc2UgJiYgYmFzZS5vcHRpb25zLnRvdWNoRHJhZyA9PT0gdHJ1ZSkgew0KICAgICAgICAgICAgICAgIHR5cGVzID0gWw0KICAgICAgICAgICAgICAgICAgICAidG91Y2hzdGFydC5vd2wiLA0KICAgICAgICAgICAgICAgICAgICAidG91Y2htb3ZlLm93bCIsDQogICAgICAgICAgICAgICAgICAgICJ0b3VjaGVuZC5vd2wgdG91Y2hjYW5jZWwub3dsIg0KICAgICAgICAgICAgICAgIF07DQogICAgICAgICAgICB9IGVsc2UgaWYgKGJhc2Uub3B0aW9ucy5tb3VzZURyYWcgPT09IHRydWUgJiYgYmFzZS5vcHRpb25zLnRvdWNoRHJhZyA9PT0gZmFsc2UpIHsNCiAgICAgICAgICAgICAgICB0eXBlcyA9IFsNCiAgICAgICAgICAgICAgICAgICAgIm1vdXNlZG93bi5vd2wiLA0KICAgICAgICAgICAgICAgICAgICAibW91c2Vtb3ZlLm93bCIsDQogICAgICAgICAgICAgICAgICAgICJtb3VzZXVwLm93bCINCiAgICAgICAgICAgICAgICBdOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBiYXNlLmV2X3R5cGVzLnN0YXJ0ID0gdHlwZXNbMF07DQogICAgICAgICAgICBiYXNlLmV2X3R5cGVzLm1vdmUgPSB0eXBlc1sxXTsNCiAgICAgICAgICAgIGJhc2UuZXZfdHlwZXMuZW5kID0gdHlwZXNbMl07DQogICAgICAgIH0sDQoNCiAgICAgICAgZGlzYWJsZWRFdmVudHM6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIHZhciBiYXNlID0gdGhpczsNCiAgICAgICAgICAgIGJhc2UuJGVsZW0ub24oImRyYWdzdGFydC5vd2wiLCBmdW5jdGlvbiAoZXZlbnQpIHsgZXZlbnQucHJldmVudERlZmF1bHQoKTsgfSk7DQogICAgICAgICAgICBiYXNlLiRlbGVtLm9uKCJtb3VzZWRvd24uZGlzYWJsZVRleHRTZWxlY3QiLCBmdW5jdGlvbiAoZSkgew0KICAgICAgICAgICAgICAgIHJldHVybiAkKGUudGFyZ2V0KS5pcygnaW5wdXQsIHRleHRhcmVhLCBzZWxlY3QsIG9wdGlvbicpOw0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0sDQoNCiAgICAgICAgZ2VzdHVyZXM6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIC8qanNsaW50IHVucGFyYW06IHRydWUqLw0KICAgICAgICAgICAgdmFyIGJhc2UgPSB0aGlzLA0KICAgICAgICAgICAgICAgIGxvY2FscyA9IHsNCiAgICAgICAgICAgICAgICAgICAgb2Zmc2V0WDogMCwNCiAgICAgICAgICAgICAgICAgICAgb2Zmc2V0WTogMCwNCiAgICAgICAgICAgICAgICAgICAgYmFzZUVsV2lkdGg6IDAsDQogICAgICAgICAgICAgICAgICAgIHJlbGF0aXZlUG9zOiAwLA0KICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgbWluU3dpcGU6IG51bGwsDQogICAgICAgICAgICAgICAgICAgIG1heFN3aXBlOiBudWxsLA0KICAgICAgICAgICAgICAgICAgICBzbGlkaW5nOiBudWxsLA0KICAgICAgICAgICAgICAgICAgICBkYXJnZ2luZzogbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0RWxlbWVudDogbnVsbA0KICAgICAgICAgICAgICAgIH07DQoNCiAgICAgICAgICAgIGJhc2UuaXNDc3NGaW5pc2ggPSB0cnVlOw0KDQogICAgICAgICAgICBmdW5jdGlvbiBnZXRUb3VjaGVzKGV2ZW50KSB7DQogICAgICAgICAgICAgICAgaWYgKGV2ZW50LnRvdWNoZXMgIT09IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gew0KICAgICAgICAgICAgICAgICAgICAgICAgeDogZXZlbnQudG91Y2hlc1swXS5wYWdlWCwNCiAgICAgICAgICAgICAgICAgICAgICAgIHk6IGV2ZW50LnRvdWNoZXNbMF0ucGFnZVkNCiAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICBpZiAoZXZlbnQudG91Y2hlcyA9PT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgICAgICAgICAgIGlmIChldmVudC5wYWdlWCAhPT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHg6IGV2ZW50LnBhZ2VYLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHk6IGV2ZW50LnBhZ2VZDQogICAgICAgICAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGlmIChldmVudC5wYWdlWCA9PT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHg6IGV2ZW50LmNsaWVudFgsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgeTogZXZlbnQuY2xpZW50WQ0KICAgICAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgZnVuY3Rpb24gc3dhcEV2ZW50cyh0eXBlKSB7DQogICAgICAgICAgICAgICAgaWYgKHR5cGUgPT09ICJvbiIpIHsNCiAgICAgICAgICAgICAgICAgICAgJChkb2N1bWVudCkub24oYmFzZS5ldl90eXBlcy5tb3ZlLCBkcmFnTW92ZSk7DQogICAgICAgICAgICAgICAgICAgICQoZG9jdW1lbnQpLm9uKGJhc2UuZXZfdHlwZXMuZW5kLCBkcmFnRW5kKTsNCiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGUgPT09ICJvZmYiKSB7DQogICAgICAgICAgICAgICAgICAgICQoZG9jdW1lbnQpLm9mZihiYXNlLmV2X3R5cGVzLm1vdmUpOw0KICAgICAgICAgICAgICAgICAgICAkKGRvY3VtZW50KS5vZmYoYmFzZS5ldl90eXBlcy5lbmQpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgZnVuY3Rpb24gZHJhZ1N0YXJ0KGV2ZW50KSB7DQogICAgICAgICAgICAgICAgdmFyIGV2ID0gZXZlbnQub3JpZ2luYWxFdmVudCB8fCBldmVudCB8fCB3aW5kb3cuZXZlbnQsDQogICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOw0KDQogICAgICAgICAgICAgICAgaWYgKGV2LndoaWNoID09PSAzKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKGJhc2UuaXRlbXNBbW91bnQgPD0gYmFzZS5vcHRpb25zLml0ZW1zKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKGJhc2UuaXNDc3NGaW5pc2ggPT09IGZhbHNlICYmICFiYXNlLm9wdGlvbnMuZHJhZ0JlZm9yZUFuaW1GaW5pc2gpIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAoYmFzZS5pc0NzczNGaW5pc2ggPT09IGZhbHNlICYmICFiYXNlLm9wdGlvbnMuZHJhZ0JlZm9yZUFuaW1GaW5pc2gpIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIGlmIChiYXNlLm9wdGlvbnMuYXV0b1BsYXkgIT09IGZhbHNlKSB7DQogICAgICAgICAgICAgICAgICAgIHdpbmRvdy5jbGVhckludGVydmFsKGJhc2UuYXV0b1BsYXlJbnRlcnZhbCk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgaWYgKGJhc2UuYnJvd3Nlci5pc1RvdWNoICE9PSB0cnVlICYmICFiYXNlLiRvd2xXcmFwcGVyLmhhc0NsYXNzKCJncmFiYmluZyIpKSB7DQogICAgICAgICAgICAgICAgICAgIGJhc2UuJG93bFdyYXBwZXIuYWRkQ2xhc3MoImdyYWJiaW5nIik7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgYmFzZS5uZXdQb3NYID0gMDsNCiAgICAgICAgICAgICAgICBiYXNlLm5ld1JlbGF0aXZlWCA9IDA7DQoNCiAgICAgICAgICAgICAgICAkKHRoaXMpLmNzcyhiYXNlLnJlbW92ZVRyYW5zaXRpb24oKSk7DQoNCiAgICAgICAgICAgICAgICBwb3NpdGlvbiA9ICQodGhpcykucG9zaXRpb24oKTsNCiAgICAgICAgICAgICAgICBsb2NhbHMucmVsYXRpdmVQb3MgPSBwb3NpdGlvbi5sZWZ0Ow0KDQogICAgICAgICAgICAgICAgbG9jYWxzLm9mZnNldFggPSBnZXRUb3VjaGVzKGV2KS54IC0gcG9zaXRpb24ubGVmdDsNCiAgICAgICAgICAgICAgICBsb2NhbHMub2Zmc2V0WSA9IGdldFRvdWNoZXMoZXYpLnkgLSBwb3NpdGlvbi50b3A7DQoNCiAgICAgICAgICAgICAgICBzd2FwRXZlbnRzKCJvbiIpOw0KDQogICAgICAgICAgICAgICAgbG9jYWxzLnNsaWRpbmcgPSBmYWxzZTsNCiAgICAgICAgICAgICAgICBsb2NhbHMudGFyZ2V0RWxlbWVudCA9IGV2LnRhcmdldCB8fCBldi5zcmNFbGVtZW50Ow0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBmdW5jdGlvbiBkcmFnTW92ZShldmVudCkgew0KICAgICAgICAgICAgICAgIHZhciBldiA9IGV2ZW50Lm9yaWdpbmFsRXZlbnQgfHwgZXZlbnQgfHwgd2luZG93LmV2ZW50LA0KICAgICAgICAgICAgICAgICAgICBtaW5Td2lwZSwNCiAgICAgICAgICAgICAgICAgICAgbWF4U3dpcGU7DQoNCiAgICAgICAgICAgICAgICBiYXNlLm5ld1Bvc1ggPSBnZXRUb3VjaGVzKGV2KS54IC0gbG9jYWxzLm9mZnNldFg7DQogICAgICAgICAgICAgICAgYmFzZS5uZXdQb3NZID0gZ2V0VG91Y2hlcyhldikueSAtIGxvY2Fscy5vZmZzZXRZOw0KICAgICAgICAgICAgICAgIGJhc2UubmV3UmVsYXRpdmVYID0gYmFzZS5uZXdQb3NYIC0gbG9jYWxzLnJlbGF0aXZlUG9zOw0KDQogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBiYXNlLm9wdGlvbnMuc3RhcnREcmFnZ2luZyA9PT0gImZ1bmN0aW9uIiAmJiBsb2NhbHMuZHJhZ2dpbmcgIT09IHRydWUgJiYgYmFzZS5uZXdSZWxhdGl2ZVggIT09IDApIHsNCiAgICAgICAgICAgICAgICAgICAgbG9jYWxzLmRyYWdnaW5nID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgYmFzZS5vcHRpb25zLnN0YXJ0RHJhZ2dpbmcuYXBwbHkoYmFzZSwgW2Jhc2UuJGVsZW1dKTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICBpZiAoKGJhc2UubmV3UmVsYXRpdmVYID4gOCB8fCBiYXNlLm5ld1JlbGF0aXZlWCA8IC04KSAmJiAoYmFzZS5icm93c2VyLmlzVG91Y2ggPT09IHRydWUpKSB7DQogICAgICAgICAgICAgICAgICAgIGlmIChldi5wcmV2ZW50RGVmYXVsdCAhPT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBldi5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgZXYucmV0dXJuVmFsdWUgPSBmYWxzZTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBsb2NhbHMuc2xpZGluZyA9IHRydWU7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgaWYgKChiYXNlLm5ld1Bvc1kgPiAxMCB8fCBiYXNlLm5ld1Bvc1kgPCAtMTApICYmIGxvY2Fscy5zbGlkaW5nID09PSBmYWxzZSkgew0KICAgICAgICAgICAgICAgICAgICAkKGRvY3VtZW50KS5vZmYoInRvdWNobW92ZS5vd2wiKTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICBtaW5Td2lwZSA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGJhc2UubmV3UmVsYXRpdmVYIC8gNTsNCiAgICAgICAgICAgICAgICB9Ow0KDQogICAgICAgICAgICAgICAgbWF4U3dpcGUgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBiYXNlLm1heGltdW1QaXhlbHMgKyBiYXNlLm5ld1JlbGF0aXZlWCAvIDU7DQogICAgICAgICAgICAgICAgfTsNCg0KICAgICAgICAgICAgICAgIGJhc2UubmV3UG9zWCA9IE1hdGgubWF4KE1hdGgubWluKGJhc2UubmV3UG9zWCwgbWluU3dpcGUoKSksIG1heFN3aXBlKCkpOw0KICAgICAgICAgICAgICAgIGlmIChiYXNlLmJyb3dzZXIuc3VwcG9ydDNkID09PSB0cnVlKSB7DQogICAgICAgICAgICAgICAgICAgIGJhc2UudHJhbnNpdGlvbjNkKGJhc2UubmV3UG9zWCk7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgYmFzZS5jc3MybW92ZShiYXNlLm5ld1Bvc1gpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgZnVuY3Rpb24gZHJhZ0VuZChldmVudCkgew0KICAgICAgICAgICAgICAgIHZhciBldiA9IGV2ZW50Lm9yaWdpbmFsRXZlbnQgfHwgZXZlbnQgfHwgd2luZG93LmV2ZW50LA0KICAgICAgICAgICAgICAgICAgICBuZXdQb3NpdGlvbiwNCiAgICAgICAgICAgICAgICAgICAgaGFuZGxlcnMsDQogICAgICAgICAgICAgICAgICAgIG93bFN0b3BFdmVudDsNCg0KICAgICAgICAgICAgICAgIGV2LnRhcmdldCA9IGV2LnRhcmdldCB8fCBldi5zcmNFbGVtZW50Ow0KDQogICAgICAgICAgICAgICAgbG9jYWxzLmRyYWdnaW5nID0gZmFsc2U7DQoNCiAgICAgICAgICAgICAgICBpZiAoYmFzZS5icm93c2VyLmlzVG91Y2ggIT09IHRydWUpIHsNCiAgICAgICAgICAgICAgICAgICAgYmFzZS4kb3dsV3JhcHBlci5yZW1vdmVDbGFzcygiZ3JhYmJpbmciKTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICBpZiAoYmFzZS5uZXdSZWxhdGl2ZVggPCAwKSB7DQogICAgICAgICAgICAgICAgICAgIGJhc2UuZHJhZ0RpcmVjdGlvbiA9IGJhc2Uub3dsLmRyYWdEaXJlY3Rpb24gPSAibGVmdCI7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgYmFzZS5kcmFnRGlyZWN0aW9uID0gYmFzZS5vd2wuZHJhZ0RpcmVjdGlvbiA9ICJyaWdodCI7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgaWYgKGJhc2UubmV3UmVsYXRpdmVYICE9PSAwKSB7DQogICAgICAgICAgICAgICAgICAgIG5ld1Bvc2l0aW9uID0gYmFzZS5nZXROZXdQb3NpdGlvbigpOw0KICAgICAgICAgICAgICAgICAgICBiYXNlLmdvVG8obmV3UG9zaXRpb24sIGZhbHNlLCAiZHJhZyIpOw0KICAgICAgICAgICAgICAgICAgICBpZiAobG9jYWxzLnRhcmdldEVsZW1lbnQgPT09IGV2LnRhcmdldCAmJiBiYXNlLmJyb3dzZXIuaXNUb3VjaCAhPT0gdHJ1ZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgJChldi50YXJnZXQpLm9uKCJjbGljay5kaXNhYmxlIiwgZnVuY3Rpb24gKGV2KSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXYuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXYuc3RvcFByb3BhZ2F0aW9uKCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXYucHJldmVudERlZmF1bHQoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKGV2LnRhcmdldCkub2ZmKCJjbGljay5kaXNhYmxlIik7DQogICAgICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZXJzID0gJC5fZGF0YShldi50YXJnZXQsICJldmVudHMiKS5jbGljazsNCiAgICAgICAgICAgICAgICAgICAgICAgIG93bFN0b3BFdmVudCA9IGhhbmRsZXJzLnBvcCgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlcnMuc3BsaWNlKDAsIDAsIG93bFN0b3BFdmVudCk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgc3dhcEV2ZW50cygib2ZmIik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBiYXNlLiRlbGVtLm9uKGJhc2UuZXZfdHlwZXMuc3RhcnQsICIub3dsLXdyYXBwZXIiLCBkcmFnU3RhcnQpOw0KICAgICAgICB9LA0KDQogICAgICAgIGdldE5ld1Bvc2l0aW9uOiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICB2YXIgYmFzZSA9IHRoaXMsDQogICAgICAgICAgICAgICAgbmV3UG9zaXRpb24gPSBiYXNlLmNsb3Nlc3RJdGVtKCk7DQoNCiAgICAgICAgICAgIGlmIChuZXdQb3NpdGlvbiA+IGJhc2UubWF4aW11bUl0ZW0pIHsNCiAgICAgICAgICAgICAgICBiYXNlLmN1cnJlbnRJdGVtID0gYmFzZS5tYXhpbXVtSXRlbTsNCiAgICAgICAgICAgICAgICBuZXdQb3NpdGlvbiA9IGJhc2UubWF4aW11bUl0ZW07DQogICAgICAgICAgICB9IGVsc2UgaWYgKGJhc2UubmV3UG9zWCA+PSAwKSB7DQogICAgICAgICAgICAgICAgbmV3UG9zaXRpb24gPSAwOw0KICAgICAgICAgICAgICAgIGJhc2UuY3VycmVudEl0ZW0gPSAwOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIG5ld1Bvc2l0aW9uOw0KICAgICAgICB9LA0KICAgICAgICBjbG9zZXN0SXRlbTogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgdmFyIGJhc2UgPSB0aGlzLA0KICAgICAgICAgICAgICAgIGFycmF5ID0gYmFzZS5vcHRpb25zLnNjcm9sbFBlclBhZ2UgPT09IHRydWUgPyBiYXNlLnBhZ2VzSW5BcnJheSA6IGJhc2UucG9zaXRpb25zSW5BcnJheSwNCiAgICAgICAgICAgICAgICBnb2FsID0gYmFzZS5uZXdQb3NYLA0KICAgICAgICAgICAgICAgIGNsb3Nlc3QgPSBudWxsOw0KDQogICAgICAgICAgICAkLmVhY2goYXJyYXksIGZ1bmN0aW9uIChpLCB2KSB7DQogICAgICAgICAgICAgICAgaWYgKGdvYWwgLSAoYmFzZS5pdGVtV2lkdGggLyAyMCkgPiBhcnJheVtpICsgMV0gJiYgZ29hbCAtIChiYXNlLml0ZW1XaWR0aCAvIDIwKSA8IHYgJiYgYmFzZS5tb3ZlRGlyZWN0aW9uKCkgPT09ICJsZWZ0Iikgew0KICAgICAgICAgICAgICAgICAgICBjbG9zZXN0ID0gdjsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGJhc2Uub3B0aW9ucy5zY3JvbGxQZXJQYWdlID09PSB0cnVlKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBiYXNlLmN1cnJlbnRJdGVtID0gJC5pbkFycmF5KGNsb3Nlc3QsIGJhc2UucG9zaXRpb25zSW5BcnJheSk7DQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICBiYXNlLmN1cnJlbnRJdGVtID0gaTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZ29hbCArIChiYXNlLml0ZW1XaWR0aCAvIDIwKSA8IHYgJiYgZ29hbCArIChiYXNlLml0ZW1XaWR0aCAvIDIwKSA+IChhcnJheVtpICsgMV0gfHwgYXJyYXlbaV0gLSBiYXNlLml0ZW1XaWR0aCkgJiYgYmFzZS5tb3ZlRGlyZWN0aW9uKCkgPT09ICJyaWdodCIpIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGJhc2Uub3B0aW9ucy5zY3JvbGxQZXJQYWdlID09PSB0cnVlKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBjbG9zZXN0ID0gYXJyYXlbaSArIDFdIHx8IGFycmF5W2FycmF5Lmxlbmd0aCAtIDFdOw0KICAgICAgICAgICAgICAgICAgICAgICAgYmFzZS5jdXJyZW50SXRlbSA9ICQuaW5BcnJheShjbG9zZXN0LCBiYXNlLnBvc2l0aW9uc0luQXJyYXkpOw0KICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgY2xvc2VzdCA9IGFycmF5W2kgKyAxXTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJhc2UuY3VycmVudEl0ZW0gPSBpICsgMTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgcmV0dXJuIGJhc2UuY3VycmVudEl0ZW07DQogICAgICAgIH0sDQoNCiAgICAgICAgbW92ZURpcmVjdGlvbjogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgdmFyIGJhc2UgPSB0aGlzLA0KICAgICAgICAgICAgICAgIGRpcmVjdGlvbjsNCiAgICAgICAgICAgIGlmIChiYXNlLm5ld1JlbGF0aXZlWCA8IDApIHsNCiAgICAgICAgICAgICAgICBkaXJlY3Rpb24gPSAicmlnaHQiOw0KICAgICAgICAgICAgICAgIGJhc2UucGxheURpcmVjdGlvbiA9ICJuZXh0IjsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgZGlyZWN0aW9uID0gImxlZnQiOw0KICAgICAgICAgICAgICAgIGJhc2UucGxheURpcmVjdGlvbiA9ICJwcmV2IjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBkaXJlY3Rpb247DQogICAgICAgIH0sDQoNCiAgICAgICAgY3VzdG9tRXZlbnRzOiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAvKmpzbGludCB1bnBhcmFtOiB0cnVlKi8NCiAgICAgICAgICAgIHZhciBiYXNlID0gdGhpczsNCiAgICAgICAgICAgIGJhc2UuJGVsZW0ub24oIm93bC5uZXh0IiwgZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgIGJhc2UubmV4dCgpOw0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgICBiYXNlLiRlbGVtLm9uKCJvd2wucHJldiIsIGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICBiYXNlLnByZXYoKTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgYmFzZS4kZWxlbS5vbigib3dsLnBsYXkiLCBmdW5jdGlvbiAoZXZlbnQsIHNwZWVkKSB7DQogICAgICAgICAgICAgICAgYmFzZS5vcHRpb25zLmF1dG9QbGF5ID0gc3BlZWQ7DQogICAgICAgICAgICAgICAgYmFzZS5wbGF5KCk7DQogICAgICAgICAgICAgICAgYmFzZS5ob3ZlclN0YXR1cyA9ICJwbGF5IjsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgYmFzZS4kZWxlbS5vbigib3dsLnN0b3AiLCBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgYmFzZS5zdG9wKCk7DQogICAgICAgICAgICAgICAgYmFzZS5ob3ZlclN0YXR1cyA9ICJzdG9wIjsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgYmFzZS4kZWxlbS5vbigib3dsLmdvVG8iLCBmdW5jdGlvbiAoZXZlbnQsIGl0ZW0pIHsNCiAgICAgICAgICAgICAgICBiYXNlLmdvVG8oaXRlbSk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIGJhc2UuJGVsZW0ub24oIm93bC5qdW1wVG8iLCBmdW5jdGlvbiAoZXZlbnQsIGl0ZW0pIHsNCiAgICAgICAgICAgICAgICBiYXNlLmp1bXBUbyhpdGVtKTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9LA0KDQogICAgICAgIHN0b3BPbkhvdmVyOiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICB2YXIgYmFzZSA9IHRoaXM7DQogICAgICAgICAgICBpZiAoYmFzZS5vcHRpb25zLnN0b3BPbkhvdmVyID09PSB0cnVlICYmIGJhc2UuYnJvd3Nlci5pc1RvdWNoICE9PSB0cnVlICYmIGJhc2Uub3B0aW9ucy5hdXRvUGxheSAhPT0gZmFsc2UpIHsNCiAgICAgICAgICAgICAgICBiYXNlLiRlbGVtLm9uKCJtb3VzZW92ZXIiLCBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgICAgIGJhc2Uuc3RvcCgpOw0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgIGJhc2UuJGVsZW0ub24oIm1vdXNlb3V0IiwgZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgICAgICBpZiAoYmFzZS5ob3ZlclN0YXR1cyAhPT0gInN0b3AiKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBiYXNlLnBsYXkoKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9LA0KDQogICAgICAgIGxhenlMb2FkOiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICB2YXIgYmFzZSA9IHRoaXMsDQogICAgICAgICAgICAgICAgaSwNCiAgICAgICAgICAgICAgICAkaXRlbSwNCiAgICAgICAgICAgICAgICBpdGVtTnVtYmVyLA0KICAgICAgICAgICAgICAgICRsYXp5SW1nLA0KICAgICAgICAgICAgICAgIGZvbGxvdzsNCg0KICAgICAgICAgICAgaWYgKGJhc2Uub3B0aW9ucy5sYXp5TG9hZCA9PT0gZmFsc2UpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgYmFzZS5pdGVtc0Ftb3VudDsgaSArPSAxKSB7DQogICAgICAgICAgICAgICAgJGl0ZW0gPSAkKGJhc2UuJG93bEl0ZW1zW2ldKTsNCg0KICAgICAgICAgICAgICAgIGlmICgkaXRlbS5kYXRhKCJvd2wtbG9hZGVkIikgPT09ICJsb2FkZWQiKSB7DQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIGl0ZW1OdW1iZXIgPSAkaXRlbS5kYXRhKCJvd2wtaXRlbSIpOw0KICAgICAgICAgICAgICAgICRsYXp5SW1nID0gJGl0ZW0uZmluZCgiLmxhenlPd2wiKTsNCg0KICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgJGxhenlJbWcuZGF0YSgic3JjIikgIT09ICJzdHJpbmciKSB7DQogICAgICAgICAgICAgICAgICAgICRpdGVtLmRhdGEoIm93bC1sb2FkZWQiLCAibG9hZGVkIik7DQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAoJGl0ZW0uZGF0YSgib3dsLWxvYWRlZCIpID09PSB1bmRlZmluZWQpIHsNCiAgICAgICAgICAgICAgICAgICAgJGxhenlJbWcuaGlkZSgpOw0KICAgICAgICAgICAgICAgICAgICAkaXRlbS5hZGRDbGFzcygibG9hZGluZyIpLmRhdGEoIm93bC1sb2FkZWQiLCAiY2hlY2tlZCIpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAoYmFzZS5vcHRpb25zLmxhenlGb2xsb3cgPT09IHRydWUpIHsNCiAgICAgICAgICAgICAgICAgICAgZm9sbG93ID0gaXRlbU51bWJlciA+PSBiYXNlLmN1cnJlbnRJdGVtOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIGZvbGxvdyA9IHRydWU7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmIChmb2xsb3cgJiYgaXRlbU51bWJlciA8IGJhc2UuY3VycmVudEl0ZW0gKyBiYXNlLm9wdGlvbnMuaXRlbXMgJiYgJGxhenlJbWcubGVuZ3RoKSB7DQogICAgICAgICAgICAgICAgICAgIGJhc2UubGF6eVByZWxvYWQoJGl0ZW0sICRsYXp5SW1nKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0sDQoNCiAgICAgICAgbGF6eVByZWxvYWQ6IGZ1bmN0aW9uICgkaXRlbSwgJGxhenlJbWcpIHsNCiAgICAgICAgICAgIHZhciBiYXNlID0gdGhpcywNCiAgICAgICAgICAgICAgICBpdGVyYXRpb25zID0gMCwNCiAgICAgICAgICAgICAgICBpc0JhY2tncm91bmRJbWc7DQoNCiAgICAgICAgICAgIGlmICgkbGF6eUltZy5wcm9wKCJ0YWdOYW1lIikgPT09ICJESVYiKSB7DQogICAgICAgICAgICAgICAgJGxhenlJbWcuY3NzKCJiYWNrZ3JvdW5kLWltYWdlIiwgInVybCgiICsgJGxhenlJbWcuZGF0YSgic3JjIikgKyAiKSIpOw0KICAgICAgICAgICAgICAgIGlzQmFja2dyb3VuZEltZyA9IHRydWU7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICRsYXp5SW1nWzBdLnNyYyA9ICRsYXp5SW1nLmRhdGEoInNyYyIpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBmdW5jdGlvbiBzaG93SW1hZ2UoKSB7DQogICAgICAgICAgICAgICAgJGl0ZW0uZGF0YSgib3dsLWxvYWRlZCIsICJsb2FkZWQiKS5yZW1vdmVDbGFzcygibG9hZGluZyIpOw0KICAgICAgICAgICAgICAgICRsYXp5SW1nLnJlbW92ZUF0dHIoImRhdGEtc3JjIik7DQogICAgICAgICAgICAgICAgaWYgKGJhc2Uub3B0aW9ucy5sYXp5RWZmZWN0ID09PSAiZmFkZSIpIHsNCiAgICAgICAgICAgICAgICAgICAgJGxhenlJbWcuZmFkZUluKDQwMCk7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgJGxhenlJbWcuc2hvdygpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGJhc2Uub3B0aW9ucy5hZnRlckxhenlMb2FkID09PSAiZnVuY3Rpb24iKSB7DQogICAgICAgICAgICAgICAgICAgIGJhc2Uub3B0aW9ucy5hZnRlckxhenlMb2FkLmFwcGx5KHRoaXMsIFtiYXNlLiRlbGVtXSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBmdW5jdGlvbiBjaGVja0xhenlJbWFnZSgpIHsNCiAgICAgICAgICAgICAgICBpdGVyYXRpb25zICs9IDE7DQogICAgICAgICAgICAgICAgaWYgKGJhc2UuY29tcGxldGVJbWcoJGxhenlJbWcuZ2V0KDApKSB8fCBpc0JhY2tncm91bmRJbWcgPT09IHRydWUpIHsNCiAgICAgICAgICAgICAgICAgICAgc2hvd0ltYWdlKCk7DQogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChpdGVyYXRpb25zIDw9IDEwMCkgey8vaWYgaW1hZ2UgbG9hZHMgaW4gbGVzcyB0aGFuIDEwIHNlY29uZHMgDQogICAgICAgICAgICAgICAgICAgIHdpbmRvdy5zZXRUaW1lb3V0KGNoZWNrTGF6eUltYWdlLCAxMDApOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIHNob3dJbWFnZSgpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgY2hlY2tMYXp5SW1hZ2UoKTsNCiAgICAgICAgfSwNCg0KICAgICAgICBhdXRvSGVpZ2h0OiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICB2YXIgYmFzZSA9IHRoaXMsDQogICAgICAgICAgICAgICAgJGN1cnJlbnRpbWcgPSAkKGJhc2UuJG93bEl0ZW1zW2Jhc2UuY3VycmVudEl0ZW1dKS5maW5kKCJpbWciKSwNCiAgICAgICAgICAgICAgICBpdGVyYXRpb25zOw0KDQogICAgICAgICAgICBmdW5jdGlvbiBhZGRIZWlnaHQoKSB7DQogICAgICAgICAgICAgICAgdmFyICRjdXJyZW50SXRlbSA9ICQoYmFzZS4kb3dsSXRlbXNbYmFzZS5jdXJyZW50SXRlbV0pLmhlaWdodCgpOw0KICAgICAgICAgICAgICAgIGJhc2Uud3JhcHBlck91dGVyLmNzcygiaGVpZ2h0IiwgJGN1cnJlbnRJdGVtICsgInB4Iik7DQogICAgICAgICAgICAgICAgaWYgKCFiYXNlLndyYXBwZXJPdXRlci5oYXNDbGFzcygiYXV0b0hlaWdodCIpKSB7DQogICAgICAgICAgICAgICAgICAgIHdpbmRvdy5zZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJhc2Uud3JhcHBlck91dGVyLmFkZENsYXNzKCJhdXRvSGVpZ2h0Iik7DQogICAgICAgICAgICAgICAgICAgIH0sIDApOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgZnVuY3Rpb24gY2hlY2tJbWFnZSgpIHsNCiAgICAgICAgICAgICAgICBpdGVyYXRpb25zICs9IDE7DQogICAgICAgICAgICAgICAgaWYgKGJhc2UuY29tcGxldGVJbWcoJGN1cnJlbnRpbWcuZ2V0KDApKSkgew0KICAgICAgICAgICAgICAgICAgICBhZGRIZWlnaHQoKTsNCiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGl0ZXJhdGlvbnMgPD0gMTAwKSB7IC8vaWYgaW1hZ2UgbG9hZHMgaW4gbGVzcyB0aGFuIDEwIHNlY29uZHMgDQogICAgICAgICAgICAgICAgICAgIHdpbmRvdy5zZXRUaW1lb3V0KGNoZWNrSW1hZ2UsIDEwMCk7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgYmFzZS53cmFwcGVyT3V0ZXIuY3NzKCJoZWlnaHQiLCAiIik7IC8vRWxzZSByZW1vdmUgaGVpZ2h0IGF0dHJpYnV0ZQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYgKCRjdXJyZW50aW1nLmdldCgwKSAhPT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgICAgICAgaXRlcmF0aW9ucyA9IDA7DQogICAgICAgICAgICAgICAgY2hlY2tJbWFnZSgpOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBhZGRIZWlnaHQoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSwNCg0KICAgICAgICBjb21wbGV0ZUltZzogZnVuY3Rpb24gKGltZykgew0KICAgICAgICAgICAgdmFyIG5hdHVyYWxXaWR0aFR5cGU7DQoNCiAgICAgICAgICAgIGlmICghaW1nLmNvbXBsZXRlKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgbmF0dXJhbFdpZHRoVHlwZSA9IHR5cGVvZiBpbWcubmF0dXJhbFdpZHRoOw0KICAgICAgICAgICAgaWYgKG5hdHVyYWxXaWR0aFR5cGUgIT09ICJ1bmRlZmluZWQiICYmIGltZy5uYXR1cmFsV2lkdGggPT09IDApIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgfSwNCg0KICAgICAgICBvblZpc2libGVJdGVtczogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgdmFyIGJhc2UgPSB0aGlzLA0KICAgICAgICAgICAgICAgIGk7DQoNCiAgICAgICAgICAgIGlmIChiYXNlLm9wdGlvbnMuYWRkQ2xhc3NBY3RpdmUgPT09IHRydWUpIHsNCiAgICAgICAgICAgICAgICBiYXNlLiRvd2xJdGVtcy5yZW1vdmVDbGFzcygiYWN0aXZlIik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBiYXNlLnZpc2libGVJdGVtcyA9IFtdOw0KICAgICAgICAgICAgZm9yIChpID0gYmFzZS5jdXJyZW50SXRlbTsgaSA8IGJhc2UuY3VycmVudEl0ZW0gKyBiYXNlLm9wdGlvbnMuaXRlbXM7IGkgKz0gMSkgew0KICAgICAgICAgICAgICAgIGJhc2UudmlzaWJsZUl0ZW1zLnB1c2goaSk7DQoNCiAgICAgICAgICAgICAgICBpZiAoYmFzZS5vcHRpb25zLmFkZENsYXNzQWN0aXZlID09PSB0cnVlKSB7DQogICAgICAgICAgICAgICAgICAgICQoYmFzZS4kb3dsSXRlbXNbaV0pLmFkZENsYXNzKCJhY3RpdmUiKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBiYXNlLm93bC52aXNpYmxlSXRlbXMgPSBiYXNlLnZpc2libGVJdGVtczsNCiAgICAgICAgfSwNCg0KICAgICAgICB0cmFuc2l0aW9uVHlwZXM6IGZ1bmN0aW9uIChjbGFzc05hbWUpIHsNCiAgICAgICAgICAgIHZhciBiYXNlID0gdGhpczsNCiAgICAgICAgICAgIC8vQ3VycmVudGx5IGF2YWlsYWJsZTogImZhZGUiLCAiYmFja1NsaWRlIiwgImdvRG93biIsICJmYWRlVXAiDQogICAgICAgICAgICBiYXNlLm91dENsYXNzID0gIm93bC0iICsgY2xhc3NOYW1lICsgIi1vdXQiOw0KICAgICAgICAgICAgYmFzZS5pbkNsYXNzID0gIm93bC0iICsgY2xhc3NOYW1lICsgIi1pbiI7DQogICAgICAgIH0sDQoNCiAgICAgICAgc2luZ2xlSXRlbVRyYW5zaXRpb246IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIHZhciBiYXNlID0gdGhpcywNCiAgICAgICAgICAgICAgICBvdXRDbGFzcyA9IGJhc2Uub3V0Q2xhc3MsDQogICAgICAgICAgICAgICAgaW5DbGFzcyA9IGJhc2UuaW5DbGFzcywNCiAgICAgICAgICAgICAgICAkY3VycmVudEl0ZW0gPSBiYXNlLiRvd2xJdGVtcy5lcShiYXNlLmN1cnJlbnRJdGVtKSwNCiAgICAgICAgICAgICAgICAkcHJldkl0ZW0gPSBiYXNlLiRvd2xJdGVtcy5lcShiYXNlLnByZXZJdGVtKSwNCiAgICAgICAgICAgICAgICBwcmV2UG9zID0gTWF0aC5hYnMoYmFzZS5wb3NpdGlvbnNJbkFycmF5W2Jhc2UuY3VycmVudEl0ZW1dKSArIGJhc2UucG9zaXRpb25zSW5BcnJheVtiYXNlLnByZXZJdGVtXSwNCiAgICAgICAgICAgICAgICBvcmlnaW4gPSBNYXRoLmFicyhiYXNlLnBvc2l0aW9uc0luQXJyYXlbYmFzZS5jdXJyZW50SXRlbV0pICsgYmFzZS5pdGVtV2lkdGggLyAyLA0KICAgICAgICAgICAgICAgIGFuaW1FbmQgPSAnd2Via2l0QW5pbWF0aW9uRW5kIG9BbmltYXRpb25FbmQgTVNBbmltYXRpb25FbmQgYW5pbWF0aW9uZW5kJzsNCg0KICAgICAgICAgICAgYmFzZS5pc1RyYW5zaXRpb24gPSB0cnVlOw0KDQogICAgICAgICAgICBiYXNlLiRvd2xXcmFwcGVyDQogICAgICAgICAgICAgICAgLmFkZENsYXNzKCdvd2wtb3JpZ2luJykNCiAgICAgICAgICAgICAgICAuY3NzKHsNCiAgICAgICAgICAgICAgICAgICAgIi13ZWJraXQtdHJhbnNmb3JtLW9yaWdpbiI6IG9yaWdpbiArICJweCIsDQogICAgICAgICAgICAgICAgICAgICItbW96LXBlcnNwZWN0aXZlLW9yaWdpbiI6IG9yaWdpbiArICJweCIsDQogICAgICAgICAgICAgICAgICAgICJwZXJzcGVjdGl2ZS1vcmlnaW4iOiBvcmlnaW4gKyAicHgiDQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICBmdW5jdGlvbiB0cmFuc1N0eWxlcyhwcmV2UG9zKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICAgICAgICAgICAgInBvc2l0aW9uIjogInJlbGF0aXZlIiwNCiAgICAgICAgICAgICAgICAgICAgImxlZnQiOiBwcmV2UG9zICsgInB4Ig0KICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICRwcmV2SXRlbQ0KICAgICAgICAgICAgICAgIC5jc3ModHJhbnNTdHlsZXMocHJldlBvcywgMTApKQ0KICAgICAgICAgICAgICAgIC5hZGRDbGFzcyhvdXRDbGFzcykNCiAgICAgICAgICAgICAgICAub24oYW5pbUVuZCwgZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgICAgICBiYXNlLmVuZFByZXYgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICAkcHJldkl0ZW0ub2ZmKGFuaW1FbmQpOw0KICAgICAgICAgICAgICAgICAgICBiYXNlLmNsZWFyVHJhbnNTdHlsZSgkcHJldkl0ZW0sIG91dENsYXNzKTsNCiAgICAgICAgICAgICAgICB9KTsNCg0KICAgICAgICAgICAgJGN1cnJlbnRJdGVtDQogICAgICAgICAgICAgICAgLmFkZENsYXNzKGluQ2xhc3MpDQogICAgICAgICAgICAgICAgLm9uKGFuaW1FbmQsIGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICAgICAgYmFzZS5lbmRDdXJyZW50ID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgJGN1cnJlbnRJdGVtLm9mZihhbmltRW5kKTsNCiAgICAgICAgICAgICAgICAgICAgYmFzZS5jbGVhclRyYW5zU3R5bGUoJGN1cnJlbnRJdGVtLCBpbkNsYXNzKTsNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgfSwNCg0KICAgICAgICBjbGVhclRyYW5zU3R5bGU6IGZ1bmN0aW9uIChpdGVtLCBjbGFzc1RvUmVtb3ZlKSB7DQogICAgICAgICAgICB2YXIgYmFzZSA9IHRoaXM7DQogICAgICAgICAgICBpdGVtLmNzcyh7DQogICAgICAgICAgICAgICAgInBvc2l0aW9uIjogIiIsDQogICAgICAgICAgICAgICAgImxlZnQiOiAiIg0KICAgICAgICAgICAgfSkucmVtb3ZlQ2xhc3MoY2xhc3NUb1JlbW92ZSk7DQoNCiAgICAgICAgICAgIGlmIChiYXNlLmVuZFByZXYgJiYgYmFzZS5lbmRDdXJyZW50KSB7DQogICAgICAgICAgICAgICAgYmFzZS4kb3dsV3JhcHBlci5yZW1vdmVDbGFzcygnb3dsLW9yaWdpbicpOw0KICAgICAgICAgICAgICAgIGJhc2UuZW5kUHJldiA9IGZhbHNlOw0KICAgICAgICAgICAgICAgIGJhc2UuZW5kQ3VycmVudCA9IGZhbHNlOw0KICAgICAgICAgICAgICAgIGJhc2UuaXNUcmFuc2l0aW9uID0gZmFsc2U7DQogICAgICAgICAgICB9DQogICAgICAgIH0sDQoNCiAgICAgICAgb3dsU3RhdHVzOiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICB2YXIgYmFzZSA9IHRoaXM7DQogICAgICAgICAgICBiYXNlLm93bCA9IHsNCiAgICAgICAgICAgICAgICAidXNlck9wdGlvbnMiOiBiYXNlLnVzZXJPcHRpb25zLA0KICAgICAgICAgICAgICAgICJiYXNlRWxlbWVudCI6IGJhc2UuJGVsZW0sDQogICAgICAgICAgICAgICAgInVzZXJJdGVtcyI6IGJhc2UuJHVzZXJJdGVtcywNCiAgICAgICAgICAgICAgICAib3dsSXRlbXMiOiBiYXNlLiRvd2xJdGVtcywNCiAgICAgICAgICAgICAgICAiY3VycmVudEl0ZW0iOiBiYXNlLmN1cnJlbnRJdGVtLA0KICAgICAgICAgICAgICAgICJwcmV2SXRlbSI6IGJhc2UucHJldkl0ZW0sDQogICAgICAgICAgICAgICAgInZpc2libGVJdGVtcyI6IGJhc2UudmlzaWJsZUl0ZW1zLA0KICAgICAgICAgICAgICAgICJpc1RvdWNoIjogYmFzZS5icm93c2VyLmlzVG91Y2gsDQogICAgICAgICAgICAgICAgImJyb3dzZXIiOiBiYXNlLmJyb3dzZXIsDQogICAgICAgICAgICAgICAgImRyYWdEaXJlY3Rpb24iOiBiYXNlLmRyYWdEaXJlY3Rpb24NCiAgICAgICAgICAgIH07DQogICAgICAgIH0sDQoNCiAgICAgICAgY2xlYXJFdmVudHM6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIHZhciBiYXNlID0gdGhpczsNCiAgICAgICAgICAgIGJhc2UuJGVsZW0ub2ZmKCIub3dsIG93bCBtb3VzZWRvd24uZGlzYWJsZVRleHRTZWxlY3QiKTsNCiAgICAgICAgICAgICQoZG9jdW1lbnQpLm9mZigiLm93bCBvd2wiKTsNCiAgICAgICAgICAgICQod2luZG93KS5vZmYoInJlc2l6ZSIsIGJhc2UucmVzaXplcik7DQogICAgICAgIH0sDQoNCiAgICAgICAgdW5XcmFwOiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICB2YXIgYmFzZSA9IHRoaXM7DQogICAgICAgICAgICBpZiAoYmFzZS4kZWxlbS5jaGlsZHJlbigpLmxlbmd0aCAhPT0gMCkgew0KICAgICAgICAgICAgICAgIGJhc2UuJG93bFdyYXBwZXIudW53cmFwKCk7DQogICAgICAgICAgICAgICAgYmFzZS4kdXNlckl0ZW1zLnVud3JhcCgpLnVud3JhcCgpOw0KICAgICAgICAgICAgICAgIGlmIChiYXNlLm93bENvbnRyb2xzKSB7DQogICAgICAgICAgICAgICAgICAgIGJhc2Uub3dsQ29udHJvbHMucmVtb3ZlKCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgYmFzZS5jbGVhckV2ZW50cygpOw0KICAgICAgICAgICAgYmFzZS4kZWxlbQ0KICAgICAgICAgICAgICAgIC5hdHRyKCJzdHlsZSIsIGJhc2UuJGVsZW0uZGF0YSgib3dsLW9yaWdpbmFsU3R5bGVzIikgfHwgIiIpDQogICAgICAgICAgICAgICAgLmF0dHIoImNsYXNzIiwgYmFzZS4kZWxlbS5kYXRhKCJvd2wtb3JpZ2luYWxDbGFzc2VzIikpOw0KICAgICAgICB9LA0KDQogICAgICAgIGRlc3Ryb3k6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIHZhciBiYXNlID0gdGhpczsNCiAgICAgICAgICAgIGJhc2Uuc3RvcCgpOw0KICAgICAgICAgICAgd2luZG93LmNsZWFySW50ZXJ2YWwoYmFzZS5jaGVja1Zpc2libGUpOw0KICAgICAgICAgICAgYmFzZS51bldyYXAoKTsNCiAgICAgICAgICAgIGJhc2UuJGVsZW0ucmVtb3ZlRGF0YSgpOw0KICAgICAgICB9LA0KDQogICAgICAgIHJlaW5pdDogZnVuY3Rpb24gKG5ld09wdGlvbnMpIHsNCiAgICAgICAgICAgIHZhciBiYXNlID0gdGhpcywNCiAgICAgICAgICAgICAgICBvcHRpb25zID0gJC5leHRlbmQoe30sIGJhc2UudXNlck9wdGlvbnMsIG5ld09wdGlvbnMpOw0KICAgICAgICAgICAgYmFzZS51bldyYXAoKTsNCiAgICAgICAgICAgIGJhc2UuaW5pdChvcHRpb25zLCBiYXNlLiRlbGVtKTsNCiAgICAgICAgfSwNCg0KICAgICAgICBhZGRJdGVtOiBmdW5jdGlvbiAoaHRtbFN0cmluZywgdGFyZ2V0UG9zaXRpb24pIHsNCiAgICAgICAgICAgIHZhciBiYXNlID0gdGhpcywNCiAgICAgICAgICAgICAgICBwb3NpdGlvbjsNCg0KICAgICAgICAgICAgaWYgKCFodG1sU3RyaW5nKSB7IHJldHVybiBmYWxzZTsgfQ0KDQogICAgICAgICAgICBpZiAoYmFzZS4kZWxlbS5jaGlsZHJlbigpLmxlbmd0aCA9PT0gMCkgew0KICAgICAgICAgICAgICAgIGJhc2UuJGVsZW0uYXBwZW5kKGh0bWxTdHJpbmcpOw0KICAgICAgICAgICAgICAgIGJhc2Uuc2V0VmFycygpOw0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGJhc2UudW5XcmFwKCk7DQogICAgICAgICAgICBpZiAodGFyZ2V0UG9zaXRpb24gPT09IHVuZGVmaW5lZCB8fCB0YXJnZXRQb3NpdGlvbiA9PT0gLTEpIHsNCiAgICAgICAgICAgICAgICBwb3NpdGlvbiA9IC0xOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBwb3NpdGlvbiA9IHRhcmdldFBvc2l0aW9uOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKHBvc2l0aW9uID49IGJhc2UuJHVzZXJJdGVtcy5sZW5ndGggfHwgcG9zaXRpb24gPT09IC0xKSB7DQogICAgICAgICAgICAgICAgYmFzZS4kdXNlckl0ZW1zLmVxKC0xKS5hZnRlcihodG1sU3RyaW5nKTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgYmFzZS4kdXNlckl0ZW1zLmVxKHBvc2l0aW9uKS5iZWZvcmUoaHRtbFN0cmluZyk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGJhc2Uuc2V0VmFycygpOw0KICAgICAgICB9LA0KDQogICAgICAgIHJlbW92ZUl0ZW06IGZ1bmN0aW9uICh0YXJnZXRQb3NpdGlvbikgew0KICAgICAgICAgICAgdmFyIGJhc2UgPSB0aGlzLA0KICAgICAgICAgICAgICAgIHBvc2l0aW9uOw0KDQogICAgICAgICAgICBpZiAoYmFzZS4kZWxlbS5jaGlsZHJlbigpLmxlbmd0aCA9PT0gMCkgew0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmICh0YXJnZXRQb3NpdGlvbiA9PT0gdW5kZWZpbmVkIHx8IHRhcmdldFBvc2l0aW9uID09PSAtMSkgew0KICAgICAgICAgICAgICAgIHBvc2l0aW9uID0gLTE7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIHBvc2l0aW9uID0gdGFyZ2V0UG9zaXRpb247DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGJhc2UudW5XcmFwKCk7DQogICAgICAgICAgICBiYXNlLiR1c2VySXRlbXMuZXEocG9zaXRpb24pLnJlbW92ZSgpOw0KICAgICAgICAgICAgYmFzZS5zZXRWYXJzKCk7DQogICAgICAgIH0NCg0KICAgIH07DQoNCiAgICAkLmZuLm93bENhcm91c2VsID0gZnVuY3Rpb24gKG9wdGlvbnMpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICBpZiAoJCh0aGlzKS5kYXRhKCJvd2wtaW5pdCIpID09PSB0cnVlKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgJCh0aGlzKS5kYXRhKCJvd2wtaW5pdCIsIHRydWUpOw0KICAgICAgICAgICAgdmFyIGNhcm91c2VsID0gT2JqZWN0LmNyZWF0ZShDYXJvdXNlbCk7DQogICAgICAgICAgICBjYXJvdXNlbC5pbml0KG9wdGlvbnMsIHRoaXMpOw0KICAgICAgICAgICAgJC5kYXRhKHRoaXMsICJvd2xDYXJvdXNlbCIsIGNhcm91c2VsKTsNCiAgICAgICAgfSk7DQogICAgfTsNCg0KICAgICQuZm4ub3dsQ2Fyb3VzZWwub3B0aW9ucyA9IHsNCg0KICAgICAgICBpdGVtczogNSwNCiAgICAgICAgaXRlbXNDdXN0b206IGZhbHNlLA0KICAgICAgICBpdGVtc0Rlc2t0b3A6IFsxMTk5LCA0XSwNCiAgICAgICAgaXRlbXNEZXNrdG9wU21hbGw6IFs5NzksIDNdLA0KICAgICAgICBpdGVtc1RhYmxldDogWzc2OCwgMl0sDQogICAgICAgIGl0ZW1zVGFibGV0U21hbGw6IGZhbHNlLA0KICAgICAgICBpdGVtc01vYmlsZTogWzQ3OSwgMV0sDQogICAgICAgIHNpbmdsZUl0ZW06IGZhbHNlLA0KICAgICAgICBpdGVtc1NjYWxlVXA6IGZhbHNlLA0KDQogICAgICAgIHNsaWRlU3BlZWQ6IDIwMCwNCiAgICAgICAgcGFnaW5hdGlvblNwZWVkOiA4MDAsDQogICAgICAgIHJld2luZFNwZWVkOiAxMDAwLA0KDQogICAgICAgIGF1dG9QbGF5OiBmYWxzZSwNCiAgICAgICAgc3RvcE9uSG92ZXI6IGZhbHNlLA0KDQogICAgICAgIG5hdmlnYXRpb246IGZhbHNlLA0KICAgICAgICBuYXZpZ2F0aW9uVGV4dDogWyJwcmV2IiwgIm5leHQiXSwNCiAgICAgICAgcmV3aW5kTmF2OiB0cnVlLA0KICAgICAgICBzY3JvbGxQZXJQYWdlOiBmYWxzZSwNCg0KICAgICAgICBwYWdpbmF0aW9uOiB0cnVlLA0KICAgICAgICBwYWdpbmF0aW9uTnVtYmVyczogZmFsc2UsDQoNCiAgICAgICAgcmVzcG9uc2l2ZTogdHJ1ZSwNCiAgICAgICAgcmVzcG9uc2l2ZVJlZnJlc2hSYXRlOiAyMDAsDQogICAgICAgIHJlc3BvbnNpdmVCYXNlV2lkdGg6IHdpbmRvdywNCg0KICAgICAgICBiYXNlQ2xhc3M6ICJvd2wtY2Fyb3VzZWwiLA0KICAgICAgICB0aGVtZTogIm93bC10aGVtZSIsDQoNCiAgICAgICAgbGF6eUxvYWQ6IGZhbHNlLA0KICAgICAgICBsYXp5Rm9sbG93OiB0cnVlLA0KICAgICAgICBsYXp5RWZmZWN0OiAiZmFkZSIsDQoNCiAgICAgICAgYXV0b0hlaWdodDogZmFsc2UsDQoNCiAgICAgICAganNvblBhdGg6IGZhbHNlLA0KICAgICAgICBqc29uU3VjY2VzczogZmFsc2UsDQoNCiAgICAgICAgZHJhZ0JlZm9yZUFuaW1GaW5pc2g6IHRydWUsDQogICAgICAgIG1vdXNlRHJhZzogdHJ1ZSwNCiAgICAgICAgdG91Y2hEcmFnOiB0cnVlLA0KDQogICAgICAgIGFkZENsYXNzQWN0aXZlOiBmYWxzZSwNCiAgICAgICAgdHJhbnNpdGlvblN0eWxlOiBmYWxzZSwNCg0KICAgICAgICBiZWZvcmVVcGRhdGU6IGZhbHNlLA0KICAgICAgICBhZnRlclVwZGF0ZTogZmFsc2UsDQogICAgICAgIGJlZm9yZUluaXQ6IGZhbHNlLA0KICAgICAgICBhZnRlckluaXQ6IGZhbHNlLA0KICAgICAgICBiZWZvcmVNb3ZlOiBmYWxzZSwNCiAgICAgICAgYWZ0ZXJNb3ZlOiBmYWxzZSwNCiAgICAgICAgYWZ0ZXJBY3Rpb246IGZhbHNlLA0KICAgICAgICBzdGFydERyYWdnaW5nOiBmYWxzZSwNCiAgICAgICAgYWZ0ZXJMYXp5TG9hZDogZmFsc2UNCiAgICB9Ow0KfShqUXVlcnksIHdpbmRvdywgZG9jdW1lbnQpKTs=
- ID: "6954b7c7-2487-423f-8600-436cb3b6dc0e"
  Hint: Size
  Value: 54119
- ID: "6f47a0a5-9c94-4b48-abeb-42d38def6054"
  Hint: Mime Type
  Value: "application/x-javascript"
- ID: "c06867fe-9a43-4c7d-b739-48780492d06f"
  Hint: Extension
  Value: js
Languages:
- Language: en
  Versions:
  - Version: 1
    Fields:
    - ID: "25bed78c-4957-4165-998a-ca1b52f67497"
      Hint: __Created
      Value: 20180203T231825Z
