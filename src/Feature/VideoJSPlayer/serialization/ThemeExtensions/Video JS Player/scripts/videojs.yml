---
ID: "07735f5e-0acf-4d45-a5b8-bbf3c023941f"
Parent: "5da90de6-88df-4e4e-9ab7-b0b9b837f6f9"
Template: "962b53c4-f93b-4df9-9821-415c867b8903"
Path: /sitecore/media library/Extension Themes/Video JS Player/scripts/videojs
DB: master
SharedFields:
- ID: "06d5295c-ed2f-4a54-9bf2-26228d113318"
  Hint: __Icon
  Value: "-/media/07735F5E0ACF4D45A5B8BBF3C023941F.ashx?h=16&thn=1&w=16"
- ID: "40e50ed9-ba07-4702-992e-a912738d32dc"
  Hint: Blob
  BlobID: "646258b4-770b-4ea8-927c-6aec5a97ff4d"
  Value: 77u/LyohIFZpZGVvLmpzIHY0LjEyLjExIENvcHlyaWdodCAyMDE0IEJyaWdodGNvdmUsIEluYy4gaHR0cHM6Ly9naXRodWIuY29tL3ZpZGVvanMvdmlkZW8uanMvYmxvYi9tYXN0ZXIvTElDRU5TRSAqLw0KKGZ1bmN0aW9uICgpIHsNCiAgICB2YXIgYiA9IHZvaWQgMCwNCiAgICAgICAgZiA9ICEwLA0KICAgICAgICBqID0gbnVsbCwNCiAgICAgICAgbCA9ICExOw0KDQogICAgZnVuY3Rpb24gbSgpIHsNCiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsgfQ0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIG4oYSkgew0KICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgcmV0dXJuIHRoaXNbYV0NCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHAoYSkgew0KICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgcmV0dXJuIGENCiAgICAgICAgfQ0KICAgIH0NCiAgICB2YXIgczsNCiAgICBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ2aWRlbyIpOw0KICAgIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImF1ZGlvIik7DQogICAgZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgidHJhY2siKTsNCg0KICAgIGZ1bmN0aW9uIHQoYSwgYywgZCkgew0KICAgICAgICBpZiAoInN0cmluZyIgPT09IHR5cGVvZiBhKSB7DQogICAgICAgICAgICAwID09PSBhLmluZGV4T2YoIiMiKSAmJiAoYSA9IGEuc2xpY2UoMSkpOw0KICAgICAgICAgICAgaWYgKHQuRGFbYV0pIHJldHVybiBjICYmIHQubG9nLndhcm4oJ1BsYXllciAiJyArIGEgKyAnIiBpcyBhbHJlYWR5IGluaXRpYWxpc2VkLiBPcHRpb25zIHdpbGwgbm90IGJlIGFwcGxpZWQuJyksIGQgJiYgdC5EYVthXS5JKGQpLCB0LkRhW2FdOw0KICAgICAgICAgICAgYSA9IHQubShhKQ0KICAgICAgICB9DQogICAgICAgIGlmICghYSB8fCAhYS5ub2RlTmFtZSkgdGhyb3cgbmV3IFR5cGVFcnJvcigiVGhlIGVsZW1lbnQgb3IgSUQgc3VwcGxpZWQgaXMgbm90IHZhbGlkLiAodmlkZW9qcykiKTsNCiAgICAgICAgcmV0dXJuIGEucGxheWVyIHx8IG5ldyB0LlBsYXllcihhLCBjLCBkKQ0KICAgIH0NCiAgICB2YXIgdmlkZW9qcyA9IHdpbmRvdy52aWRlb2pzID0gdDsNCiAgICB0LmpjID0gIjQuMTIiOw0KICAgIHQud2QgPSAiaHR0cHM6IiA9PSBkb2N1bWVudC5sb2NhdGlvbi5wcm90b2NvbCA/ICJodHRwczovLyIgOiAiaHR0cDovLyI7DQogICAgdC5WRVJTSU9OID0gIjQuMTIuMTEiOw0KICAgIHQub3B0aW9ucyA9IHsNCiAgICAgICAgdGVjaE9yZGVyOiBbImh0bWw1IiwgImZsYXNoIl0sDQogICAgICAgIGh0bWw1OiB7fSwNCiAgICAgICAgZmxhc2g6IHt9LA0KICAgICAgICB3aWR0aDogMzAwLA0KICAgICAgICBoZWlnaHQ6IDE1MCwNCiAgICAgICAgZGVmYXVsdFZvbHVtZTogMCwNCiAgICAgICAgcGxheWJhY2tSYXRlczogW10sDQogICAgICAgIGluYWN0aXZpdHlUaW1lb3V0OiAyRTMsDQogICAgICAgIGNoaWxkcmVuOiB7DQogICAgICAgICAgICBtZWRpYUxvYWRlcjoge30sDQogICAgICAgICAgICBwb3N0ZXJJbWFnZToge30sDQogICAgICAgICAgICBsb2FkaW5nU3Bpbm5lcjoge30sDQogICAgICAgICAgICB0ZXh0VHJhY2tEaXNwbGF5OiB7fSwNCiAgICAgICAgICAgIGJpZ1BsYXlCdXR0b246IHt9LA0KICAgICAgICAgICAgY29udHJvbEJhcjoge30sDQogICAgICAgICAgICBlcnJvckRpc3BsYXk6IHt9LA0KICAgICAgICAgICAgdGV4dFRyYWNrU2V0dGluZ3M6IHt9DQogICAgICAgIH0sDQogICAgICAgIGxhbmd1YWdlOiBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiaHRtbCIpWzBdLmdldEF0dHJpYnV0ZSgibGFuZyIpIHx8IG5hdmlnYXRvci5sYW5ndWFnZXMgJiYgbmF2aWdhdG9yLmxhbmd1YWdlc1swXSB8fCBuYXZpZ2F0b3IuSmYgfHwgbmF2aWdhdG9yLmxhbmd1YWdlIHx8ICJlbiIsDQogICAgICAgIGxhbmd1YWdlczoge30sDQogICAgICAgIG5vdFN1cHBvcnRlZE1lc3NhZ2U6ICJObyBjb21wYXRpYmxlIHNvdXJjZSB3YXMgZm91bmQgZm9yIHRoaXMgdmlkZW8uIg0KICAgIH07DQogICAgIkdFTkVSQVRFRF9DRE5fVlNOIiAhPT0gdC5qYyAmJiAodmlkZW9qcy5vcHRpb25zLmZsYXNoLnN3ZiA9IHQud2QgKyAidmpzLnplbmNkbi5uZXQvIiArIHQuamMgKyAiL3ZpZGVvLWpzLnN3ZiIpOw0KICAgIHQuS2QgPSBmdW5jdGlvbiAoYSwgYykgew0KICAgICAgICB0Lm9wdGlvbnMubGFuZ3VhZ2VzW2FdID0gdC5vcHRpb25zLmxhbmd1YWdlc1thXSAhPT0gYiA/IHQuJC5CYSh0Lm9wdGlvbnMubGFuZ3VhZ2VzW2FdLCBjKSA6IGM7DQogICAgICAgIHJldHVybiB0Lm9wdGlvbnMubGFuZ3VhZ2VzDQogICAgfTsNCiAgICB0LkRhID0ge307DQogICAgImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGRlZmluZSAmJiBkZWZpbmUuYW1kID8gZGVmaW5lKCJ2aWRlb2pzIiwgW10sIGZ1bmN0aW9uICgpIHsNCiAgICAgICAgcmV0dXJuIHZpZGVvanMNCiAgICB9KSA6ICJvYmplY3QiID09PSB0eXBlb2YgZXhwb3J0cyAmJiAib2JqZWN0IiA9PT0gdHlwZW9mIG1vZHVsZSAmJiAobW9kdWxlLmV4cG9ydHMgPSB2aWRlb2pzKTsNCiAgICB0LkhhID0gdC5Db3JlT2JqZWN0ID0gbSgpOw0KICAgIHQuSGEuZXh0ZW5kID0gZnVuY3Rpb24gKGEpIHsNCiAgICAgICAgdmFyIGMsIGQ7DQogICAgICAgIGEgPSBhIHx8IHt9Ow0KICAgICAgICBjID0gYS5pbml0IHx8IGEubCB8fCB0aGlzLnByb3RvdHlwZS5pbml0IHx8IHRoaXMucHJvdG90eXBlLmwgfHwgbSgpOw0KICAgICAgICBkID0gZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgYy5hcHBseSh0aGlzLCBhcmd1bWVudHMpDQogICAgICAgIH07DQogICAgICAgIGQucHJvdG90eXBlID0gdC5pLmNyZWF0ZSh0aGlzLnByb3RvdHlwZSk7DQogICAgICAgIGQucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gZDsNCiAgICAgICAgZC5leHRlbmQgPSB0LkhhLmV4dGVuZDsNCiAgICAgICAgZC5jcmVhdGUgPSB0LkhhLmNyZWF0ZTsNCiAgICAgICAgZm9yICh2YXIgZSBpbiBhKSBhLmhhc093blByb3BlcnR5KGUpICYmIChkLnByb3RvdHlwZVtlXSA9IGFbZV0pOw0KICAgICAgICByZXR1cm4gZA0KICAgIH07DQogICAgdC5IYS5jcmVhdGUgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHZhciBhID0gdC5pLmNyZWF0ZSh0aGlzLnByb3RvdHlwZSk7DQogICAgICAgIHRoaXMuYXBwbHkoYSwgYXJndW1lbnRzKTsNCiAgICAgICAgcmV0dXJuIGENCiAgICB9Ow0KICAgIHQuYiA9IGZ1bmN0aW9uIChhLCBjLCBkKSB7DQogICAgICAgIGlmICh0LmkuaXNBcnJheShjKSkgcmV0dXJuIHYodC5iLCBhLCBjLCBkKTsNCiAgICAgICAgdmFyIGUgPSB0LmdldERhdGEoYSk7DQogICAgICAgIGUuRyB8fCAoZS5HID0ge30pOw0KICAgICAgICBlLkdbY10gfHwgKGUuR1tjXSA9IFtdKTsNCiAgICAgICAgZC5zIHx8IChkLnMgPSB0LnMrKyk7DQogICAgICAgIGUuR1tjXS5wdXNoKGQpOw0KICAgICAgICBlLmNhIHx8IChlLmRpc2FibGVkID0gbCwgZS5jYSA9IGZ1bmN0aW9uIChjKSB7DQogICAgICAgICAgICBpZiAoIWUuZGlzYWJsZWQpIHsNCiAgICAgICAgICAgICAgICBjID0gdC5RYihjKTsNCiAgICAgICAgICAgICAgICB2YXIgZCA9IGUuR1tjLnR5cGVdOw0KICAgICAgICAgICAgICAgIGlmIChkKQ0KICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBkID0gZC5zbGljZSgwKSwgayA9IDAsIHEgPSBkLmxlbmd0aDsgayA8IHEgJiYgIWMuUmMoKSA7IGsrKykgZFtrXS5jYWxsKGEsIGMpDQogICAgICAgICAgICB9DQogICAgICAgIH0pOw0KICAgICAgICAxID09IGUuR1tjXS5sZW5ndGggJiYgKGEuYWRkRXZlbnRMaXN0ZW5lciA/IGEuYWRkRXZlbnRMaXN0ZW5lcihjLCBlLmNhLCBsKSA6IGEuYXR0YWNoRXZlbnQgJiYgYS5hdHRhY2hFdmVudCgib24iICsgYywgZS5jYSkpDQogICAgfTsNCiAgICB0Lm4gPSBmdW5jdGlvbiAoYSwgYywgZCkgew0KICAgICAgICBpZiAodC5NYyhhKSkgew0KICAgICAgICAgICAgdmFyIGUgPSB0LmdldERhdGEoYSk7DQogICAgICAgICAgICBpZiAoZS5HKSB7DQogICAgICAgICAgICAgICAgaWYgKHQuaS5pc0FycmF5KGMpKSByZXR1cm4gdih0Lm4sIGEsIGMsIGQpOw0KICAgICAgICAgICAgICAgIGlmIChjKSB7DQogICAgICAgICAgICAgICAgICAgIHZhciBnID0gZS5HW2NdOw0KICAgICAgICAgICAgICAgICAgICBpZiAoZykgew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGQpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZC5zKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGUgPSAwOyBlIDwgZy5sZW5ndGg7IGUrKykgZ1tlXS5zID09PSBkLnMgJiYgZy5zcGxpY2UoZS0tLCAxKQ0KICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGUuR1tjXSA9IFtdOw0KICAgICAgICAgICAgICAgICAgICAgICAgdC5CYyhhLCBjKQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSBlbHNlDQogICAgICAgICAgICAgICAgICAgIGZvciAoZyBpbiBlLkcpIGMgPSBnLCBlLkdbY10gPSBbXSwgdC5CYyhhLCBjKQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfTsNCiAgICB0LkJjID0gZnVuY3Rpb24gKGEsIGMpIHsNCiAgICAgICAgdmFyIGQgPSB0LmdldERhdGEoYSk7DQogICAgICAgIDAgPT09IGQuR1tjXS5sZW5ndGggJiYgKGRlbGV0ZSBkLkdbY10sIGEucmVtb3ZlRXZlbnRMaXN0ZW5lciA/IGEucmVtb3ZlRXZlbnRMaXN0ZW5lcihjLCBkLmNhLCBsKSA6IGEuZGV0YWNoRXZlbnQgJiYgYS5kZXRhY2hFdmVudCgib24iICsgYywgZC5jYSkpOw0KICAgICAgICB0LmtiKGQuRykgJiYgKGRlbGV0ZSBkLkcsIGRlbGV0ZSBkLmNhLCBkZWxldGUgZC5kaXNhYmxlZCk7DQogICAgICAgIHQua2IoZCkgJiYgdC5jZChhKQ0KICAgIH07DQogICAgdC5RYiA9IGZ1bmN0aW9uIChhKSB7DQogICAgICAgIGZ1bmN0aW9uIGMoKSB7DQogICAgICAgICAgICByZXR1cm4gZg0KICAgICAgICB9DQoNCiAgICAgICAgZnVuY3Rpb24gZCgpIHsNCiAgICAgICAgICAgIHJldHVybiBsDQogICAgICAgIH0NCiAgICAgICAgaWYgKCFhIHx8ICFhLldiKSB7DQogICAgICAgICAgICB2YXIgZSA9IGEgfHwgd2luZG93LmV2ZW50Ow0KICAgICAgICAgICAgYSA9IHt9Ow0KICAgICAgICAgICAgZm9yICh2YXIgZyBpbiBlKSAibGF5ZXJYIiAhPT0gZyAmJiAoImxheWVyWSIgIT09IGcgJiYgImtleUxvY2F0aW9uIiAhPT0gZykgJiYgKCJyZXR1cm5WYWx1ZSIgPT0gZyAmJiBlLnByZXZlbnREZWZhdWx0IHx8IChhW2ddID0gZVtnXSkpOw0KICAgICAgICAgICAgYS50YXJnZXQgfHwgKGEudGFyZ2V0ID0gYS5zcmNFbGVtZW50IHx8IGRvY3VtZW50KTsNCiAgICAgICAgICAgIGEucmVsYXRlZFRhcmdldCA9IGEuZnJvbUVsZW1lbnQgPT09IGEudGFyZ2V0ID8gYS50b0VsZW1lbnQgOiBhLmZyb21FbGVtZW50Ow0KICAgICAgICAgICAgYS5wcmV2ZW50RGVmYXVsdCA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0ICYmIGUucHJldmVudERlZmF1bHQoKTsNCiAgICAgICAgICAgICAgICBhLnJldHVyblZhbHVlID0gbDsNCiAgICAgICAgICAgICAgICBhLmplID0gYzsNCiAgICAgICAgICAgICAgICBhLmRlZmF1bHRQcmV2ZW50ZWQgPSBmDQogICAgICAgICAgICB9Ow0KICAgICAgICAgICAgYS5qZSA9IGQ7DQogICAgICAgICAgICBhLmRlZmF1bHRQcmV2ZW50ZWQgPSBsOw0KICAgICAgICAgICAgYS5zdG9wUHJvcGFnYXRpb24gPSBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24gJiYNCiAgICAgICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsNCiAgICAgICAgICAgICAgICBhLmNhbmNlbEJ1YmJsZSA9IGY7DQogICAgICAgICAgICAgICAgYS5XYiA9IGMNCiAgICAgICAgICAgIH07DQogICAgICAgICAgICBhLldiID0gZDsNCiAgICAgICAgICAgIGEuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uID0gZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgIGUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uICYmIGUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7DQogICAgICAgICAgICAgICAgYS5SYyA9IGM7DQogICAgICAgICAgICAgICAgYS5zdG9wUHJvcGFnYXRpb24oKQ0KICAgICAgICAgICAgfTsNCiAgICAgICAgICAgIGEuUmMgPSBkOw0KICAgICAgICAgICAgaWYgKGEuY2xpZW50WCAhPSBqKSB7DQogICAgICAgICAgICAgICAgZyA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudDsNCiAgICAgICAgICAgICAgICB2YXIgaCA9IGRvY3VtZW50LmJvZHk7DQogICAgICAgICAgICAgICAgYS5wYWdlWCA9IGEuY2xpZW50WCArIChnICYmIGcuc2Nyb2xsTGVmdCB8fCBoICYmIGguc2Nyb2xsTGVmdCB8fCAwKSAtIChnICYmIGcuY2xpZW50TGVmdCB8fCBoICYmIGguY2xpZW50TGVmdCB8fCAwKTsNCiAgICAgICAgICAgICAgICBhLnBhZ2VZID0gYS5jbGllbnRZICsgKGcgJiYgZy5zY3JvbGxUb3AgfHwgaCAmJiBoLnNjcm9sbFRvcCB8fCAwKSAtIChnICYmIGcuY2xpZW50VG9wIHx8IGggJiYgaC5jbGllbnRUb3AgfHwgMCkNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGEud2hpY2ggPSBhLmNoYXJDb2RlIHx8IGEua2V5Q29kZTsNCiAgICAgICAgICAgIGEuYnV0dG9uICE9IGogJiYgKGEuYnV0dG9uID0gYS5idXR0b24gJiAxID8gMCA6IGEuYnV0dG9uICYNCiAgICAgICAgICAgICAgICA0ID8gMSA6IGEuYnV0dG9uICYgMiA/IDIgOiAwKQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiBhDQogICAgfTsNCiAgICB0Lm8gPSBmdW5jdGlvbiAoYSwgYykgew0KICAgICAgICB2YXIgZCA9IHQuTWMoYSkgPyB0LmdldERhdGEoYSkgOiB7fSwNCiAgICAgICAgICAgIGUgPSBhLnBhcmVudE5vZGUgfHwgYS5vd25lckRvY3VtZW50Ow0KICAgICAgICAic3RyaW5nIiA9PT0gdHlwZW9mIGMgJiYgKGMgPSB7DQogICAgICAgICAgICB0eXBlOiBjLA0KICAgICAgICAgICAgdGFyZ2V0OiBhDQogICAgICAgIH0pOw0KICAgICAgICBjID0gdC5RYihjKTsNCiAgICAgICAgZC5jYSAmJiBkLmNhLmNhbGwoYSwgYyk7DQogICAgICAgIGlmIChlICYmICFjLldiKCkgJiYgYy5idWJibGVzICE9PSBsKSB0Lm8oZSwgYyk7DQogICAgICAgIGVsc2UgaWYgKCFlICYmICFjLmRlZmF1bHRQcmV2ZW50ZWQgJiYgKGQgPSB0LmdldERhdGEoYy50YXJnZXQpLCBjLnRhcmdldFtjLnR5cGVdKSkgew0KICAgICAgICAgICAgZC5kaXNhYmxlZCA9IGY7DQogICAgICAgICAgICBpZiAoImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGMudGFyZ2V0W2MudHlwZV0pIGMudGFyZ2V0W2MudHlwZV0oKTsNCiAgICAgICAgICAgIGQuZGlzYWJsZWQgPSBsDQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuICFjLmRlZmF1bHRQcmV2ZW50ZWQNCiAgICB9Ow0KICAgIHQuTiA9IGZ1bmN0aW9uIChhLCBjLCBkKSB7DQogICAgICAgIGZ1bmN0aW9uIGUoKSB7DQogICAgICAgICAgICB0Lm4oYSwgYywgZSk7DQogICAgICAgICAgICBkLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykNCiAgICAgICAgfQ0KICAgICAgICBpZiAodC5pLmlzQXJyYXkoYykpIHJldHVybiB2KHQuTiwgYSwgYywgZCk7DQogICAgICAgIGUucyA9IGQucyA9IGQucyB8fCB0LnMrKzsNCiAgICAgICAgdC5iKGEsIGMsIGUpDQogICAgfTsNCg0KICAgIGZ1bmN0aW9uIHYoYSwgYywgZCwgZSkgew0KICAgICAgICB0LnhjLmZvckVhY2goZCwgZnVuY3Rpb24gKGQpIHsNCiAgICAgICAgICAgIGEoYywgZCwgZSkNCiAgICAgICAgfSkNCiAgICB9DQogICAgdmFyIHcgPSBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5Ow0KICAgIHQuZiA9IGZ1bmN0aW9uIChhLCBjKSB7DQogICAgICAgIHZhciBkOw0KICAgICAgICBjID0gYyB8fCB7fTsNCiAgICAgICAgZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoYSB8fCAiZGl2Iik7DQogICAgICAgIHQuaS5kYShjLCBmdW5jdGlvbiAoYSwgYykgew0KICAgICAgICAgICAgLTEgIT09IGEuaW5kZXhPZigiYXJpYS0iKSB8fCAicm9sZSIgPT0gYSA/IGQuc2V0QXR0cmlidXRlKGEsIGMpIDogZFthXSA9IGMNCiAgICAgICAgfSk7DQogICAgICAgIHJldHVybiBkDQogICAgfTsNCiAgICB0LndhID0gZnVuY3Rpb24gKGEpIHsNCiAgICAgICAgcmV0dXJuIGEuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBhLnNsaWNlKDEpDQogICAgfTsNCiAgICB0LmkgPSB7fTsNCiAgICB0LmkuY3JlYXRlID0gT2JqZWN0LmNyZWF0ZSB8fCBmdW5jdGlvbiAoYSkgew0KICAgICAgICBmdW5jdGlvbiBjKCkgeyB9DQogICAgICAgIGMucHJvdG90eXBlID0gYTsNCiAgICAgICAgcmV0dXJuIG5ldyBjDQogICAgfTsNCiAgICB0LmkuZGEgPSBmdW5jdGlvbiAoYSwgYywgZCkgew0KICAgICAgICBmb3IgKHZhciBlIGluIGEpIHcuY2FsbChhLCBlKSAmJiBjLmNhbGwoZCB8fCB0aGlzLCBlLCBhW2VdKQ0KICAgIH07DQogICAgdC5pLkQgPSBmdW5jdGlvbiAoYSwgYykgew0KICAgICAgICBpZiAoIWMpIHJldHVybiBhOw0KICAgICAgICBmb3IgKHZhciBkIGluIGMpIHcuY2FsbChjLCBkKSAmJiAoYVtkXSA9IGNbZF0pOw0KICAgICAgICByZXR1cm4gYQ0KICAgIH07DQogICAgdC5pLlNkID0gZnVuY3Rpb24gKGEsIGMpIHsNCiAgICAgICAgdmFyIGQsIGUsIGc7DQogICAgICAgIGEgPSB0LmkuY29weShhKTsNCiAgICAgICAgZm9yIChkIGluIGMpIHcuY2FsbChjLCBkKSAmJiAoZSA9IGFbZF0sIGcgPSBjW2RdLCBhW2RdID0gdC5pLmxiKGUpICYmIHQuaS5sYihnKSA/IHQuaS5TZChlLCBnKSA6IGNbZF0pOw0KICAgICAgICByZXR1cm4gYQ0KICAgIH07DQogICAgdC5pLmNvcHkgPSBmdW5jdGlvbiAoYSkgew0KICAgICAgICByZXR1cm4gdC5pLkQoe30sIGEpDQogICAgfTsNCiAgICB0LmkubGIgPSBmdW5jdGlvbiAoYSkgew0KICAgICAgICByZXR1cm4gISFhICYmICJvYmplY3QiID09PSB0eXBlb2YgYSAmJiAiW29iamVjdCBPYmplY3RdIiA9PT0gYS50b1N0cmluZygpICYmIGEuY29uc3RydWN0b3IgPT09IE9iamVjdA0KICAgIH07DQogICAgdC5pLmlzQXJyYXkgPSBBcnJheS5pc0FycmF5IHx8IGZ1bmN0aW9uIChhKSB7DQogICAgICAgIHJldHVybiAiW29iamVjdCBBcnJheV0iID09PSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoYSkNCiAgICB9Ow0KICAgIHQubGUgPSBmdW5jdGlvbiAoYSkgew0KICAgICAgICByZXR1cm4gYSAhPT0gYQ0KICAgIH07DQogICAgdC5iaW5kID0gZnVuY3Rpb24gKGEsIGMsIGQpIHsNCiAgICAgICAgZnVuY3Rpb24gZSgpIHsNCiAgICAgICAgICAgIHJldHVybiBjLmFwcGx5KGEsIGFyZ3VtZW50cykNCiAgICAgICAgfQ0KICAgICAgICBjLnMgfHwgKGMucyA9IHQucysrKTsNCiAgICAgICAgZS5zID0gZCA/IGQgKyAiXyIgKyBjLnMgOiBjLnM7DQogICAgICAgIHJldHVybiBlDQogICAgfTsNCiAgICB0LnZhID0ge307DQogICAgdC5zID0gMTsNCiAgICB0LmV4cGFuZG8gPSAidmRhdGEiICsgKG5ldyBEYXRlKS5nZXRUaW1lKCk7DQogICAgdC5nZXREYXRhID0gZnVuY3Rpb24gKGEpIHsNCiAgICAgICAgdmFyIGMgPSBhW3QuZXhwYW5kb107DQogICAgICAgIGMgfHwgKGMgPSBhW3QuZXhwYW5kb10gPSB0LnMrKyk7DQogICAgICAgIHQudmFbY10gfHwgKHQudmFbY10gPSB7fSk7DQogICAgICAgIHJldHVybiB0LnZhW2NdDQogICAgfTsNCiAgICB0Lk1jID0gZnVuY3Rpb24gKGEpIHsNCiAgICAgICAgYSA9IGFbdC5leHBhbmRvXTsNCiAgICAgICAgcmV0dXJuICEoIWEgfHwgdC5rYih0LnZhW2FdKSkNCiAgICB9Ow0KICAgIHQuY2QgPSBmdW5jdGlvbiAoYSkgew0KICAgICAgICB2YXIgYyA9IGFbdC5leHBhbmRvXTsNCiAgICAgICAgaWYgKGMpIHsNCiAgICAgICAgICAgIGRlbGV0ZSB0LnZhW2NdOw0KICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICBkZWxldGUgYVt0LmV4cGFuZG9dDQogICAgICAgICAgICB9IGNhdGNoIChkKSB7DQogICAgICAgICAgICAgICAgYS5yZW1vdmVBdHRyaWJ1dGUgPyBhLnJlbW92ZUF0dHJpYnV0ZSh0LmV4cGFuZG8pIDogYVt0LmV4cGFuZG9dID0gag0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfTsNCiAgICB0LmtiID0gZnVuY3Rpb24gKGEpIHsNCiAgICAgICAgZm9yICh2YXIgYyBpbiBhKQ0KICAgICAgICAgICAgaWYgKGFbY10gIT09IGopIHJldHVybiBsOw0KICAgICAgICByZXR1cm4gZg0KICAgIH07DQogICAgdC5RYSA9IGZ1bmN0aW9uIChhLCBjKSB7DQogICAgICAgIHJldHVybiAtMSAhPT0gKCIgIiArIGEuY2xhc3NOYW1lICsgIiAiKS5pbmRleE9mKCIgIiArIGMgKyAiICIpDQogICAgfTsNCiAgICB0LnAgPSBmdW5jdGlvbiAoYSwgYykgew0KICAgICAgICB0LlFhKGEsIGMpIHx8IChhLmNsYXNzTmFtZSA9ICIiID09PSBhLmNsYXNzTmFtZSA/IGMgOiBhLmNsYXNzTmFtZSArICIgIiArIGMpDQogICAgfTsNCiAgICB0LnIgPSBmdW5jdGlvbiAoYSwgYykgew0KICAgICAgICB2YXIgZCwgZTsNCiAgICAgICAgaWYgKHQuUWEoYSwgYykpIHsNCiAgICAgICAgICAgIGQgPSBhLmNsYXNzTmFtZS5zcGxpdCgiICIpOw0KICAgICAgICAgICAgZm9yIChlID0gZC5sZW5ndGggLSAxOyAwIDw9IGU7IGUtLSkgZFtlXSA9PT0gYyAmJiBkLnNwbGljZShlLCAxKTsNCiAgICAgICAgICAgIGEuY2xhc3NOYW1lID0gZC5qb2luKCIgIikNCiAgICAgICAgfQ0KICAgIH07DQogICAgdC5BID0gdC5mKCJ2aWRlbyIpOw0KICAgIHZhciB4ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgidHJhY2siKTsNCiAgICB4LlhiID0gImNhcHRpb25zIjsNCiAgICB4LmpkID0gImVuIjsNCiAgICB4LmxhYmVsID0gIkVuZ2xpc2giOw0KICAgIHQuQS5hcHBlbmRDaGlsZCh4KTsNCiAgICB0LlAgPSBuYXZpZ2F0b3IudXNlckFnZW50Ow0KICAgIHQuRGQgPSAvaVBob25lL2kudGVzdCh0LlApOw0KICAgIHQuQ2QgPSAvaVBhZC9pLnRlc3QodC5QKTsNCiAgICB0LkVkID0gL2lQb2QvaS50ZXN0KHQuUCk7DQogICAgdC5CZCA9IHQuRGQgfHwgdC5DZCB8fCB0LkVkOw0KICAgIHZhciBhYSA9IHQsDQogICAgICAgIHk7DQogICAgdmFyIHogPSB0LlAubWF0Y2goL09TIChcZCspXy9pKTsNCiAgICB5ID0geiAmJiB6WzFdID8gelsxXSA6IGI7DQogICAgYWEubGYgPSB5Ow0KICAgIHQuQWQgPSAvQW5kcm9pZC9pLnRlc3QodC5QKTsNCiAgICB2YXIgYmEgPSB0LA0KICAgICAgICBCOw0KICAgIHZhciBDID0gdC5QLm1hdGNoKC9BbmRyb2lkIChcZCspKD86XC4oXGQrKSk/KD86XC4oXGQrKSkqL2kpLA0KICAgICAgICBELCBFOw0KICAgIEMgPyAoRCA9IENbMV0gJiYgcGFyc2VGbG9hdChDWzFdKSwgRSA9IENbMl0gJiYgcGFyc2VGbG9hdChDWzJdKSwgQiA9IEQgJiYgRSA/IHBhcnNlRmxvYXQoQ1sxXSArICIuIiArIENbMl0pIDogRCA/IEQgOiBqKSA6IEIgPSBqOw0KICAgIGJhLmljID0gQjsNCiAgICB0LkZkID0gdC5BZCAmJiAvd2Via2l0L2kudGVzdCh0LlApICYmIDIuMyA+IHQuaWM7DQogICAgdC5rYyA9IC9GaXJlZm94L2kudGVzdCh0LlApOw0KICAgIHQubWYgPSAvQ2hyb21lL2kudGVzdCh0LlApOw0KICAgIHQucWEgPSAvTVNJRVxzOFwuMC8udGVzdCh0LlApOw0KICAgIHQuR2IgPSAhISgib250b3VjaHN0YXJ0IiBpbiB3aW5kb3cgfHwgd2luZG93LnlkICYmIGRvY3VtZW50IGluc3RhbmNlb2Ygd2luZG93LnlkKTsNCiAgICB0LnhkID0gImJhY2tncm91bmRTaXplIiBpbiB0LkEuc3R5bGU7DQogICAgdC5lZCA9IGZ1bmN0aW9uIChhLCBjKSB7DQogICAgICAgIHQuaS5kYShjLCBmdW5jdGlvbiAoYywgZSkgew0KICAgICAgICAgICAgZSA9PT0gaiB8fCAidW5kZWZpbmVkIiA9PT0gdHlwZW9mIGUgfHwgZSA9PT0gbCA/IGEucmVtb3ZlQXR0cmlidXRlKGMpIDogYS5zZXRBdHRyaWJ1dGUoYywgZSA9PT0gZiA/ICIiIDogZSkNCiAgICAgICAgfSkNCiAgICB9Ow0KICAgIHQuUGEgPSBmdW5jdGlvbiAoYSkgew0KICAgICAgICB2YXIgYywgZCwgZSwgZzsNCiAgICAgICAgYyA9IHt9Ow0KICAgICAgICBpZiAoYSAmJiBhLmF0dHJpYnV0ZXMgJiYgMCA8IGEuYXR0cmlidXRlcy5sZW5ndGgpIHsNCiAgICAgICAgICAgIGQgPSBhLmF0dHJpYnV0ZXM7DQogICAgICAgICAgICBmb3IgKHZhciBoID0gZC5sZW5ndGggLSAxOyAwIDw9IGg7IGgtLSkgew0KICAgICAgICAgICAgICAgIGUgPSBkW2hdLm5hbWU7DQogICAgICAgICAgICAgICAgZyA9IGRbaF0udmFsdWU7DQogICAgICAgICAgICAgICAgaWYgKCJib29sZWFuIiA9PT0gdHlwZW9mIGFbZV0gfHwgLTEgIT09ICIsYXV0b3BsYXksY29udHJvbHMsbG9vcCxtdXRlZCxkZWZhdWx0LCIuaW5kZXhPZigiLCIgKyBlICsgIiwiKSkgZyA9IGcgIT09IGogPyBmIDogbDsNCiAgICAgICAgICAgICAgICBjW2VdID0gZw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiBjDQogICAgfTsNCiAgICB0LndmID0gZnVuY3Rpb24gKGEsIGMpIHsNCiAgICAgICAgdmFyIGQgPSAiIjsNCiAgICAgICAgZG9jdW1lbnQuZGVmYXVsdFZpZXcgJiYgZG9jdW1lbnQuZGVmYXVsdFZpZXcuZ2V0Q29tcHV0ZWRTdHlsZSA/IGQgPSBkb2N1bWVudC5kZWZhdWx0Vmlldy5nZXRDb21wdXRlZFN0eWxlKGEsICIiKS5nZXRQcm9wZXJ0eVZhbHVlKGMpIDogYS5jdXJyZW50U3R5bGUgJiYgKGQgPSBhWyJjbGllbnQiICsgYy5zdWJzdHIoMCwgMSkudG9VcHBlckNhc2UoKSArIGMuc3Vic3RyKDEpXSArICJweCIpOw0KICAgICAgICByZXR1cm4gZA0KICAgIH07DQogICAgdC5WYiA9IGZ1bmN0aW9uIChhLCBjKSB7DQogICAgICAgIGMuZmlyc3RDaGlsZCA/IGMuaW5zZXJ0QmVmb3JlKGEsIGMuZmlyc3RDaGlsZCkgOiBjLmFwcGVuZENoaWxkKGEpDQogICAgfTsNCiAgICB0LmViID0ge307DQogICAgdC5tID0gZnVuY3Rpb24gKGEpIHsNCiAgICAgICAgMCA9PT0gYS5pbmRleE9mKCIjIikgJiYgKGEgPSBhLnNsaWNlKDEpKTsNCiAgICAgICAgcmV0dXJuIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGEpDQogICAgfTsNCiAgICB0Lk9hID0gZnVuY3Rpb24gKGEsIGMpIHsNCiAgICAgICAgYyA9IGMgfHwgYTsNCiAgICAgICAgdmFyIGQgPSBNYXRoLmZsb29yKGEgJSA2MCksDQogICAgICAgICAgICBlID0gTWF0aC5mbG9vcihhIC8gNjAgJSA2MCksDQogICAgICAgICAgICBnID0gTWF0aC5mbG9vcihhIC8gMzYwMCksDQogICAgICAgICAgICBoID0gTWF0aC5mbG9vcihjIC8gNjAgJSA2MCksDQogICAgICAgICAgICBrID0gTWF0aC5mbG9vcihjIC8gMzYwMCk7DQogICAgICAgIGlmIChpc05hTihhKSB8fCBJbmZpbml0eSA9PT0gYSkgZyA9IGUgPSBkID0gIi0iOw0KICAgICAgICBnID0gMCA8IGcgfHwgMCA8IGsgPyBnICsgIjoiIDogIiI7DQogICAgICAgIHJldHVybiBnICsgKCgoZyB8fCAxMCA8PSBoKSAmJiAxMCA+IGUgPyAiMCIgKyBlIDogZSkgKyAiOiIpICsgKDEwID4gZCA/ICIwIiArIGQgOiBkKQ0KICAgIH07DQogICAgdC5NZCA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgZG9jdW1lbnQuYm9keS5mb2N1cygpOw0KICAgICAgICBkb2N1bWVudC5vbnNlbGVjdHN0YXJ0ID0gcChsKQ0KICAgIH07DQogICAgdC5iZiA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgZG9jdW1lbnQub25zZWxlY3RzdGFydCA9IHAoZikNCiAgICB9Ow0KICAgIHQudHJpbSA9IGZ1bmN0aW9uIChhKSB7DQogICAgICAgIHJldHVybiAoYSArICIiKS5yZXBsYWNlKC9eXHMrfFxzKyQvZywgIiIpDQogICAgfTsNCiAgICB0LnJvdW5kID0gZnVuY3Rpb24gKGEsIGMpIHsNCiAgICAgICAgYyB8fCAoYyA9IDApOw0KICAgICAgICByZXR1cm4gTWF0aC5yb3VuZChhICogTWF0aC5wb3coMTAsIGMpKSAvIE1hdGgucG93KDEwLCBjKQ0KICAgIH07DQogICAgdC55YSA9IGZ1bmN0aW9uIChhLCBjKSB7DQogICAgICAgIHJldHVybiBhID09PSBiICYmIGMgPT09IGIgPyB7DQogICAgICAgICAgICBsZW5ndGg6IDAsDQogICAgICAgICAgICBzdGFydDogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgIHRocm93IEVycm9yKCJUaGlzIFRpbWVSYW5nZXMgb2JqZWN0IGlzIGVtcHR5Iik7DQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgZW5kOiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgdGhyb3cgRXJyb3IoIlRoaXMgVGltZVJhbmdlcyBvYmplY3QgaXMgZW1wdHkiKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSA6IHsNCiAgICAgICAgICAgIGxlbmd0aDogMSwNCiAgICAgICAgICAgIHN0YXJ0OiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGENCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBlbmQ6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gYw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfTsNCiAgICB0Lk5lID0gZnVuY3Rpb24gKGEpIHsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIHZhciBjID0gd2luZG93LmxvY2FsU3RvcmFnZSB8fCBsOw0KICAgICAgICAgICAgYyAmJiAoYy52b2x1bWUgPSBhKQ0KICAgICAgICB9IGNhdGNoIChkKSB7DQogICAgICAgICAgICAyMiA9PSBkLmNvZGUgfHwgMTAxNCA9PSBkLmNvZGUgPyB0LmxvZygiTG9jYWxTdG9yYWdlIEZ1bGwgKFZpZGVvSlMpIiwgZCkgOiAxOCA9PSBkLmNvZGUgPyB0LmxvZygiTG9jYWxTdG9yYWdlIG5vdCBhbGxvd2VkIChWaWRlb0pTKSIsIGQpIDogdC5sb2coIkxvY2FsU3RvcmFnZSBFcnJvciAoVmlkZW9KUykiLCBkKQ0KICAgICAgICB9DQogICAgfTsNCiAgICB0LmFlID0gZnVuY3Rpb24gKGEpIHsNCiAgICAgICAgYS5tYXRjaCgvXmh0dHBzPzpcL1wvLykgfHwgKGEgPSB0LmYoImRpdiIsIHsNCiAgICAgICAgICAgIGlubmVySFRNTDogJzxhIGhyZWY9IicgKyBhICsgJyI+eDwvYT4nDQogICAgICAgIH0pLmZpcnN0Q2hpbGQuaHJlZik7DQogICAgICAgIHJldHVybiBhDQogICAgfTsNCiAgICB0LkZlID0gZnVuY3Rpb24gKGEpIHsNCiAgICAgICAgdmFyIGMsIGQsIGUsIGc7DQogICAgICAgIGcgPSAicHJvdG9jb2wgaG9zdG5hbWUgcG9ydCBwYXRobmFtZSBzZWFyY2ggaGFzaCBob3N0Ii5zcGxpdCgiICIpOw0KICAgICAgICBkID0gdC5mKCJhIiwgew0KICAgICAgICAgICAgaHJlZjogYQ0KICAgICAgICB9KTsNCiAgICAgICAgaWYgKGUgPSAiIiA9PT0gZC5ob3N0ICYmICJmaWxlOiIgIT09IGQucHJvdG9jb2wpIGMgPSB0LmYoImRpdiIpLCBjLmlubmVySFRNTCA9ICc8YSBocmVmPSInICsgYSArICciPjwvYT4nLCBkID0gYy5maXJzdENoaWxkLCBjLnNldEF0dHJpYnV0ZSgic3R5bGUiLCAiZGlzcGxheTpub25lOyBwb3NpdGlvbjphYnNvbHV0ZTsiKSwgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChjKTsNCiAgICAgICAgYSA9IHt9Ow0KICAgICAgICBmb3IgKHZhciBoID0gMDsgaCA8IGcubGVuZ3RoOyBoKyspIGFbZ1toXV0gPSBkW2dbaF1dOw0KICAgICAgICAiaHR0cDoiID09PSBhLnByb3RvY29sICYmIChhLmhvc3QgPSBhLmhvc3QucmVwbGFjZSgvOjgwJC8sICIiKSk7DQogICAgICAgICJodHRwczoiID09PSBhLnByb3RvY29sICYmIChhLmhvc3QgPSBhLmhvc3QucmVwbGFjZSgvOjQ0MyQvLCAiIikpOw0KICAgICAgICBlICYmIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQoYyk7DQogICAgICAgIHJldHVybiBhDQogICAgfTsNCg0KICAgIGZ1bmN0aW9uIEYoYSwgYykgew0KICAgICAgICB2YXIgZCwgZTsNCiAgICAgICAgZCA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGMpOw0KICAgICAgICBlID0gbSgpOw0KICAgICAgICBlID0gd2luZG93LmNvbnNvbGUgfHwgew0KICAgICAgICAgICAgbG9nOiBlLA0KICAgICAgICAgICAgd2FybjogZSwNCiAgICAgICAgICAgIGVycm9yOiBlDQogICAgICAgIH07DQogICAgICAgIGEgPyBkLnVuc2hpZnQoYS50b1VwcGVyQ2FzZSgpICsgIjoiKSA6IGEgPSAibG9nIjsNCiAgICAgICAgdC5sb2cuaGlzdG9yeS5wdXNoKGQpOw0KICAgICAgICBkLnVuc2hpZnQoIlZJREVPSlM6Iik7DQogICAgICAgIGlmIChlW2FdLmFwcGx5KSBlW2FdLmFwcGx5KGUsIGQpOw0KICAgICAgICBlbHNlIGVbYV0oZC5qb2luKCIgIikpDQogICAgfQ0KICAgIHQubG9nID0gZnVuY3Rpb24gKCkgew0KICAgICAgICBGKGosIGFyZ3VtZW50cykNCiAgICB9Ow0KICAgIHQubG9nLmhpc3RvcnkgPSBbXTsNCiAgICB0LmxvZy5lcnJvciA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgRigiZXJyb3IiLCBhcmd1bWVudHMpDQogICAgfTsNCiAgICB0LmxvZy53YXJuID0gZnVuY3Rpb24gKCkgew0KICAgICAgICBGKCJ3YXJuIiwgYXJndW1lbnRzKQ0KICAgIH07DQogICAgdC5aZCA9IGZ1bmN0aW9uIChhKSB7DQogICAgICAgIHZhciBjLCBkOw0KICAgICAgICBhLmdldEJvdW5kaW5nQ2xpZW50UmVjdCAmJiBhLnBhcmVudE5vZGUgJiYgKGMgPSBhLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpKTsNCiAgICAgICAgaWYgKCFjKSByZXR1cm4gew0KICAgICAgICAgICAgbGVmdDogMCwNCiAgICAgICAgICAgIHRvcDogMA0KICAgICAgICB9Ow0KICAgICAgICBhID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50Ow0KICAgICAgICBkID0gZG9jdW1lbnQuYm9keTsNCiAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICAgIGxlZnQ6IHQucm91bmQoYy5sZWZ0ICsgKHdpbmRvdy5wYWdlWE9mZnNldCB8fCBkLnNjcm9sbExlZnQpIC0gKGEuY2xpZW50TGVmdCB8fCBkLmNsaWVudExlZnQgfHwgMCkpLA0KICAgICAgICAgICAgdG9wOiB0LnJvdW5kKGMudG9wICsgKHdpbmRvdy5wYWdlWU9mZnNldCB8fCBkLnNjcm9sbFRvcCkgLSAoYS5jbGllbnRUb3AgfHwgZC5jbGllbnRUb3AgfHwgMCkpDQogICAgICAgIH0NCiAgICB9Ow0KICAgIHQueGMgPSB7fTsNCiAgICB0LnhjLmZvckVhY2ggPSBmdW5jdGlvbiAoYSwgYywgZCkgew0KICAgICAgICBpZiAodC5pLmlzQXJyYXkoYSkgJiYgYyBpbnN0YW5jZW9mIEZ1bmN0aW9uKQ0KICAgICAgICAgICAgZm9yICh2YXIgZSA9IDAsIGcgPSBhLmxlbmd0aDsgZSA8IGc7ICsrZSkgYy5jYWxsKGQgfHwgdCwgYVtlXSwgZSwgYSk7DQogICAgICAgIHJldHVybiBhDQogICAgfTsNCiAgICB0LmdmID0gZnVuY3Rpb24gKGEsIGMpIHsNCiAgICAgICAgdmFyIGQsIGUsIGcsIGgsIGssIHEsIHI7DQogICAgICAgICJzdHJpbmciID09PSB0eXBlb2YgYSAmJiAoYSA9IHsNCiAgICAgICAgICAgIHVyaTogYQ0KICAgICAgICB9KTsNCiAgICAgICAgdmlkZW9qcy4kLkJhKHsNCiAgICAgICAgICAgIG1ldGhvZDogIkdFVCIsDQogICAgICAgICAgICB0aW1lb3V0OiA0NUUzDQogICAgICAgIH0sIGEpOw0KICAgICAgICBjID0gYyB8fCBtKCk7DQogICAgICAgIHEgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICB3aW5kb3cuY2xlYXJUaW1lb3V0KGspOw0KICAgICAgICAgICAgYyhqLCBlLCBlLnJlc3BvbnNlIHx8IGUucmVzcG9uc2VUZXh0KQ0KICAgICAgICB9Ow0KICAgICAgICByID0gZnVuY3Rpb24gKGEpIHsNCiAgICAgICAgICAgIHdpbmRvdy5jbGVhclRpbWVvdXQoayk7DQogICAgICAgICAgICBpZiAoIWEgfHwgInN0cmluZyIgPT09IHR5cGVvZiBhKSBhID0gRXJyb3IoYSk7DQogICAgICAgICAgICBjKGEsIGUpDQogICAgICAgIH07DQogICAgICAgIGQgPSB3aW5kb3cuWE1MSHR0cFJlcXVlc3Q7DQogICAgICAgICJ1bmRlZmluZWQiID09PSB0eXBlb2YgZCAmJiAoZCA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyB3aW5kb3cuQWN0aXZlWE9iamVjdCgiTXN4bWwyLlhNTEhUVFAuNi4wIikNCiAgICAgICAgICAgIH0gY2F0Y2ggKGEpIHsgfQ0KICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IHdpbmRvdy5BY3RpdmVYT2JqZWN0KCJNc3htbDIuWE1MSFRUUC4zLjAiKQ0KICAgICAgICAgICAgfSBjYXRjaCAoYykgeyB9DQogICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgIHJldHVybiBuZXcgd2luZG93LkFjdGl2ZVhPYmplY3QoIk1zeG1sMi5YTUxIVFRQIikNCiAgICAgICAgICAgIH0gY2F0Y2ggKGQpIHsgfQ0KICAgICAgICAgICAgdGhyb3cgRXJyb3IoIlRoaXMgYnJvd3NlciBkb2VzIG5vdCBzdXBwb3J0IFhNTEh0dHBSZXF1ZXN0LiIpOw0KICAgICAgICB9KTsNCiAgICAgICAgZSA9IG5ldyBkOw0KICAgICAgICBlLnVyaSA9IGEudXJpOw0KICAgICAgICBkID0gdC5GZShhLnVyaSk7DQogICAgICAgIGcgPSB3aW5kb3cubG9jYXRpb247DQogICAgICAgIGQucHJvdG9jb2wgKyBkLmhvc3QgIT09IGcucHJvdG9jb2wgKyBnLmhvc3QgJiYgd2luZG93LlhEb21haW5SZXF1ZXN0ICYmICEoIndpdGhDcmVkZW50aWFscyIgaW4gZSkgPyAoZSA9IG5ldyB3aW5kb3cuWERvbWFpblJlcXVlc3QsIGUub25sb2FkID0gcSwgZS5vbmVycm9yID0gciwgZS5vbnByb2dyZXNzID0gbSgpLCBlLm9udGltZW91dCA9IG0oKSkgOiAoaCA9ICJmaWxlOiIgPT0gZC5wcm90b2NvbCB8fCAiZmlsZToiID09IGcucHJvdG9jb2wsIGUub25yZWFkeXN0YXRlY2hhbmdlID0gZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgaWYgKDQgPT09IGUucmVhZHlTdGF0ZSkgew0KICAgICAgICAgICAgICAgIGlmIChlLlplKSByZXR1cm4gcigidGltZW91dCIpOw0KICAgICAgICAgICAgICAgIDIwMCA9PT0gZS5zdGF0dXMgfHwgaCAmJiAwID09PSBlLnN0YXR1cyA/IHEoKSA6IHIoKQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9LCBhLnRpbWVvdXQgJiYgKGsgPSB3aW5kb3cuc2V0VGltZW91dChmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICA0ICE9PSBlLnJlYWR5U3RhdGUgJiYgKGUuWmUgPSBmLCBlLmFib3J0KCkpDQogICAgICAgIH0sIGEudGltZW91dCkpKTsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIGUub3BlbihhLm1ldGhvZCB8fA0KICAgICAgICAgICAgICAgICJHRVQiLCBhLnVyaSwgZikNCiAgICAgICAgfSBjYXRjaCAodSkgew0KICAgICAgICAgICAgcih1KTsNCiAgICAgICAgICAgIHJldHVybg0KICAgICAgICB9DQogICAgICAgIGEud2l0aENyZWRlbnRpYWxzICYmIChlLndpdGhDcmVkZW50aWFscyA9IGYpOw0KICAgICAgICBhLnJlc3BvbnNlVHlwZSAmJiAoZS5yZXNwb25zZVR5cGUgPSBhLnJlc3BvbnNlVHlwZSk7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBlLnNlbmQoKQ0KICAgICAgICB9IGNhdGNoIChBKSB7DQogICAgICAgICAgICByKEEpDQogICAgICAgIH0NCiAgICB9Ow0KICAgIHQuJCA9IHt9Ow0KICAgIHQuJC5CYSA9IGZ1bmN0aW9uIChhLCBjKSB7DQogICAgICAgIHZhciBkLCBlLCBnOw0KICAgICAgICBhID0gdC5pLmNvcHkoYSk7DQogICAgICAgIGZvciAoZCBpbiBjKSBjLmhhc093blByb3BlcnR5KGQpICYmIChlID0gYVtkXSwgZyA9IGNbZF0sIGFbZF0gPSB0LmkubGIoZSkgJiYgdC5pLmxiKGcpID8gdC4kLkJhKGUsIGcpIDogY1tkXSk7DQogICAgICAgIHJldHVybiBhDQogICAgfTsNCiAgICB0LnogPSBtKCk7DQogICAgcyA9IHQuei5wcm90b3R5cGU7DQogICAgcy5jYiA9IHt9Ow0KICAgIHMuYiA9IGZ1bmN0aW9uIChhLCBjKSB7DQogICAgICAgIHZhciBkID0gdGhpcy5hZGRFdmVudExpc3RlbmVyOw0KICAgICAgICB0aGlzLmFkZEV2ZW50TGlzdGVuZXIgPSBGdW5jdGlvbi5wcm90b3R5cGU7DQogICAgICAgIHQuYih0aGlzLCBhLCBjKTsNCiAgICAgICAgdGhpcy5hZGRFdmVudExpc3RlbmVyID0gZA0KICAgIH07DQogICAgcy5hZGRFdmVudExpc3RlbmVyID0gdC56LnByb3RvdHlwZS5iOw0KICAgIHMubiA9IGZ1bmN0aW9uIChhLCBjKSB7DQogICAgICAgIHQubih0aGlzLCBhLCBjKQ0KICAgIH07DQogICAgcy5yZW1vdmVFdmVudExpc3RlbmVyID0gdC56LnByb3RvdHlwZS5uOw0KICAgIHMuTiA9IGZ1bmN0aW9uIChhLCBjKSB7DQogICAgICAgIHQuTih0aGlzLCBhLCBjKQ0KICAgIH07DQogICAgcy5vID0gZnVuY3Rpb24gKGEpIHsNCiAgICAgICAgdmFyIGMgPSBhLnR5cGUgfHwgYTsNCiAgICAgICAgInN0cmluZyIgPT09IHR5cGVvZiBhICYmIChhID0gew0KICAgICAgICAgICAgdHlwZTogYw0KICAgICAgICB9KTsNCiAgICAgICAgYSA9IHQuUWIoYSk7DQogICAgICAgIGlmICh0aGlzLmNiW2NdICYmIHRoaXNbIm9uIiArIGNdKSB0aGlzWyJvbiIgKyBjXShhKTsNCiAgICAgICAgdC5vKHRoaXMsIGEpDQogICAgfTsNCiAgICBzLmRpc3BhdGNoRXZlbnQgPSB0LnoucHJvdG90eXBlLm87DQogICAgdC5hID0gdC5IYS5leHRlbmQoew0KICAgICAgICBsOiBmdW5jdGlvbiAoYSwgYywgZCkgew0KICAgICAgICAgICAgdGhpcy5kID0gYTsNCiAgICAgICAgICAgIHRoaXMucSA9IHQuaS5jb3B5KHRoaXMucSk7DQogICAgICAgICAgICBjID0gdGhpcy5vcHRpb25zKGMpOw0KICAgICAgICAgICAgdGhpcy5SYSA9IGMuaWQgfHwgYy5lbCAmJiBjLmVsLmlkOw0KICAgICAgICAgICAgdGhpcy5SYSB8fCAodGhpcy5SYSA9IChhLmlkICYmIGEuaWQoKSB8fCAibm9fcGxheWVyIikgKyAiX2NvbXBvbmVudF8iICsgdC5zKyspOw0KICAgICAgICAgICAgdGhpcy51ZSA9IGMubmFtZSB8fCBqOw0KICAgICAgICAgICAgdGhpcy5jID0gYy5lbCB8fCB0aGlzLmYoKTsNCiAgICAgICAgICAgIHRoaXMuUiA9IFtdOw0KICAgICAgICAgICAgdGhpcy5nYiA9IHt9Ow0KICAgICAgICAgICAgdGhpcy5oYiA9IHt9Ow0KICAgICAgICAgICAgdGhpcy5PYygpOw0KICAgICAgICAgICAgdGhpcy5JKGQpOw0KICAgICAgICAgICAgaWYgKGMuZGQgIT09IGwpIHsNCiAgICAgICAgICAgICAgICB2YXIgZSwgZzsNCiAgICAgICAgICAgICAgICB0aGlzLmsoKS5yZXBvcnRVc2VyQWN0aXZpdHkgJiYgKGUgPSB0LmJpbmQodGhpcy5rKCksIHRoaXMuaygpLnJlcG9ydFVzZXJBY3Rpdml0eSksIHRoaXMuYigidG91Y2hzdGFydCIsIGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICAgICAgZSgpOw0KICAgICAgICAgICAgICAgICAgICB0aGlzLmNsZWFySW50ZXJ2YWwoZyk7DQogICAgICAgICAgICAgICAgICAgIGcgPSB0aGlzLnNldEludGVydmFsKGUsIDI1MCkNCiAgICAgICAgICAgICAgICB9KSwgYSA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICAgICAgZSgpOw0KICAgICAgICAgICAgICAgICAgICB0aGlzLmNsZWFySW50ZXJ2YWwoZykNCiAgICAgICAgICAgICAgICB9LCB0aGlzLmIoInRvdWNobW92ZSIsDQogICAgICAgICAgICAgICAgICAgIGUpLCB0aGlzLmIoInRvdWNoZW5kIiwgYSksIHRoaXMuYigidG91Y2hjYW5jZWwiLCBhKSkNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0pOw0KICAgIHMgPSB0LmEucHJvdG90eXBlOw0KICAgIHMuZGlzcG9zZSA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgdGhpcy5vKHsNCiAgICAgICAgICAgIHR5cGU6ICJkaXNwb3NlIiwNCiAgICAgICAgICAgIGJ1YmJsZXM6IGwNCiAgICAgICAgfSk7DQogICAgICAgIGlmICh0aGlzLlIpDQogICAgICAgICAgICBmb3IgKHZhciBhID0gdGhpcy5SLmxlbmd0aCAtIDE7IDAgPD0gYTsgYS0tKSB0aGlzLlJbYV0uZGlzcG9zZSAmJiB0aGlzLlJbYV0uZGlzcG9zZSgpOw0KICAgICAgICB0aGlzLmhiID0gdGhpcy5nYiA9IHRoaXMuUiA9IGo7DQogICAgICAgIHRoaXMubigpOw0KICAgICAgICB0aGlzLmMucGFyZW50Tm9kZSAmJiB0aGlzLmMucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0aGlzLmMpOw0KICAgICAgICB0LmNkKHRoaXMuYyk7DQogICAgICAgIHRoaXMuYyA9IGoNCiAgICB9Ow0KICAgIHMuZCA9IGY7DQogICAgcy5rID0gbigiZCIpOw0KICAgIHMub3B0aW9ucyA9IGZ1bmN0aW9uIChhKSB7DQogICAgICAgIHJldHVybiBhID09PSBiID8gdGhpcy5xIDogdGhpcy5xID0gdC4kLkJhKHRoaXMucSwgYSkNCiAgICB9Ow0KICAgIHMuZiA9IGZ1bmN0aW9uIChhLCBjKSB7DQogICAgICAgIHJldHVybiB0LmYoYSwgYykNCiAgICB9Ow0KICAgIHMudiA9IGZ1bmN0aW9uIChhKSB7DQogICAgICAgIHZhciBjID0gdGhpcy5kLmxhbmd1YWdlKCksDQogICAgICAgICAgICBkID0gdGhpcy5kLmxhbmd1YWdlcygpOw0KICAgICAgICByZXR1cm4gZCAmJiBkW2NdICYmIGRbY11bYV0gPyBkW2NdW2FdIDogYQ0KICAgIH07DQogICAgcy5tID0gbigiYyIpOw0KICAgIHMueGEgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHJldHVybiB0aGlzLkIgfHwgdGhpcy5jDQogICAgfTsNCiAgICBzLmlkID0gbigiUmEiKTsNCiAgICBzLm5hbWUgPSBuKCJ1ZSIpOw0KICAgIHMuY2hpbGRyZW4gPSBuKCJSIik7DQogICAgcy5iZSA9IGZ1bmN0aW9uIChhKSB7DQogICAgICAgIHJldHVybiB0aGlzLmdiW2FdDQogICAgfTsNCiAgICBzLmVhID0gZnVuY3Rpb24gKGEpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuaGJbYV0NCiAgICB9Ow0KICAgIHMuYmEgPSBmdW5jdGlvbiAoYSwgYykgew0KICAgICAgICB2YXIgZCwgZTsNCiAgICAgICAgInN0cmluZyIgPT09IHR5cGVvZiBhID8gKGUgPSBhLCBjID0gYyB8fCB7fSwgZCA9IGMuY29tcG9uZW50Q2xhc3MgfHwgdC53YShlKSwgYy5uYW1lID0gZSwgZCA9IG5ldyB3aW5kb3cudmlkZW9qc1tkXSh0aGlzLmQgfHwgdGhpcywgYykpIDogZCA9IGE7DQogICAgICAgIHRoaXMuUi5wdXNoKGQpOw0KICAgICAgICAiZnVuY3Rpb24iID09PSB0eXBlb2YgZC5pZCAmJiAodGhpcy5nYltkLmlkKCldID0gZCk7DQogICAgICAgIChlID0gZSB8fCBkLm5hbWUgJiYgZC5uYW1lKCkpICYmICh0aGlzLmhiW2VdID0gZCk7DQogICAgICAgICJmdW5jdGlvbiIgPT09IHR5cGVvZiBkLmVsICYmIGQuZWwoKSAmJiB0aGlzLnhhKCkuYXBwZW5kQ2hpbGQoZC5lbCgpKTsNCiAgICAgICAgcmV0dXJuIGQNCiAgICB9Ow0KICAgIHMucmVtb3ZlQ2hpbGQgPSBmdW5jdGlvbiAoYSkgew0KICAgICAgICAic3RyaW5nIiA9PT0gdHlwZW9mIGEgJiYgKGEgPSB0aGlzLmVhKGEpKTsNCiAgICAgICAgaWYgKGEgJiYgdGhpcy5SKSB7DQogICAgICAgICAgICBmb3IgKHZhciBjID0gbCwgZCA9IHRoaXMuUi5sZW5ndGggLSAxOyAwIDw9IGQ7IGQtLSkNCiAgICAgICAgICAgICAgICBpZiAodGhpcy5SW2RdID09PSBhKSB7DQogICAgICAgICAgICAgICAgICAgIGMgPSBmOw0KICAgICAgICAgICAgICAgICAgICB0aGlzLlIuc3BsaWNlKGQsIDEpOw0KICAgICAgICAgICAgICAgICAgICBicmVhaw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGMgJiYgKHRoaXMuZ2JbYS5pZCgpXSA9IGosIHRoaXMuaGJbYS5uYW1lKCldID0gaiwgKGMgPSBhLm0oKSkgJiYgYy5wYXJlbnROb2RlID09PSB0aGlzLnhhKCkgJiYgdGhpcy54YSgpLnJlbW92ZUNoaWxkKGEubSgpKSkNCiAgICAgICAgfQ0KICAgIH07DQogICAgcy5PYyA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgdmFyIGEsIGMsIGQsIGUsIGcsIGg7DQogICAgICAgIGEgPSB0aGlzOw0KICAgICAgICBjID0gYS5vcHRpb25zKCk7DQogICAgICAgIGlmIChkID0gYy5jaGlsZHJlbikNCiAgICAgICAgICAgIGlmIChoID0gZnVuY3Rpb24gKGQsIGUpIHsNCiAgICAgICAgICAgICAgICAgICAgY1tkXSAhPT0gYiAmJiAoZSA9IGNbZF0pOw0KICAgICAgICAgICAgICAgICAgICBlICE9PSBsICYmIChhW2RdID0gYS5iYShkLCBlKSkNCiAgICAgICAgICAgIH0sIHQuaS5pc0FycmF5KGQpKQ0KICAgICAgICAgICAgICAgIGZvciAodmFyIGsgPSAwOyBrIDwgZC5sZW5ndGg7IGsrKykgZSA9IGRba10sICJzdHJpbmciID09IHR5cGVvZiBlID8gKGcgPSBlLCBlID0ge30pIDogZyA9IGUubmFtZSwgaChnLCBlKTsNCiAgICAgICAgICAgIGVsc2UgdC5pLmRhKGQsIGgpDQogICAgfTsNCiAgICBzLlYgPSBwKCIiKTsNCiAgICBzLmIgPSBmdW5jdGlvbiAoYSwgYywgZCkgew0KICAgICAgICB2YXIgZSwgZywgaDsNCiAgICAgICAgInN0cmluZyIgPT09IHR5cGVvZiBhIHx8IHQuaS5pc0FycmF5KGEpID8gdC5iKHRoaXMuYywgYSwgdC5iaW5kKHRoaXMsIGMpKSA6IChlID0gdC5iaW5kKHRoaXMsIGQpLCBoID0gdGhpcywgZyA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIGgubihhLCBjLCBlKQ0KICAgICAgICB9LCBnLnMgPSBlLnMsIHRoaXMuYigiZGlzcG9zZSIsIGcpLCBkID0gZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgaC5uKCJkaXNwb3NlIiwgZykNCiAgICAgICAgfSwgZC5zID0gZS5zLCBhLm5vZGVOYW1lID8gKHQuYihhLCBjLCBlKSwgdC5iKGEsICJkaXNwb3NlIiwgZCkpIDogImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGEuYiAmJiAoYS5iKGMsIGUpLCBhLmIoImRpc3Bvc2UiLCBkKSkpOw0KICAgICAgICByZXR1cm4gdGhpcw0KICAgIH07DQogICAgcy5uID0gZnVuY3Rpb24gKGEsIGMsIGQpIHsNCiAgICAgICAgIWEgfHwgInN0cmluZyIgPT09IHR5cGVvZiBhIHx8IHQuaS5pc0FycmF5KGEpID8gdC5uKHRoaXMuYywgYSwgYykgOiAoZCA9IHQuYmluZCh0aGlzLCBkKSwgdGhpcy5uKCJkaXNwb3NlIiwgZCksIGEubm9kZU5hbWUgPyAodC5uKGEsIGMsIGQpLCB0Lm4oYSwgImRpc3Bvc2UiLCBkKSkgOiAoYS5uKGMsIGQpLCBhLm4oImRpc3Bvc2UiLCBkKSkpOw0KICAgICAgICByZXR1cm4gdGhpcw0KICAgIH07DQogICAgcy5OID0gZnVuY3Rpb24gKGEsIGMsIGQpIHsNCiAgICAgICAgdmFyIGUsIGcsIGg7DQogICAgICAgICJzdHJpbmciID09PSB0eXBlb2YgYSB8fCB0LmkuaXNBcnJheShhKSA/IHQuTih0aGlzLmMsIGEsIHQuYmluZCh0aGlzLCBjKSkgOiAoZSA9IHQuYmluZCh0aGlzLCBkKSwgZyA9IHRoaXMsIGggPSBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICBnLm4oYSwgYywgaCk7DQogICAgICAgICAgICBlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykNCiAgICAgICAgfSwgaC5zID0gZS5zLCB0aGlzLmIoYSwgYywgaCkpOw0KICAgICAgICByZXR1cm4gdGhpcw0KICAgIH07DQogICAgcy5vID0gZnVuY3Rpb24gKGEpIHsNCiAgICAgICAgdC5vKHRoaXMuYywgYSk7DQogICAgICAgIHJldHVybiB0aGlzDQogICAgfTsNCiAgICBzLkkgPSBmdW5jdGlvbiAoYSkgew0KICAgICAgICBhICYmICh0aGlzLnphID8gYS5jYWxsKHRoaXMpIDogKHRoaXMucGIgPT09IGIgJiYgKHRoaXMucGIgPSBbXSksIHRoaXMucGIucHVzaChhKSkpOw0KICAgICAgICByZXR1cm4gdGhpcw0KICAgIH07DQogICAgcy5YYSA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgdGhpcy56YSA9IGY7DQogICAgICAgIHZhciBhID0gdGhpcy5wYjsNCiAgICAgICAgaWYgKGEgJiYgMCA8IGEubGVuZ3RoKSB7DQogICAgICAgICAgICBmb3IgKHZhciBjID0gMCwgZCA9IGEubGVuZ3RoOyBjIDwgZDsgYysrKSBhW2NdLmNhbGwodGhpcyk7DQogICAgICAgICAgICB0aGlzLnBiID0gW107DQogICAgICAgICAgICB0aGlzLm8oInJlYWR5IikNCiAgICAgICAgfQ0KICAgIH07DQogICAgcy5RYSA9IGZ1bmN0aW9uIChhKSB7DQogICAgICAgIHJldHVybiB0LlFhKHRoaXMuYywgYSkNCiAgICB9Ow0KICAgIHMucCA9IGZ1bmN0aW9uIChhKSB7DQogICAgICAgIHQucCh0aGlzLmMsIGEpOw0KICAgICAgICByZXR1cm4gdGhpcw0KICAgIH07DQogICAgcy5yID0gZnVuY3Rpb24gKGEpIHsNCiAgICAgICAgdC5yKHRoaXMuYywgYSk7DQogICAgICAgIHJldHVybiB0aGlzDQogICAgfTsNCiAgICBzLnNob3cgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHRoaXMucigidmpzLWhpZGRlbiIpOw0KICAgICAgICByZXR1cm4gdGhpcw0KICAgIH07DQogICAgcy5ZID0gZnVuY3Rpb24gKCkgew0KICAgICAgICB0aGlzLnAoInZqcy1oaWRkZW4iKTsNCiAgICAgICAgcmV0dXJuIHRoaXMNCiAgICB9Ow0KDQogICAgZnVuY3Rpb24gRyhhKSB7DQogICAgICAgIGEucigidmpzLWxvY2stc2hvd2luZyIpDQogICAgfQ0KICAgIHMud2lkdGggPSBmdW5jdGlvbiAoYSwgYykgew0KICAgICAgICByZXR1cm4gY2EodGhpcywgIndpZHRoIiwgYSwgYykNCiAgICB9Ow0KICAgIHMuaGVpZ2h0ID0gZnVuY3Rpb24gKGEsIGMpIHsNCiAgICAgICAgcmV0dXJuIGNhKHRoaXMsICJoZWlnaHQiLCBhLCBjKQ0KICAgIH07DQogICAgcy5VZCA9IGZ1bmN0aW9uIChhLCBjKSB7DQogICAgICAgIHJldHVybiB0aGlzLndpZHRoKGEsIGYpLmhlaWdodChjKQ0KICAgIH07DQoNCiAgICBmdW5jdGlvbiBjYShhLCBjLCBkLCBlKSB7DQogICAgICAgIGlmIChkICE9PSBiKSB7DQogICAgICAgICAgICBpZiAoZCA9PT0gaiB8fCB0LmxlKGQpKSBkID0gMDsNCiAgICAgICAgICAgIGEuYy5zdHlsZVtjXSA9IC0xICE9PSAoIiIgKyBkKS5pbmRleE9mKCIlIikgfHwgLTEgIT09ICgiIiArIGQpLmluZGV4T2YoInB4IikgPyBkIDogImF1dG8iID09PSBkID8gIiIgOiBkICsgInB4IjsNCiAgICAgICAgICAgIGUgfHwgYS5vKCJyZXNpemUiKTsNCiAgICAgICAgICAgIHJldHVybiBhDQogICAgICAgIH0NCiAgICAgICAgaWYgKCFhLmMpIHJldHVybiAwOw0KICAgICAgICBkID0gYS5jLnN0eWxlW2NdOw0KICAgICAgICBlID0gZC5pbmRleE9mKCJweCIpOw0KICAgICAgICByZXR1cm4gLTEgIT09IGUgPyBwYXJzZUludChkLnNsaWNlKDAsIGUpLCAxMCkgOiBwYXJzZUludChhLmNbIm9mZnNldCIgKyB0LndhKGMpXSwgMTApDQogICAgfQ0KDQogICAgZnVuY3Rpb24gZGEoYSkgew0KICAgICAgICB2YXIgYywgZCwgZSwgZywgaCwgaywgcSwgcjsNCiAgICAgICAgYyA9IDA7DQogICAgICAgIGQgPSBqOw0KICAgICAgICBhLmIoInRvdWNoc3RhcnQiLCBmdW5jdGlvbiAoYSkgew0KICAgICAgICAgICAgMSA9PT0gYS50b3VjaGVzLmxlbmd0aCAmJiAoZCA9IHQuaS5jb3B5KGEudG91Y2hlc1swXSksIGMgPSAobmV3IERhdGUpLmdldFRpbWUoKSwgZyA9IGYpDQogICAgICAgIH0pOw0KICAgICAgICBhLmIoInRvdWNobW92ZSIsIGZ1bmN0aW9uIChhKSB7DQogICAgICAgICAgICAxIDwgYS50b3VjaGVzLmxlbmd0aCA/IGcgPSBsIDogZCAmJiAoayA9IGEudG91Y2hlc1swXS5wYWdlWCAtIGQucGFnZVgsIHEgPSBhLnRvdWNoZXNbMF0ucGFnZVkgLSBkLnBhZ2VZLCByID0gTWF0aC5zcXJ0KGsgKiBrICsgcSAqIHEpLCAxMCA8IHIgJiYgKGcgPSBsKSkNCiAgICAgICAgfSk7DQogICAgICAgIGggPSBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICBnID0gbA0KICAgICAgICB9Ow0KICAgICAgICBhLmIoInRvdWNobGVhdmUiLCBoKTsNCiAgICAgICAgYS5iKCJ0b3VjaGNhbmNlbCIsIGgpOw0KICAgICAgICBhLmIoInRvdWNoZW5kIiwgZnVuY3Rpb24gKGEpIHsNCiAgICAgICAgICAgIGQgPSBqOw0KICAgICAgICAgICAgZyA9PT0gZiAmJiAoZSA9IChuZXcgRGF0ZSkuZ2V0VGltZSgpIC0gYywgMjAwID4gZSAmJiAoYS5wcmV2ZW50RGVmYXVsdCgpLCB0aGlzLm8oInRhcCIpKSkNCiAgICAgICAgfSkNCiAgICB9DQogICAgcy5zZXRUaW1lb3V0ID0gZnVuY3Rpb24gKGEsIGMpIHsNCiAgICAgICAgZnVuY3Rpb24gZCgpIHsNCiAgICAgICAgICAgIHRoaXMuY2xlYXJUaW1lb3V0KGUpDQogICAgICAgIH0NCiAgICAgICAgYSA9IHQuYmluZCh0aGlzLCBhKTsNCiAgICAgICAgdmFyIGUgPSBzZXRUaW1lb3V0KGEsIGMpOw0KICAgICAgICBkLnMgPSAidmpzLXRpbWVvdXQtIiArIGU7DQogICAgICAgIHRoaXMuYigiZGlzcG9zZSIsIGQpOw0KICAgICAgICByZXR1cm4gZQ0KICAgIH07DQogICAgcy5jbGVhclRpbWVvdXQgPSBmdW5jdGlvbiAoYSkgew0KICAgICAgICBmdW5jdGlvbiBjKCkgeyB9DQogICAgICAgIGNsZWFyVGltZW91dChhKTsNCiAgICAgICAgYy5zID0gInZqcy10aW1lb3V0LSIgKyBhOw0KICAgICAgICB0aGlzLm4oImRpc3Bvc2UiLCBjKTsNCiAgICAgICAgcmV0dXJuIGENCiAgICB9Ow0KICAgIHMuc2V0SW50ZXJ2YWwgPSBmdW5jdGlvbiAoYSwgYykgew0KICAgICAgICBmdW5jdGlvbiBkKCkgew0KICAgICAgICAgICAgdGhpcy5jbGVhckludGVydmFsKGUpDQogICAgICAgIH0NCiAgICAgICAgYSA9IHQuYmluZCh0aGlzLCBhKTsNCiAgICAgICAgdmFyIGUgPSBzZXRJbnRlcnZhbChhLCBjKTsNCiAgICAgICAgZC5zID0gInZqcy1pbnRlcnZhbC0iICsgZTsNCiAgICAgICAgdGhpcy5iKCJkaXNwb3NlIiwgZCk7DQogICAgICAgIHJldHVybiBlDQogICAgfTsNCiAgICBzLmNsZWFySW50ZXJ2YWwgPSBmdW5jdGlvbiAoYSkgew0KICAgICAgICBmdW5jdGlvbiBjKCkgeyB9DQogICAgICAgIGNsZWFySW50ZXJ2YWwoYSk7DQogICAgICAgIGMucyA9ICJ2anMtaW50ZXJ2YWwtIiArIGE7DQogICAgICAgIHRoaXMubigiZGlzcG9zZSIsIGMpOw0KICAgICAgICByZXR1cm4gYQ0KICAgIH07DQogICAgdC53ID0gdC5hLmV4dGVuZCh7DQogICAgICAgIGw6IGZ1bmN0aW9uIChhLCBjKSB7DQogICAgICAgICAgICB0LmEuY2FsbCh0aGlzLCBhLCBjKTsNCiAgICAgICAgICAgIGRhKHRoaXMpOw0KICAgICAgICAgICAgdGhpcy5iKCJ0YXAiLCB0aGlzLnUpOw0KICAgICAgICAgICAgdGhpcy5iKCJjbGljayIsIHRoaXMudSk7DQogICAgICAgICAgICB0aGlzLmIoImZvY3VzIiwgdGhpcy5uYik7DQogICAgICAgICAgICB0aGlzLmIoImJsdXIiLCB0aGlzLm1iKQ0KICAgICAgICB9DQogICAgfSk7DQogICAgcyA9IHQudy5wcm90b3R5cGU7DQogICAgcy5mID0gZnVuY3Rpb24gKGEsIGMpIHsNCiAgICAgICAgdmFyIGQ7DQogICAgICAgIGMgPSB0LmkuRCh7DQogICAgICAgICAgICBjbGFzc05hbWU6IHRoaXMuVigpLA0KICAgICAgICAgICAgcm9sZTogImJ1dHRvbiIsDQogICAgICAgICAgICAiYXJpYS1saXZlIjogInBvbGl0ZSIsDQogICAgICAgICAgICB0YWJJbmRleDogMA0KICAgICAgICB9LCBjKTsNCiAgICAgICAgZCA9IHQuYS5wcm90b3R5cGUuZi5jYWxsKHRoaXMsIGEsIGMpOw0KICAgICAgICBjLmlubmVySFRNTCB8fCAodGhpcy5CID0gdC5mKCJkaXYiLCB7DQogICAgICAgICAgICBjbGFzc05hbWU6ICJ2anMtY29udHJvbC1jb250ZW50Ig0KICAgICAgICB9KSwgdGhpcy5MYiA9IHQuZigic3BhbiIsIHsNCiAgICAgICAgICAgIGNsYXNzTmFtZTogInZqcy1jb250cm9sLXRleHQiLA0KICAgICAgICAgICAgaW5uZXJIVE1MOiB0aGlzLnYodGhpcy51YSkgfHwgIk5lZWQgVGV4dCINCiAgICAgICAgfSksIHRoaXMuQi5hcHBlbmRDaGlsZCh0aGlzLkxiKSwgZC5hcHBlbmRDaGlsZCh0aGlzLkIpKTsNCiAgICAgICAgcmV0dXJuIGQNCiAgICB9Ow0KICAgIHMuViA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgcmV0dXJuICJ2anMtY29udHJvbCAiICsgdC5hLnByb3RvdHlwZS5WLmNhbGwodGhpcykNCiAgICB9Ow0KICAgIHMudSA9IG0oKTsNCiAgICBzLm5iID0gZnVuY3Rpb24gKCkgew0KICAgICAgICB0LmIoZG9jdW1lbnQsICJrZXlkb3duIiwgdC5iaW5kKHRoaXMsIHRoaXMubGEpKQ0KICAgIH07DQogICAgcy5sYSA9IGZ1bmN0aW9uIChhKSB7DQogICAgICAgIGlmICgzMiA9PSBhLndoaWNoIHx8IDEzID09IGEud2hpY2gpIGEucHJldmVudERlZmF1bHQoKSwgdGhpcy51KCkNCiAgICB9Ow0KICAgIHMubWIgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHQubihkb2N1bWVudCwgImtleWRvd24iLCB0LmJpbmQodGhpcywgdGhpcy5sYSkpDQogICAgfTsNCiAgICB0LlUgPSB0LmEuZXh0ZW5kKHsNCiAgICAgICAgbDogZnVuY3Rpb24gKGEsIGMpIHsNCiAgICAgICAgICAgIHQuYS5jYWxsKHRoaXMsIGEsIGMpOw0KICAgICAgICAgICAgdGhpcy5MZCA9IHRoaXMuZWEodGhpcy5xLmJhck5hbWUpOw0KICAgICAgICAgICAgdGhpcy5oYW5kbGUgPSB0aGlzLmVhKHRoaXMucS5oYW5kbGVOYW1lKTsNCiAgICAgICAgICAgIHRoaXMuYigibW91c2Vkb3duIiwgdGhpcy5vYik7DQogICAgICAgICAgICB0aGlzLmIoInRvdWNoc3RhcnQiLCB0aGlzLm9iKTsNCiAgICAgICAgICAgIHRoaXMuYigiZm9jdXMiLCB0aGlzLm5iKTsNCiAgICAgICAgICAgIHRoaXMuYigiYmx1ciIsIHRoaXMubWIpOw0KICAgICAgICAgICAgdGhpcy5iKCJjbGljayIsIHRoaXMudSk7DQogICAgICAgICAgICB0aGlzLmIoYSwgImNvbnRyb2xzdmlzaWJsZSIsIHRoaXMudXBkYXRlKTsNCiAgICAgICAgICAgIHRoaXMuYihhLCB0aGlzLlljLCB0aGlzLnVwZGF0ZSkNCiAgICAgICAgfQ0KICAgIH0pOw0KICAgIHMgPSB0LlUucHJvdG90eXBlOw0KICAgIHMuZiA9IGZ1bmN0aW9uIChhLCBjKSB7DQogICAgICAgIGMgPSBjIHx8IHt9Ow0KICAgICAgICBjLmNsYXNzTmFtZSArPSAiIHZqcy1zbGlkZXIiOw0KICAgICAgICBjID0gdC5pLkQoew0KICAgICAgICAgICAgcm9sZTogInNsaWRlciIsDQogICAgICAgICAgICAiYXJpYS12YWx1ZW5vdyI6IDAsDQogICAgICAgICAgICAiYXJpYS12YWx1ZW1pbiI6IDAsDQogICAgICAgICAgICAiYXJpYS12YWx1ZW1heCI6IDEwMCwNCiAgICAgICAgICAgIHRhYkluZGV4OiAwDQogICAgICAgIH0sIGMpOw0KICAgICAgICByZXR1cm4gdC5hLnByb3RvdHlwZS5mLmNhbGwodGhpcywgYSwgYykNCiAgICB9Ow0KICAgIHMub2IgPSBmdW5jdGlvbiAoYSkgew0KICAgICAgICBhLnByZXZlbnREZWZhdWx0KCk7DQogICAgICAgIHQuTWQoKTsNCiAgICAgICAgdGhpcy5wKCJ2anMtc2xpZGluZyIpOw0KICAgICAgICB0aGlzLmIoZG9jdW1lbnQsICJtb3VzZW1vdmUiLCB0aGlzLm1hKTsNCiAgICAgICAgdGhpcy5iKGRvY3VtZW50LCAibW91c2V1cCIsIHRoaXMuQ2EpOw0KICAgICAgICB0aGlzLmIoZG9jdW1lbnQsICJ0b3VjaG1vdmUiLCB0aGlzLm1hKTsNCiAgICAgICAgdGhpcy5iKGRvY3VtZW50LCAidG91Y2hlbmQiLCB0aGlzLkNhKTsNCiAgICAgICAgdGhpcy5tYShhKQ0KICAgIH07DQogICAgcy5tYSA9IG0oKTsNCiAgICBzLkNhID0gZnVuY3Rpb24gKCkgew0KICAgICAgICB0LmJmKCk7DQogICAgICAgIHRoaXMucigidmpzLXNsaWRpbmciKTsNCiAgICAgICAgdGhpcy5uKGRvY3VtZW50LCAibW91c2Vtb3ZlIiwgdGhpcy5tYSk7DQogICAgICAgIHRoaXMubihkb2N1bWVudCwgIm1vdXNldXAiLCB0aGlzLkNhKTsNCiAgICAgICAgdGhpcy5uKGRvY3VtZW50LCAidG91Y2htb3ZlIiwgdGhpcy5tYSk7DQogICAgICAgIHRoaXMubihkb2N1bWVudCwgInRvdWNoZW5kIiwgdGhpcy5DYSk7DQogICAgICAgIHRoaXMudXBkYXRlKCkNCiAgICB9Ow0KICAgIHMudXBkYXRlID0gZnVuY3Rpb24gKCkgew0KICAgICAgICBpZiAodGhpcy5jKSB7DQogICAgICAgICAgICB2YXIgYSwgYyA9IHRoaXMuVGIoKSwNCiAgICAgICAgICAgICAgICBkID0gdGhpcy5oYW5kbGUsDQogICAgICAgICAgICAgICAgZSA9IHRoaXMuTGQ7DQogICAgICAgICAgICBpZiAoIm51bWJlciIgIT09IHR5cGVvZiBjIHx8IGMgIT09IGMgfHwgMCA+IGMgfHwgSW5maW5pdHkgPT09IGMpIGMgPSAwOw0KICAgICAgICAgICAgYSA9IGM7DQogICAgICAgICAgICBpZiAoZCkgew0KICAgICAgICAgICAgICAgIGEgPSB0aGlzLmMub2Zmc2V0V2lkdGg7DQogICAgICAgICAgICAgICAgdmFyIGcgPSBkLm0oKS5vZmZzZXRXaWR0aDsNCiAgICAgICAgICAgICAgICBhID0gZyA/IGcgLyBhIDogMDsNCiAgICAgICAgICAgICAgICBjICo9IDEgLSBhOw0KICAgICAgICAgICAgICAgIGEgPSBjICsgYSAvIDI7DQogICAgICAgICAgICAgICAgZC5tKCkuc3R5bGUubGVmdCA9IHQucm91bmQoMTAwICogYywgMikgKyAiJSINCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGUgJiYgKGUubSgpLnN0eWxlLndpZHRoID0gdC5yb3VuZCgxMDAgKiBhLCAyKSArICIlIikNCiAgICAgICAgfQ0KICAgIH07DQoNCiAgICBmdW5jdGlvbiBlYShhLCBjKSB7DQogICAgICAgIHZhciBkLCBlLCBnLCBoOw0KICAgICAgICBkID0gYS5jOw0KICAgICAgICBlID0gdC5aZChkKTsNCiAgICAgICAgaCA9IGcgPSBkLm9mZnNldFdpZHRoOw0KICAgICAgICBkID0gYS5oYW5kbGU7DQogICAgICAgIGlmIChhLm9wdGlvbnMoKS52ZXJ0aWNhbCkgcmV0dXJuIGggPSBlLnRvcCwgZSA9IGMuY2hhbmdlZFRvdWNoZXMgPyBjLmNoYW5nZWRUb3VjaGVzWzBdLnBhZ2VZIDogYy5wYWdlWSwgZCAmJiAoZCA9IGQubSgpLm9mZnNldEhlaWdodCwgaCArPSBkIC8gMiwgZyAtPSBkKSwgTWF0aC5tYXgoMCwgTWF0aC5taW4oMSwgKGggLSBlICsgZykgLyBnKSk7DQogICAgICAgIGcgPSBlLmxlZnQ7DQogICAgICAgIGUgPSBjLmNoYW5nZWRUb3VjaGVzID8gYy5jaGFuZ2VkVG91Y2hlc1swXS5wYWdlWCA6IGMucGFnZVg7DQogICAgICAgIGQgJiYgKGQgPSBkLm0oKS5vZmZzZXRXaWR0aCwgZyArPSBkIC8gMiwgaCAtPSBkKTsNCiAgICAgICAgcmV0dXJuIE1hdGgubWF4KDAsIE1hdGgubWluKDEsIChlIC0gZykgLyBoKSkNCiAgICB9DQogICAgcy5uYiA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgdGhpcy5iKGRvY3VtZW50LCAia2V5ZG93biIsIHRoaXMubGEpDQogICAgfTsNCiAgICBzLmxhID0gZnVuY3Rpb24gKGEpIHsNCiAgICAgICAgaWYgKDM3ID09IGEud2hpY2ggfHwgNDAgPT0gYS53aGljaCkgYS5wcmV2ZW50RGVmYXVsdCgpLCB0aGlzLmtkKCk7DQogICAgICAgIGVsc2UgaWYgKDM4ID09IGEud2hpY2ggfHwgMzkgPT0gYS53aGljaCkgYS5wcmV2ZW50RGVmYXVsdCgpLCB0aGlzLmxkKCkNCiAgICB9Ow0KICAgIHMubWIgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHRoaXMubihkb2N1bWVudCwgImtleWRvd24iLCB0aGlzLmxhKQ0KICAgIH07DQogICAgcy51ID0gZnVuY3Rpb24gKGEpIHsNCiAgICAgICAgYS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTsNCiAgICAgICAgYS5wcmV2ZW50RGVmYXVsdCgpDQogICAgfTsNCiAgICB0LmhhID0gdC5hLmV4dGVuZCgpOw0KICAgIHQuaGEucHJvdG90eXBlLmRlZmF1bHRWYWx1ZSA9IDA7DQogICAgdC5oYS5wcm90b3R5cGUuZiA9IGZ1bmN0aW9uIChhLCBjKSB7DQogICAgICAgIGMgPSBjIHx8IHt9Ow0KICAgICAgICBjLmNsYXNzTmFtZSArPSAiIHZqcy1zbGlkZXItaGFuZGxlIjsNCiAgICAgICAgYyA9IHQuaS5EKHsNCiAgICAgICAgICAgIGlubmVySFRNTDogJzxzcGFuIGNsYXNzPSJ2anMtY29udHJvbC10ZXh0Ij4nICsgdGhpcy5kZWZhdWx0VmFsdWUgKyAiPC9zcGFuPiINCiAgICAgICAgfSwgYyk7DQogICAgICAgIHJldHVybiB0LmEucHJvdG90eXBlLmYuY2FsbCh0aGlzLCAiZGl2IiwgYykNCiAgICB9Ow0KICAgIHQucmEgPSB0LmEuZXh0ZW5kKCk7DQoNCiAgICBmdW5jdGlvbiBmYShhLCBjKSB7DQogICAgICAgIGEuYmEoYyk7DQogICAgICAgIGMuYigiY2xpY2siLCB0LmJpbmQoYSwgZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgRyh0aGlzKQ0KICAgICAgICB9KSkNCiAgICB9DQogICAgdC5yYS5wcm90b3R5cGUuZiA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgdmFyIGEgPSB0aGlzLm9wdGlvbnMoKS5EYyB8fCAidWwiOw0KICAgICAgICB0aGlzLkIgPSB0LmYoYSwgew0KICAgICAgICAgICAgY2xhc3NOYW1lOiAidmpzLW1lbnUtY29udGVudCINCiAgICAgICAgfSk7DQogICAgICAgIGEgPSB0LmEucHJvdG90eXBlLmYuY2FsbCh0aGlzLCAiZGl2Iiwgew0KICAgICAgICAgICAgYXBwZW5kOiB0aGlzLkIsDQogICAgICAgICAgICBjbGFzc05hbWU6ICJ2anMtbWVudSINCiAgICAgICAgfSk7DQogICAgICAgIGEuYXBwZW5kQ2hpbGQodGhpcy5CKTsNCiAgICAgICAgdC5iKGEsICJjbGljayIsIGZ1bmN0aW9uIChhKSB7DQogICAgICAgICAgICBhLnByZXZlbnREZWZhdWx0KCk7DQogICAgICAgICAgICBhLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpDQogICAgICAgIH0pOw0KICAgICAgICByZXR1cm4gYQ0KICAgIH07DQogICAgdC5NID0gdC53LmV4dGVuZCh7DQogICAgICAgIGw6IGZ1bmN0aW9uIChhLCBjKSB7DQogICAgICAgICAgICB0LncuY2FsbCh0aGlzLCBhLCBjKTsNCiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWQoYy5zZWxlY3RlZCkNCiAgICAgICAgfQ0KICAgIH0pOw0KICAgIHQuTS5wcm90b3R5cGUuZiA9IGZ1bmN0aW9uIChhLCBjKSB7DQogICAgICAgIHJldHVybiB0LncucHJvdG90eXBlLmYuY2FsbCh0aGlzLCAibGkiLCB0LmkuRCh7DQogICAgICAgICAgICBjbGFzc05hbWU6ICJ2anMtbWVudS1pdGVtIiwNCiAgICAgICAgICAgIGlubmVySFRNTDogdGhpcy52KHRoaXMucS5sYWJlbCkNCiAgICAgICAgfSwgYykpDQogICAgfTsNCiAgICB0Lk0ucHJvdG90eXBlLnUgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHRoaXMuc2VsZWN0ZWQoZikNCiAgICB9Ow0KICAgIHQuTS5wcm90b3R5cGUuc2VsZWN0ZWQgPSBmdW5jdGlvbiAoYSkgew0KICAgICAgICBhID8gKHRoaXMucCgidmpzLXNlbGVjdGVkIiksIHRoaXMuYy5zZXRBdHRyaWJ1dGUoImFyaWEtc2VsZWN0ZWQiLCBmKSkgOiAodGhpcy5yKCJ2anMtc2VsZWN0ZWQiKSwgdGhpcy5jLnNldEF0dHJpYnV0ZSgiYXJpYS1zZWxlY3RlZCIsIGwpKQ0KICAgIH07DQogICAgdC5PID0gdC53LmV4dGVuZCh7DQogICAgICAgIGw6IGZ1bmN0aW9uIChhLCBjKSB7DQogICAgICAgICAgICB0LncuY2FsbCh0aGlzLCBhLCBjKTsNCiAgICAgICAgICAgIHRoaXMudXBkYXRlKCk7DQogICAgICAgICAgICB0aGlzLmIoImtleWRvd24iLCB0aGlzLmxhKTsNCiAgICAgICAgICAgIHRoaXMuYy5zZXRBdHRyaWJ1dGUoImFyaWEtaGFzcG9wdXAiLCBmKTsNCiAgICAgICAgICAgIHRoaXMuYy5zZXRBdHRyaWJ1dGUoInJvbGUiLCAiYnV0dG9uIikNCiAgICAgICAgfQ0KICAgIH0pOw0KICAgIHMgPSB0Lk8ucHJvdG90eXBlOw0KICAgIHMudXBkYXRlID0gZnVuY3Rpb24gKCkgew0KICAgICAgICB2YXIgYSA9IHRoaXMuTWEoKTsNCiAgICAgICAgdGhpcy5BYSAmJiB0aGlzLnJlbW92ZUNoaWxkKHRoaXMuQWEpOw0KICAgICAgICB0aGlzLkFhID0gYTsNCiAgICAgICAgdGhpcy5iYShhKTsNCiAgICAgICAgdGhpcy5IICYmIDAgPT09IHRoaXMuSC5sZW5ndGggPyB0aGlzLlkoKSA6IHRoaXMuSCAmJiAxIDwgdGhpcy5ILmxlbmd0aCAmJiB0aGlzLnNob3coKQ0KICAgIH07DQogICAgcy5LYSA9IGw7DQogICAgcy5NYSA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgdmFyIGEgPSBuZXcgdC5yYSh0aGlzLmQpOw0KICAgICAgICB0aGlzLm9wdGlvbnMoKS50aXRsZSAmJiBhLnhhKCkuYXBwZW5kQ2hpbGQodC5mKCJsaSIsIHsNCiAgICAgICAgICAgIGNsYXNzTmFtZTogInZqcy1tZW51LXRpdGxlIiwNCiAgICAgICAgICAgIGlubmVySFRNTDogdC53YSh0aGlzLm9wdGlvbnMoKS50aXRsZSksDQogICAgICAgICAgICBYZTogLTENCiAgICAgICAgfSkpOw0KICAgICAgICBpZiAodGhpcy5IID0gdGhpcy5jcmVhdGVJdGVtcygpKQ0KICAgICAgICAgICAgZm9yICh2YXIgYyA9IDA7IGMgPCB0aGlzLkgubGVuZ3RoOyBjKyspIGZhKGEsIHRoaXMuSFtjXSk7DQogICAgICAgIHJldHVybiBhDQogICAgfTsNCiAgICBzLkxhID0gbSgpOw0KICAgIHMuViA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuY2xhc3NOYW1lICsgIiB2anMtbWVudS1idXR0b24gIiArIHQudy5wcm90b3R5cGUuVi5jYWxsKHRoaXMpDQogICAgfTsNCiAgICBzLm5iID0gbSgpOw0KICAgIHMubWIgPSBtKCk7DQogICAgcy51ID0gZnVuY3Rpb24gKCkgew0KICAgICAgICB0aGlzLk4oIm1vdXNlb3V0IiwgdC5iaW5kKHRoaXMsIGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIEcodGhpcy5BYSk7DQogICAgICAgICAgICB0aGlzLmMuYmx1cigpDQogICAgICAgIH0pKTsNCiAgICAgICAgdGhpcy5LYSA/IEgodGhpcykgOiBnYSh0aGlzKQ0KICAgIH07DQogICAgcy5sYSA9IGZ1bmN0aW9uIChhKSB7DQogICAgICAgIDMyID09IGEud2hpY2ggfHwgMTMgPT0gYS53aGljaCA/ICh0aGlzLkthID8gSCh0aGlzKSA6IGdhKHRoaXMpLCBhLnByZXZlbnREZWZhdWx0KCkpIDogMjcgPT0gYS53aGljaCAmJiAodGhpcy5LYSAmJiBIKHRoaXMpLCBhLnByZXZlbnREZWZhdWx0KCkpDQogICAgfTsNCg0KICAgIGZ1bmN0aW9uIGdhKGEpIHsNCiAgICAgICAgYS5LYSA9IGY7DQogICAgICAgIGEuQWEucCgidmpzLWxvY2stc2hvd2luZyIpOw0KICAgICAgICBhLmMuc2V0QXR0cmlidXRlKCJhcmlhLXByZXNzZWQiLCBmKTsNCiAgICAgICAgYS5IICYmIDAgPCBhLkgubGVuZ3RoICYmIGEuSFswXS5tKCkuZm9jdXMoKQ0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIEgoYSkgew0KICAgICAgICBhLkthID0gbDsNCiAgICAgICAgRyhhLkFhKTsNCiAgICAgICAgYS5jLnNldEF0dHJpYnV0ZSgiYXJpYS1wcmVzc2VkIiwgbCkNCiAgICB9DQogICAgdC5KID0gZnVuY3Rpb24gKGEpIHsNCiAgICAgICAgIm51bWJlciIgPT09IHR5cGVvZiBhID8gdGhpcy5jb2RlID0gYSA6ICJzdHJpbmciID09PSB0eXBlb2YgYSA/IHRoaXMubWVzc2FnZSA9IGEgOiAib2JqZWN0IiA9PT0gdHlwZW9mIGEgJiYgdC5pLkQodGhpcywgYSk7DQogICAgICAgIHRoaXMubWVzc2FnZSB8fCAodGhpcy5tZXNzYWdlID0gdC5KLlRkW3RoaXMuY29kZV0gfHwgIiIpDQogICAgfTsNCiAgICB0LkoucHJvdG90eXBlLmNvZGUgPSAwOw0KICAgIHQuSi5wcm90b3R5cGUubWVzc2FnZSA9ICIiOw0KICAgIHQuSi5wcm90b3R5cGUuc3RhdHVzID0gajsNCiAgICB0LkouamIgPSAiTUVESUFfRVJSX0NVU1RPTSBNRURJQV9FUlJfQUJPUlRFRCBNRURJQV9FUlJfTkVUV09SSyBNRURJQV9FUlJfREVDT0RFIE1FRElBX0VSUl9TUkNfTk9UX1NVUFBPUlRFRCBNRURJQV9FUlJfRU5DUllQVEVEIi5zcGxpdCgiICIpOw0KICAgIHQuSi5UZCA9IHsNCiAgICAgICAgMTogIllvdSBhYm9ydGVkIHRoZSB2aWRlbyBwbGF5YmFjayIsDQogICAgICAgIDI6ICJBIG5ldHdvcmsgZXJyb3IgY2F1c2VkIHRoZSB2aWRlbyBkb3dubG9hZCB0byBmYWlsIHBhcnQtd2F5LiIsDQogICAgICAgIDM6ICJUaGUgdmlkZW8gcGxheWJhY2sgd2FzIGFib3J0ZWQgZHVlIHRvIGEgY29ycnVwdGlvbiBwcm9ibGVtIG9yIGJlY2F1c2UgdGhlIHZpZGVvIHVzZWQgZmVhdHVyZXMgeW91ciBicm93c2VyIGRpZCBub3Qgc3VwcG9ydC4iLA0KICAgICAgICA0OiAiVGhlIHZpZGVvIGNvdWxkIG5vdCBiZSBsb2FkZWQsIGVpdGhlciBiZWNhdXNlIHRoZSBzZXJ2ZXIgb3IgbmV0d29yayBmYWlsZWQgb3IgYmVjYXVzZSB0aGUgZm9ybWF0IGlzIG5vdCBzdXBwb3J0ZWQuIiwNCiAgICAgICAgNTogIlRoZSB2aWRlbyBpcyBlbmNyeXB0ZWQgYW5kIHdlIGRvIG5vdCBoYXZlIHRoZSBrZXlzIHRvIGRlY3J5cHQgaXQuIg0KICAgIH07DQogICAgZm9yICh2YXIgSSA9IDA7IEkgPCB0LkouamIubGVuZ3RoOyBJKyspIHQuSlt0LkouamJbSV1dID0gSSwgdC5KLnByb3RvdHlwZVt0LkouamJbSV1dID0gSTsNCiAgICB2YXIgSiwgaGEsIEssIEw7DQogICAgSiA9IFsicmVxdWVzdEZ1bGxzY3JlZW4gZXhpdEZ1bGxzY3JlZW4gZnVsbHNjcmVlbkVsZW1lbnQgZnVsbHNjcmVlbkVuYWJsZWQgZnVsbHNjcmVlbmNoYW5nZSBmdWxsc2NyZWVuZXJyb3IiLnNwbGl0KCIgIiksICJ3ZWJraXRSZXF1ZXN0RnVsbHNjcmVlbiB3ZWJraXRFeGl0RnVsbHNjcmVlbiB3ZWJraXRGdWxsc2NyZWVuRWxlbWVudCB3ZWJraXRGdWxsc2NyZWVuRW5hYmxlZCB3ZWJraXRmdWxsc2NyZWVuY2hhbmdlIHdlYmtpdGZ1bGxzY3JlZW5lcnJvciIuc3BsaXQoIiAiKSwgIndlYmtpdFJlcXVlc3RGdWxsU2NyZWVuIHdlYmtpdENhbmNlbEZ1bGxTY3JlZW4gd2Via2l0Q3VycmVudEZ1bGxTY3JlZW5FbGVtZW50IHdlYmtpdENhbmNlbEZ1bGxTY3JlZW4gd2Via2l0ZnVsbHNjcmVlbmNoYW5nZSB3ZWJraXRmdWxsc2NyZWVuZXJyb3IiLnNwbGl0KCIgIiksICJtb3pSZXF1ZXN0RnVsbFNjcmVlbiBtb3pDYW5jZWxGdWxsU2NyZWVuIG1vekZ1bGxTY3JlZW5FbGVtZW50IG1vekZ1bGxTY3JlZW5FbmFibGVkIG1vemZ1bGxzY3JlZW5jaGFuZ2UgbW96ZnVsbHNjcmVlbmVycm9yIi5zcGxpdCgiICIpLCAibXNSZXF1ZXN0RnVsbHNjcmVlbiBtc0V4aXRGdWxsc2NyZWVuIG1zRnVsbHNjcmVlbkVsZW1lbnQgbXNGdWxsc2NyZWVuRW5hYmxlZCBNU0Z1bGxzY3JlZW5DaGFuZ2UgTVNGdWxsc2NyZWVuRXJyb3IiLnNwbGl0KCIgIildOw0KICAgIGhhID0gSlswXTsNCiAgICBmb3IgKEwgPSAwOyBMIDwgSi5sZW5ndGg7IEwrKykNCiAgICAgICAgaWYgKEpbTF1bMV0gaW4gZG9jdW1lbnQpIHsNCiAgICAgICAgICAgIEsgPSBKW0xdOw0KICAgICAgICAgICAgYnJlYWsNCiAgICAgICAgfQ0KICAgIGlmIChLKSB7DQogICAgICAgIHQuZWIuU2IgPSB7fTsNCiAgICAgICAgZm9yIChMID0gMDsgTCA8IEsubGVuZ3RoOyBMKyspIHQuZWIuU2JbaGFbTF1dID0gS1tMXQ0KICAgIH0NCiAgICB0LlBsYXllciA9IHQuYS5leHRlbmQoew0KICAgICAgICBsOiBmdW5jdGlvbiAoYSwgYywgZCkgew0KICAgICAgICAgICAgdGhpcy5MID0gYTsNCiAgICAgICAgICAgIGEuaWQgPSBhLmlkIHx8ICJ2anNfdmlkZW9fIiArIHQucysrOw0KICAgICAgICAgICAgdGhpcy5ZZSA9IGEgJiYgdC5QYShhKTsNCiAgICAgICAgICAgIGMgPSB0LmkuRChpYShhKSwgYyk7DQogICAgICAgICAgICB0aGlzLlRjID0gYy5sYW5ndWFnZSB8fCB0Lm9wdGlvbnMubGFuZ3VhZ2U7DQogICAgICAgICAgICB0aGlzLm9lID0gYy5sYW5ndWFnZXMgfHwgdC5vcHRpb25zLmxhbmd1YWdlczsNCiAgICAgICAgICAgIHRoaXMuSyA9IHt9Ow0KICAgICAgICAgICAgdGhpcy5aYyA9IGMucG9zdGVyIHx8ICIiOw0KICAgICAgICAgICAgdGhpcy5NYiA9ICEhYy5jb250cm9sczsNCiAgICAgICAgICAgIGEuY29udHJvbHMgPSBsOw0KICAgICAgICAgICAgYy5kZCA9IGw7DQogICAgICAgICAgICBqYSh0aGlzLCAiYXVkaW8iID09PSB0aGlzLkwubm9kZU5hbWUudG9Mb3dlckNhc2UoKSk7DQogICAgICAgICAgICB0LmEuY2FsbCh0aGlzLCB0aGlzLCBjLCBkKTsNCiAgICAgICAgICAgIHRoaXMuY29udHJvbHMoKSA/IHRoaXMucCgidmpzLWNvbnRyb2xzLWVuYWJsZWQiKSA6IHRoaXMucCgidmpzLWNvbnRyb2xzLWRpc2FibGVkIik7DQogICAgICAgICAgICBqYSh0aGlzKSAmJiB0aGlzLnAoInZqcy1hdWRpbyIpOw0KICAgICAgICAgICAgdC5EYVt0aGlzLlJhXSA9IHRoaXM7DQogICAgICAgICAgICBjLnBsdWdpbnMgJiYgdC5pLmRhKGMucGx1Z2lucywgZnVuY3Rpb24gKGEsDQogICAgICAgICAgICAgICAgYykgew0KICAgICAgICAgICAgICAgIHRoaXNbYV0oYykNCiAgICAgICAgICAgIH0sIHRoaXMpOw0KICAgICAgICAgICAgdmFyIGUsIGcsIGgsIGssIHE7DQogICAgICAgICAgICBlID0gdC5iaW5kKHRoaXMsIHRoaXMucmVwb3J0VXNlckFjdGl2aXR5KTsNCiAgICAgICAgICAgIHRoaXMuYigibW91c2Vkb3duIiwgZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgIGUoKTsNCiAgICAgICAgICAgICAgICB0aGlzLmNsZWFySW50ZXJ2YWwoZyk7DQogICAgICAgICAgICAgICAgZyA9IHRoaXMuc2V0SW50ZXJ2YWwoZSwgMjUwKQ0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB0aGlzLmIoIm1vdXNlbW92ZSIsIGZ1bmN0aW9uIChhKSB7DQogICAgICAgICAgICAgICAgaWYgKGEuc2NyZWVuWCAhPSBrIHx8IGEuc2NyZWVuWSAhPSBxKSBrID0gYS5zY3JlZW5YLCBxID0gYS5zY3JlZW5ZLCBlKCkNCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgdGhpcy5iKCJtb3VzZXVwIiwgZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgIGUoKTsNCiAgICAgICAgICAgICAgICB0aGlzLmNsZWFySW50ZXJ2YWwoZykNCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgdGhpcy5iKCJrZXlkb3duIiwgZSk7DQogICAgICAgICAgICB0aGlzLmIoImtleXVwIiwgZSk7DQogICAgICAgICAgICB0aGlzLnNldEludGVydmFsKGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICBpZiAodGhpcy5HYSkgew0KICAgICAgICAgICAgICAgICAgICB0aGlzLkdhID0gbDsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy51c2VyQWN0aXZlKGYpOw0KICAgICAgICAgICAgICAgICAgICB0aGlzLmNsZWFyVGltZW91dChoKTsNCiAgICAgICAgICAgICAgICAgICAgdmFyIGEgPSB0aGlzLm9wdGlvbnMoKS5pbmFjdGl2aXR5VGltZW91dDsNCiAgICAgICAgICAgICAgICAgICAgMCA8IGEgJiYgKGggPSB0aGlzLnNldFRpbWVvdXQoZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5HYSB8fA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudXNlckFjdGl2ZShsKQ0KICAgICAgICAgICAgICAgICAgICB9LCBhKSkNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9LCAyNTApDQogICAgICAgIH0NCiAgICB9KTsNCiAgICBzID0gdC5QbGF5ZXIucHJvdG90eXBlOw0KICAgIHMubGFuZ3VhZ2UgPSBmdW5jdGlvbiAoYSkgew0KICAgICAgICBpZiAoYSA9PT0gYikgcmV0dXJuIHRoaXMuVGM7DQogICAgICAgIHRoaXMuVGMgPSBhOw0KICAgICAgICByZXR1cm4gdGhpcw0KICAgIH07DQogICAgcy5sYW5ndWFnZXMgPSBuKCJvZSIpOw0KICAgIHMucSA9IHQub3B0aW9uczsNCiAgICBzLmRpc3Bvc2UgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHRoaXMubygiZGlzcG9zZSIpOw0KICAgICAgICB0aGlzLm4oImRpc3Bvc2UiKTsNCiAgICAgICAgdC5EYVt0aGlzLlJhXSA9IGo7DQogICAgICAgIHRoaXMuTCAmJiB0aGlzLkwucGxheWVyICYmICh0aGlzLkwucGxheWVyID0gaik7DQogICAgICAgIHRoaXMuYyAmJiB0aGlzLmMucGxheWVyICYmICh0aGlzLmMucGxheWVyID0gaik7DQogICAgICAgIHRoaXMuaCAmJiB0aGlzLmguZGlzcG9zZSgpOw0KICAgICAgICB0LmEucHJvdG90eXBlLmRpc3Bvc2UuY2FsbCh0aGlzKQ0KICAgIH07DQoNCiAgICBmdW5jdGlvbiBpYShhKSB7DQogICAgICAgIHZhciBjLCBkLCBlID0gew0KICAgICAgICAgICAgc291cmNlczogW10sDQogICAgICAgICAgICB0cmFja3M6IFtdDQogICAgICAgIH07DQogICAgICAgIGMgPSB0LlBhKGEpOw0KICAgICAgICBkID0gY1siZGF0YS1zZXR1cCJdOw0KICAgICAgICBkICE9PSBqICYmIHQuaS5EKGMsIHQuSlNPTi5wYXJzZShkIHx8ICJ7fSIpKTsNCiAgICAgICAgdC5pLkQoZSwgYyk7DQogICAgICAgIGlmIChhLmhhc0NoaWxkTm9kZXMoKSkgew0KICAgICAgICAgICAgdmFyIGcsIGg7DQogICAgICAgICAgICBhID0gYS5jaGlsZE5vZGVzOw0KICAgICAgICAgICAgZyA9IDA7DQogICAgICAgICAgICBmb3IgKGggPSBhLmxlbmd0aDsgZyA8IGg7IGcrKykgYyA9IGFbZ10sIGQgPSBjLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCksICJzb3VyY2UiID09PSBkID8gZS5zb3VyY2VzLnB1c2godC5QYShjKSkgOiAidHJhY2siID09PSBkICYmIGUudHJhY2tzLnB1c2godC5QYShjKSkNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gZQ0KICAgIH0NCiAgICBzLmYgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHZhciBhID0gdGhpcy5jID0gdC5hLnByb3RvdHlwZS5mLmNhbGwodGhpcywgImRpdiIpLA0KICAgICAgICAgICAgYyA9IHRoaXMuTCwNCiAgICAgICAgICAgIGQ7DQogICAgICAgIGMucmVtb3ZlQXR0cmlidXRlKCJ3aWR0aCIpOw0KICAgICAgICBjLnJlbW92ZUF0dHJpYnV0ZSgiaGVpZ2h0Iik7DQogICAgICAgIGQgPSB0LlBhKGMpOw0KICAgICAgICB0LmkuZGEoZCwgZnVuY3Rpb24gKGMpIHsNCiAgICAgICAgICAgICJjbGFzcyIgPT0gYyA/IGEuY2xhc3NOYW1lID0gZFtjXSA6IGEuc2V0QXR0cmlidXRlKGMsIGRbY10pDQogICAgICAgIH0pOw0KICAgICAgICBjLmlkICs9ICJfaHRtbDVfYXBpIjsNCiAgICAgICAgYy5jbGFzc05hbWUgPSAidmpzLXRlY2giOw0KICAgICAgICBjLnBsYXllciA9IGEucGxheWVyID0gdGhpczsNCiAgICAgICAgdGhpcy5wKCJ2anMtcGF1c2VkIik7DQogICAgICAgIHRoaXMud2lkdGgodGhpcy5xLndpZHRoLCBmKTsNCiAgICAgICAgdGhpcy5oZWlnaHQodGhpcy5xLmhlaWdodCwgZik7DQogICAgICAgIGMuaGUgPSBjLm5ldHdvcmtTdGF0ZTsNCiAgICAgICAgYy5wYXJlbnROb2RlICYmIGMucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoYSwgYyk7DQogICAgICAgIHQuVmIoYywgYSk7DQogICAgICAgIHRoaXMuYyA9IGE7DQogICAgICAgIHRoaXMuYigibG9hZHN0YXJ0IiwgdGhpcy55ZSk7DQogICAgICAgIHRoaXMuYigid2FpdGluZyIsIHRoaXMuRWUpOw0KICAgICAgICB0aGlzLmIoWyJjYW5wbGF5IiwNCiAgICAgICAgICAgICJjYW5wbGF5dGhyb3VnaCIsICJwbGF5aW5nIiwgImVuZGVkIg0KICAgICAgICBdLCB0aGlzLkRlKTsNCiAgICAgICAgdGhpcy5iKCJzZWVraW5nIiwgdGhpcy5CZSk7DQogICAgICAgIHRoaXMuYigic2Vla2VkIiwgdGhpcy5BZSk7DQogICAgICAgIHRoaXMuYigiZW5kZWQiLCB0aGlzLnZlKTsNCiAgICAgICAgdGhpcy5iKCJwbGF5IiwgdGhpcy5hYyk7DQogICAgICAgIHRoaXMuYigiZmlyc3RwbGF5IiwgdGhpcy53ZSk7DQogICAgICAgIHRoaXMuYigicGF1c2UiLCB0aGlzLiRiKTsNCiAgICAgICAgdGhpcy5iKCJwcm9ncmVzcyIsIHRoaXMuemUpOw0KICAgICAgICB0aGlzLmIoImR1cmF0aW9uY2hhbmdlIiwgdGhpcy5XYyk7DQogICAgICAgIHRoaXMuYigiZnVsbHNjcmVlbmNoYW5nZSIsIHRoaXMueGUpOw0KICAgICAgICByZXR1cm4gYQ0KICAgIH07DQoNCiAgICBmdW5jdGlvbiBrYShhLCBjLCBkKSB7DQogICAgICAgIGEuaCAmJiAoYS56YSA9IGwsIGEuaC5kaXNwb3NlKCksIGEuaCA9IGwpOw0KICAgICAgICAiSHRtbDUiICE9PSBjICYmIGEuTCAmJiAodC5lLk5iKGEuTCksIGEuTCA9IGopOw0KICAgICAgICBhLlZhID0gYzsNCiAgICAgICAgYS56YSA9IGw7DQogICAgICAgIHZhciBlID0gdC5pLkQoew0KICAgICAgICAgICAgc291cmNlOiBkLA0KICAgICAgICAgICAgcGFyZW50RWw6IGEuYw0KICAgICAgICB9LCBhLnFbYy50b0xvd2VyQ2FzZSgpXSk7DQogICAgICAgIGQgJiYgKGEuR2MgPSBkLnR5cGUsIGQuc3JjID09IGEuSy5zcmMgJiYgMCA8IGEuSy5jdXJyZW50VGltZSAmJiAoZS5zdGFydFRpbWUgPSBhLksuY3VycmVudFRpbWUpLCBhLksuc3JjID0gZC5zcmMpOw0KICAgICAgICBhLmggPSBuZXcgd2luZG93LnZpZGVvanNbY10oYSwgZSk7DQogICAgICAgIGEuaC5JKGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIHRoaXMuZC5YYSgpDQogICAgICAgIH0pDQogICAgfQ0KICAgIHMueWUgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHRoaXMucigidmpzLWVuZGVkIik7DQogICAgICAgIHRoaXMuZXJyb3Ioaik7DQogICAgICAgIHRoaXMucGF1c2VkKCkgPyBsYSh0aGlzLCBsKSA6IHRoaXMubygiZmlyc3RwbGF5IikNCiAgICB9Ow0KICAgIHMuTmMgPSBsOw0KDQogICAgZnVuY3Rpb24gbGEoYSwgYykgew0KICAgICAgICBjICE9PSBiICYmIGEuTmMgIT09IGMgJiYgKChhLk5jID0gYykgPyAoYS5wKCJ2anMtaGFzLXN0YXJ0ZWQiKSwgYS5vKCJmaXJzdHBsYXkiKSkgOiBhLnIoInZqcy1oYXMtc3RhcnRlZCIpKQ0KICAgIH0NCiAgICBzLmFjID0gZnVuY3Rpb24gKCkgew0KICAgICAgICB0aGlzLnIoInZqcy1lbmRlZCIpOw0KICAgICAgICB0aGlzLnIoInZqcy1wYXVzZWQiKTsNCiAgICAgICAgdGhpcy5wKCJ2anMtcGxheWluZyIpOw0KICAgICAgICBsYSh0aGlzLCBmKQ0KICAgIH07DQogICAgcy5FZSA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgdGhpcy5wKCJ2anMtd2FpdGluZyIpDQogICAgfTsNCiAgICBzLkRlID0gZnVuY3Rpb24gKCkgew0KICAgICAgICB0aGlzLnIoInZqcy13YWl0aW5nIikNCiAgICB9Ow0KICAgIHMuQmUgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHRoaXMucCgidmpzLXNlZWtpbmciKQ0KICAgIH07DQogICAgcy5BZSA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgdGhpcy5yKCJ2anMtc2Vla2luZyIpDQogICAgfTsNCiAgICBzLndlID0gZnVuY3Rpb24gKCkgew0KICAgICAgICB0aGlzLnEuc3RhcnR0aW1lICYmIHRoaXMuY3VycmVudFRpbWUodGhpcy5xLnN0YXJ0dGltZSk7DQogICAgICAgIHRoaXMucCgidmpzLWhhcy1zdGFydGVkIikNCiAgICB9Ow0KICAgIHMuJGIgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHRoaXMucigidmpzLXBsYXlpbmciKTsNCiAgICAgICAgdGhpcy5wKCJ2anMtcGF1c2VkIikNCiAgICB9Ow0KICAgIHMuemUgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIDEgPT0gdGhpcy5idWZmZXJlZFBlcmNlbnQoKSAmJiB0aGlzLm8oImxvYWRlZGFsbGRhdGEiKQ0KICAgIH07DQogICAgcy52ZSA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgdGhpcy5wKCJ2anMtZW5kZWQiKTsNCiAgICAgICAgdGhpcy5xLmxvb3AgPyAodGhpcy5jdXJyZW50VGltZSgwKSwgdGhpcy5wbGF5KCkpIDogdGhpcy5wYXVzZWQoKSB8fCB0aGlzLnBhdXNlKCkNCiAgICB9Ow0KICAgIHMuV2MgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHZhciBhID0gTSh0aGlzLCAiZHVyYXRpb24iKTsNCiAgICAgICAgYSAmJiAoMCA+IGEgJiYgKGEgPSBJbmZpbml0eSksIHRoaXMuZHVyYXRpb24oYSksIEluZmluaXR5ID09PSBhID8gdGhpcy5wKCJ2anMtbGl2ZSIpIDogdGhpcy5yKCJ2anMtbGl2ZSIpKQ0KICAgIH07DQogICAgcy54ZSA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgdGhpcy5pc0Z1bGxzY3JlZW4oKSA/IHRoaXMucCgidmpzLWZ1bGxzY3JlZW4iKSA6IHRoaXMucigidmpzLWZ1bGxzY3JlZW4iKQ0KICAgIH07DQoNCiAgICBmdW5jdGlvbiBOKGEsIGMsIGQpIHsNCiAgICAgICAgaWYgKGEuaCAmJiAhYS5oLnphKSBhLmguSShmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICB0aGlzW2NdKGQpDQogICAgICAgIH0pOw0KICAgICAgICBlbHNlIHRyeSB7DQogICAgICAgICAgICBhLmhbY10oZCkNCiAgICAgICAgfSBjYXRjaCAoZSkgew0KICAgICAgICAgICAgdGhyb3cgdC5sb2coZSksIGU7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBmdW5jdGlvbiBNKGEsIGMpIHsNCiAgICAgICAgaWYgKGEuaCAmJiBhLmguemEpIHRyeSB7DQogICAgICAgICAgICByZXR1cm4gYS5oW2NdKCkNCiAgICAgICAgfSBjYXRjaCAoZCkgew0KICAgICAgICAgICAgdGhyb3cgYS5oW2NdID09PSBiID8gdC5sb2coIlZpZGVvLmpzOiAiICsgYyArICIgbWV0aG9kIG5vdCBkZWZpbmVkIGZvciAiICsgYS5WYSArICIgcGxheWJhY2sgdGVjaG5vbG9neS4iLCBkKSA6ICJUeXBlRXJyb3IiID09IGQubmFtZSA/ICh0LmxvZygiVmlkZW8uanM6ICIgKyBjICsgIiB1bmF2YWlsYWJsZSBvbiAiICsgYS5WYSArICIgcGxheWJhY2sgdGVjaG5vbG9neSBlbGVtZW50LiIsIGQpLCBhLmguemEgPSBsKSA6IHQubG9nKGQpLCBkOw0KICAgICAgICB9DQogICAgfQ0KICAgIHMucGxheSA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgTih0aGlzLCAicGxheSIpOw0KICAgICAgICByZXR1cm4gdGhpcw0KICAgIH07DQogICAgcy5wYXVzZSA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgTih0aGlzLCAicGF1c2UiKTsNCiAgICAgICAgcmV0dXJuIHRoaXMNCiAgICB9Ow0KICAgIHMucGF1c2VkID0gZnVuY3Rpb24gKCkgew0KICAgICAgICByZXR1cm4gTSh0aGlzLCAicGF1c2VkIikgPT09IGwgPyBsIDogZg0KICAgIH07DQogICAgcy5jdXJyZW50VGltZSA9IGZ1bmN0aW9uIChhKSB7DQogICAgICAgIHJldHVybiBhICE9PSBiID8gKE4odGhpcywgInNldEN1cnJlbnRUaW1lIiwgYSksIHRoaXMpIDogdGhpcy5LLmN1cnJlbnRUaW1lID0gTSh0aGlzLCAiY3VycmVudFRpbWUiKSB8fCAwDQogICAgfTsNCiAgICBzLmR1cmF0aW9uID0gZnVuY3Rpb24gKGEpIHsNCiAgICAgICAgaWYgKGEgIT09IGIpIHJldHVybiB0aGlzLksuZHVyYXRpb24gPSBwYXJzZUZsb2F0KGEpLCB0aGlzOw0KICAgICAgICB0aGlzLksuZHVyYXRpb24gPT09IGIgJiYgdGhpcy5XYygpOw0KICAgICAgICByZXR1cm4gdGhpcy5LLmR1cmF0aW9uIHx8IDANCiAgICB9Ow0KICAgIHMucmVtYWluaW5nVGltZSA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuZHVyYXRpb24oKSAtIHRoaXMuY3VycmVudFRpbWUoKQ0KICAgIH07DQogICAgcy5idWZmZXJlZCA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgdmFyIGEgPSBNKHRoaXMsICJidWZmZXJlZCIpOw0KICAgICAgICBpZiAoIWEgfHwgIWEubGVuZ3RoKSBhID0gdC55YSgwLCAwKTsNCiAgICAgICAgcmV0dXJuIGENCiAgICB9Ow0KICAgIHMuYnVmZmVyZWRQZXJjZW50ID0gZnVuY3Rpb24gKCkgew0KICAgICAgICB2YXIgYSA9IHRoaXMuZHVyYXRpb24oKSwNCiAgICAgICAgICAgIGMgPSB0aGlzLmJ1ZmZlcmVkKCksDQogICAgICAgICAgICBkID0gMCwNCiAgICAgICAgICAgIGUsIGc7DQogICAgICAgIGlmICghYSkgcmV0dXJuIDA7DQogICAgICAgIGZvciAodmFyIGggPSAwOyBoIDwgYy5sZW5ndGg7IGgrKykgZSA9IGMuc3RhcnQoaCksIGcgPSBjLmVuZChoKSwgZyA+IGEgJiYgKGcgPSBhKSwgZCArPSBnIC0gZTsNCiAgICAgICAgcmV0dXJuIGQgLyBhDQogICAgfTsNCiAgICBzLnZvbHVtZSA9IGZ1bmN0aW9uIChhKSB7DQogICAgICAgIGlmIChhICE9PSBiKSByZXR1cm4gYSA9IE1hdGgubWF4KDAsIE1hdGgubWluKDEsIHBhcnNlRmxvYXQoYSkpKSwgdGhpcy5LLnZvbHVtZSA9IGEsIE4odGhpcywgInNldFZvbHVtZSIsIGEpLCB0Lk5lKGEpLCB0aGlzOw0KICAgICAgICBhID0gcGFyc2VGbG9hdChNKHRoaXMsICJ2b2x1bWUiKSk7DQogICAgICAgIHJldHVybiBpc05hTihhKSA/IDEgOiBhDQogICAgfTsNCiAgICBzLm11dGVkID0gZnVuY3Rpb24gKGEpIHsNCiAgICAgICAgcmV0dXJuIGEgIT09IGIgPyAoTih0aGlzLCAic2V0TXV0ZWQiLCBhKSwgdGhpcykgOiBNKHRoaXMsICJtdXRlZCIpIHx8IGwNCiAgICB9Ow0KICAgIHMuVWEgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHJldHVybiBNKHRoaXMsICJzdXBwb3J0c0Z1bGxTY3JlZW4iKSB8fCBsDQogICAgfTsNCiAgICBzLlFjID0gbDsNCiAgICBzLmlzRnVsbHNjcmVlbiA9IGZ1bmN0aW9uIChhKSB7DQogICAgICAgIHJldHVybiBhICE9PSBiID8gKHRoaXMuUWMgPSAhIWEsIHRoaXMpIDogdGhpcy5RYw0KICAgIH07DQogICAgcy5pc0Z1bGxTY3JlZW4gPSBmdW5jdGlvbiAoYSkgew0KICAgICAgICB0LmxvZy53YXJuKCdwbGF5ZXIuaXNGdWxsU2NyZWVuKCkgaGFzIGJlZW4gZGVwcmVjYXRlZCwgdXNlIHBsYXllci5pc0Z1bGxzY3JlZW4oKSB3aXRoIGEgbG93ZXJjYXNlICJzIiknKTsNCiAgICAgICAgcmV0dXJuIHRoaXMuaXNGdWxsc2NyZWVuKGEpDQogICAgfTsNCiAgICBzLnJlcXVlc3RGdWxsc2NyZWVuID0gZnVuY3Rpb24gKCkgew0KICAgICAgICB2YXIgYSA9IHQuZWIuU2I7DQogICAgICAgIHRoaXMuaXNGdWxsc2NyZWVuKGYpOw0KICAgICAgICBhID8gKHQuYihkb2N1bWVudCwgYS5mdWxsc2NyZWVuY2hhbmdlLCB0LmJpbmQodGhpcywgZnVuY3Rpb24gKGMpIHsNCiAgICAgICAgICAgIHRoaXMuaXNGdWxsc2NyZWVuKGRvY3VtZW50W2EuZnVsbHNjcmVlbkVsZW1lbnRdKTsNCiAgICAgICAgICAgIHRoaXMuaXNGdWxsc2NyZWVuKCkgPT09IGwgJiYgdC5uKGRvY3VtZW50LCBhLmZ1bGxzY3JlZW5jaGFuZ2UsIGFyZ3VtZW50cy5jYWxsZWUpOw0KICAgICAgICAgICAgdGhpcy5vKCJmdWxsc2NyZWVuY2hhbmdlIikNCiAgICAgICAgfSkpLCB0aGlzLmNbYS5yZXF1ZXN0RnVsbHNjcmVlbl0oKSkgOiB0aGlzLmguVWEoKSA/IE4odGhpcywgImVudGVyRnVsbFNjcmVlbiIpIDogKHRoaXMuSmMoKSwgdGhpcy5vKCJmdWxsc2NyZWVuY2hhbmdlIikpOw0KICAgICAgICByZXR1cm4gdGhpcw0KICAgIH07DQogICAgcy5yZXF1ZXN0RnVsbFNjcmVlbiA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgdC5sb2cud2FybigncGxheWVyLnJlcXVlc3RGdWxsU2NyZWVuKCkgaGFzIGJlZW4gZGVwcmVjYXRlZCwgdXNlIHBsYXllci5yZXF1ZXN0RnVsbHNjcmVlbigpIHdpdGggYSBsb3dlcmNhc2UgInMiKScpOw0KICAgICAgICByZXR1cm4gdGhpcy5yZXF1ZXN0RnVsbHNjcmVlbigpDQogICAgfTsNCiAgICBzLmV4aXRGdWxsc2NyZWVuID0gZnVuY3Rpb24gKCkgew0KICAgICAgICB2YXIgYSA9IHQuZWIuU2I7DQogICAgICAgIHRoaXMuaXNGdWxsc2NyZWVuKGwpOw0KICAgICAgICBpZiAoYSkgZG9jdW1lbnRbYS5leGl0RnVsbHNjcmVlbl0oKTsNCiAgICAgICAgZWxzZSB0aGlzLmguVWEoKSA/IE4odGhpcywgImV4aXRGdWxsU2NyZWVuIikgOiAodGhpcy5PYigpLCB0aGlzLm8oImZ1bGxzY3JlZW5jaGFuZ2UiKSk7DQogICAgICAgIHJldHVybiB0aGlzDQogICAgfTsNCiAgICBzLmNhbmNlbEZ1bGxTY3JlZW4gPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHQubG9nLndhcm4oInBsYXllci5jYW5jZWxGdWxsU2NyZWVuKCkgaGFzIGJlZW4gZGVwcmVjYXRlZCwgdXNlIHBsYXllci5leGl0RnVsbHNjcmVlbigpIik7DQogICAgICAgIHJldHVybiB0aGlzLmV4aXRGdWxsc2NyZWVuKCkNCiAgICB9Ow0KICAgIHMuSmMgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHRoaXMua2UgPSBmOw0KICAgICAgICB0aGlzLlZkID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnN0eWxlLm92ZXJmbG93Ow0KICAgICAgICB0LmIoZG9jdW1lbnQsICJrZXlkb3duIiwgdC5iaW5kKHRoaXMsIHRoaXMuS2MpKTsNCiAgICAgICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnN0eWxlLm92ZXJmbG93ID0gImhpZGRlbiI7DQogICAgICAgIHQucChkb2N1bWVudC5ib2R5LCAidmpzLWZ1bGwtd2luZG93Iik7DQogICAgICAgIHRoaXMubygiZW50ZXJGdWxsV2luZG93IikNCiAgICB9Ow0KICAgIHMuS2MgPSBmdW5jdGlvbiAoYSkgew0KICAgICAgICAyNyA9PT0gYS5rZXlDb2RlICYmICh0aGlzLmlzRnVsbHNjcmVlbigpID09PSBmID8gdGhpcy5leGl0RnVsbHNjcmVlbigpIDogdGhpcy5PYigpKQ0KICAgIH07DQogICAgcy5PYiA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgdGhpcy5rZSA9IGw7DQogICAgICAgIHQubihkb2N1bWVudCwgImtleWRvd24iLCB0aGlzLktjKTsNCiAgICAgICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnN0eWxlLm92ZXJmbG93ID0gdGhpcy5WZDsNCiAgICAgICAgdC5yKGRvY3VtZW50LmJvZHksICJ2anMtZnVsbC13aW5kb3ciKTsNCiAgICAgICAgdGhpcy5vKCJleGl0RnVsbFdpbmRvdyIpDQogICAgfTsNCiAgICBzLnNlbGVjdFNvdXJjZSA9IGZ1bmN0aW9uIChhKSB7DQogICAgICAgIGZvciAodmFyIGMgPSAwLCBkID0gdGhpcy5xLnRlY2hPcmRlcjsgYyA8IGQubGVuZ3RoOyBjKyspIHsNCiAgICAgICAgICAgIHZhciBlID0gdC53YShkW2NdKSwNCiAgICAgICAgICAgICAgICBnID0gd2luZG93LnZpZGVvanNbZV07DQogICAgICAgICAgICBpZiAoZykgew0KICAgICAgICAgICAgICAgIGlmIChnLmlzU3VwcG9ydGVkKCkpDQogICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGggPSAwLCBrID0gYTsgaCA8IGsubGVuZ3RoOyBoKyspIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBxID0ga1toXTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChnLmNhblBsYXlTb3VyY2UocSkpIHJldHVybiB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc291cmNlOiBxLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGg6IGUNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSBlbHNlIHQubG9nLmVycm9yKCdUaGUgIicgKyBlICsgJyIgdGVjaCBpcyB1bmRlZmluZWQuIFNraXBwZWQgYnJvd3NlciBzdXBwb3J0IGNoZWNrIGZvciB0aGF0IHRlY2guJykNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gbA0KICAgIH07DQogICAgcy5zcmMgPSBmdW5jdGlvbiAoYSkgew0KICAgICAgICBpZiAoYSA9PT0gYikgcmV0dXJuIE0odGhpcywgInNyYyIpOw0KICAgICAgICB0LmkuaXNBcnJheShhKSA/IG1hKHRoaXMsIGEpIDogInN0cmluZyIgPT09IHR5cGVvZiBhID8gdGhpcy5zcmMoew0KICAgICAgICAgICAgc3JjOiBhDQogICAgICAgIH0pIDogYSBpbnN0YW5jZW9mIE9iamVjdCAmJiAoYS50eXBlICYmICF3aW5kb3cudmlkZW9qc1t0aGlzLlZhXS5jYW5QbGF5U291cmNlKGEpID8gbWEodGhpcywgW2FdKSA6ICh0aGlzLksuc3JjID0gYS5zcmMsIHRoaXMuR2MgPSBhLnR5cGUgfHwgIiIsIHRoaXMuSShmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICB3aW5kb3cudmlkZW9qc1t0aGlzLlZhXS5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkoInNldFNvdXJjZSIpID8gTih0aGlzLCAic2V0U291cmNlIiwgYSkgOiBOKHRoaXMsICJzcmMiLCBhLnNyYyk7DQogICAgICAgICAgICAiYXV0byIgPT0gdGhpcy5xLnByZWxvYWQgJiYgdGhpcy5sb2FkKCk7DQogICAgICAgICAgICB0aGlzLnEuYXV0b3BsYXkgJiYgdGhpcy5wbGF5KCkNCiAgICAgICAgfSkpKTsNCiAgICAgICAgcmV0dXJuIHRoaXMNCiAgICB9Ow0KDQogICAgZnVuY3Rpb24gbWEoYSwgYykgew0KICAgICAgICB2YXIgZCA9IGEuc2VsZWN0U291cmNlKGMpOw0KICAgICAgICBkID8gZC5oID09PSBhLlZhID8gYS5zcmMoZC5zb3VyY2UpIDoga2EoYSwgZC5oLCBkLnNvdXJjZSkgOiAoYS5zZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIHRoaXMuZXJyb3Ioew0KICAgICAgICAgICAgICAgIGNvZGU6IDQsDQogICAgICAgICAgICAgICAgbWVzc2FnZTogdGhpcy52KHRoaXMub3B0aW9ucygpLm5vdFN1cHBvcnRlZE1lc3NhZ2UpDQogICAgICAgICAgICB9KQ0KICAgICAgICB9LCAwKSwgYS5YYSgpKQ0KICAgIH0NCiAgICBzLmxvYWQgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIE4odGhpcywgImxvYWQiKTsNCiAgICAgICAgcmV0dXJuIHRoaXMNCiAgICB9Ow0KICAgIHMuY3VycmVudFNyYyA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgcmV0dXJuIE0odGhpcywgImN1cnJlbnRTcmMiKSB8fCB0aGlzLksuc3JjIHx8ICIiDQogICAgfTsNCiAgICBzLlJkID0gZnVuY3Rpb24gKCkgew0KICAgICAgICByZXR1cm4gdGhpcy5HYyB8fCAiIg0KICAgIH07DQogICAgcy5TYSA9IGZ1bmN0aW9uIChhKSB7DQogICAgICAgIHJldHVybiBhICE9PSBiID8gKE4odGhpcywgInNldFByZWxvYWQiLCBhKSwgdGhpcy5xLnByZWxvYWQgPSBhLCB0aGlzKSA6IE0odGhpcywgInByZWxvYWQiKQ0KICAgIH07DQogICAgcy5hdXRvcGxheSA9IGZ1bmN0aW9uIChhKSB7DQogICAgICAgIHJldHVybiBhICE9PSBiID8gKE4odGhpcywgInNldEF1dG9wbGF5IiwgYSksIHRoaXMucS5hdXRvcGxheSA9IGEsIHRoaXMpIDogTSh0aGlzLCAiYXV0b3BsYXkiKQ0KICAgIH07DQogICAgcy5sb29wID0gZnVuY3Rpb24gKGEpIHsNCiAgICAgICAgcmV0dXJuIGEgIT09IGIgPyAoTih0aGlzLCAic2V0TG9vcCIsIGEpLCB0aGlzLnEubG9vcCA9IGEsIHRoaXMpIDogTSh0aGlzLCAibG9vcCIpDQogICAgfTsNCiAgICBzLnBvc3RlciA9IGZ1bmN0aW9uIChhKSB7DQogICAgICAgIGlmIChhID09PSBiKSByZXR1cm4gdGhpcy5aYzsNCiAgICAgICAgYSB8fCAoYSA9ICIiKTsNCiAgICAgICAgdGhpcy5aYyA9IGE7DQogICAgICAgIE4odGhpcywgInNldFBvc3RlciIsIGEpOw0KICAgICAgICB0aGlzLm8oInBvc3RlcmNoYW5nZSIpOw0KICAgICAgICByZXR1cm4gdGhpcw0KICAgIH07DQogICAgcy5jb250cm9scyA9IGZ1bmN0aW9uIChhKSB7DQogICAgICAgIHJldHVybiBhICE9PSBiID8gKGEgPSAhIWEsIHRoaXMuTWIgIT09IGEgJiYgKCh0aGlzLk1iID0gYSkgPyAodGhpcy5yKCJ2anMtY29udHJvbHMtZGlzYWJsZWQiKSwgdGhpcy5wKCJ2anMtY29udHJvbHMtZW5hYmxlZCIpLCB0aGlzLm8oImNvbnRyb2xzZW5hYmxlZCIpKSA6ICh0aGlzLnIoInZqcy1jb250cm9scy1lbmFibGVkIiksIHRoaXMucCgidmpzLWNvbnRyb2xzLWRpc2FibGVkIiksIHRoaXMubygiY29udHJvbHNkaXNhYmxlZCIpKSksIHRoaXMpIDogdGhpcy5NYg0KICAgIH07DQogICAgdC5QbGF5ZXIucHJvdG90eXBlLmZjOw0KICAgIHMgPSB0LlBsYXllci5wcm90b3R5cGU7DQogICAgcy51c2luZ05hdGl2ZUNvbnRyb2xzID0gZnVuY3Rpb24gKGEpIHsNCiAgICAgICAgcmV0dXJuIGEgIT09IGIgPyAoYSA9ICEhYSwgdGhpcy5mYyAhPT0gYSAmJiAoKHRoaXMuZmMgPSBhKSA/ICh0aGlzLnAoInZqcy11c2luZy1uYXRpdmUtY29udHJvbHMiKSwgdGhpcy5vKCJ1c2luZ25hdGl2ZWNvbnRyb2xzIikpIDogKHRoaXMucigidmpzLXVzaW5nLW5hdGl2ZS1jb250cm9scyIpLCB0aGlzLm8oInVzaW5nY3VzdG9tY29udHJvbHMiKSkpLCB0aGlzKSA6IHRoaXMuZmMNCiAgICB9Ow0KICAgIHMua2EgPSBqOw0KICAgIHMuZXJyb3IgPSBmdW5jdGlvbiAoYSkgew0KICAgICAgICBpZiAoYSA9PT0gYikgcmV0dXJuIHRoaXMua2E7DQogICAgICAgIGlmIChhID09PSBqKSByZXR1cm4gdGhpcy5rYSA9IGEsIHRoaXMucigidmpzLWVycm9yIiksIHRoaXM7DQogICAgICAgIHRoaXMua2EgPSBhIGluc3RhbmNlb2YgdC5KID8gYSA6IG5ldyB0LkooYSk7DQogICAgICAgIHRoaXMubygiZXJyb3IiKTsNCiAgICAgICAgdGhpcy5wKCJ2anMtZXJyb3IiKTsNCiAgICAgICAgdC5sb2cuZXJyb3IoIihDT0RFOiIgKyB0aGlzLmthLmNvZGUgKyAiICIgKyB0LkouamJbdGhpcy5rYS5jb2RlXSArICIpIiwgdGhpcy5rYS5tZXNzYWdlLCB0aGlzLmthKTsNCiAgICAgICAgcmV0dXJuIHRoaXMNCiAgICB9Ow0KICAgIHMuZW5kZWQgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHJldHVybiBNKHRoaXMsICJlbmRlZCIpDQogICAgfTsNCiAgICBzLnNlZWtpbmcgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHJldHVybiBNKHRoaXMsICJzZWVraW5nIikNCiAgICB9Ow0KICAgIHMuc2Vla2FibGUgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHJldHVybiBNKHRoaXMsICJzZWVrYWJsZSIpDQogICAgfTsNCiAgICBzLkdhID0gZjsNCiAgICBzLnJlcG9ydFVzZXJBY3Rpdml0eSA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgdGhpcy5HYSA9IGYNCiAgICB9Ow0KICAgIHMuZWMgPSBmOw0KICAgIHMudXNlckFjdGl2ZSA9IGZ1bmN0aW9uIChhKSB7DQogICAgICAgIHJldHVybiBhICE9PSBiID8gKGEgPSAhIWEsIGEgIT09IHRoaXMuZWMgJiYgKCh0aGlzLmVjID0gYSkgPyAodGhpcy5HYSA9IGYsIHRoaXMucigidmpzLXVzZXItaW5hY3RpdmUiKSwgdGhpcy5wKCJ2anMtdXNlci1hY3RpdmUiKSwgdGhpcy5vKCJ1c2VyYWN0aXZlIikpIDogKHRoaXMuR2EgPSBsLCB0aGlzLmggJiYgdGhpcy5oLk4oIm1vdXNlbW92ZSIsIGZ1bmN0aW9uIChhKSB7DQogICAgICAgICAgICBhLnN0b3BQcm9wYWdhdGlvbigpOw0KICAgICAgICAgICAgYS5wcmV2ZW50RGVmYXVsdCgpDQogICAgICAgIH0pLCB0aGlzLnIoInZqcy11c2VyLWFjdGl2ZSIpLCB0aGlzLnAoInZqcy11c2VyLWluYWN0aXZlIiksIHRoaXMubygidXNlcmluYWN0aXZlIikpKSwgdGhpcykgOiB0aGlzLmVjDQogICAgfTsNCiAgICBzLnBsYXliYWNrUmF0ZSA9IGZ1bmN0aW9uIChhKSB7DQogICAgICAgIHJldHVybiBhICE9PSBiID8gKE4odGhpcywgInNldFBsYXliYWNrUmF0ZSIsIGEpLCB0aGlzKSA6IHRoaXMuaCAmJiB0aGlzLmguZmVhdHVyZXNQbGF5YmFja1JhdGUgPyBNKHRoaXMsICJwbGF5YmFja1JhdGUiKSA6IDENCiAgICB9Ow0KICAgIHMuUGMgPSBsOw0KDQogICAgZnVuY3Rpb24gamEoYSwgYykgew0KICAgICAgICByZXR1cm4gYyAhPT0gYiA/IChhLlBjID0gISFjLCBhKSA6IGEuUGMNCiAgICB9DQogICAgcy5uZXR3b3JrU3RhdGUgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHJldHVybiBNKHRoaXMsICJuZXR3b3JrU3RhdGUiKQ0KICAgIH07DQogICAgcy5yZWFkeVN0YXRlID0gZnVuY3Rpb24gKCkgew0KICAgICAgICByZXR1cm4gTSh0aGlzLCAicmVhZHlTdGF0ZSIpDQogICAgfTsNCiAgICBzLnRleHRUcmFja3MgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHJldHVybiB0aGlzLmggJiYgdGhpcy5oLnRleHRUcmFja3MoKQ0KICAgIH07DQogICAgcy5aID0gZnVuY3Rpb24gKCkgew0KICAgICAgICByZXR1cm4gdGhpcy5oICYmIHRoaXMuaC5yZW1vdGVUZXh0VHJhY2tzKCkNCiAgICB9Ow0KICAgIHMuYWRkVGV4dFRyYWNrID0gZnVuY3Rpb24gKGEsIGMsIGQpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuaCAmJiB0aGlzLmguYWRkVGV4dFRyYWNrKGEsIGMsIGQpDQogICAgfTsNCiAgICBzLmlhID0gZnVuY3Rpb24gKGEpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuaCAmJiB0aGlzLmguYWRkUmVtb3RlVGV4dFRyYWNrKGEpDQogICAgfTsNCiAgICBzLkVhID0gZnVuY3Rpb24gKGEpIHsNCiAgICAgICAgdGhpcy5oICYmIHRoaXMuaC5yZW1vdmVSZW1vdGVUZXh0VHJhY2soYSkNCiAgICB9Ow0KICAgIHQud2IgPSB0LmEuZXh0ZW5kKCk7DQogICAgdC53Yi5wcm90b3R5cGUucSA9IHsNCiAgICAgICAgeGY6ICJwbGF5IiwNCiAgICAgICAgY2hpbGRyZW46IHsNCiAgICAgICAgICAgIHBsYXlUb2dnbGU6IHt9LA0KICAgICAgICAgICAgY3VycmVudFRpbWVEaXNwbGF5OiB7fSwNCiAgICAgICAgICAgIHRpbWVEaXZpZGVyOiB7fSwNCiAgICAgICAgICAgIGR1cmF0aW9uRGlzcGxheToge30sDQogICAgICAgICAgICByZW1haW5pbmdUaW1lRGlzcGxheToge30sDQogICAgICAgICAgICBsaXZlRGlzcGxheToge30sDQogICAgICAgICAgICBwcm9ncmVzc0NvbnRyb2w6IHt9LA0KICAgICAgICAgICAgZnVsbHNjcmVlblRvZ2dsZToge30sDQogICAgICAgICAgICB2b2x1bWVDb250cm9sOiB7fSwNCiAgICAgICAgICAgIG11dGVUb2dnbGU6IHt9LA0KICAgICAgICAgICAgcGxheWJhY2tSYXRlTWVudUJ1dHRvbjoge30sDQogICAgICAgICAgICBzdWJ0aXRsZXNCdXR0b246IHt9LA0KICAgICAgICAgICAgY2FwdGlvbnNCdXR0b246IHt9LA0KICAgICAgICAgICAgY2hhcHRlcnNCdXR0b246IHt9DQogICAgICAgIH0NCiAgICB9Ow0KICAgIHQud2IucHJvdG90eXBlLmYgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHJldHVybiB0LmYoImRpdiIsIHsNCiAgICAgICAgICAgIGNsYXNzTmFtZTogInZqcy1jb250cm9sLWJhciINCiAgICAgICAgfSkNCiAgICB9Ow0KICAgIHQubGMgPSB0LmEuZXh0ZW5kKHsNCiAgICAgICAgbDogZnVuY3Rpb24gKGEsIGMpIHsNCiAgICAgICAgICAgIHQuYS5jYWxsKHRoaXMsIGEsIGMpDQogICAgICAgIH0NCiAgICB9KTsNCiAgICB0LmxjLnByb3RvdHlwZS5mID0gZnVuY3Rpb24gKCkgew0KICAgICAgICB2YXIgYSA9IHQuYS5wcm90b3R5cGUuZi5jYWxsKHRoaXMsICJkaXYiLCB7DQogICAgICAgICAgICBjbGFzc05hbWU6ICJ2anMtbGl2ZS1jb250cm9scyB2anMtY29udHJvbCINCiAgICAgICAgfSk7DQogICAgICAgIHRoaXMuQiA9IHQuZigiZGl2Iiwgew0KICAgICAgICAgICAgY2xhc3NOYW1lOiAidmpzLWxpdmUtZGlzcGxheSIsDQogICAgICAgICAgICBpbm5lckhUTUw6ICc8c3BhbiBjbGFzcz0idmpzLWNvbnRyb2wtdGV4dCI+JyArIHRoaXMudigiU3RyZWFtIFR5cGUiKSArICI8L3NwYW4+IiArIHRoaXMudigiTElWRSIpLA0KICAgICAgICAgICAgImFyaWEtbGl2ZSI6ICJvZmYiDQogICAgICAgIH0pOw0KICAgICAgICBhLmFwcGVuZENoaWxkKHRoaXMuQik7DQogICAgICAgIHJldHVybiBhDQogICAgfTsNCiAgICB0Lm9jID0gdC53LmV4dGVuZCh7DQogICAgICAgIGw6IGZ1bmN0aW9uIChhLCBjKSB7DQogICAgICAgICAgICB0LncuY2FsbCh0aGlzLCBhLCBjKTsNCiAgICAgICAgICAgIHRoaXMuYihhLCAicGxheSIsIHRoaXMuYWMpOw0KICAgICAgICAgICAgdGhpcy5iKGEsICJwYXVzZSIsIHRoaXMuJGIpDQogICAgICAgIH0NCiAgICB9KTsNCiAgICBzID0gdC5vYy5wcm90b3R5cGU7DQogICAgcy51YSA9ICJQbGF5IjsNCiAgICBzLlYgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHJldHVybiAidmpzLXBsYXktY29udHJvbCAiICsgdC53LnByb3RvdHlwZS5WLmNhbGwodGhpcykNCiAgICB9Ow0KICAgIHMudSA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgdGhpcy5kLnBhdXNlZCgpID8gdGhpcy5kLnBsYXkoKSA6IHRoaXMuZC5wYXVzZSgpDQogICAgfTsNCiAgICBzLmFjID0gZnVuY3Rpb24gKCkgew0KICAgICAgICB0aGlzLnIoInZqcy1wYXVzZWQiKTsNCiAgICAgICAgdGhpcy5wKCJ2anMtcGxheWluZyIpOw0KICAgICAgICB0aGlzLmMuY2hpbGRyZW5bMF0uY2hpbGRyZW5bMF0uaW5uZXJIVE1MID0gdGhpcy52KCJQYXVzZSIpDQogICAgfTsNCiAgICBzLiRiID0gZnVuY3Rpb24gKCkgew0KICAgICAgICB0aGlzLnIoInZqcy1wbGF5aW5nIik7DQogICAgICAgIHRoaXMucCgidmpzLXBhdXNlZCIpOw0KICAgICAgICB0aGlzLmMuY2hpbGRyZW5bMF0uY2hpbGRyZW5bMF0uaW5uZXJIVE1MID0gdGhpcy52KCJQbGF5IikNCiAgICB9Ow0KICAgIHQueGIgPSB0LmEuZXh0ZW5kKHsNCiAgICAgICAgbDogZnVuY3Rpb24gKGEsIGMpIHsNCiAgICAgICAgICAgIHQuYS5jYWxsKHRoaXMsIGEsIGMpOw0KICAgICAgICAgICAgdGhpcy5iKGEsICJ0aW1ldXBkYXRlIiwgdGhpcy5nYSkNCiAgICAgICAgfQ0KICAgIH0pOw0KICAgIHQueGIucHJvdG90eXBlLmYgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHZhciBhID0gdC5hLnByb3RvdHlwZS5mLmNhbGwodGhpcywgImRpdiIsIHsNCiAgICAgICAgICAgIGNsYXNzTmFtZTogInZqcy1jdXJyZW50LXRpbWUgdmpzLXRpbWUtY29udHJvbHMgdmpzLWNvbnRyb2wiDQogICAgICAgIH0pOw0KICAgICAgICB0aGlzLkIgPSB0LmYoImRpdiIsIHsNCiAgICAgICAgICAgIGNsYXNzTmFtZTogInZqcy1jdXJyZW50LXRpbWUtZGlzcGxheSIsDQogICAgICAgICAgICBpbm5lckhUTUw6ICc8c3BhbiBjbGFzcz0idmpzLWNvbnRyb2wtdGV4dCI+Q3VycmVudCBUaW1lIDwvc3Bhbj4wOjAwJywNCiAgICAgICAgICAgICJhcmlhLWxpdmUiOiAib2ZmIg0KICAgICAgICB9KTsNCiAgICAgICAgYS5hcHBlbmRDaGlsZCh0aGlzLkIpOw0KICAgICAgICByZXR1cm4gYQ0KICAgIH07DQogICAgdC54Yi5wcm90b3R5cGUuZ2EgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHZhciBhID0gdGhpcy5kLnFiID8gdGhpcy5kLksuY3VycmVudFRpbWUgOiB0aGlzLmQuY3VycmVudFRpbWUoKTsNCiAgICAgICAgdGhpcy5CLmlubmVySFRNTCA9ICc8c3BhbiBjbGFzcz0idmpzLWNvbnRyb2wtdGV4dCI+JyArIHRoaXMudigiQ3VycmVudCBUaW1lIikgKyAiPC9zcGFuPiAiICsgdC5PYShhLCB0aGlzLmQuZHVyYXRpb24oKSkNCiAgICB9Ow0KICAgIHQueWIgPSB0LmEuZXh0ZW5kKHsNCiAgICAgICAgbDogZnVuY3Rpb24gKGEsIGMpIHsNCiAgICAgICAgICAgIHQuYS5jYWxsKHRoaXMsIGEsIGMpOw0KICAgICAgICAgICAgdGhpcy5iKGEsICJ0aW1ldXBkYXRlIiwgdGhpcy5nYSk7DQogICAgICAgICAgICB0aGlzLmIoYSwgImxvYWRlZG1ldGFkYXRhIiwgdGhpcy5nYSkNCiAgICAgICAgfQ0KICAgIH0pOw0KICAgIHQueWIucHJvdG90eXBlLmYgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHZhciBhID0gdC5hLnByb3RvdHlwZS5mLmNhbGwodGhpcywgImRpdiIsIHsNCiAgICAgICAgICAgIGNsYXNzTmFtZTogInZqcy1kdXJhdGlvbiB2anMtdGltZS1jb250cm9scyB2anMtY29udHJvbCINCiAgICAgICAgfSk7DQogICAgICAgIHRoaXMuQiA9IHQuZigiZGl2Iiwgew0KICAgICAgICAgICAgY2xhc3NOYW1lOiAidmpzLWR1cmF0aW9uLWRpc3BsYXkiLA0KICAgICAgICAgICAgaW5uZXJIVE1MOiAnPHNwYW4gY2xhc3M9InZqcy1jb250cm9sLXRleHQiPicgKyB0aGlzLnYoIkR1cmF0aW9uIFRpbWUiKSArICI8L3NwYW4+IDA6MDAiLA0KICAgICAgICAgICAgImFyaWEtbGl2ZSI6ICJvZmYiDQogICAgICAgIH0pOw0KICAgICAgICBhLmFwcGVuZENoaWxkKHRoaXMuQik7DQogICAgICAgIHJldHVybiBhDQogICAgfTsNCiAgICB0LnliLnByb3RvdHlwZS5nYSA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgdmFyIGEgPSB0aGlzLmQuZHVyYXRpb24oKTsNCiAgICAgICAgYSAmJiAodGhpcy5CLmlubmVySFRNTCA9ICc8c3BhbiBjbGFzcz0idmpzLWNvbnRyb2wtdGV4dCI+JyArIHRoaXMudigiRHVyYXRpb24gVGltZSIpICsgIjwvc3Bhbj4gIiArIHQuT2EoYSkpDQogICAgfTsNCiAgICB0LnVjID0gdC5hLmV4dGVuZCh7DQogICAgICAgIGw6IGZ1bmN0aW9uIChhLCBjKSB7DQogICAgICAgICAgICB0LmEuY2FsbCh0aGlzLCBhLCBjKQ0KICAgICAgICB9DQogICAgfSk7DQogICAgdC51Yy5wcm90b3R5cGUuZiA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgcmV0dXJuIHQuYS5wcm90b3R5cGUuZi5jYWxsKHRoaXMsICJkaXYiLCB7DQogICAgICAgICAgICBjbGFzc05hbWU6ICJ2anMtdGltZS1kaXZpZGVyIiwNCiAgICAgICAgICAgIGlubmVySFRNTDogIjxkaXY+PHNwYW4+Lzwvc3Bhbj48L2Rpdj4iDQogICAgICAgIH0pDQogICAgfTsNCiAgICB0LkZiID0gdC5hLmV4dGVuZCh7DQogICAgICAgIGw6IGZ1bmN0aW9uIChhLCBjKSB7DQogICAgICAgICAgICB0LmEuY2FsbCh0aGlzLCBhLCBjKTsNCiAgICAgICAgICAgIHRoaXMuYihhLCAidGltZXVwZGF0ZSIsIHRoaXMuZ2EpDQogICAgICAgIH0NCiAgICB9KTsNCiAgICB0LkZiLnByb3RvdHlwZS5mID0gZnVuY3Rpb24gKCkgew0KICAgICAgICB2YXIgYSA9IHQuYS5wcm90b3R5cGUuZi5jYWxsKHRoaXMsICJkaXYiLCB7DQogICAgICAgICAgICBjbGFzc05hbWU6ICJ2anMtcmVtYWluaW5nLXRpbWUgdmpzLXRpbWUtY29udHJvbHMgdmpzLWNvbnRyb2wiDQogICAgICAgIH0pOw0KICAgICAgICB0aGlzLkIgPSB0LmYoImRpdiIsIHsNCiAgICAgICAgICAgIGNsYXNzTmFtZTogInZqcy1yZW1haW5pbmctdGltZS1kaXNwbGF5IiwNCiAgICAgICAgICAgIGlubmVySFRNTDogJzxzcGFuIGNsYXNzPSJ2anMtY29udHJvbC10ZXh0Ij4nICsgdGhpcy52KCJSZW1haW5pbmcgVGltZSIpICsgIjwvc3Bhbj4gLTA6MDAiLA0KICAgICAgICAgICAgImFyaWEtbGl2ZSI6ICJvZmYiDQogICAgICAgIH0pOw0KICAgICAgICBhLmFwcGVuZENoaWxkKHRoaXMuQik7DQogICAgICAgIHJldHVybiBhDQogICAgfTsNCiAgICB0LkZiLnByb3RvdHlwZS5nYSA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgdGhpcy5kLmR1cmF0aW9uKCkgJiYgKHRoaXMuQi5pbm5lckhUTUwgPSAnPHNwYW4gY2xhc3M9InZqcy1jb250cm9sLXRleHQiPicgKyB0aGlzLnYoIlJlbWFpbmluZyBUaW1lIikgKyAiPC9zcGFuPiAtIiArIHQuT2EodGhpcy5kLnJlbWFpbmluZ1RpbWUoKSkpDQogICAgfTsNCiAgICB0LiRhID0gdC53LmV4dGVuZCh7DQogICAgICAgIGw6IGZ1bmN0aW9uIChhLCBjKSB7DQogICAgICAgICAgICB0LncuY2FsbCh0aGlzLCBhLCBjKQ0KICAgICAgICB9DQogICAgfSk7DQogICAgdC4kYS5wcm90b3R5cGUudWEgPSAiRnVsbHNjcmVlbiI7DQogICAgdC4kYS5wcm90b3R5cGUuViA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgcmV0dXJuICJ2anMtZnVsbHNjcmVlbi1jb250cm9sICIgKyB0LncucHJvdG90eXBlLlYuY2FsbCh0aGlzKQ0KICAgIH07DQogICAgdC4kYS5wcm90b3R5cGUudSA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgdGhpcy5kLmlzRnVsbHNjcmVlbigpID8gKHRoaXMuZC5leGl0RnVsbHNjcmVlbigpLCB0aGlzLkxiLmlubmVySFRNTCA9IHRoaXMudigiRnVsbHNjcmVlbiIpKSA6ICh0aGlzLmQucmVxdWVzdEZ1bGxzY3JlZW4oKSwgdGhpcy5MYi5pbm5lckhUTUwgPSB0aGlzLnYoIk5vbi1GdWxsc2NyZWVuIikpDQogICAgfTsNCiAgICB0LkViID0gdC5hLmV4dGVuZCh7DQogICAgICAgIGw6IGZ1bmN0aW9uIChhLCBjKSB7DQogICAgICAgICAgICB0LmEuY2FsbCh0aGlzLCBhLCBjKQ0KICAgICAgICB9DQogICAgfSk7DQogICAgdC5FYi5wcm90b3R5cGUucSA9IHsNCiAgICAgICAgY2hpbGRyZW46IHsNCiAgICAgICAgICAgIHNlZWtCYXI6IHt9DQogICAgICAgIH0NCiAgICB9Ow0KICAgIHQuRWIucHJvdG90eXBlLmYgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHJldHVybiB0LmEucHJvdG90eXBlLmYuY2FsbCh0aGlzLCAiZGl2Iiwgew0KICAgICAgICAgICAgY2xhc3NOYW1lOiAidmpzLXByb2dyZXNzLWNvbnRyb2wgdmpzLWNvbnRyb2wiDQogICAgICAgIH0pDQogICAgfTsNCiAgICB0LnJjID0gdC5VLmV4dGVuZCh7DQogICAgICAgIGw6IGZ1bmN0aW9uIChhLCBjKSB7DQogICAgICAgICAgICB0LlUuY2FsbCh0aGlzLCBhLCBjKTsNCiAgICAgICAgICAgIHRoaXMuYihhLCAidGltZXVwZGF0ZSIsIHRoaXMuRmEpOw0KICAgICAgICAgICAgYS5JKHQuYmluZCh0aGlzLCB0aGlzLkZhKSkNCiAgICAgICAgfQ0KICAgIH0pOw0KICAgIHMgPSB0LnJjLnByb3RvdHlwZTsNCiAgICBzLnEgPSB7DQogICAgICAgIGNoaWxkcmVuOiB7DQogICAgICAgICAgICBsb2FkUHJvZ3Jlc3NCYXI6IHt9LA0KICAgICAgICAgICAgcGxheVByb2dyZXNzQmFyOiB7fSwNCiAgICAgICAgICAgIHNlZWtIYW5kbGU6IHt9DQogICAgICAgIH0sDQogICAgICAgIGJhck5hbWU6ICJwbGF5UHJvZ3Jlc3NCYXIiLA0KICAgICAgICBoYW5kbGVOYW1lOiAic2Vla0hhbmRsZSINCiAgICB9Ow0KICAgIHMuWWMgPSAidGltZXVwZGF0ZSI7DQogICAgcy5mID0gZnVuY3Rpb24gKCkgew0KICAgICAgICByZXR1cm4gdC5VLnByb3RvdHlwZS5mLmNhbGwodGhpcywgImRpdiIsIHsNCiAgICAgICAgICAgIGNsYXNzTmFtZTogInZqcy1wcm9ncmVzcy1ob2xkZXIiLA0KICAgICAgICAgICAgImFyaWEtbGFiZWwiOiAidmlkZW8gcHJvZ3Jlc3MgYmFyIg0KICAgICAgICB9KQ0KICAgIH07DQogICAgcy5GYSA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgdmFyIGEgPSB0aGlzLmQucWIgPyB0aGlzLmQuSy5jdXJyZW50VGltZSA6IHRoaXMuZC5jdXJyZW50VGltZSgpOw0KICAgICAgICB0aGlzLmMuc2V0QXR0cmlidXRlKCJhcmlhLXZhbHVlbm93IiwgdC5yb3VuZCgxMDAgKiB0aGlzLlRiKCksIDIpKTsNCiAgICAgICAgdGhpcy5jLnNldEF0dHJpYnV0ZSgiYXJpYS12YWx1ZXRleHQiLCB0Lk9hKGEsIHRoaXMuZC5kdXJhdGlvbigpKSkNCiAgICB9Ow0KICAgIHMuVGIgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHJldHVybiB0aGlzLmQuY3VycmVudFRpbWUoKSAvIHRoaXMuZC5kdXJhdGlvbigpDQogICAgfTsNCiAgICBzLm9iID0gZnVuY3Rpb24gKGEpIHsNCiAgICAgICAgdC5VLnByb3RvdHlwZS5vYi5jYWxsKHRoaXMsIGEpOw0KICAgICAgICB0aGlzLmQucWIgPSBmOw0KICAgICAgICB0aGlzLmQucCgidmpzLXNjcnViYmluZyIpOw0KICAgICAgICB0aGlzLmVmID0gIXRoaXMuZC5wYXVzZWQoKTsNCiAgICAgICAgdGhpcy5kLnBhdXNlKCkNCiAgICB9Ow0KICAgIHMubWEgPSBmdW5jdGlvbiAoYSkgew0KICAgICAgICBhID0gZWEodGhpcywgYSkgKiB0aGlzLmQuZHVyYXRpb24oKTsNCiAgICAgICAgYSA9PSB0aGlzLmQuZHVyYXRpb24oKSAmJiAoYSAtPSAwLjEpOw0KICAgICAgICB0aGlzLmQuY3VycmVudFRpbWUoYSkNCiAgICB9Ow0KICAgIHMuQ2EgPSBmdW5jdGlvbiAoYSkgew0KICAgICAgICB0LlUucHJvdG90eXBlLkNhLmNhbGwodGhpcywgYSk7DQogICAgICAgIHRoaXMuZC5xYiA9IGw7DQogICAgICAgIHRoaXMuZC5yKCJ2anMtc2NydWJiaW5nIik7DQogICAgICAgIHRoaXMuZWYgJiYgdGhpcy5kLnBsYXkoKQ0KICAgIH07DQogICAgcy5sZCA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgdGhpcy5kLmN1cnJlbnRUaW1lKHRoaXMuZC5jdXJyZW50VGltZSgpICsgNSkNCiAgICB9Ow0KICAgIHMua2QgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHRoaXMuZC5jdXJyZW50VGltZSh0aGlzLmQuY3VycmVudFRpbWUoKSAtIDUpDQogICAgfTsNCiAgICB0LkJiID0gdC5hLmV4dGVuZCh7DQogICAgICAgIGw6IGZ1bmN0aW9uIChhLCBjKSB7DQogICAgICAgICAgICB0LmEuY2FsbCh0aGlzLCBhLCBjKTsNCiAgICAgICAgICAgIHRoaXMuYihhLCAicHJvZ3Jlc3MiLCB0aGlzLnVwZGF0ZSkNCiAgICAgICAgfQ0KICAgIH0pOw0KICAgIHQuQmIucHJvdG90eXBlLmYgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHJldHVybiB0LmEucHJvdG90eXBlLmYuY2FsbCh0aGlzLCAiZGl2Iiwgew0KICAgICAgICAgICAgY2xhc3NOYW1lOiAidmpzLWxvYWQtcHJvZ3Jlc3MiLA0KICAgICAgICAgICAgaW5uZXJIVE1MOiAnPHNwYW4gY2xhc3M9InZqcy1jb250cm9sLXRleHQiPjxzcGFuPicgKyB0aGlzLnYoIkxvYWRlZCIpICsgIjwvc3Bhbj46IDAlPC9zcGFuPiINCiAgICAgICAgfSkNCiAgICB9Ow0KICAgIHQuQmIucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgdmFyIGEsIGMsIGQsIGUsIGcgPSB0aGlzLmQuYnVmZmVyZWQoKTsNCiAgICAgICAgYSA9IHRoaXMuZC5kdXJhdGlvbigpOw0KICAgICAgICB2YXIgaCwgayA9IHRoaXMuZDsNCiAgICAgICAgaCA9IGsuYnVmZmVyZWQoKTsNCiAgICAgICAgayA9IGsuZHVyYXRpb24oKTsNCiAgICAgICAgaCA9IGguZW5kKGgubGVuZ3RoIC0gMSk7DQogICAgICAgIGggPiBrICYmIChoID0gayk7DQogICAgICAgIGsgPSB0aGlzLmMuY2hpbGRyZW47DQogICAgICAgIHRoaXMuYy5zdHlsZS53aWR0aCA9IDEwMCAqIChoIC8gYSB8fCAwKSArICIlIjsNCiAgICAgICAgZm9yIChhID0gMDsgYSA8IGcubGVuZ3RoOyBhKyspIGMgPSBnLnN0YXJ0KGEpLCBkID0gZy5lbmQoYSksIChlID0ga1thXSkgfHwgKGUgPSB0aGlzLmMuYXBwZW5kQ2hpbGQodC5mKCkpKSwgZS5zdHlsZS5sZWZ0ID0gMTAwICogKGMgLyBoIHx8IDApICsgIiUiLCBlLnN0eWxlLndpZHRoID0gMTAwICogKChkIC0gYykgLyBoIHx8IDApICsgIiUiOw0KICAgICAgICBmb3IgKGEgPSBrLmxlbmd0aDsgYSA+IGcubGVuZ3RoOyBhLS0pIHRoaXMuYy5yZW1vdmVDaGlsZChrW2EgLSAxXSkNCiAgICB9Ow0KICAgIHQubmMgPSB0LmEuZXh0ZW5kKHsNCiAgICAgICAgbDogZnVuY3Rpb24gKGEsIGMpIHsNCiAgICAgICAgICAgIHQuYS5jYWxsKHRoaXMsIGEsIGMpDQogICAgICAgIH0NCiAgICB9KTsNCiAgICB0Lm5jLnByb3RvdHlwZS5mID0gZnVuY3Rpb24gKCkgew0KICAgICAgICByZXR1cm4gdC5hLnByb3RvdHlwZS5mLmNhbGwodGhpcywgImRpdiIsIHsNCiAgICAgICAgICAgIGNsYXNzTmFtZTogInZqcy1wbGF5LXByb2dyZXNzIiwNCiAgICAgICAgICAgIGlubmVySFRNTDogJzxzcGFuIGNsYXNzPSJ2anMtY29udHJvbC10ZXh0Ij48c3Bhbj4nICsgdGhpcy52KCJQcm9ncmVzcyIpICsgIjwvc3Bhbj46IDAlPC9zcGFuPiINCiAgICAgICAgfSkNCiAgICB9Ow0KICAgIHQuYWIgPSB0LmhhLmV4dGVuZCh7DQogICAgICAgIGw6IGZ1bmN0aW9uIChhLCBjKSB7DQogICAgICAgICAgICB0LmhhLmNhbGwodGhpcywgYSwgYyk7DQogICAgICAgICAgICB0aGlzLmIoYSwgInRpbWV1cGRhdGUiLCB0aGlzLmdhKQ0KICAgICAgICB9DQogICAgfSk7DQogICAgdC5hYi5wcm90b3R5cGUuZGVmYXVsdFZhbHVlID0gIjAwOjAwIjsNCiAgICB0LmFiLnByb3RvdHlwZS5mID0gZnVuY3Rpb24gKCkgew0KICAgICAgICByZXR1cm4gdC5oYS5wcm90b3R5cGUuZi5jYWxsKHRoaXMsICJkaXYiLCB7DQogICAgICAgICAgICBjbGFzc05hbWU6ICJ2anMtc2Vlay1oYW5kbGUiLA0KICAgICAgICAgICAgImFyaWEtbGl2ZSI6ICJvZmYiDQogICAgICAgIH0pDQogICAgfTsNCiAgICB0LmFiLnByb3RvdHlwZS5nYSA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgdmFyIGEgPSB0aGlzLmQucWIgPyB0aGlzLmQuSy5jdXJyZW50VGltZSA6IHRoaXMuZC5jdXJyZW50VGltZSgpOw0KICAgICAgICB0aGlzLmMuaW5uZXJIVE1MID0gJzxzcGFuIGNsYXNzPSJ2anMtY29udHJvbC10ZXh0Ij4nICsgdC5PYShhLCB0aGlzLmQuZHVyYXRpb24oKSkgKyAiPC9zcGFuPiINCiAgICB9Ow0KICAgIHQuSWIgPSB0LmEuZXh0ZW5kKHsNCiAgICAgICAgbDogZnVuY3Rpb24gKGEsIGMpIHsNCiAgICAgICAgICAgIHQuYS5jYWxsKHRoaXMsIGEsIGMpOw0KICAgICAgICAgICAgYS5oICYmIGEuaC5mZWF0dXJlc1ZvbHVtZUNvbnRyb2wgPT09IGwgJiYgdGhpcy5wKCJ2anMtaGlkZGVuIik7DQogICAgICAgICAgICB0aGlzLmIoYSwgImxvYWRzdGFydCIsIGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICBhLmguZmVhdHVyZXNWb2x1bWVDb250cm9sID09PSBsID8gdGhpcy5wKCJ2anMtaGlkZGVuIikgOiB0aGlzLnIoInZqcy1oaWRkZW4iKQ0KICAgICAgICAgICAgfSkNCiAgICAgICAgfQ0KICAgIH0pOw0KICAgIHQuSWIucHJvdG90eXBlLnEgPSB7DQogICAgICAgIGNoaWxkcmVuOiB7DQogICAgICAgICAgICB2b2x1bWVCYXI6IHt9DQogICAgICAgIH0NCiAgICB9Ow0KICAgIHQuSWIucHJvdG90eXBlLmYgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHJldHVybiB0LmEucHJvdG90eXBlLmYuY2FsbCh0aGlzLCAiZGl2Iiwgew0KICAgICAgICAgICAgY2xhc3NOYW1lOiAidmpzLXZvbHVtZS1jb250cm9sIHZqcy1jb250cm9sIg0KICAgICAgICB9KQ0KICAgIH07DQogICAgdC5IYiA9IHQuVS5leHRlbmQoew0KICAgICAgICBsOiBmdW5jdGlvbiAoYSwgYykgew0KICAgICAgICAgICAgdC5VLmNhbGwodGhpcywgYSwgYyk7DQogICAgICAgICAgICB0aGlzLmIoYSwgInZvbHVtZWNoYW5nZSIsIHRoaXMuRmEpOw0KICAgICAgICAgICAgYS5JKHQuYmluZCh0aGlzLCB0aGlzLkZhKSkNCiAgICAgICAgfQ0KICAgIH0pOw0KICAgIHMgPSB0LkhiLnByb3RvdHlwZTsNCiAgICBzLkZhID0gZnVuY3Rpb24gKCkgew0KICAgICAgICB0aGlzLmMuc2V0QXR0cmlidXRlKCJhcmlhLXZhbHVlbm93IiwgdC5yb3VuZCgxMDAgKiB0aGlzLmQudm9sdW1lKCksIDIpKTsNCiAgICAgICAgdGhpcy5jLnNldEF0dHJpYnV0ZSgiYXJpYS12YWx1ZXRleHQiLCB0LnJvdW5kKDEwMCAqIHRoaXMuZC52b2x1bWUoKSwgMikgKyAiJSIpDQogICAgfTsNCiAgICBzLnEgPSB7DQogICAgICAgIGNoaWxkcmVuOiB7DQogICAgICAgICAgICB2b2x1bWVMZXZlbDoge30sDQogICAgICAgICAgICB2b2x1bWVIYW5kbGU6IHt9DQogICAgICAgIH0sDQogICAgICAgIGJhck5hbWU6ICJ2b2x1bWVMZXZlbCIsDQogICAgICAgIGhhbmRsZU5hbWU6ICJ2b2x1bWVIYW5kbGUiDQogICAgfTsNCiAgICBzLlljID0gInZvbHVtZWNoYW5nZSI7DQogICAgcy5mID0gZnVuY3Rpb24gKCkgew0KICAgICAgICByZXR1cm4gdC5VLnByb3RvdHlwZS5mLmNhbGwodGhpcywgImRpdiIsIHsNCiAgICAgICAgICAgIGNsYXNzTmFtZTogInZqcy12b2x1bWUtYmFyIiwNCiAgICAgICAgICAgICJhcmlhLWxhYmVsIjogInZvbHVtZSBsZXZlbCINCiAgICAgICAgfSkNCiAgICB9Ow0KICAgIHMubWEgPSBmdW5jdGlvbiAoYSkgew0KICAgICAgICB0aGlzLmQubXV0ZWQoKSAmJiB0aGlzLmQubXV0ZWQobCk7DQogICAgICAgIHRoaXMuZC52b2x1bWUoZWEodGhpcywgYSkpDQogICAgfTsNCiAgICBzLlRiID0gZnVuY3Rpb24gKCkgew0KICAgICAgICByZXR1cm4gdGhpcy5kLm11dGVkKCkgPyAwIDogdGhpcy5kLnZvbHVtZSgpDQogICAgfTsNCiAgICBzLmxkID0gZnVuY3Rpb24gKCkgew0KICAgICAgICB0aGlzLmQudm9sdW1lKHRoaXMuZC52b2x1bWUoKSArIDAuMSkNCiAgICB9Ow0KICAgIHMua2QgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHRoaXMuZC52b2x1bWUodGhpcy5kLnZvbHVtZSgpIC0gMC4xKQ0KICAgIH07DQogICAgdC52YyA9IHQuYS5leHRlbmQoew0KICAgICAgICBsOiBmdW5jdGlvbiAoYSwgYykgew0KICAgICAgICAgICAgdC5hLmNhbGwodGhpcywgYSwgYykNCiAgICAgICAgfQ0KICAgIH0pOw0KICAgIHQudmMucHJvdG90eXBlLmYgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHJldHVybiB0LmEucHJvdG90eXBlLmYuY2FsbCh0aGlzLCAiZGl2Iiwgew0KICAgICAgICAgICAgY2xhc3NOYW1lOiAidmpzLXZvbHVtZS1sZXZlbCIsDQogICAgICAgICAgICBpbm5lckhUTUw6ICc8c3BhbiBjbGFzcz0idmpzLWNvbnRyb2wtdGV4dCI+PC9zcGFuPicNCiAgICAgICAgfSkNCiAgICB9Ow0KICAgIHQuSmIgPSB0LmhhLmV4dGVuZCgpOw0KICAgIHQuSmIucHJvdG90eXBlLmRlZmF1bHRWYWx1ZSA9ICIwMDowMCI7DQogICAgdC5KYi5wcm90b3R5cGUuZiA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgcmV0dXJuIHQuaGEucHJvdG90eXBlLmYuY2FsbCh0aGlzLCAiZGl2Iiwgew0KICAgICAgICAgICAgY2xhc3NOYW1lOiAidmpzLXZvbHVtZS1oYW5kbGUiDQogICAgICAgIH0pDQogICAgfTsNCiAgICB0LnNhID0gdC53LmV4dGVuZCh7DQogICAgICAgIGw6IGZ1bmN0aW9uIChhLCBjKSB7DQogICAgICAgICAgICB0LncuY2FsbCh0aGlzLCBhLCBjKTsNCiAgICAgICAgICAgIHRoaXMuYihhLCAidm9sdW1lY2hhbmdlIiwgdGhpcy51cGRhdGUpOw0KICAgICAgICAgICAgYS5oICYmIGEuaC5mZWF0dXJlc1ZvbHVtZUNvbnRyb2wgPT09IGwgJiYgdGhpcy5wKCJ2anMtaGlkZGVuIik7DQogICAgICAgICAgICB0aGlzLmIoYSwgImxvYWRzdGFydCIsIGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICBhLmguZmVhdHVyZXNWb2x1bWVDb250cm9sID09PSBsID8gdGhpcy5wKCJ2anMtaGlkZGVuIikgOiB0aGlzLnIoInZqcy1oaWRkZW4iKQ0KICAgICAgICAgICAgfSkNCiAgICAgICAgfQ0KICAgIH0pOw0KICAgIHQuc2EucHJvdG90eXBlLmYgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHJldHVybiB0LncucHJvdG90eXBlLmYuY2FsbCh0aGlzLCAiZGl2Iiwgew0KICAgICAgICAgICAgY2xhc3NOYW1lOiAidmpzLW11dGUtY29udHJvbCB2anMtY29udHJvbCIsDQogICAgICAgICAgICBpbm5lckhUTUw6ICc8ZGl2PjxzcGFuIGNsYXNzPSJ2anMtY29udHJvbC10ZXh0Ij4nICsgdGhpcy52KCJNdXRlIikgKyAiPC9zcGFuPjwvZGl2PiINCiAgICAgICAgfSkNCiAgICB9Ow0KICAgIHQuc2EucHJvdG90eXBlLnUgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHRoaXMuZC5tdXRlZCh0aGlzLmQubXV0ZWQoKSA/IGwgOiBmKQ0KICAgIH07DQogICAgdC5zYS5wcm90b3R5cGUudXBkYXRlID0gZnVuY3Rpb24gKCkgew0KICAgICAgICB2YXIgYSA9IHRoaXMuZC52b2x1bWUoKSwNCiAgICAgICAgICAgIGMgPSAzOw0KICAgICAgICAwID09PSBhIHx8IHRoaXMuZC5tdXRlZCgpID8gYyA9IDAgOiAwLjMzID4gYSA/IGMgPSAxIDogMC42NyA+IGEgJiYgKGMgPSAyKTsNCiAgICAgICAgdGhpcy5kLm11dGVkKCkgPyB0aGlzLmMuY2hpbGRyZW5bMF0uY2hpbGRyZW5bMF0uaW5uZXJIVE1MICE9IHRoaXMudigiVW5tdXRlIikgJiYgKHRoaXMuYy5jaGlsZHJlblswXS5jaGlsZHJlblswXS5pbm5lckhUTUwgPSB0aGlzLnYoIlVubXV0ZSIpKSA6IHRoaXMuYy5jaGlsZHJlblswXS5jaGlsZHJlblswXS5pbm5lckhUTUwgIT0gdGhpcy52KCJNdXRlIikgJiYgKHRoaXMuYy5jaGlsZHJlblswXS5jaGlsZHJlblswXS5pbm5lckhUTUwgPSB0aGlzLnYoIk11dGUiKSk7DQogICAgICAgIGZvciAoYSA9IDA7IDQgPiBhOyBhKyspIHQucih0aGlzLmMsICJ2anMtdm9sLSIgKyBhKTsNCiAgICAgICAgdC5wKHRoaXMuYywgInZqcy12b2wtIiArIGMpDQogICAgfTsNCiAgICB0LklhID0gdC5PLmV4dGVuZCh7DQogICAgICAgIGw6IGZ1bmN0aW9uIChhLCBjKSB7DQogICAgICAgICAgICB0Lk8uY2FsbCh0aGlzLCBhLCBjKTsNCiAgICAgICAgICAgIHRoaXMuYihhLCAidm9sdW1lY2hhbmdlIiwgdGhpcy5mZik7DQogICAgICAgICAgICBhLmggJiYgYS5oLmZlYXR1cmVzVm9sdW1lQ29udHJvbCA9PT0gbCAmJiB0aGlzLnAoInZqcy1oaWRkZW4iKTsNCiAgICAgICAgICAgIHRoaXMuYihhLCAibG9hZHN0YXJ0IiwgZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgIGEuaC5mZWF0dXJlc1ZvbHVtZUNvbnRyb2wgPT09IGwgPyB0aGlzLnAoInZqcy1oaWRkZW4iKSA6IHRoaXMucigidmpzLWhpZGRlbiIpDQogICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIHRoaXMucCgidmpzLW1lbnUtYnV0dG9uIikNCiAgICAgICAgfQ0KICAgIH0pOw0KICAgIHQuSWEucHJvdG90eXBlLk1hID0gZnVuY3Rpb24gKCkgew0KICAgICAgICB2YXIgYSA9IG5ldyB0LnJhKHRoaXMuZCwgew0KICAgICAgICAgICAgRGM6ICJkaXYiDQogICAgICAgIH0pLA0KICAgICAgICAgICAgYyA9IG5ldyB0LkhiKHRoaXMuZCwgdGhpcy5xLnZvbHVtZUJhcik7DQogICAgICAgIGMuYigiZm9jdXMiLCBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICBhLnAoInZqcy1sb2NrLXNob3dpbmciKQ0KICAgICAgICB9KTsNCiAgICAgICAgYy5iKCJibHVyIiwgZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgRyhhKQ0KICAgICAgICB9KTsNCiAgICAgICAgYS5iYShjKTsNCiAgICAgICAgcmV0dXJuIGENCiAgICB9Ow0KICAgIHQuSWEucHJvdG90eXBlLnUgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHQuc2EucHJvdG90eXBlLnUuY2FsbCh0aGlzKTsNCiAgICAgICAgdC5PLnByb3RvdHlwZS51LmNhbGwodGhpcykNCiAgICB9Ow0KICAgIHQuSWEucHJvdG90eXBlLmYgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHJldHVybiB0LncucHJvdG90eXBlLmYuY2FsbCh0aGlzLCAiZGl2Iiwgew0KICAgICAgICAgICAgY2xhc3NOYW1lOiAidmpzLXZvbHVtZS1tZW51LWJ1dHRvbiB2anMtbWVudS1idXR0b24gdmpzLWNvbnRyb2wiLA0KICAgICAgICAgICAgaW5uZXJIVE1MOiAnPGRpdj48c3BhbiBjbGFzcz0idmpzLWNvbnRyb2wtdGV4dCI+JyArIHRoaXMudigiTXV0ZSIpICsgIjwvc3Bhbj48L2Rpdj4iDQogICAgICAgIH0pDQogICAgfTsNCiAgICB0LklhLnByb3RvdHlwZS5mZiA9IHQuc2EucHJvdG90eXBlLnVwZGF0ZTsNCiAgICB0LnBjID0gdC5PLmV4dGVuZCh7DQogICAgICAgIGw6IGZ1bmN0aW9uIChhLCBjKSB7DQogICAgICAgICAgICB0Lk8uY2FsbCh0aGlzLCBhLCBjKTsNCiAgICAgICAgICAgIHRoaXMudGQoKTsNCiAgICAgICAgICAgIHRoaXMuc2QoKTsNCiAgICAgICAgICAgIHRoaXMuYihhLCAibG9hZHN0YXJ0IiwgdGhpcy50ZCk7DQogICAgICAgICAgICB0aGlzLmIoYSwgInJhdGVjaGFuZ2UiLCB0aGlzLnNkKQ0KICAgICAgICB9DQogICAgfSk7DQogICAgcyA9IHQucGMucHJvdG90eXBlOw0KICAgIHMudWEgPSAiUGxheWJhY2sgUmF0ZSI7DQogICAgcy5jbGFzc05hbWUgPSAidmpzLXBsYXliYWNrLXJhdGUiOw0KICAgIHMuZiA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgdmFyIGEgPSB0Lk8ucHJvdG90eXBlLmYuY2FsbCh0aGlzKTsNCiAgICAgICAgdGhpcy5TYyA9IHQuZigiZGl2Iiwgew0KICAgICAgICAgICAgY2xhc3NOYW1lOiAidmpzLXBsYXliYWNrLXJhdGUtdmFsdWUiLA0KICAgICAgICAgICAgaW5uZXJIVE1MOiAxDQogICAgICAgIH0pOw0KICAgICAgICBhLmFwcGVuZENoaWxkKHRoaXMuU2MpOw0KICAgICAgICByZXR1cm4gYQ0KICAgIH07DQogICAgcy5NYSA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgdmFyIGEgPSBuZXcgdC5yYSh0aGlzLmsoKSksDQogICAgICAgICAgICBjID0gdGhpcy5rKCkub3B0aW9ucygpLnBsYXliYWNrUmF0ZXM7DQogICAgICAgIGlmIChjKQ0KICAgICAgICAgICAgZm9yICh2YXIgZCA9IGMubGVuZ3RoIC0gMTsgMCA8PSBkOyBkLS0pIGEuYmEobmV3IHQuRGIodGhpcy5rKCksIHsNCiAgICAgICAgICAgICAgICByYXRlOiBjW2RdICsgIngiDQogICAgICAgICAgICB9KSk7DQogICAgICAgIHJldHVybiBhDQogICAgfTsNCiAgICBzLkZhID0gZnVuY3Rpb24gKCkgew0KICAgICAgICB0aGlzLm0oKS5zZXRBdHRyaWJ1dGUoImFyaWEtdmFsdWVub3ciLCB0aGlzLmsoKS5wbGF5YmFja1JhdGUoKSkNCiAgICB9Ow0KICAgIHMudSA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgZm9yICh2YXIgYSA9IHRoaXMuaygpLnBsYXliYWNrUmF0ZSgpLCBjID0gdGhpcy5rKCkub3B0aW9ucygpLnBsYXliYWNrUmF0ZXMsIGQgPSBjWzBdLCBlID0gMDsgZSA8IGMubGVuZ3RoOyBlKyspDQogICAgICAgICAgICBpZiAoY1tlXSA+IGEpIHsNCiAgICAgICAgICAgICAgICBkID0gY1tlXTsNCiAgICAgICAgICAgICAgICBicmVhaw0KICAgICAgICAgICAgfQ0KICAgICAgICB0aGlzLmsoKS5wbGF5YmFja1JhdGUoZCkNCiAgICB9Ow0KDQogICAgZnVuY3Rpb24gbmEoYSkgew0KICAgICAgICByZXR1cm4gYS5rKCkuaCAmJiBhLmsoKS5oLmZlYXR1cmVzUGxheWJhY2tSYXRlICYmIGEuaygpLm9wdGlvbnMoKS5wbGF5YmFja1JhdGVzICYmIDAgPCBhLmsoKS5vcHRpb25zKCkucGxheWJhY2tSYXRlcy5sZW5ndGgNCiAgICB9DQogICAgcy50ZCA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgbmEodGhpcykgPyB0aGlzLnIoInZqcy1oaWRkZW4iKSA6IHRoaXMucCgidmpzLWhpZGRlbiIpDQogICAgfTsNCiAgICBzLnNkID0gZnVuY3Rpb24gKCkgew0KICAgICAgICBuYSh0aGlzKSAmJiAodGhpcy5TYy5pbm5lckhUTUwgPSB0aGlzLmsoKS5wbGF5YmFja1JhdGUoKSArICJ4IikNCiAgICB9Ow0KICAgIHQuRGIgPSB0Lk0uZXh0ZW5kKHsNCiAgICAgICAgRGM6ICJidXR0b24iLA0KICAgICAgICBsOiBmdW5jdGlvbiAoYSwgYykgew0KICAgICAgICAgICAgdmFyIGQgPSB0aGlzLmxhYmVsID0gYy5yYXRlLA0KICAgICAgICAgICAgICAgIGUgPSB0aGlzLiRjID0gcGFyc2VGbG9hdChkLCAxMCk7DQogICAgICAgICAgICBjLmxhYmVsID0gZDsNCiAgICAgICAgICAgIGMuc2VsZWN0ZWQgPSAxID09PSBlOw0KICAgICAgICAgICAgdC5NLmNhbGwodGhpcywgYSwgYyk7DQogICAgICAgICAgICB0aGlzLmIoYSwgInJhdGVjaGFuZ2UiLCB0aGlzLnVwZGF0ZSkNCiAgICAgICAgfQ0KICAgIH0pOw0KICAgIHQuRGIucHJvdG90eXBlLnUgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHQuTS5wcm90b3R5cGUudS5jYWxsKHRoaXMpOw0KICAgICAgICB0aGlzLmsoKS5wbGF5YmFja1JhdGUodGhpcy4kYykNCiAgICB9Ow0KICAgIHQuRGIucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgdGhpcy5zZWxlY3RlZCh0aGlzLmsoKS5wbGF5YmFja1JhdGUoKSA9PSB0aGlzLiRjKQ0KICAgIH07DQogICAgdC5xYyA9IHQudy5leHRlbmQoew0KICAgICAgICBsOiBmdW5jdGlvbiAoYSwgYykgew0KICAgICAgICAgICAgdC53LmNhbGwodGhpcywgYSwgYyk7DQogICAgICAgICAgICB0aGlzLnVwZGF0ZSgpOw0KICAgICAgICAgICAgYS5iKCJwb3N0ZXJjaGFuZ2UiLCB0LmJpbmQodGhpcywgdGhpcy51cGRhdGUpKQ0KICAgICAgICB9DQogICAgfSk7DQogICAgcyA9IHQucWMucHJvdG90eXBlOw0KICAgIHMuZGlzcG9zZSA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgdGhpcy5rKCkubigicG9zdGVyY2hhbmdlIiwgdGhpcy51cGRhdGUpOw0KICAgICAgICB0LncucHJvdG90eXBlLmRpc3Bvc2UuY2FsbCh0aGlzKQ0KICAgIH07DQogICAgcy5mID0gZnVuY3Rpb24gKCkgew0KICAgICAgICB2YXIgYSA9IHQuZigiZGl2Iiwgew0KICAgICAgICAgICAgY2xhc3NOYW1lOiAidmpzLXBvc3RlciIsDQogICAgICAgICAgICB0YWJJbmRleDogLTENCiAgICAgICAgfSk7DQogICAgICAgIHQueGQgfHwgKHRoaXMuUGIgPSB0LmYoImltZyIpLCBhLmFwcGVuZENoaWxkKHRoaXMuUGIpKTsNCiAgICAgICAgcmV0dXJuIGENCiAgICB9Ow0KICAgIHMudXBkYXRlID0gZnVuY3Rpb24gKCkgew0KICAgICAgICB2YXIgYSA9IHRoaXMuaygpLnBvc3RlcigpOw0KICAgICAgICB0aGlzLm9hKGEpOw0KICAgICAgICBhID8gdGhpcy5zaG93KCkgOiB0aGlzLlkoKQ0KICAgIH07DQogICAgcy5vYSA9IGZ1bmN0aW9uIChhKSB7DQogICAgICAgIHZhciBjOw0KICAgICAgICB0aGlzLlBiID8gdGhpcy5QYi5zcmMgPSBhIDogKGMgPSAiIiwgYSAmJiAoYyA9ICd1cmwoIicgKyBhICsgJyIpJyksIHRoaXMuYy5zdHlsZS5iYWNrZ3JvdW5kSW1hZ2UgPSBjKQ0KICAgIH07DQogICAgcy51ID0gZnVuY3Rpb24gKCkgew0KICAgICAgICB0aGlzLmQucGxheSgpDQogICAgfTsNCiAgICB0Lm1jID0gdC5hLmV4dGVuZCh7DQogICAgICAgIGw6IGZ1bmN0aW9uIChhLCBjKSB7DQogICAgICAgICAgICB0LmEuY2FsbCh0aGlzLCBhLCBjKQ0KICAgICAgICB9DQogICAgfSk7DQogICAgdC5tYy5wcm90b3R5cGUuZiA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgcmV0dXJuIHQuYS5wcm90b3R5cGUuZi5jYWxsKHRoaXMsICJkaXYiLCB7DQogICAgICAgICAgICBjbGFzc05hbWU6ICJ2anMtbG9hZGluZy1zcGlubmVyIg0KICAgICAgICB9KQ0KICAgIH07DQogICAgdC51YiA9IHQudy5leHRlbmQoKTsNCiAgICB0LnViLnByb3RvdHlwZS5mID0gZnVuY3Rpb24gKCkgew0KICAgICAgICByZXR1cm4gdC53LnByb3RvdHlwZS5mLmNhbGwodGhpcywgImRpdiIsIHsNCiAgICAgICAgICAgIGNsYXNzTmFtZTogInZqcy1iaWctcGxheS1idXR0b24iLA0KICAgICAgICAgICAgaW5uZXJIVE1MOiAnPHNwYW4gYXJpYS1oaWRkZW49InRydWUiPjwvc3Bhbj4nLA0KICAgICAgICAgICAgImFyaWEtbGFiZWwiOiAicGxheSB2aWRlbyINCiAgICAgICAgfSkNCiAgICB9Ow0KICAgIHQudWIucHJvdG90eXBlLnUgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHRoaXMuZC5wbGF5KCkNCiAgICB9Ow0KICAgIHQuemIgPSB0LmEuZXh0ZW5kKHsNCiAgICAgICAgbDogZnVuY3Rpb24gKGEsIGMpIHsNCiAgICAgICAgICAgIHQuYS5jYWxsKHRoaXMsIGEsIGMpOw0KICAgICAgICAgICAgdGhpcy51cGRhdGUoKTsNCiAgICAgICAgICAgIHRoaXMuYihhLCAiZXJyb3IiLCB0aGlzLnVwZGF0ZSkNCiAgICAgICAgfQ0KICAgIH0pOw0KICAgIHQuemIucHJvdG90eXBlLmYgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHZhciBhID0gdC5hLnByb3RvdHlwZS5mLmNhbGwodGhpcywgImRpdiIsIHsNCiAgICAgICAgICAgIGNsYXNzTmFtZTogInZqcy1lcnJvci1kaXNwbGF5Ig0KICAgICAgICB9KTsNCiAgICAgICAgdGhpcy5CID0gdC5mKCJkaXYiKTsNCiAgICAgICAgYS5hcHBlbmRDaGlsZCh0aGlzLkIpOw0KICAgICAgICByZXR1cm4gYQ0KICAgIH07DQogICAgdC56Yi5wcm90b3R5cGUudXBkYXRlID0gZnVuY3Rpb24gKCkgew0KICAgICAgICB0aGlzLmsoKS5lcnJvcigpICYmICh0aGlzLkIuaW5uZXJIVE1MID0gdGhpcy52KHRoaXMuaygpLmVycm9yKCkubWVzc2FnZSkpDQogICAgfTsNCiAgICB2YXIgTzsNCiAgICB0LmogPSB0LmEuZXh0ZW5kKHsNCiAgICAgICAgbDogZnVuY3Rpb24gKGEsIGMsIGQpIHsNCiAgICAgICAgICAgIGMgPSBjIHx8IHt9Ow0KICAgICAgICAgICAgYy5kZCA9IGw7DQogICAgICAgICAgICB0LmEuY2FsbCh0aGlzLCBhLCBjLCBkKTsNCiAgICAgICAgICAgIHRoaXMuZmVhdHVyZXNQcm9ncmVzc0V2ZW50cyB8fCB0aGlzLnNlKCk7DQogICAgICAgICAgICB0aGlzLmZlYXR1cmVzVGltZXVwZGF0ZUV2ZW50cyB8fCB0aGlzLnRlKCk7DQogICAgICAgICAgICB0aGlzLmdlKCk7DQogICAgICAgICAgICB0aGlzLmZlYXR1cmVzTmF0aXZlVGV4dFRyYWNrcyB8fCB0aGlzLldkKCk7DQogICAgICAgICAgICB0aGlzLmllKCkNCiAgICAgICAgfQ0KICAgIH0pOw0KICAgIHMgPSB0LmoucHJvdG90eXBlOw0KICAgIHMuZ2UgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHZhciBhLCBjOw0KICAgICAgICBhID0gdGhpcy5rKCk7DQogICAgICAgIGMgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICBhLmNvbnRyb2xzKCkgJiYgIWEudXNpbmdOYXRpdmVDb250cm9scygpICYmIHRoaXMuSmQoKQ0KICAgICAgICB9Ow0KICAgICAgICB0aGlzLkkoYyk7DQogICAgICAgIHRoaXMuYihhLCAiY29udHJvbHNlbmFibGVkIiwgYyk7DQogICAgICAgIHRoaXMuYihhLCAiY29udHJvbHNkaXNhYmxlZCIsIHRoaXMuSWUpOw0KICAgICAgICB0aGlzLkkoZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgdGhpcy5uZXR3b3JrU3RhdGUgJiYgMCA8IHRoaXMubmV0d29ya1N0YXRlKCkgJiYgdGhpcy5rKCkubygibG9hZHN0YXJ0IikNCiAgICAgICAgfSkNCiAgICB9Ow0KICAgIHMuSmQgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHZhciBhOw0KICAgICAgICB0aGlzLmIoIm1vdXNlZG93biIsIHRoaXMudSk7DQogICAgICAgIHRoaXMuYigidG91Y2hzdGFydCIsIGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIGEgPSB0aGlzLmQudXNlckFjdGl2ZSgpDQogICAgICAgIH0pOw0KICAgICAgICB0aGlzLmIoInRvdWNobW92ZSIsIGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIGEgJiYgdGhpcy5rKCkucmVwb3J0VXNlckFjdGl2aXR5KCkNCiAgICAgICAgfSk7DQogICAgICAgIHRoaXMuYigidG91Y2hlbmQiLCBmdW5jdGlvbiAoYSkgew0KICAgICAgICAgICAgYS5wcmV2ZW50RGVmYXVsdCgpDQogICAgICAgIH0pOw0KICAgICAgICBkYSh0aGlzKTsNCiAgICAgICAgdGhpcy5iKCJ0YXAiLCB0aGlzLkNlKQ0KICAgIH07DQogICAgcy5JZSA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgdGhpcy5uKCJ0YXAiKTsNCiAgICAgICAgdGhpcy5uKCJ0b3VjaHN0YXJ0Iik7DQogICAgICAgIHRoaXMubigidG91Y2htb3ZlIik7DQogICAgICAgIHRoaXMubigidG91Y2hsZWF2ZSIpOw0KICAgICAgICB0aGlzLm4oInRvdWNoY2FuY2VsIik7DQogICAgICAgIHRoaXMubigidG91Y2hlbmQiKTsNCiAgICAgICAgdGhpcy5uKCJjbGljayIpOw0KICAgICAgICB0aGlzLm4oIm1vdXNlZG93biIpDQogICAgfTsNCiAgICBzLnUgPSBmdW5jdGlvbiAoYSkgew0KICAgICAgICAwID09PSBhLmJ1dHRvbiAmJiB0aGlzLmsoKS5jb250cm9scygpICYmICh0aGlzLmsoKS5wYXVzZWQoKSA/IHRoaXMuaygpLnBsYXkoKSA6IHRoaXMuaygpLnBhdXNlKCkpDQogICAgfTsNCiAgICBzLkNlID0gZnVuY3Rpb24gKCkgew0KICAgICAgICB0aGlzLmsoKS51c2VyQWN0aXZlKCF0aGlzLmsoKS51c2VyQWN0aXZlKCkpDQogICAgfTsNCiAgICBzLnNlID0gZnVuY3Rpb24gKCkgew0KICAgICAgICB0aGlzLlVjID0gZjsNCiAgICAgICAgdGhpcy5hZigpDQogICAgfTsNCiAgICBzLnJlID0gZnVuY3Rpb24gKCkgew0KICAgICAgICB0aGlzLlVjID0gbDsNCiAgICAgICAgdGhpcy5tZCgpDQogICAgfTsNCiAgICBzLmFmID0gZnVuY3Rpb24gKCkgew0KICAgICAgICB0aGlzLkhlID0gdGhpcy5zZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICB2YXIgYSA9IHRoaXMuaygpLmJ1ZmZlcmVkUGVyY2VudCgpOw0KICAgICAgICAgICAgdGhpcy5OZCAhPSBhICYmIHRoaXMuaygpLm8oInByb2dyZXNzIik7DQogICAgICAgICAgICB0aGlzLk5kID0gYTsNCiAgICAgICAgICAgIDEgPT09IGEgJiYgdGhpcy5tZCgpDQogICAgICAgIH0sIDUwMCkNCiAgICB9Ow0KICAgIHMubWQgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHRoaXMuY2xlYXJJbnRlcnZhbCh0aGlzLkhlKQ0KICAgIH07DQogICAgcy50ZSA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgdmFyIGEgPSB0aGlzLmQ7DQogICAgICAgIHRoaXMuWmIgPSBmOw0KICAgICAgICB0aGlzLmIoYSwgInBsYXkiLCB0aGlzLnFkKTsNCiAgICAgICAgdGhpcy5iKGEsICJwYXVzZSIsIHRoaXMudGIpOw0KICAgICAgICB0aGlzLk4oInRpbWV1cGRhdGUiLCBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICB0aGlzLmZlYXR1cmVzVGltZXVwZGF0ZUV2ZW50cyA9IGY7DQogICAgICAgICAgICB0aGlzLlZjKCkNCiAgICAgICAgfSkNCiAgICB9Ow0KICAgIHMuVmMgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHZhciBhID0gdGhpcy5kOw0KICAgICAgICB0aGlzLlpiID0gbDsNCiAgICAgICAgdGhpcy50YigpOw0KICAgICAgICB0aGlzLm4oYSwgInBsYXkiLCB0aGlzLnFkKTsNCiAgICAgICAgdGhpcy5uKGEsICJwYXVzZSIsIHRoaXMudGIpDQogICAgfTsNCiAgICBzLnFkID0gZnVuY3Rpb24gKCkgew0KICAgICAgICB0aGlzLkZjICYmIHRoaXMudGIoKTsNCiAgICAgICAgdGhpcy5GYyA9IHRoaXMuc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgdGhpcy5rKCkubygidGltZXVwZGF0ZSIpDQogICAgICAgIH0sIDI1MCkNCiAgICB9Ow0KICAgIHMudGIgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHRoaXMuY2xlYXJJbnRlcnZhbCh0aGlzLkZjKTsNCiAgICAgICAgdGhpcy5rKCkubygidGltZXVwZGF0ZSIpDQogICAgfTsNCiAgICBzLmRpc3Bvc2UgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHRoaXMuVWMgJiYgdGhpcy5yZSgpOw0KICAgICAgICB0aGlzLlpiICYmIHRoaXMuVmMoKTsNCiAgICAgICAgdC5hLnByb3RvdHlwZS5kaXNwb3NlLmNhbGwodGhpcykNCiAgICB9Ow0KICAgIHMuY2MgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHRoaXMuWmIgJiYgdGhpcy5rKCkubygidGltZXVwZGF0ZSIpDQogICAgfTsNCiAgICBzLmllID0gZnVuY3Rpb24gKCkgew0KICAgICAgICBmdW5jdGlvbiBhKCkgew0KICAgICAgICAgICAgdmFyIGEgPSBjLmVhKCJ0ZXh0VHJhY2tEaXNwbGF5Iik7DQogICAgICAgICAgICBhICYmIGEuQygpDQogICAgICAgIH0NCiAgICAgICAgdmFyIGMgPSB0aGlzLmQsDQogICAgICAgICAgICBkOw0KICAgICAgICBpZiAoZCA9IHRoaXMudGV4dFRyYWNrcygpKSBkLmFkZEV2ZW50TGlzdGVuZXIoInJlbW92ZXRyYWNrIiwgYSksIGQuYWRkRXZlbnRMaXN0ZW5lcigiYWRkdHJhY2siLCBhKSwgdGhpcy5iKCJkaXNwb3NlIiwgdC5iaW5kKHRoaXMsIGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIGQucmVtb3ZlRXZlbnRMaXN0ZW5lcigicmVtb3ZldHJhY2siLCBhKTsNCiAgICAgICAgICAgIGQucmVtb3ZlRXZlbnRMaXN0ZW5lcigiYWRkdHJhY2siLCBhKQ0KICAgICAgICB9KSkNCiAgICB9Ow0KICAgIHMuV2QgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHZhciBhID0gdGhpcy5kLA0KICAgICAgICAgICAgYywgZCwgZTsNCiAgICAgICAgd2luZG93LldlYlZUVCB8fCAoZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNjcmlwdCIpLCBlLnNyYyA9IGEub3B0aW9ucygpWyJ2dHQuanMiXSB8fCAiLi4vbm9kZV9tb2R1bGVzL3Z0dC5qcy9kaXN0L3Z0dC5qcyIsIGEubSgpLmFwcGVuZENoaWxkKGUpLCB3aW5kb3cuV2ViVlRUID0gZik7DQogICAgICAgIGlmIChkID0gdGhpcy50ZXh0VHJhY2tzKCkpIGMgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICB2YXIgYywgZCwgZTsNCiAgICAgICAgICAgIGUgPSBhLmVhKCJ0ZXh0VHJhY2tEaXNwbGF5Iik7DQogICAgICAgICAgICBlLkMoKTsNCiAgICAgICAgICAgIGZvciAoYyA9IDA7IGMgPCB0aGlzLmxlbmd0aDsgYysrKSBkID0gdGhpc1tjXSwgZC5yZW1vdmVFdmVudExpc3RlbmVyKCJjdWVjaGFuZ2UiLCB0LmJpbmQoZSwgZS5DKSksICJzaG93aW5nIiA9PT0gZC5tb2RlICYmIGQuYWRkRXZlbnRMaXN0ZW5lcigiY3VlY2hhbmdlIiwgdC5iaW5kKGUsIGUuQykpDQogICAgICAgIH0sIGQuYWRkRXZlbnRMaXN0ZW5lcigiY2hhbmdlIiwgYyksIHRoaXMuYigiZGlzcG9zZSIsIHQuYmluZCh0aGlzLCBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICBkLnJlbW92ZUV2ZW50TGlzdGVuZXIoImNoYW5nZSIsDQogICAgICAgICAgICAgICAgYykNCiAgICAgICAgfSkpDQogICAgfTsNCiAgICBzLnRleHRUcmFja3MgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHRoaXMuZC5wZCA9IHRoaXMuZC5wZCB8fCBuZXcgdC5GOw0KICAgICAgICByZXR1cm4gdGhpcy5kLnBkDQogICAgfTsNCiAgICBzLlogPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHRoaXMuZC5hZCA9IHRoaXMuZC5hZCB8fCBuZXcgdC5GOw0KICAgICAgICByZXR1cm4gdGhpcy5kLmFkDQogICAgfTsNCiAgICBPID0gZnVuY3Rpb24gKGEsIGMsIGQsIGUsIGcpIHsNCiAgICAgICAgdmFyIGggPSBhLnRleHRUcmFja3MoKTsNCiAgICAgICAgZyA9IGcgfHwge307DQogICAgICAgIGcua2luZCA9IGM7DQogICAgICAgIGQgJiYgKGcubGFiZWwgPSBkKTsNCiAgICAgICAgZSAmJiAoZy5sYW5ndWFnZSA9IGUpOw0KICAgICAgICBnLnBsYXllciA9IGEuZDsNCiAgICAgICAgYSA9IG5ldyB0LnQoZyk7DQogICAgICAgIFAoaCwgYSk7DQogICAgICAgIHJldHVybiBhDQogICAgfTsNCiAgICB0LmoucHJvdG90eXBlLmFkZFRleHRUcmFjayA9IGZ1bmN0aW9uIChhLCBjLCBkKSB7DQogICAgICAgIGlmICghYSkgdGhyb3cgRXJyb3IoIlRleHRUcmFjayBraW5kIGlzIHJlcXVpcmVkIGJ1dCB3YXMgbm90IHByb3ZpZGVkIik7DQogICAgICAgIHJldHVybiBPKHRoaXMsIGEsIGMsIGQpDQogICAgfTsNCiAgICB0LmoucHJvdG90eXBlLmlhID0gZnVuY3Rpb24gKGEpIHsNCiAgICAgICAgYSA9IE8odGhpcywgYS5raW5kLCBhLmxhYmVsLCBhLmxhbmd1YWdlLCBhKTsNCiAgICAgICAgUCh0aGlzLlooKSwgYSk7DQogICAgICAgIHJldHVybiB7DQogICAgICAgICAgICBUOiBhDQogICAgICAgIH0NCiAgICB9Ow0KICAgIHQuai5wcm90b3R5cGUuRWEgPSBmdW5jdGlvbiAoYSkgew0KICAgICAgICBRKHRoaXMudGV4dFRyYWNrcygpLCBhKTsNCiAgICAgICAgUSh0aGlzLlooKSwgYSkNCiAgICB9Ow0KICAgIHQuai5wcm90b3R5cGUuZmQgPSBtKCk7DQogICAgdC5qLnByb3RvdHlwZS5mZWF0dXJlc1ZvbHVtZUNvbnRyb2wgPSBmOw0KICAgIHQuai5wcm90b3R5cGUuZmVhdHVyZXNGdWxsc2NyZWVuUmVzaXplID0gbDsNCiAgICB0LmoucHJvdG90eXBlLmZlYXR1cmVzUGxheWJhY2tSYXRlID0gbDsNCiAgICB0LmoucHJvdG90eXBlLmZlYXR1cmVzUHJvZ3Jlc3NFdmVudHMgPSBsOw0KICAgIHQuai5wcm90b3R5cGUuZmVhdHVyZXNUaW1ldXBkYXRlRXZlbnRzID0gbDsNCiAgICB0LmoucHJvdG90eXBlLmZlYXR1cmVzTmF0aXZlVGV4dFRyYWNrcyA9IGw7DQogICAgdC5qLmhjID0gZnVuY3Rpb24gKGEpIHsNCiAgICAgICAgYS5UYSA9IGZ1bmN0aW9uIChjLCBkKSB7DQogICAgICAgICAgICB2YXIgZSA9IGEuZ2Q7DQogICAgICAgICAgICBlIHx8IChlID0gYS5nZCA9IFtdKTsNCiAgICAgICAgICAgIGQgPT09IGIgJiYgKGQgPSBlLmxlbmd0aCk7DQogICAgICAgICAgICBlLnNwbGljZShkLCAwLCBjKQ0KICAgICAgICB9Ow0KICAgICAgICBhLnJiID0gZnVuY3Rpb24gKGMpIHsNCiAgICAgICAgICAgIGZvciAodmFyIGQgPSBhLmdkIHx8IFtdLCBlLCBnID0gMDsgZyA8IGQubGVuZ3RoOyBnKyspDQogICAgICAgICAgICAgICAgaWYgKGUgPSBkW2ddLmZiKGMpKSByZXR1cm4gZFtnXTsNCiAgICAgICAgICAgIHJldHVybiBqDQogICAgICAgIH07DQogICAgICAgIGEuQWMgPSBmdW5jdGlvbiAoYykgew0KICAgICAgICAgICAgdmFyIGQgPSBhLnJiKGMpOw0KICAgICAgICAgICAgcmV0dXJuIGQgPyBkLmZiKGMpIDogIiINCiAgICAgICAgfTsNCiAgICAgICAgYS5wcm90b3R5cGUubmEgPSBmdW5jdGlvbiAoYykgew0KICAgICAgICAgICAgdmFyIGQgPSBhLnJiKGMpOw0KICAgICAgICAgICAgZCB8fCAoYS5TID8gZCA9IGEuUyA6IHQubG9nLmVycm9yKCJObyBzb3VyY2UgaGFuZGVyIGZvdW5kIGZvciB0aGUgY3VycmVudCBzb3VyY2UuIikpOw0KICAgICAgICAgICAgdGhpcy5qYSgpOw0KICAgICAgICAgICAgdGhpcy5uKCJkaXNwb3NlIiwgdGhpcy5qYSk7DQogICAgICAgICAgICB0aGlzLmliID0gYzsNCiAgICAgICAgICAgIHRoaXMuZGMgPSBkLlViKGMsIHRoaXMpOw0KICAgICAgICAgICAgdGhpcy5iKCJkaXNwb3NlIiwgdGhpcy5qYSk7DQogICAgICAgICAgICByZXR1cm4gdGhpcw0KICAgICAgICB9Ow0KICAgICAgICBhLnByb3RvdHlwZS5qYSA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIHRoaXMuZGMgJiYNCiAgICAgICAgICAgICAgICB0aGlzLmRjLmRpc3Bvc2UgJiYgdGhpcy5kYy5kaXNwb3NlKCkNCiAgICAgICAgfQ0KICAgIH07DQogICAgdC5tZWRpYSA9IHt9Ow0KICAgIHQuZSA9IHQuai5leHRlbmQoew0KICAgICAgICBsOiBmdW5jdGlvbiAoYSwgYywgZCkgew0KICAgICAgICAgICAgdmFyIGUsIGcsIGg7DQogICAgICAgICAgICBpZiAoYy5uYXRpdmVDYXB0aW9ucyA9PT0gbCB8fCBjLm5hdGl2ZVRleHRUcmFja3MgPT09IGwpIHRoaXMuZmVhdHVyZXNOYXRpdmVUZXh0VHJhY2tzID0gbDsNCiAgICAgICAgICAgIHQuai5jYWxsKHRoaXMsIGEsIGMsIGQpOw0KICAgICAgICAgICAgZm9yIChkID0gdC5lLkFiLmxlbmd0aCAtIDE7IDAgPD0gZDsgZC0tKSB0aGlzLmIodC5lLkFiW2RdLCB0aGlzLlhkKTsNCiAgICAgICAgICAgIChjID0gYy5zb3VyY2UpICYmICh0aGlzLmMuY3VycmVudFNyYyAhPT0gYy5zcmMgfHwgYS5MICYmIDMgPT09IGEuTC5oZSkgJiYgdGhpcy5uYShjKTsNCiAgICAgICAgICAgIGlmICh0aGlzLmMuaGFzQ2hpbGROb2RlcygpKSB7DQogICAgICAgICAgICAgICAgZCA9IHRoaXMuYy5jaGlsZE5vZGVzOw0KICAgICAgICAgICAgICAgIGUgPSBkLmxlbmd0aDsNCiAgICAgICAgICAgICAgICBmb3IgKGMgPSBbXTsgZS0tOykgZyA9IGRbZV0sIGggPSBnLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCksICJ0cmFjayIgPT09IGggJiYgKHRoaXMuZmVhdHVyZXNOYXRpdmVUZXh0VHJhY2tzID8gUCh0aGlzLlooKSwgZy50cmFjaykgOiBjLnB1c2goZykpOw0KICAgICAgICAgICAgICAgIGZvciAoZCA9IDA7IGQgPCBjLmxlbmd0aDsgZCsrKSB0aGlzLmMucmVtb3ZlQ2hpbGQoY1tkXSkNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHRoaXMuZmVhdHVyZXNOYXRpdmVUZXh0VHJhY2tzICYmDQogICAgICAgICAgICAgICAgdGhpcy5iKCJsb2Fkc3RhcnQiLCB0LmJpbmQodGhpcywgdGhpcy5mZSkpOw0KICAgICAgICAgICAgaWYgKHQuR2IgJiYgYS5vcHRpb25zKCkubmF0aXZlQ29udHJvbHNGb3JUb3VjaCA9PT0gZikgew0KICAgICAgICAgICAgICAgIHZhciBrLCBxLCByLCB1Ow0KICAgICAgICAgICAgICAgIGsgPSB0aGlzOw0KICAgICAgICAgICAgICAgIHEgPSB0aGlzLmsoKTsNCiAgICAgICAgICAgICAgICBjID0gcS5jb250cm9scygpOw0KICAgICAgICAgICAgICAgIGsuYy5jb250cm9scyA9ICEhYzsNCiAgICAgICAgICAgICAgICByID0gZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgICAgICBrLmMuY29udHJvbHMgPSBmDQogICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICB1ID0gZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgICAgICBrLmMuY29udHJvbHMgPSBsDQogICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICBxLmIoImNvbnRyb2xzZW5hYmxlZCIsIHIpOw0KICAgICAgICAgICAgICAgIHEuYigiY29udHJvbHNkaXNhYmxlZCIsIHUpOw0KICAgICAgICAgICAgICAgIGMgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgICAgIHEubigiY29udHJvbHNlbmFibGVkIiwgcik7DQogICAgICAgICAgICAgICAgICAgIHEubigiY29udHJvbHNkaXNhYmxlZCIsIHUpDQogICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICBrLmIoImRpc3Bvc2UiLCBjKTsNCiAgICAgICAgICAgICAgICBxLmIoInVzaW5nY3VzdG9tY29udHJvbHMiLCBjKTsNCiAgICAgICAgICAgICAgICBxLnVzaW5nTmF0aXZlQ29udHJvbHMoZikNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGEuSShmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgdGhpcy5zcmMoKSAmJiAodGhpcy5MICYmIHRoaXMucS5hdXRvcGxheSAmJiB0aGlzLnBhdXNlZCgpKSAmJiAoZGVsZXRlIHRoaXMuTC5wb3N0ZXIsIHRoaXMucGxheSgpKQ0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB0aGlzLlhhKCkNCiAgICAgICAgfQ0KICAgIH0pOw0KICAgIHMgPSB0LmUucHJvdG90eXBlOw0KICAgIHMuZGlzcG9zZSA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgdC5lLk5iKHRoaXMuYyk7DQogICAgICAgIHQuai5wcm90b3R5cGUuZGlzcG9zZS5jYWxsKHRoaXMpDQogICAgfTsNCiAgICBzLmYgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHZhciBhID0gdGhpcy5kLA0KICAgICAgICAgICAgYywgZCwgZSwgZyA9IGEuTDsNCiAgICAgICAgaWYgKCFnIHx8IHRoaXMubW92aW5nTWVkaWFFbGVtZW50SW5ET00gPT09IGwpIHsNCiAgICAgICAgICAgIGcgPyAoZSA9IGcuY2xvbmVOb2RlKGwpLCB0LmUuTmIoZyksIGcgPSBlLCBhLkwgPSBqKSA6IChnID0gdC5mKCJ2aWRlbyIpLCBlID0gdmlkZW9qcy4kLkJhKHt9LCBhLlllKSwgKCF0LkdiIHx8IGEub3B0aW9ucygpLm5hdGl2ZUNvbnRyb2xzRm9yVG91Y2ggIT09IGYpICYmIGRlbGV0ZSBlLmNvbnRyb2xzLCB0LmVkKGcsIHQuaS5EKGUsIHsNCiAgICAgICAgICAgICAgICBpZDogYS5pZCgpICsgIl9odG1sNV9hcGkiLA0KICAgICAgICAgICAgICAgICJjbGFzcyI6ICJ2anMtdGVjaCINCiAgICAgICAgICAgIH0pKSk7DQogICAgICAgICAgICBnLnBsYXllciA9IGE7DQogICAgICAgICAgICBpZiAoYS5xLnJkKQ0KICAgICAgICAgICAgICAgIGZvciAoZSA9IDA7IGUgPCBhLnEucmQubGVuZ3RoOyBlKyspIGMgPSBhLnEucmRbZV0sIGQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0cmFjayIpLCBkLlhiID0gYy5YYiwgZC5sYWJlbCA9IGMubGFiZWwsIGQuamQgPSBjLmpkLCBkLnNyYyA9IGMuc3JjLCAiZGVmYXVsdCIgaW4gYyAmJiBkLnNldEF0dHJpYnV0ZSgiZGVmYXVsdCIsICJkZWZhdWx0IiksIGcuYXBwZW5kQ2hpbGQoZCk7DQogICAgICAgICAgICB0LlZiKGcsIGEubSgpKQ0KICAgICAgICB9DQogICAgICAgIGMgPSBbImF1dG9wbGF5IiwgInByZWxvYWQiLCAibG9vcCIsICJtdXRlZCJdOw0KICAgICAgICBmb3IgKGUgPSBjLmxlbmd0aCAtIDE7IDAgPD0gZTsgZS0tKSB7DQogICAgICAgICAgICBkID0gY1tlXTsNCiAgICAgICAgICAgIHZhciBoID0ge307DQogICAgICAgICAgICAidW5kZWZpbmVkIiAhPT0gdHlwZW9mIGEucVtkXSAmJiAoaFtkXSA9IGEucVtkXSk7DQogICAgICAgICAgICB0LmVkKGcsIGgpDQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIGcNCiAgICB9Ow0KICAgIHMuZmUgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIGZvciAodmFyIGEgPSB0aGlzLmMucXVlcnlTZWxlY3RvckFsbCgidHJhY2siKSwgYywgZCA9IGEubGVuZ3RoLCBlID0gew0KICAgICAgICAgICAgY2FwdGlvbnM6IDEsDQogICAgICAgICAgICBzdWJ0aXRsZXM6IDENCiAgICAgICAgfTsgZC0tOykNCiAgICAgICAgICAgIGlmICgoYyA9IGFbZF0uVCkgJiYgYy5raW5kIGluIGUgJiYgIWFbZF1bImRlZmF1bHQiXSkgYy5tb2RlID0gImRpc2FibGVkIg0KICAgIH07DQogICAgcy5YZCA9IGZ1bmN0aW9uIChhKSB7DQogICAgICAgICJlcnJvciIgPT0gYS50eXBlICYmIHRoaXMuZXJyb3IoKSA/IHRoaXMuaygpLmVycm9yKHRoaXMuZXJyb3IoKS5jb2RlKSA6IChhLmJ1YmJsZXMgPSBsLCB0aGlzLmsoKS5vKGEpKQ0KICAgIH07DQogICAgcy5wbGF5ID0gZnVuY3Rpb24gKCkgew0KICAgICAgICB0aGlzLmMucGxheSgpDQogICAgfTsNCiAgICBzLnBhdXNlID0gZnVuY3Rpb24gKCkgew0KICAgICAgICB0aGlzLmMucGF1c2UoKQ0KICAgIH07DQogICAgcy5wYXVzZWQgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHJldHVybiB0aGlzLmMucGF1c2VkDQogICAgfTsNCiAgICBzLmN1cnJlbnRUaW1lID0gZnVuY3Rpb24gKCkgew0KICAgICAgICByZXR1cm4gdGhpcy5jLmN1cnJlbnRUaW1lDQogICAgfTsNCiAgICBzLmNjID0gZnVuY3Rpb24gKGEpIHsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIHRoaXMuYy5jdXJyZW50VGltZSA9IGENCiAgICAgICAgfSBjYXRjaCAoYykgew0KICAgICAgICAgICAgdC5sb2coYywgIlZpZGVvIGlzIG5vdCByZWFkeS4gKFZpZGVvLmpzKSIpDQogICAgICAgIH0NCiAgICB9Ow0KICAgIHMuZHVyYXRpb24gPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHJldHVybiB0aGlzLmMuZHVyYXRpb24gfHwgMA0KICAgIH07DQogICAgcy5idWZmZXJlZCA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuYy5idWZmZXJlZA0KICAgIH07DQogICAgcy52b2x1bWUgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHJldHVybiB0aGlzLmMudm9sdW1lDQogICAgfTsNCiAgICBzLlRlID0gZnVuY3Rpb24gKGEpIHsNCiAgICAgICAgdGhpcy5jLnZvbHVtZSA9IGENCiAgICB9Ow0KICAgIHMubXV0ZWQgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHJldHVybiB0aGlzLmMubXV0ZWQNCiAgICB9Ow0KICAgIHMuUGUgPSBmdW5jdGlvbiAoYSkgew0KICAgICAgICB0aGlzLmMubXV0ZWQgPSBhDQogICAgfTsNCiAgICBzLndpZHRoID0gZnVuY3Rpb24gKCkgew0KICAgICAgICByZXR1cm4gdGhpcy5jLm9mZnNldFdpZHRoDQogICAgfTsNCiAgICBzLmhlaWdodCA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuYy5vZmZzZXRIZWlnaHQNCiAgICB9Ow0KICAgIHMuVWEgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHJldHVybiAiZnVuY3Rpb24iID09IHR5cGVvZiB0aGlzLmMud2Via2l0RW50ZXJGdWxsU2NyZWVuICYmICgvQW5kcm9pZC8udGVzdCh0LlApIHx8ICEvQ2hyb21lfE1hYyBPUyBYIDEwLjUvLnRlc3QodC5QKSkgPyBmIDogbA0KICAgIH07DQogICAgcy5JYyA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgdmFyIGEgPSB0aGlzLmM7DQogICAgICAgICJ3ZWJraXREaXNwbGF5aW5nRnVsbHNjcmVlbiIgaW4gYSAmJiB0aGlzLk4oIndlYmtpdGJlZ2luZnVsbHNjcmVlbiIsIGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIHRoaXMuZC5pc0Z1bGxzY3JlZW4oZik7DQogICAgICAgICAgICB0aGlzLk4oIndlYmtpdGVuZGZ1bGxzY3JlZW4iLCBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgdGhpcy5kLmlzRnVsbHNjcmVlbihsKTsNCiAgICAgICAgICAgICAgICB0aGlzLmQubygiZnVsbHNjcmVlbmNoYW5nZSIpDQogICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIHRoaXMuZC5vKCJmdWxsc2NyZWVuY2hhbmdlIikNCiAgICAgICAgfSk7DQogICAgICAgIGEucGF1c2VkICYmIGEubmV0d29ya1N0YXRlIDw9IGEua2YgPyAodGhpcy5jLnBsYXkoKSwgdGhpcy5zZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIGEucGF1c2UoKTsNCiAgICAgICAgICAgIGEud2Via2l0RW50ZXJGdWxsU2NyZWVuKCkNCiAgICAgICAgfSwgMCkpIDogYS53ZWJraXRFbnRlckZ1bGxTY3JlZW4oKQ0KICAgIH07DQogICAgcy5ZZCA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgdGhpcy5jLndlYmtpdEV4aXRGdWxsU2NyZWVuKCkNCiAgICB9Ow0KDQogICAgZnVuY3Rpb24gb2EoYSwgYykgew0KICAgICAgICB2YXIgZCA9IC9eYmxvYlw6L2k7DQogICAgICAgIHJldHVybiBjICYmIGEgJiYgZC50ZXN0KGEpID8gYyA6IGENCiAgICB9DQogICAgcy5zcmMgPSBmdW5jdGlvbiAoYSkgew0KICAgICAgICB2YXIgYyA9IHRoaXMuYy5zcmM7DQogICAgICAgIGlmIChhID09PSBiKSByZXR1cm4gb2EoYywgdGhpcy5oZCk7DQogICAgICAgIHRoaXMub2EoYSkNCiAgICB9Ow0KICAgIHMub2EgPSBmdW5jdGlvbiAoYSkgew0KICAgICAgICB0aGlzLmMuc3JjID0gYQ0KICAgIH07DQogICAgcy5sb2FkID0gZnVuY3Rpb24gKCkgew0KICAgICAgICB0aGlzLmMubG9hZCgpDQogICAgfTsNCiAgICBzLmN1cnJlbnRTcmMgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHZhciBhID0gdGhpcy5jLmN1cnJlbnRTcmM7DQogICAgICAgIHJldHVybiAhdGhpcy5pYiA/IGEgOiBvYShhLCB0aGlzLmliLnNyYykNCiAgICB9Ow0KICAgIHMucG9zdGVyID0gZnVuY3Rpb24gKCkgew0KICAgICAgICByZXR1cm4gdGhpcy5jLnBvc3Rlcg0KICAgIH07DQogICAgcy5mZCA9IGZ1bmN0aW9uIChhKSB7DQogICAgICAgIHRoaXMuYy5wb3N0ZXIgPSBhDQogICAgfTsNCiAgICBzLlNhID0gZnVuY3Rpb24gKCkgew0KICAgICAgICByZXR1cm4gdGhpcy5jLlNhDQogICAgfTsNCiAgICBzLlJlID0gZnVuY3Rpb24gKGEpIHsNCiAgICAgICAgdGhpcy5jLlNhID0gYQ0KICAgIH07DQogICAgcy5hdXRvcGxheSA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuYy5hdXRvcGxheQ0KICAgIH07DQogICAgcy5NZSA9IGZ1bmN0aW9uIChhKSB7DQogICAgICAgIHRoaXMuYy5hdXRvcGxheSA9IGENCiAgICB9Ow0KICAgIHMuY29udHJvbHMgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHJldHVybiB0aGlzLmMuY29udHJvbHMNCiAgICB9Ow0KICAgIHMubG9vcCA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuYy5sb29wDQogICAgfTsNCiAgICBzLk9lID0gZnVuY3Rpb24gKGEpIHsNCiAgICAgICAgdGhpcy5jLmxvb3AgPSBhDQogICAgfTsNCiAgICBzLmVycm9yID0gZnVuY3Rpb24gKCkgew0KICAgICAgICByZXR1cm4gdGhpcy5jLmVycm9yDQogICAgfTsNCiAgICBzLnNlZWtpbmcgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHJldHVybiB0aGlzLmMuc2Vla2luZw0KICAgIH07DQogICAgcy5zZWVrYWJsZSA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuYy5zZWVrYWJsZQ0KICAgIH07DQogICAgcy5lbmRlZCA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuYy5lbmRlZA0KICAgIH07DQogICAgcy5wbGF5YmFja1JhdGUgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHJldHVybiB0aGlzLmMucGxheWJhY2tSYXRlDQogICAgfTsNCiAgICBzLlFlID0gZnVuY3Rpb24gKGEpIHsNCiAgICAgICAgdGhpcy5jLnBsYXliYWNrUmF0ZSA9IGENCiAgICB9Ow0KICAgIHMubmV0d29ya1N0YXRlID0gZnVuY3Rpb24gKCkgew0KICAgICAgICByZXR1cm4gdGhpcy5jLm5ldHdvcmtTdGF0ZQ0KICAgIH07DQogICAgcy5yZWFkeVN0YXRlID0gZnVuY3Rpb24gKCkgew0KICAgICAgICByZXR1cm4gdGhpcy5jLnJlYWR5U3RhdGUNCiAgICB9Ow0KICAgIHMudGV4dFRyYWNrcyA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgcmV0dXJuICF0aGlzLmZlYXR1cmVzTmF0aXZlVGV4dFRyYWNrcyA/IHQuai5wcm90b3R5cGUudGV4dFRyYWNrcy5jYWxsKHRoaXMpIDogdGhpcy5jLnRleHRUcmFja3MNCiAgICB9Ow0KICAgIHMuYWRkVGV4dFRyYWNrID0gZnVuY3Rpb24gKGEsIGMsIGQpIHsNCiAgICAgICAgcmV0dXJuICF0aGlzLmZlYXR1cmVzTmF0aXZlVGV4dFRyYWNrcyA/IHQuai5wcm90b3R5cGUuYWRkVGV4dFRyYWNrLmNhbGwodGhpcywgYSwgYywgZCkgOiB0aGlzLmMuYWRkVGV4dFRyYWNrKGEsIGMsIGQpDQogICAgfTsNCiAgICBzLmlhID0gZnVuY3Rpb24gKGEpIHsNCiAgICAgICAgaWYgKCF0aGlzLmZlYXR1cmVzTmF0aXZlVGV4dFRyYWNrcykgcmV0dXJuIHQuai5wcm90b3R5cGUuaWEuY2FsbCh0aGlzLCBhKTsNCiAgICAgICAgdmFyIGMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0cmFjayIpOw0KICAgICAgICBhID0gYSB8fCB7fTsNCiAgICAgICAgYS5raW5kICYmIChjLmtpbmQgPSBhLmtpbmQpOw0KICAgICAgICBhLmxhYmVsICYmIChjLmxhYmVsID0gYS5sYWJlbCk7DQogICAgICAgIGlmIChhLmxhbmd1YWdlIHx8IGEuc3JjbGFuZykgYy5zcmNsYW5nID0gYS5sYW5ndWFnZSB8fCBhLnNyY2xhbmc7DQogICAgICAgIGFbImRlZmF1bHQiXSAmJiAoY1siZGVmYXVsdCJdID0gYVsiZGVmYXVsdCJdKTsNCiAgICAgICAgYS5pZCAmJiAoYy5pZCA9IGEuaWQpOw0KICAgICAgICBhLnNyYyAmJiAoYy5zcmMgPSBhLnNyYyk7DQogICAgICAgIHRoaXMubSgpLmFwcGVuZENoaWxkKGMpOw0KICAgICAgICBjLnRyYWNrLm1vZGUgPSAibWV0YWRhdGEiID09PSBjLlQua2luZCA/ICJoaWRkZW4iIDogImRpc2FibGVkIjsNCiAgICAgICAgYy5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICB2YXIgYSA9IGMudHJhY2s7DQogICAgICAgICAgICAyIDw9IGMucmVhZHlTdGF0ZSAmJiAoIm1ldGFkYXRhIiA9PT0gYS5raW5kICYmICJoaWRkZW4iICE9PSBhLm1vZGUgPyBhLm1vZGUgPSAiaGlkZGVuIiA6DQogICAgICAgICAgICAgICAgIm1ldGFkYXRhIiAhPT0gYS5raW5kICYmICJkaXNhYmxlZCIgIT09IGEubW9kZSAmJiAoYS5tb2RlID0gImRpc2FibGVkIiksIGMub25sb2FkID0gaikNCiAgICAgICAgfTsNCiAgICAgICAgUCh0aGlzLlooKSwgYy5UKTsNCiAgICAgICAgcmV0dXJuIGMNCiAgICB9Ow0KICAgIHMuRWEgPSBmdW5jdGlvbiAoYSkgew0KICAgICAgICBpZiAoIXRoaXMuZmVhdHVyZXNOYXRpdmVUZXh0VHJhY2tzKSByZXR1cm4gdC5qLnByb3RvdHlwZS5FYS5jYWxsKHRoaXMsIGEpOw0KICAgICAgICB2YXIgYywgZDsNCiAgICAgICAgUSh0aGlzLlooKSwgYSk7DQogICAgICAgIGMgPSB0aGlzLm0oKS5xdWVyeVNlbGVjdG9yQWxsKCJ0cmFjayIpOw0KICAgICAgICBmb3IgKGQgPSAwOyBkIDwgYy5sZW5ndGg7IGQrKykNCiAgICAgICAgICAgIGlmIChjW2RdID09PSBhIHx8IGNbZF0udHJhY2sgPT09IGEpIHsNCiAgICAgICAgICAgICAgICBjW2RdLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoY1tkXSk7DQogICAgICAgICAgICAgICAgYnJlYWsNCiAgICAgICAgICAgIH0NCiAgICB9Ow0KICAgIHQuZS5pc1N1cHBvcnRlZCA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIHQuQS52b2x1bWUgPSAwLjUNCiAgICAgICAgfSBjYXRjaCAoYSkgew0KICAgICAgICAgICAgcmV0dXJuIGwNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gISF0LkEuY2FuUGxheVR5cGUNCiAgICB9Ow0KICAgIHQuai5oYyh0LmUpOw0KICAgIHZhciBwYSA9IHQuZS5wcm90b3R5cGUubmEsDQogICAgICAgIHFhID0gdC5lLnByb3RvdHlwZS5qYTsNCiAgICB0LmUucHJvdG90eXBlLm5hID0gZnVuY3Rpb24gKGEpIHsNCiAgICAgICAgdmFyIGMgPSBwYS5jYWxsKHRoaXMsIGEpOw0KICAgICAgICB0aGlzLmhkID0gYS5zcmM7DQogICAgICAgIHJldHVybiBjDQogICAgfTsNCiAgICB0LmUucHJvdG90eXBlLmphID0gZnVuY3Rpb24gKCkgew0KICAgICAgICB0aGlzLmhkID0gYjsNCiAgICAgICAgcmV0dXJuIHFhLmNhbGwodGhpcykNCiAgICB9Ow0KICAgIHQuZS5TID0ge307DQogICAgdC5lLlMuZmIgPSBmdW5jdGlvbiAoYSkgew0KICAgICAgICBmdW5jdGlvbiBjKGEpIHsNCiAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIHQuQS5jYW5QbGF5VHlwZShhKQ0KICAgICAgICAgICAgfSBjYXRjaCAoYykgew0KICAgICAgICAgICAgICAgIHJldHVybiAiIg0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiBhLnR5cGUgPyBjKGEudHlwZSkgOiBhLnNyYyA/IChhID0gKGEgPSBhLnNyYy5tYXRjaCgvXC4oW14uXC9cP10rKShcP1teXC9dKyk/JC9pKSkgJiYgYVsxXSwgYygidmlkZW8vIiArIGEpKSA6ICIiDQogICAgfTsNCiAgICB0LmUuUy5VYiA9IGZ1bmN0aW9uIChhLCBjKSB7DQogICAgICAgIGMub2EoYS5zcmMpDQogICAgfTsNCiAgICB0LmUuUy5kaXNwb3NlID0gbSgpOw0KICAgIHQuZS5UYSh0LmUuUyk7DQogICAgdC5lLlBkID0gZnVuY3Rpb24gKCkgew0KICAgICAgICB2YXIgYSA9IHQuQS52b2x1bWU7DQogICAgICAgIHQuQS52b2x1bWUgPSBhIC8gMiArIDAuMTsNCiAgICAgICAgcmV0dXJuIGEgIT09IHQuQS52b2x1bWUNCiAgICB9Ow0KICAgIHQuZS5PZCA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgdmFyIGEgPSB0LkEucGxheWJhY2tSYXRlOw0KICAgICAgICB0LkEucGxheWJhY2tSYXRlID0gYSAvIDIgKyAwLjE7DQogICAgICAgIHJldHVybiBhICE9PSB0LkEucGxheWJhY2tSYXRlDQogICAgfTsNCiAgICB0LmUuV2UgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHZhciBhOw0KICAgICAgICAoYSA9ICEhdC5BLnRleHRUcmFja3MpICYmIDAgPCB0LkEudGV4dFRyYWNrcy5sZW5ndGggJiYgKGEgPSAibnVtYmVyIiAhPT0gdHlwZW9mIHQuQS50ZXh0VHJhY2tzWzBdLm1vZGUpOw0KICAgICAgICBhICYmIHQua2MgJiYgKGEgPSBsKTsNCiAgICAgICAgcmV0dXJuIGENCiAgICB9Ow0KICAgIHQuZS5wcm90b3R5cGUuZmVhdHVyZXNWb2x1bWVDb250cm9sID0gdC5lLlBkKCk7DQogICAgdC5lLnByb3RvdHlwZS5mZWF0dXJlc1BsYXliYWNrUmF0ZSA9IHQuZS5PZCgpOw0KICAgIHQuZS5wcm90b3R5cGUubW92aW5nTWVkaWFFbGVtZW50SW5ET00gPSAhdC5CZDsNCiAgICB0LmUucHJvdG90eXBlLmZlYXR1cmVzRnVsbHNjcmVlblJlc2l6ZSA9IGY7DQogICAgdC5lLnByb3RvdHlwZS5mZWF0dXJlc1Byb2dyZXNzRXZlbnRzID0gZjsNCiAgICB0LmUucHJvdG90eXBlLmZlYXR1cmVzTmF0aXZlVGV4dFRyYWNrcyA9IHQuZS5XZSgpOw0KICAgIHZhciBTLCByYSA9IC9eYXBwbGljYXRpb25cLyg/OngtfHZuZFwuYXBwbGVcLiltcGVndXJsL2ksDQogICAgICAgIHNhID0gL152aWRlb1wvbXA0L2k7DQogICAgdC5lLlhjID0gZnVuY3Rpb24gKCkgew0KICAgICAgICA0IDw9IHQuaWMgJiYgKFMgfHwgKFMgPSB0LkEuY29uc3RydWN0b3IucHJvdG90eXBlLmNhblBsYXlUeXBlKSwgdC5BLmNvbnN0cnVjdG9yLnByb3RvdHlwZS5jYW5QbGF5VHlwZSA9IGZ1bmN0aW9uIChhKSB7DQogICAgICAgICAgICByZXR1cm4gYSAmJiByYS50ZXN0KGEpID8gIm1heWJlIiA6IFMuY2FsbCh0aGlzLCBhKQ0KICAgICAgICB9KTsNCiAgICAgICAgdC5GZCAmJiAoUyB8fCAoUyA9IHQuQS5jb25zdHJ1Y3Rvci5wcm90b3R5cGUuY2FuUGxheVR5cGUpLCB0LkEuY29uc3RydWN0b3IucHJvdG90eXBlLmNhblBsYXlUeXBlID0gZnVuY3Rpb24gKGEpIHsNCiAgICAgICAgICAgIHJldHVybiBhICYmIHNhLnRlc3QoYSkgPyAibWF5YmUiIDogUy5jYWxsKHRoaXMsIGEpDQogICAgICAgIH0pDQogICAgfTsNCiAgICB0LmUuY2YgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHZhciBhID0gdC5BLmNvbnN0cnVjdG9yLnByb3RvdHlwZS5jYW5QbGF5VHlwZTsNCiAgICAgICAgdC5BLmNvbnN0cnVjdG9yLnByb3RvdHlwZS5jYW5QbGF5VHlwZSA9IFM7DQogICAgICAgIFMgPSBqOw0KICAgICAgICByZXR1cm4gYQ0KICAgIH07DQogICAgdC5lLlhjKCk7DQogICAgdC5lLkFiID0gImxvYWRzdGFydCBzdXNwZW5kIGFib3J0IGVycm9yIGVtcHRpZWQgc3RhbGxlZCBsb2FkZWRtZXRhZGF0YSBsb2FkZWRkYXRhIGNhbnBsYXkgY2FucGxheXRocm91Z2ggcGxheWluZyB3YWl0aW5nIHNlZWtpbmcgc2Vla2VkIGVuZGVkIGR1cmF0aW9uY2hhbmdlIHRpbWV1cGRhdGUgcHJvZ3Jlc3MgcGxheSBwYXVzZSByYXRlY2hhbmdlIHZvbHVtZWNoYW5nZSIuc3BsaXQoIiAiKTsNCiAgICB0LmUuTmIgPSBmdW5jdGlvbiAoYSkgew0KICAgICAgICBpZiAoYSkgew0KICAgICAgICAgICAgYS5wbGF5ZXIgPSBqOw0KICAgICAgICAgICAgZm9yIChhLnBhcmVudE5vZGUgJiYgYS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGEpIDsgYS5oYXNDaGlsZE5vZGVzKCkgOykgYS5yZW1vdmVDaGlsZChhLmZpcnN0Q2hpbGQpOw0KICAgICAgICAgICAgYS5yZW1vdmVBdHRyaWJ1dGUoInNyYyIpOw0KICAgICAgICAgICAgaWYgKCJmdW5jdGlvbiIgPT09IHR5cGVvZiBhLmxvYWQpIHRyeSB7DQogICAgICAgICAgICAgICAgYS5sb2FkKCkNCiAgICAgICAgICAgIH0gY2F0Y2ggKGMpIHsgfQ0KICAgICAgICB9DQogICAgfTsNCiAgICB0LmcgPSB0LmouZXh0ZW5kKHsNCiAgICAgICAgbDogZnVuY3Rpb24gKGEsIGMsIGQpIHsNCiAgICAgICAgICAgIHQuai5jYWxsKHRoaXMsIGEsIGMsIGQpOw0KICAgICAgICAgICAgdmFyIGUgPSBjLnNvdXJjZTsNCiAgICAgICAgICAgIGQgPSBhLmlkKCkgKyAiX2ZsYXNoX2FwaSI7DQogICAgICAgICAgICB2YXIgZyA9IGEucSwNCiAgICAgICAgICAgICAgICBnID0gdC5pLkQoew0KICAgICAgICAgICAgICAgICAgICByZWFkeUZ1bmN0aW9uOiAidmlkZW9qcy5GbGFzaC5vblJlYWR5IiwNCiAgICAgICAgICAgICAgICAgICAgZXZlbnRQcm94eUZ1bmN0aW9uOiAidmlkZW9qcy5GbGFzaC5vbkV2ZW50IiwNCiAgICAgICAgICAgICAgICAgICAgZXJyb3JFdmVudFByb3h5RnVuY3Rpb246ICJ2aWRlb2pzLkZsYXNoLm9uRXJyb3IiLA0KICAgICAgICAgICAgICAgICAgICBhdXRvcGxheTogZy5hdXRvcGxheSwNCiAgICAgICAgICAgICAgICAgICAgcHJlbG9hZDogZy5TYSwNCiAgICAgICAgICAgICAgICAgICAgbG9vcDogZy5sb29wLA0KICAgICAgICAgICAgICAgICAgICBtdXRlZDogZy5tdXRlZA0KICAgICAgICAgICAgICAgIH0sIGMuZmxhc2hWYXJzKSwNCiAgICAgICAgICAgICAgICBoID0gdC5pLkQoew0KICAgICAgICAgICAgICAgICAgICB3bW9kZTogIm9wYXF1ZSIsDQogICAgICAgICAgICAgICAgICAgIGJnY29sb3I6ICIjMDAwMDAwIg0KICAgICAgICAgICAgICAgIH0sIGMucGFyYW1zKTsNCiAgICAgICAgICAgIGQgPSB0LmkuRCh7DQogICAgICAgICAgICAgICAgaWQ6IGQsDQogICAgICAgICAgICAgICAgbmFtZTogZCwNCiAgICAgICAgICAgICAgICAiY2xhc3MiOiAidmpzLXRlY2giDQogICAgICAgICAgICB9LCBjLmF0dHJpYnV0ZXMpOw0KICAgICAgICAgICAgZSAmJiB0aGlzLkkoZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgIHRoaXMubmEoZSkNCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgdC5WYih0aGlzLmMsIGMucGFyZW50RWwpOw0KICAgICAgICAgICAgYy5zdGFydFRpbWUgJiYgdGhpcy5JKGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICB0aGlzLmxvYWQoKTsNCiAgICAgICAgICAgICAgICB0aGlzLnBsYXkoKTsNCiAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRUaW1lKGMuc3RhcnRUaW1lKQ0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB0LmtjICYmIHRoaXMuSShmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgdGhpcy5iKCJtb3VzZW1vdmUiLCBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuaygpLm8oew0KICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogIm1vdXNlbW92ZSIsDQogICAgICAgICAgICAgICAgICAgICAgICBidWJibGVzOiBsDQogICAgICAgICAgICAgICAgICAgIH0pDQogICAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgYS5iKCJzdGFnZWNsaWNrIiwgYS5yZXBvcnRVc2VyQWN0aXZpdHkpOw0KICAgICAgICAgICAgdGhpcy5jID0gdC5nLkhjKGMuc3dmLCB0aGlzLmMsIGcsIGgsIGQpDQogICAgICAgIH0NCiAgICB9KTsNCiAgICBzID0gdC5nLnByb3RvdHlwZTsNCiAgICBzLmRpc3Bvc2UgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHQuai5wcm90b3R5cGUuZGlzcG9zZS5jYWxsKHRoaXMpDQogICAgfTsNCiAgICBzLnBsYXkgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHRoaXMuYy52anNfcGxheSgpDQogICAgfTsNCiAgICBzLnBhdXNlID0gZnVuY3Rpb24gKCkgew0KICAgICAgICB0aGlzLmMudmpzX3BhdXNlKCkNCiAgICB9Ow0KICAgIHMuc3JjID0gZnVuY3Rpb24gKGEpIHsNCiAgICAgICAgcmV0dXJuIGEgPT09IGIgPyB0aGlzLmN1cnJlbnRTcmMoKSA6IHRoaXMub2EoYSkNCiAgICB9Ow0KICAgIHMub2EgPSBmdW5jdGlvbiAoYSkgew0KICAgICAgICBhID0gdC5hZShhKTsNCiAgICAgICAgdGhpcy5jLnZqc19zcmMoYSk7DQogICAgICAgIGlmICh0aGlzLmQuYXV0b3BsYXkoKSkgew0KICAgICAgICAgICAgdmFyIGMgPSB0aGlzOw0KICAgICAgICAgICAgdGhpcy5zZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICBjLnBsYXkoKQ0KICAgICAgICAgICAgfSwgMCkNCiAgICAgICAgfQ0KICAgIH07DQogICAgdC5nLnByb3RvdHlwZS5zZXRDdXJyZW50VGltZSA9IGZ1bmN0aW9uIChhKSB7DQogICAgICAgIHRoaXMucGUgPSBhOw0KICAgICAgICB0aGlzLmMudmpzX3NldFByb3BlcnR5KCJjdXJyZW50VGltZSIsIGEpOw0KICAgICAgICB0LmoucHJvdG90eXBlLmNjLmNhbGwodGhpcykNCiAgICB9Ow0KICAgIHQuZy5wcm90b3R5cGUuY3VycmVudFRpbWUgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHJldHVybiB0aGlzLnNlZWtpbmcoKSA/IHRoaXMucGUgfHwgMCA6IHRoaXMuYy52anNfZ2V0UHJvcGVydHkoImN1cnJlbnRUaW1lIikNCiAgICB9Ow0KICAgIHQuZy5wcm90b3R5cGUuY3VycmVudFNyYyA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuaWIgPyB0aGlzLmliLnNyYyA6IHRoaXMuYy52anNfZ2V0UHJvcGVydHkoImN1cnJlbnRTcmMiKQ0KICAgIH07DQogICAgdC5nLnByb3RvdHlwZS5sb2FkID0gZnVuY3Rpb24gKCkgew0KICAgICAgICB0aGlzLmMudmpzX2xvYWQoKQ0KICAgIH07DQogICAgdC5nLnByb3RvdHlwZS5wb3N0ZXIgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHRoaXMuYy52anNfZ2V0UHJvcGVydHkoInBvc3RlciIpDQogICAgfTsNCiAgICB0LmcucHJvdG90eXBlLnNldFBvc3RlciA9IG0oKTsNCiAgICBzID0gdC5nLnByb3RvdHlwZTsNCiAgICBzLnNlZWthYmxlID0gZnVuY3Rpb24gKCkgew0KICAgICAgICByZXR1cm4gMCA9PT0gdGhpcy5kdXJhdGlvbigpID8gdC55YSgpIDogdC55YSgwLCB0aGlzLmR1cmF0aW9uKCkpDQogICAgfTsNCiAgICBzLmJ1ZmZlcmVkID0gZnVuY3Rpb24gKCkgew0KICAgICAgICByZXR1cm4gIXRoaXMuYy52anNfZ2V0UHJvcGVydHkgPyB0LnlhKCkgOiB0LnlhKDAsIHRoaXMuYy52anNfZ2V0UHJvcGVydHkoImJ1ZmZlcmVkIikpDQogICAgfTsNCiAgICBzLmR1cmF0aW9uID0gZnVuY3Rpb24gKCkgew0KICAgICAgICByZXR1cm4gIXRoaXMuYy52anNfZ2V0UHJvcGVydHkgPyAwIDogdGhpcy5jLnZqc19nZXRQcm9wZXJ0eSgiZHVyYXRpb24iKQ0KICAgIH07DQogICAgcy5VYSA9IHAobCk7DQogICAgcy5JYyA9IHAobCk7DQoNCiAgICBmdW5jdGlvbiB0YSgpIHsNCiAgICAgICAgdmFyIGEgPSBUW1VdLA0KICAgICAgICAgICAgYyA9IGEuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBhLnNsaWNlKDEpOw0KICAgICAgICB1YVsic2V0IiArIGNdID0gZnVuY3Rpb24gKGMpIHsNCiAgICAgICAgICAgIHJldHVybiB0aGlzLmMudmpzX3NldFByb3BlcnR5KGEsIGMpDQogICAgICAgIH0NCiAgICB9DQoNCiAgICBmdW5jdGlvbiB2YShhKSB7DQogICAgICAgIHVhW2FdID0gZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgcmV0dXJuIHRoaXMuYy52anNfZ2V0UHJvcGVydHkoYSkNCiAgICAgICAgfQ0KICAgIH0NCiAgICB2YXIgdWEgPSB0LmcucHJvdG90eXBlLA0KICAgICAgICBUID0gInJ0bXBDb25uZWN0aW9uIHJ0bXBTdHJlYW0gcHJlbG9hZCBkZWZhdWx0UGxheWJhY2tSYXRlIHBsYXliYWNrUmF0ZSBhdXRvcGxheSBsb29wIG1lZGlhR3JvdXAgY29udHJvbGxlciBjb250cm9scyB2b2x1bWUgbXV0ZWQgZGVmYXVsdE11dGVkIi5zcGxpdCgiICIpLA0KICAgICAgICB3YSA9ICJlcnJvciBuZXR3b3JrU3RhdGUgcmVhZHlTdGF0ZSBzZWVraW5nIGluaXRpYWxUaW1lIHN0YXJ0T2Zmc2V0VGltZSBwYXVzZWQgcGxheWVkIGVuZGVkIHZpZGVvVHJhY2tzIGF1ZGlvVHJhY2tzIHZpZGVvV2lkdGggdmlkZW9IZWlnaHQiLnNwbGl0KCIgIiksDQogICAgICAgIFU7DQogICAgZm9yIChVID0gMDsgVSA8IFQubGVuZ3RoOyBVKyspIHZhKFRbVV0pLCB0YSgpOw0KICAgIGZvciAoVSA9IDA7IFUgPCB3YS5sZW5ndGg7IFUrKykgdmEod2FbVV0pOw0KICAgIHQuZy5pc1N1cHBvcnRlZCA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgcmV0dXJuIDEwIDw9IHQuZy52ZXJzaW9uKClbMF0NCiAgICB9Ow0KICAgIHQuai5oYyh0LmcpOw0KICAgIHQuZy5TID0ge307DQogICAgdC5nLlMuZmIgPSBmdW5jdGlvbiAoYSkgew0KICAgICAgICByZXR1cm4gIWEudHlwZSA/ICIiIDogYS50eXBlLnJlcGxhY2UoLzsuKi8sICIiKS50b0xvd2VyQ2FzZSgpIGluIHQuZy4kZCA/ICJtYXliZSIgOiAiIg0KICAgIH07DQogICAgdC5nLlMuVWIgPSBmdW5jdGlvbiAoYSwgYykgew0KICAgICAgICBjLm9hKGEuc3JjKQ0KICAgIH07DQogICAgdC5nLlMuZGlzcG9zZSA9IG0oKTsNCiAgICB0LmcuVGEodC5nLlMpOw0KICAgIHQuZy4kZCA9IHsNCiAgICAgICAgInZpZGVvL2ZsdiI6ICJGTFYiLA0KICAgICAgICAidmlkZW8veC1mbHYiOiAiRkxWIiwNCiAgICAgICAgInZpZGVvL21wNCI6ICJNUDQiLA0KICAgICAgICAidmlkZW8vbTR2IjogIk1QNCINCiAgICB9Ow0KICAgIHQuZy5vblJlYWR5ID0gZnVuY3Rpb24gKGEpIHsNCiAgICAgICAgdmFyIGM7DQogICAgICAgIGlmIChjID0gKGEgPSB0Lm0oYSkpICYmIGEucGFyZW50Tm9kZSAmJiBhLnBhcmVudE5vZGUucGxheWVyKSBhLnBsYXllciA9IGMsIHQuZy5jaGVja1JlYWR5KGMuaCkNCiAgICB9Ow0KICAgIHQuZy5jaGVja1JlYWR5ID0gZnVuY3Rpb24gKGEpIHsNCiAgICAgICAgYS5tKCkgJiYgKGEubSgpLnZqc19nZXRQcm9wZXJ0eSA/IGEuWGEoKSA6IHRoaXMuc2V0VGltZW91dChmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICB0LmcuY2hlY2tSZWFkeShhKQ0KICAgICAgICB9LCA1MCkpDQogICAgfTsNCiAgICB0Lmcub25FdmVudCA9IGZ1bmN0aW9uIChhLCBjKSB7DQogICAgICAgIHQubShhKS5wbGF5ZXIubyhjKQ0KICAgIH07DQogICAgdC5nLm9uRXJyb3IgPSBmdW5jdGlvbiAoYSwgYykgew0KICAgICAgICB2YXIgZCA9IHQubShhKS5wbGF5ZXIsDQogICAgICAgICAgICBlID0gIkZMQVNIOiAiICsgYzsNCiAgICAgICAgInNyY25vdGZvdW5kIiA9PSBjID8gZC5lcnJvcih7DQogICAgICAgICAgICBjb2RlOiA0LA0KICAgICAgICAgICAgbWVzc2FnZTogZQ0KICAgICAgICB9KSA6IGQuZXJyb3IoZSkNCiAgICB9Ow0KICAgIHQuZy52ZXJzaW9uID0gZnVuY3Rpb24gKCkgew0KICAgICAgICB2YXIgYSA9ICIwLDAsMCI7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICBhID0gKG5ldyB3aW5kb3cuQWN0aXZlWE9iamVjdCgiU2hvY2t3YXZlRmxhc2guU2hvY2t3YXZlRmxhc2giKSkuR2V0VmFyaWFibGUoIiR2ZXJzaW9uIikucmVwbGFjZSgvXEQrL2csICIsIikubWF0Y2goL14sPyguKyksPyQvKVsxXQ0KICAgICAgICB9IGNhdGNoIChjKSB7DQogICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgIG5hdmlnYXRvci5taW1lVHlwZXNbImFwcGxpY2F0aW9uL3gtc2hvY2t3YXZlLWZsYXNoIl0uZW5hYmxlZFBsdWdpbiAmJiAoYSA9IChuYXZpZ2F0b3IucGx1Z2luc1siU2hvY2t3YXZlIEZsYXNoIDIuMCJdIHx8IG5hdmlnYXRvci5wbHVnaW5zWyJTaG9ja3dhdmUgRmxhc2giXSkuZGVzY3JpcHRpb24ucmVwbGFjZSgvXEQrL2csICIsIikubWF0Y2goL14sPyguKyksPyQvKVsxXSkNCiAgICAgICAgICAgIH0gY2F0Y2ggKGQpIHsgfQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiBhLnNwbGl0KCIsIikNCiAgICB9Ow0KICAgIHQuZy5IYyA9IGZ1bmN0aW9uIChhLCBjLCBkLCBlLCBnKSB7DQogICAgICAgIGEgPSB0LmcuZGUoYSwgZCwgZSwgZyk7DQogICAgICAgIGEgPSB0LmYoImRpdiIsIHsNCiAgICAgICAgICAgIGlubmVySFRNTDogYQ0KICAgICAgICB9KS5jaGlsZE5vZGVzWzBdOw0KICAgICAgICBkID0gYy5wYXJlbnROb2RlOw0KICAgICAgICBjLnBhcmVudE5vZGUucmVwbGFjZUNoaWxkKGEsIGMpOw0KICAgICAgICBhW3QuZXhwYW5kb10gPSBjW3QuZXhwYW5kb107DQogICAgICAgIHZhciBoID0gZC5jaGlsZE5vZGVzWzBdOw0KICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIGguc3R5bGUuZGlzcGxheSA9ICJibG9jayINCiAgICAgICAgfSwgMUUzKTsNCiAgICAgICAgcmV0dXJuIGENCiAgICB9Ow0KICAgIHQuZy5kZSA9IGZ1bmN0aW9uIChhLCBjLCBkLCBlKSB7DQogICAgICAgIHZhciBnID0gIiIsDQogICAgICAgICAgICBoID0gIiIsDQogICAgICAgICAgICBrID0gIiI7DQogICAgICAgIGMgJiYgdC5pLmRhKGMsIGZ1bmN0aW9uIChhLCBjKSB7DQogICAgICAgICAgICBnICs9IGEgKyAiPSIgKyBjICsgIiZhbXA7Ig0KICAgICAgICB9KTsNCiAgICAgICAgZCA9IHQuaS5EKHsNCiAgICAgICAgICAgIG1vdmllOiBhLA0KICAgICAgICAgICAgZmxhc2h2YXJzOiBnLA0KICAgICAgICAgICAgYWxsb3dTY3JpcHRBY2Nlc3M6ICJhbHdheXMiLA0KICAgICAgICAgICAgYWxsb3dOZXR3b3JraW5nOiAiYWxsIg0KICAgICAgICB9LCBkKTsNCiAgICAgICAgdC5pLmRhKGQsIGZ1bmN0aW9uIChhLCBjKSB7DQogICAgICAgICAgICBoICs9ICc8cGFyYW0gbmFtZT0iJyArIGEgKyAnIiB2YWx1ZT0iJyArIGMgKyAnIiAvPicNCiAgICAgICAgfSk7DQogICAgICAgIGUgPSB0LmkuRCh7DQogICAgICAgICAgICBkYXRhOiBhLA0KICAgICAgICAgICAgd2lkdGg6ICIxMDAlIiwNCiAgICAgICAgICAgIGhlaWdodDogIjEwMCUiDQogICAgICAgIH0sIGUpOw0KICAgICAgICB0LmkuZGEoZSwgZnVuY3Rpb24gKGEsIGMpIHsNCiAgICAgICAgICAgIGsgKz0gYSArICc9IicgKyBjICsgJyIgJw0KICAgICAgICB9KTsNCiAgICAgICAgcmV0dXJuICc8b2JqZWN0IHR5cGU9ImFwcGxpY2F0aW9uL3gtc2hvY2t3YXZlLWZsYXNoIiAnICsgayArICI+IiArIGggKyAiPC9vYmplY3Q+Ig0KICAgIH07DQogICAgdC5nLlZlID0gew0KICAgICAgICAicnRtcC9tcDQiOiAiTVA0IiwNCiAgICAgICAgInJ0bXAvZmx2IjogIkZMViINCiAgICB9Ow0KICAgIHQuZy5JZiA9IGZ1bmN0aW9uIChhLCBjKSB7DQogICAgICAgIHJldHVybiBhICsgIiYiICsgYw0KICAgIH07DQogICAgdC5nLlVlID0gZnVuY3Rpb24gKGEpIHsNCiAgICAgICAgdmFyIGMgPSB7DQogICAgICAgICAgICBDYzogIiIsDQogICAgICAgICAgICBuZDogIiINCiAgICAgICAgfTsNCiAgICAgICAgaWYgKCFhKSByZXR1cm4gYzsNCiAgICAgICAgdmFyIGQgPSBhLmluZGV4T2YoIiYiKSwNCiAgICAgICAgICAgIGU7IC0xICE9PSBkID8gZSA9IGQgKyAxIDogKGQgPSBlID0gYS5sYXN0SW5kZXhPZigiLyIpICsgMSwgMCA9PT0gZCAmJiAoZCA9IGUgPSBhLmxlbmd0aCkpOw0KICAgICAgICBjLkNjID0gYS5zdWJzdHJpbmcoMCwgZCk7DQogICAgICAgIGMubmQgPSBhLnN1YnN0cmluZyhlLCBhLmxlbmd0aCk7DQogICAgICAgIHJldHVybiBjDQogICAgfTsNCiAgICB0LmcubmUgPSBmdW5jdGlvbiAoYSkgew0KICAgICAgICByZXR1cm4gYSBpbiB0LmcuVmUNCiAgICB9Ow0KICAgIHQuZy5IZCA9IC9ecnRtcFtzZXRdPzpcL1wvL2k7DQogICAgdC5nLm1lID0gZnVuY3Rpb24gKGEpIHsNCiAgICAgICAgcmV0dXJuIHQuZy5IZC50ZXN0KGEpDQogICAgfTsNCiAgICB0LmcuYmMgPSB7fTsNCiAgICB0LmcuYmMuZmIgPSBmdW5jdGlvbiAoYSkgew0KICAgICAgICByZXR1cm4gdC5nLm5lKGEudHlwZSkgfHwgdC5nLm1lKGEuc3JjKSA/ICJtYXliZSIgOiAiIg0KICAgIH07DQogICAgdC5nLmJjLlViID0gZnVuY3Rpb24gKGEsIGMpIHsNCiAgICAgICAgdmFyIGQgPSB0LmcuVWUoYS5zcmMpOw0KICAgICAgICBjLnNldFJ0bXBDb25uZWN0aW9uKGQuQ2MpOw0KICAgICAgICBjLnNldFJ0bXBTdHJlYW0oZC5uZCkNCiAgICB9Ow0KICAgIHQuZy5UYSh0LmcuYmMpOw0KICAgIHQuR2QgPSB0LmEuZXh0ZW5kKHsNCiAgICAgICAgbDogZnVuY3Rpb24gKGEsIGMsIGQpIHsNCiAgICAgICAgICAgIHQuYS5jYWxsKHRoaXMsIGEsIGMsIGQpOw0KICAgICAgICAgICAgaWYgKCFhLnEuc291cmNlcyB8fCAwID09PSBhLnEuc291cmNlcy5sZW5ndGgpIHsNCiAgICAgICAgICAgICAgICBjID0gMDsNCiAgICAgICAgICAgICAgICBmb3IgKGQgPSBhLnEudGVjaE9yZGVyOyBjIDwgZC5sZW5ndGg7IGMrKykgew0KICAgICAgICAgICAgICAgICAgICB2YXIgZSA9IHQud2EoZFtjXSksDQogICAgICAgICAgICAgICAgICAgICAgICBnID0gd2luZG93LnZpZGVvanNbZV07DQogICAgICAgICAgICAgICAgICAgIGlmIChnICYmIGcuaXNTdXBwb3J0ZWQoKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAga2EoYSwgZSk7DQogICAgICAgICAgICAgICAgICAgICAgICBicmVhaw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSBlbHNlIGEuc3JjKGEucS5zb3VyY2VzKQ0KICAgICAgICB9DQogICAgfSk7DQogICAgdC5zYyA9IHsNCiAgICAgICAgZGlzYWJsZWQ6ICJkaXNhYmxlZCIsDQogICAgICAgIGhpZGRlbjogImhpZGRlbiIsDQogICAgICAgIHNob3dpbmc6ICJzaG93aW5nIg0KICAgIH07DQogICAgdC5JZCA9IHsNCiAgICAgICAgc3VidGl0bGVzOiAic3VidGl0bGVzIiwNCiAgICAgICAgY2FwdGlvbnM6ICJjYXB0aW9ucyIsDQogICAgICAgIGRlc2NyaXB0aW9uczogImRlc2NyaXB0aW9ucyIsDQogICAgICAgIGNoYXB0ZXJzOiAiY2hhcHRlcnMiLA0KICAgICAgICBtZXRhZGF0YTogIm1ldGFkYXRhIg0KICAgIH07DQogICAgdC50ID0gZnVuY3Rpb24gKGEpIHsNCiAgICAgICAgdmFyIGMsIGQsIGUsIGcsIGgsIGssIHEsIHIsIHUsIEEsIFI7DQogICAgICAgIGEgPSBhIHx8IHt9Ow0KICAgICAgICBpZiAoIWEucGxheWVyKSB0aHJvdyBFcnJvcigiQSBwbGF5ZXIgd2FzIG5vdCBwcm92aWRlZC4iKTsNCiAgICAgICAgYyA9IHRoaXM7DQogICAgICAgIGlmICh0LnFhKQ0KICAgICAgICAgICAgZm9yIChSIGluIGMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJjdXN0b20iKSwgdC50LnByb3RvdHlwZSkgY1tSXSA9IHQudC5wcm90b3R5cGVbUl07DQogICAgICAgIGMuZCA9IGEucGxheWVyOw0KICAgICAgICBlID0gdC5zY1thLm1vZGVdIHx8ICJkaXNhYmxlZCI7DQogICAgICAgIGcgPSB0LklkW2Eua2luZF0gfHwgInN1YnRpdGxlcyI7DQogICAgICAgIGggPSBhLmxhYmVsIHx8ICIiOw0KICAgICAgICBrID0gYS5sYW5ndWFnZSB8fCBhLnNyY2xhbmcgfHwgIiI7DQogICAgICAgIGQgPSBhLmlkIHx8ICJ2anNfdGV4dF90cmFja18iICsgdC5zKys7DQogICAgICAgIGlmICgibWV0YWRhdGEiID09PSBnIHx8ICJjaGFwdGVycyIgPT09IGcpIGUgPSAiaGlkZGVuIjsNCiAgICAgICAgYy5YID0gW107DQogICAgICAgIGMuSmEgPSBbXTsNCiAgICAgICAgcSA9IG5ldyB0LlcoYy5YKTsNCiAgICAgICAgciA9IG5ldyB0LlcoYy5KYSk7DQogICAgICAgIEEgPSBsOw0KICAgICAgICB1ID0gdC5iaW5kKGMsIGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIHRoaXMuYWN0aXZlQ3VlczsNCiAgICAgICAgICAgIEEgJiYgKHRoaXMudHJpZ2dlcigiY3VlY2hhbmdlIiksDQogICAgICAgICAgICAgICAgQSA9IGwpDQogICAgICAgIH0pOw0KICAgICAgICAiZGlzYWJsZWQiICE9PSBlICYmIGMuZC5iKCJ0aW1ldXBkYXRlIiwgdSk7DQogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShjLCAia2luZCIsIHsNCiAgICAgICAgICAgIGdldDogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgIHJldHVybiBnDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgc2V0OiBGdW5jdGlvbi5wcm90b3R5cGUNCiAgICAgICAgfSk7DQogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShjLCAibGFiZWwiLCB7DQogICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gaA0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIHNldDogRnVuY3Rpb24ucHJvdG90eXBlDQogICAgICAgIH0pOw0KICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoYywgImxhbmd1YWdlIiwgew0KICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGsNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBzZXQ6IEZ1bmN0aW9uLnByb3RvdHlwZQ0KICAgICAgICB9KTsNCiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGMsICJpZCIsIHsNCiAgICAgICAgICAgIGdldDogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgIHJldHVybiBkDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgc2V0OiBGdW5jdGlvbi5wcm90b3R5cGUNCiAgICAgICAgfSk7DQogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShjLCAibW9kZSIsIHsNCiAgICAgICAgICAgIGdldDogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgIHJldHVybiBlDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgc2V0OiBmdW5jdGlvbiAoYSkgew0KICAgICAgICAgICAgICAgIHQuc2NbYV0gJiYgKGUgPSBhLCAic2hvd2luZyIgPT09IGUgJiYgdGhpcy5kLmIoInRpbWV1cGRhdGUiLCB1KSwNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5vKCJtb2RlY2hhbmdlIikpDQogICAgICAgICAgICB9DQogICAgICAgIH0pOw0KICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoYywgImN1ZXMiLCB7DQogICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gIXRoaXMuWWIgPyBqIDogcQ0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIHNldDogRnVuY3Rpb24ucHJvdG90eXBlDQogICAgICAgIH0pOw0KICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoYywgImFjdGl2ZUN1ZXMiLCB7DQogICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICB2YXIgYSwgYywgZCwgZSwgZzsNCiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuWWIpIHJldHVybiBqOw0KICAgICAgICAgICAgICAgIGlmICgwID09PSB0aGlzLmN1ZXMubGVuZ3RoKSByZXR1cm4gcjsNCiAgICAgICAgICAgICAgICBlID0gdGhpcy5kLmN1cnJlbnRUaW1lKCk7DQogICAgICAgICAgICAgICAgYSA9IDA7DQogICAgICAgICAgICAgICAgYyA9IHRoaXMuY3Vlcy5sZW5ndGg7DQogICAgICAgICAgICAgICAgZm9yIChkID0gW107IGEgPCBjOyBhKyspIGcgPSB0aGlzLmN1ZXNbYV0sIGcuc3RhcnRUaW1lIDw9IGUgJiYgZy5lbmRUaW1lID49IGUgPyBkLnB1c2goZykgOiBnLnN0YXJ0VGltZSA9PT0gZy5lbmRUaW1lICYmIChnLnN0YXJ0VGltZSA8PSBlICYmIGcuc3RhcnRUaW1lICsgMC41ID49IGUpICYmIGQucHVzaChnKTsNCiAgICAgICAgICAgICAgICBBID0gbDsNCiAgICAgICAgICAgICAgICBpZiAoZC5sZW5ndGggIT09IHRoaXMuSmEubGVuZ3RoKSBBID0gZjsNCiAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgIGZvciAoYSA9IDA7IGEgPCBkLmxlbmd0aDsgYSsrKSAtMSA9PT0geGEuY2FsbCh0aGlzLkphLA0KICAgICAgICAgICAgICAgICAgICAgICAgZFthXSkgJiYgKEEgPSBmKTsNCiAgICAgICAgICAgICAgICB0aGlzLkphID0gZDsNCiAgICAgICAgICAgICAgICByLnNiKHRoaXMuSmEpOw0KICAgICAgICAgICAgICAgIHJldHVybiByDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgc2V0OiBGdW5jdGlvbi5wcm90b3R5cGUNCiAgICAgICAgfSk7DQogICAgICAgIGEuc3JjID8geWEoYS5zcmMsIGMpIDogYy5ZYiA9IGY7DQogICAgICAgIGlmICh0LnFhKSByZXR1cm4gYw0KICAgIH07DQogICAgdC50LnByb3RvdHlwZSA9IHQuaS5jcmVhdGUodC56LnByb3RvdHlwZSk7DQogICAgdC50LnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IHQudDsNCiAgICB0LnQucHJvdG90eXBlLmNiID0gew0KICAgICAgICBjdWVjaGFuZ2U6ICJjdWVjaGFuZ2UiDQogICAgfTsNCiAgICB0LnQucHJvdG90eXBlLndjID0gZnVuY3Rpb24gKGEpIHsNCiAgICAgICAgdmFyIGMgPSB0aGlzLmQudGV4dFRyYWNrcygpLA0KICAgICAgICAgICAgZCA9IDA7DQogICAgICAgIGlmIChjKQ0KICAgICAgICAgICAgZm9yICg7IGQgPCBjLmxlbmd0aDsgZCsrKSBjW2RdICE9PSB0aGlzICYmIGNbZF0uYmQoYSk7DQogICAgICAgIHRoaXMuWC5wdXNoKGEpOw0KICAgICAgICB0aGlzLmN1ZXMuc2IodGhpcy5YKQ0KICAgIH07DQogICAgdC50LnByb3RvdHlwZS5iZCA9IGZ1bmN0aW9uIChhKSB7DQogICAgICAgIGZvciAodmFyIGMgPSAwLCBkID0gdGhpcy5YLmxlbmd0aCwgZSwgZyA9IGw7IGMgPCBkOyBjKyspIGUgPSB0aGlzLlhbY10sIGUgPT09IGEgJiYgKHRoaXMuWC5zcGxpY2UoYywgMSksIGcgPSBmKTsNCiAgICAgICAgZyAmJiB0aGlzLkVjLnNiKHRoaXMuWCkNCiAgICB9Ow0KICAgIHZhciB5YSwgViwgeGE7DQogICAgeWEgPSBmdW5jdGlvbiAoYSwgYykgew0KICAgICAgICB0LmdmKGEsIHQuYmluZCh0aGlzLCBmdW5jdGlvbiAoYSwgZSwgZykgew0KICAgICAgICAgICAgaWYgKGEpIHJldHVybiB0LmxvZy5lcnJvcihhKTsNCiAgICAgICAgICAgIGMuWWIgPSBmOw0KICAgICAgICAgICAgVihnLCBjKQ0KICAgICAgICB9KSkNCiAgICB9Ow0KICAgIFYgPSBmdW5jdGlvbiAoYSwgYykgew0KICAgICAgICBpZiAoImZ1bmN0aW9uIiAhPT0gdHlwZW9mIHdpbmRvdy5XZWJWVFQpIHdpbmRvdy5zZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIFYoYSwgYykNCiAgICAgICAgfSwgMjUpOw0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIHZhciBkID0gbmV3IHdpbmRvdy5XZWJWVFQuUGFyc2VyKHdpbmRvdywgd2luZG93LnZ0dGpzLCB3aW5kb3cuV2ViVlRULlN0cmluZ0RlY29kZXIoKSk7DQogICAgICAgICAgICBkLm9uY3VlID0gZnVuY3Rpb24gKGEpIHsNCiAgICAgICAgICAgICAgICBjLndjKGEpDQogICAgICAgICAgICB9Ow0KICAgICAgICAgICAgZC5vbnBhcnNpbmdlcnJvciA9IGZ1bmN0aW9uIChhKSB7DQogICAgICAgICAgICAgICAgdC5sb2cuZXJyb3IoYSkNCiAgICAgICAgICAgIH07DQogICAgICAgICAgICBkLnBhcnNlKGEpOw0KICAgICAgICAgICAgZC5mbHVzaCgpDQogICAgICAgIH0NCiAgICB9Ow0KICAgIHhhID0gZnVuY3Rpb24gKGEsIGMpIHsNCiAgICAgICAgdmFyIGQ7DQogICAgICAgIGlmICh0aGlzID09IGopIHRocm93IG5ldyBUeXBlRXJyb3IoJyJ0aGlzIiBpcyBudWxsIG9yIG5vdCBkZWZpbmVkJyk7DQogICAgICAgIHZhciBlID0gT2JqZWN0KHRoaXMpLA0KICAgICAgICAgICAgZyA9IGUubGVuZ3RoID4+PiAwOw0KICAgICAgICBpZiAoMCA9PT0gZykgcmV0dXJuIC0xOw0KICAgICAgICBkID0gK2MgfHwgMDsNCiAgICAgICAgSW5maW5pdHkgPT09IE1hdGguYWJzKGQpICYmIChkID0gMCk7DQogICAgICAgIGlmIChkID49IGcpIHJldHVybiAtMTsNCiAgICAgICAgZm9yIChkID0gTWF0aC5tYXgoMCA8PSBkID8gZCA6IGcgLSBNYXRoLmFicyhkKSwgMCkgOyBkIDwgZzspIHsNCiAgICAgICAgICAgIGlmIChkIGluIGUgJiYgZVtkXSA9PT0gYSkgcmV0dXJuIGQ7DQogICAgICAgICAgICBkKysNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gLTENCiAgICB9Ow0KICAgIHQuRiA9IGZ1bmN0aW9uIChhKSB7DQogICAgICAgIHZhciBjID0gdGhpcywNCiAgICAgICAgICAgIGQsIGUgPSAwOw0KICAgICAgICBpZiAodC5xYSkNCiAgICAgICAgICAgIGZvciAoZCBpbiBjID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiY3VzdG9tIiksIHQuRi5wcm90b3R5cGUpIGNbZF0gPSB0LkYucHJvdG90eXBlW2RdOw0KICAgICAgICBhID0gYSB8fCBbXTsNCiAgICAgICAgYy5XYSA9IFtdOw0KICAgICAgICBmb3IgKE9iamVjdC5kZWZpbmVQcm9wZXJ0eShjLCAibGVuZ3RoIiwgew0KICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLldhLmxlbmd0aA0KICAgICAgICB9DQogICAgICAgIH0pIDsgZSA8IGEubGVuZ3RoOyBlKyspIFAoYywgYVtlXSk7DQogICAgICAgIGlmICh0LnFhKSByZXR1cm4gYw0KICAgIH07DQogICAgdC5GLnByb3RvdHlwZSA9IHQuaS5jcmVhdGUodC56LnByb3RvdHlwZSk7DQogICAgdC5GLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IHQuRjsNCiAgICB0LkYucHJvdG90eXBlLmNiID0gew0KICAgICAgICBjaGFuZ2U6ICJjaGFuZ2UiLA0KICAgICAgICBhZGR0cmFjazogImFkZHRyYWNrIiwNCiAgICAgICAgcmVtb3ZldHJhY2s6ICJyZW1vdmV0cmFjayINCiAgICB9Ow0KICAgIGZvciAodmFyIHphIGluIHQuRi5wcm90b3R5cGUuY2IpIHQuRi5wcm90b3R5cGVbIm9uIiArIHphXSA9IGo7DQoNCiAgICBmdW5jdGlvbiBQKGEsIGMpIHsNCiAgICAgICAgdmFyIGQgPSBhLldhLmxlbmd0aDsNCiAgICAgICAgIiIgKyBkIGluIGEgfHwgT2JqZWN0LmRlZmluZVByb3BlcnR5KGEsIGQsIHsNCiAgICAgICAgICAgIGdldDogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLldhW2RdDQogICAgICAgICAgICB9DQogICAgICAgIH0pOw0KICAgICAgICBjLmFkZEV2ZW50TGlzdGVuZXIoIm1vZGVjaGFuZ2UiLCB0LmJpbmQoYSwgZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgdGhpcy5vKCJjaGFuZ2UiKQ0KICAgICAgICB9KSk7DQogICAgICAgIGEuV2EucHVzaChjKTsNCiAgICAgICAgYS5vKHsNCiAgICAgICAgICAgIHR5cGU6ICJhZGR0cmFjayIsDQogICAgICAgICAgICBUOiBjDQogICAgICAgIH0pDQogICAgfQ0KDQogICAgZnVuY3Rpb24gUShhLCBjKSB7DQogICAgICAgIGZvciAodmFyIGQgPSAwLCBlID0gYS5sZW5ndGgsIGc7IGQgPCBlOyBkKyspDQogICAgICAgICAgICBpZiAoZyA9IGFbZF0sIGcgPT09IGMpIHsNCiAgICAgICAgICAgICAgICBhLldhLnNwbGljZShkLCAxKTsNCiAgICAgICAgICAgICAgICBicmVhaw0KICAgICAgICAgICAgfQ0KICAgICAgICBhLm8oew0KICAgICAgICAgICAgdHlwZTogInJlbW92ZXRyYWNrIiwNCiAgICAgICAgICAgIFQ6IGMNCiAgICAgICAgfSkNCiAgICB9DQogICAgdC5GLnByb3RvdHlwZS5lZSA9IGZ1bmN0aW9uIChhKSB7DQogICAgICAgIGZvciAodmFyIGMgPSAwLCBkID0gdGhpcy5sZW5ndGgsIGUgPSBqLCBnOyBjIDwgZDsgYysrKQ0KICAgICAgICAgICAgaWYgKGcgPSB0aGlzW2NdLCBnLmlkID09PSBhKSB7DQogICAgICAgICAgICAgICAgZSA9IGc7DQogICAgICAgICAgICAgICAgYnJlYWsNCiAgICAgICAgICAgIH0NCiAgICAgICAgcmV0dXJuIGUNCiAgICB9Ow0KICAgIHQuVyA9IGZ1bmN0aW9uIChhKSB7DQogICAgICAgIHZhciBjID0gdGhpcywNCiAgICAgICAgICAgIGQ7DQogICAgICAgIGlmICh0LnFhKQ0KICAgICAgICAgICAgZm9yIChkIGluIGMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJjdXN0b20iKSwgdC5XLnByb3RvdHlwZSkgY1tkXSA9IHQuVy5wcm90b3R5cGVbZF07DQogICAgICAgIHQuVy5wcm90b3R5cGUuc2IuY2FsbChjLCBhKTsNCiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGMsICJsZW5ndGgiLCB7DQogICAgICAgICAgICBnZXQ6IG4oInFlIikNCiAgICAgICAgfSk7DQogICAgICAgIGlmICh0LnFhKSByZXR1cm4gYw0KICAgIH07DQogICAgdC5XLnByb3RvdHlwZS5zYiA9IGZ1bmN0aW9uIChhKSB7DQogICAgICAgIHZhciBjID0gdGhpcy5sZW5ndGggfHwgMCwNCiAgICAgICAgICAgIGQgPSAwLA0KICAgICAgICAgICAgZSA9IGEubGVuZ3RoOw0KICAgICAgICB0aGlzLlggPSBhOw0KICAgICAgICB0aGlzLnFlID0gYS5sZW5ndGg7DQogICAgICAgIGEgPSBmdW5jdGlvbiAoYSkgew0KICAgICAgICAgICAgIiIgKyBhIGluIHRoaXMgfHwgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsICIiICsgYSwgew0KICAgICAgICAgICAgICAgIGdldDogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5YW2FdDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSkNCiAgICAgICAgfTsNCiAgICAgICAgaWYgKGMgPCBlKQ0KICAgICAgICAgICAgZm9yIChkID0gYzsgZCA8IGU7IGQrKykgYS5jYWxsKHRoaXMsIGQpDQogICAgfTsNCiAgICB0LlcucHJvdG90eXBlLmNlID0gZnVuY3Rpb24gKGEpIHsNCiAgICAgICAgZm9yICh2YXIgYyA9IDAsIGQgPSB0aGlzLmxlbmd0aCwgZSA9IGosIGc7IGMgPCBkOyBjKyspDQogICAgICAgICAgICBpZiAoZyA9IHRoaXNbY10sIGcuaWQgPT09IGEpIHsNCiAgICAgICAgICAgICAgICBlID0gZzsNCiAgICAgICAgICAgICAgICBicmVhaw0KICAgICAgICAgICAgfQ0KICAgICAgICByZXR1cm4gZQ0KICAgIH07DQogICAgdC50YSA9IHQuYS5leHRlbmQoew0KICAgICAgICBsOiBmdW5jdGlvbiAoYSwgYywgZCkgew0KICAgICAgICAgICAgdC5hLmNhbGwodGhpcywgYSwgYywgZCk7DQogICAgICAgICAgICBhLmIoImxvYWRzdGFydCIsIHQuYmluZCh0aGlzLCB0aGlzLiRlKSk7DQogICAgICAgICAgICBhLkkodC5iaW5kKHRoaXMsIGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICBpZiAoYS5oICYmIGEuaC5mZWF0dXJlc05hdGl2ZVRleHRUcmFja3MpIHRoaXMuWSgpOw0KICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICB2YXIgYywgZCwgaDsNCiAgICAgICAgICAgICAgICAgICAgYS5iKCJmdWxsc2NyZWVuY2hhbmdlIiwgdC5iaW5kKHRoaXMsIHRoaXMuQykpOw0KICAgICAgICAgICAgICAgICAgICBkID0gYS5xLnRyYWNrcyB8fCBbXTsNCiAgICAgICAgICAgICAgICAgICAgZm9yIChjID0gMDsgYyA8IGQubGVuZ3RoOyBjKyspIGggPSBkW2NdLCB0aGlzLmQuaWEoaCkNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KSkNCiAgICAgICAgfQ0KICAgIH0pOw0KICAgIHQudGEucHJvdG90eXBlLiRlID0gZnVuY3Rpb24gKCkgew0KICAgICAgICB0aGlzLmQuaCAmJiB0aGlzLmQuaC5mZWF0dXJlc05hdGl2ZVRleHRUcmFja3MgPyB0aGlzLlkoKSA6IHRoaXMuc2hvdygpDQogICAgfTsNCiAgICB0LnRhLnByb3RvdHlwZS5mID0gZnVuY3Rpb24gKCkgew0KICAgICAgICByZXR1cm4gdC5hLnByb3RvdHlwZS5mLmNhbGwodGhpcywgImRpdiIsIHsNCiAgICAgICAgICAgIGNsYXNzTmFtZTogInZqcy10ZXh0LXRyYWNrLWRpc3BsYXkiDQogICAgICAgIH0pDQogICAgfTsNCiAgICB0LnRhLnByb3RvdHlwZS5RZCA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgImZ1bmN0aW9uIiA9PT0gdHlwZW9mIHdpbmRvdy5XZWJWVFQgJiYgd2luZG93LldlYlZUVC5wcm9jZXNzQ3Vlcyh3aW5kb3csIFtdLCB0aGlzLmMpDQogICAgfTsNCg0KICAgIGZ1bmN0aW9uIFcoYSwgYykgew0KICAgICAgICByZXR1cm4gInJnYmEoIiArIHBhcnNlSW50KGFbMV0gKyBhWzFdLCAxNikgKyAiLCIgKyBwYXJzZUludChhWzJdICsgYVsyXSwgMTYpICsgIiwiICsgcGFyc2VJbnQoYVszXSArIGFbM10sIDE2KSArICIsIiArIGMgKyAiKSINCiAgICB9DQogICAgdmFyIEFhID0gew0KICAgICAgICB5ZjogIm1vbm9zcGFjZSIsDQogICAgICAgIEVmOiAic2Fucy1zZXJpZiIsDQogICAgICAgIEdmOiAic2VyaWYiLA0KICAgICAgICB6ZjogJyJBbmRhbGUgTW9ubyIsICJMdWNpZGEgQ29uc29sZSIsIG1vbm9zcGFjZScsDQogICAgICAgIEFmOiAnIkNvdXJpZXIgTmV3IiwgbW9ub3NwYWNlJywNCiAgICAgICAgQ2Y6ICJzYW5zLXNlcmlmIiwNCiAgICAgICAgRGY6ICJzZXJpZiIsDQogICAgICAgIHBmOiAnIkNvbWljIFNhbnMgTVMiLCBJbXBhY3QsIGZhbnRhc3knLA0KICAgICAgICBGZjogJyJNb25vdHlwZSBDb3JzaXZhIiwgY3Vyc2l2ZScsDQogICAgICAgIEhmOiAnIkFuZGFsZSBNb25vIiwgIkx1Y2lkYSBDb25zb2xlIiwgbW9ub3NwYWNlLCBzYW5zLXNlcmlmJw0KICAgIH07DQogICAgdC50YS5wcm90b3R5cGUuQyA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgdmFyIGEgPSB0aGlzLmQudGV4dFRyYWNrcygpLA0KICAgICAgICAgICAgYyA9IDAsDQogICAgICAgICAgICBkOw0KICAgICAgICB0aGlzLlFkKCk7DQogICAgICAgIGlmIChhKQ0KICAgICAgICAgICAgZm9yICg7IGMgPCBhLmxlbmd0aDsgYysrKSBkID0gYVtjXSwgInNob3dpbmciID09PSBkLm1vZGUgJiYgdGhpcy5kZihkKQ0KICAgIH07DQogICAgdC50YS5wcm90b3R5cGUuZGYgPSBmdW5jdGlvbiAoYSkgew0KICAgICAgICBpZiAoImZ1bmN0aW9uIiA9PT0gdHlwZW9mIHdpbmRvdy5XZWJWVFQgJiYgYS5hY3RpdmVDdWVzKSB7DQogICAgICAgICAgICBmb3IgKHZhciBjID0gMCwgZCA9IHRoaXMuZC50ZXh0VHJhY2tTZXR0aW5ncy5MYygpLCBlLCBnID0gW107IGMgPCBhLmFjdGl2ZUN1ZXMubGVuZ3RoOyBjKyspIGcucHVzaChhLmFjdGl2ZUN1ZXNbY10pOw0KICAgICAgICAgICAgd2luZG93LldlYlZUVC5wcm9jZXNzQ3Vlcyh3aW5kb3csIGEuYWN0aXZlQ3VlcywgdGhpcy5jKTsNCiAgICAgICAgICAgIGZvciAoYyA9IGcubGVuZ3RoOyBjLS07KSB7DQogICAgICAgICAgICAgICAgYSA9IGdbY10ucWY7DQogICAgICAgICAgICAgICAgZC5jb2xvciAmJiAoYS5maXJzdENoaWxkLnN0eWxlLmNvbG9yID0gZC5jb2xvcik7DQogICAgICAgICAgICAgICAgaWYgKGQub2QpIHRyeSB7DQogICAgICAgICAgICAgICAgICAgIGEuZmlyc3RDaGlsZC5zdHlsZS5jb2xvciA9IFcoZC5jb2xvciB8fCAiI2ZmZiIsIGQub2QpDQogICAgICAgICAgICAgICAgfSBjYXRjaCAoaCkgeyB9DQogICAgICAgICAgICAgICAgZC5iYWNrZ3JvdW5kQ29sb3IgJiYgKGEuZmlyc3RDaGlsZC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBkLmJhY2tncm91bmRDb2xvcik7DQogICAgICAgICAgICAgICAgaWYgKGQuemMpIHRyeSB7DQogICAgICAgICAgICAgICAgICAgIGEuZmlyc3RDaGlsZC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPQ0KICAgICAgICAgICAgICAgICAgICAgICAgVyhkLmJhY2tncm91bmRDb2xvciB8fCAiIzAwMCIsIGQuemMpDQogICAgICAgICAgICAgICAgfSBjYXRjaCAoaykgeyB9DQogICAgICAgICAgICAgICAgaWYgKGQuZ2MpDQogICAgICAgICAgICAgICAgICAgIGlmIChkLnZkKSB0cnkgew0KICAgICAgICAgICAgICAgICAgICAgICAgYS5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBXKGQuZ2MsIGQudmQpDQogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKHEpIHsgfSBlbHNlIGEuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gZC5nYzsNCiAgICAgICAgICAgICAgICBkLk5hICYmICgiZHJvcHNoYWRvdyIgPT09IGQuTmEgPyBhLmZpcnN0Q2hpbGQuc3R5bGUudGV4dFNoYWRvdyA9ICIycHggMnB4IDNweCAjMjIyLCAycHggMnB4IDRweCAjMjIyLCAycHggMnB4IDVweCAjMjIyIiA6ICJyYWlzZWQiID09PSBkLk5hID8gYS5maXJzdENoaWxkLnN0eWxlLnRleHRTaGFkb3cgPSAiMXB4IDFweCAjMjIyLCAycHggMnB4ICMyMjIsIDNweCAzcHggIzIyMiIgOiAiZGVwcmVzc2VkIiA9PT0gZC5OYSA/IGEuZmlyc3RDaGlsZC5zdHlsZS50ZXh0U2hhZG93ID0gIjFweCAxcHggI2NjYywgMCAxcHggI2NjYywgLTFweCAtMXB4ICMyMjIsIDAgLTFweCAjMjIyIiA6ICJ1bmlmb3JtIiA9PT0gZC5OYSAmJiAoYS5maXJzdENoaWxkLnN0eWxlLnRleHRTaGFkb3cgPSAiMCAwIDRweCAjMjIyLCAwIDAgNHB4ICMyMjIsIDAgMCA0cHggIzIyMiwgMCAwIDRweCAjMjIyIikpOw0KICAgICAgICAgICAgICAgIGQuUmIgJiYgMSAhPT0gZC5SYiAmJiAoZSA9IHdpbmRvdy5CZihhLnN0eWxlLmZvbnRTaXplKSwgYS5zdHlsZS5mb250U2l6ZSA9IGUgKiBkLlJiICsgInB4IiwgYS5zdHlsZS5oZWlnaHQgPSAiYXV0byIsIGEuc3R5bGUudG9wID0gImF1dG8iLCBhLnN0eWxlLmJvdHRvbSA9ICIycHgiKTsNCiAgICAgICAgICAgICAgICBkLmZvbnRGYW1pbHkgJiYgImRlZmF1bHQiICE9PSBkLmZvbnRGYW1pbHkgJiYgKCJzbWFsbC1jYXBzIiA9PT0gZC5mb250RmFtaWx5ID8gYS5maXJzdENoaWxkLnN0eWxlLmZvbnRWYXJpYW50ID0gInNtYWxsLWNhcHMiIDogYS5maXJzdENoaWxkLnN0eWxlLmZvbnRGYW1pbHkgPSBBYVtkLmZvbnRGYW1pbHldKQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfTsNCiAgICB0LmFhID0gdC5NLmV4dGVuZCh7DQogICAgICAgIGw6IGZ1bmN0aW9uIChhLCBjKSB7DQogICAgICAgICAgICB2YXIgZCA9IHRoaXMuVCA9IGMudHJhY2ssDQogICAgICAgICAgICAgICAgZSA9IGEudGV4dFRyYWNrcygpLA0KICAgICAgICAgICAgICAgIGcsIGg7DQogICAgICAgICAgICBlICYmIChnID0gdC5iaW5kKHRoaXMsIGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICB2YXIgYSA9ICJzaG93aW5nIiA9PT0gdGhpcy5ULm1vZGUsDQogICAgICAgICAgICAgICAgICAgIGMsIGQsIGc7DQogICAgICAgICAgICAgICAgaWYgKHRoaXMgaW5zdGFuY2VvZiB0LkNiKSB7DQogICAgICAgICAgICAgICAgICAgIGEgPSBmOw0KICAgICAgICAgICAgICAgICAgICBkID0gMDsNCiAgICAgICAgICAgICAgICAgICAgZm9yIChnID0gZS5sZW5ndGg7IGQgPCBnOyBkKyspDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoYyA9IGVbZF0sIGMua2luZCA9PT0gdGhpcy5ULmtpbmQgJiYgInNob3dpbmciID09PSBjLm1vZGUpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhID0gbDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkKGEpDQogICAgICAgICAgICB9KSwgZS5hZGRFdmVudExpc3RlbmVyKCJjaGFuZ2UiLCBnKSwgYS5iKCJkaXNwb3NlIiwgZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgIGUucmVtb3ZlRXZlbnRMaXN0ZW5lcigiY2hhbmdlIiwgZykNCiAgICAgICAgICAgIH0pKTsNCiAgICAgICAgICAgIGMubGFiZWwgPSBkLmxhYmVsIHx8IGQubGFuZ3VhZ2UgfHwgIlVua25vd24iOw0KICAgICAgICAgICAgYy5zZWxlY3RlZCA9IGRbImRlZmF1bHQiXSB8fCAic2hvd2luZyIgPT09IGQubW9kZTsNCiAgICAgICAgICAgIHQuTS5jYWxsKHRoaXMsIGEsIGMpOw0KICAgICAgICAgICAgZSAmJiBlLm9uY2hhbmdlID09PSBiICYmIHRoaXMuYihbInRhcCIsDQogICAgICAgICAgICAgICAgImNsaWNrIg0KICAgICAgICAgICAgXSwgZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgIGlmICgib2JqZWN0IiAhPT0gdHlwZW9mIHdpbmRvdy56ZCkgdHJ5IHsNCiAgICAgICAgICAgICAgICAgICAgaCA9IG5ldyB3aW5kb3cuemQoImNoYW5nZSIpDQogICAgICAgICAgICAgICAgfSBjYXRjaCAoYSkgeyB9DQogICAgICAgICAgICAgICAgaCB8fCAoaCA9IGRvY3VtZW50LmNyZWF0ZUV2ZW50KCJFdmVudCIpLCBoLmluaXRFdmVudCgiY2hhbmdlIiwgZiwgZikpOw0KICAgICAgICAgICAgICAgIGUuZGlzcGF0Y2hFdmVudChoKQ0KICAgICAgICAgICAgfSkNCiAgICAgICAgfQ0KICAgIH0pOw0KICAgIHQuYWEucHJvdG90eXBlLnUgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHZhciBhID0gdGhpcy5ULmtpbmQsDQogICAgICAgICAgICBjID0gdGhpcy5kLnRleHRUcmFja3MoKSwNCiAgICAgICAgICAgIGQsIGUgPSAwOw0KICAgICAgICB0Lk0ucHJvdG90eXBlLnUuY2FsbCh0aGlzKTsNCiAgICAgICAgaWYgKGMpDQogICAgICAgICAgICBmb3IgKDsgZSA8IGMubGVuZ3RoOyBlKyspIGQgPSBjW2VdLCBkLmtpbmQgPT09IGEgJiYgKGQubW9kZSA9IGQgPT09IHRoaXMuVCA/ICJzaG93aW5nIiA6ICJkaXNhYmxlZCIpDQogICAgfTsNCiAgICB0LkNiID0gdC5hYS5leHRlbmQoew0KICAgICAgICBsOiBmdW5jdGlvbiAoYSwgYykgew0KICAgICAgICAgICAgYy50cmFjayA9IHsNCiAgICAgICAgICAgICAgICBraW5kOiBjLmtpbmQsDQogICAgICAgICAgICAgICAgcGxheWVyOiBhLA0KICAgICAgICAgICAgICAgIGxhYmVsOiBjLmtpbmQgKyAiIG9mZiIsDQogICAgICAgICAgICAgICAgImRlZmF1bHQiOiBsLA0KICAgICAgICAgICAgICAgIG1vZGU6ICJkaXNhYmxlZCINCiAgICAgICAgICAgIH07DQogICAgICAgICAgICB0LmFhLmNhbGwodGhpcywgYSwgYyk7DQogICAgICAgICAgICB0aGlzLnNlbGVjdGVkKGYpDQogICAgICAgIH0NCiAgICB9KTsNCiAgICB0LnZiID0gdC5hYS5leHRlbmQoew0KICAgICAgICBsOiBmdW5jdGlvbiAoYSwgYykgew0KICAgICAgICAgICAgYy50cmFjayA9IHsNCiAgICAgICAgICAgICAgICBraW5kOiBjLmtpbmQsDQogICAgICAgICAgICAgICAgcGxheWVyOiBhLA0KICAgICAgICAgICAgICAgIGxhYmVsOiBjLmtpbmQgKyAiIHNldHRpbmdzIiwNCiAgICAgICAgICAgICAgICAiZGVmYXVsdCI6IGwsDQogICAgICAgICAgICAgICAgbW9kZTogImRpc2FibGVkIg0KICAgICAgICAgICAgfTsNCiAgICAgICAgICAgIHQuYWEuY2FsbCh0aGlzLCBhLCBjKTsNCiAgICAgICAgICAgIHRoaXMucCgidmpzLXRleHR0cmFjay1zZXR0aW5ncyIpDQogICAgICAgIH0NCiAgICB9KTsNCiAgICB0LnZiLnByb3RvdHlwZS51ID0gZnVuY3Rpb24gKCkgew0KICAgICAgICB0aGlzLmsoKS5lYSgidGV4dFRyYWNrU2V0dGluZ3MiKS5zaG93KCkNCiAgICB9Ow0KICAgIHQuUSA9IHQuTy5leHRlbmQoew0KICAgICAgICBsOiBmdW5jdGlvbiAoYSwgYykgew0KICAgICAgICAgICAgdmFyIGQsIGU7DQogICAgICAgICAgICB0Lk8uY2FsbCh0aGlzLCBhLCBjKTsNCiAgICAgICAgICAgIGQgPSB0aGlzLmQudGV4dFRyYWNrcygpOw0KICAgICAgICAgICAgMSA+PSB0aGlzLkgubGVuZ3RoICYmIHRoaXMuWSgpOw0KICAgICAgICAgICAgZCAmJiAoZSA9IHQuYmluZCh0aGlzLCB0aGlzLnVwZGF0ZSksIGQuYWRkRXZlbnRMaXN0ZW5lcigicmVtb3ZldHJhY2siLCBlKSwgZC5hZGRFdmVudExpc3RlbmVyKCJhZGR0cmFjayIsIGUpLCB0aGlzLmQuYigiZGlzcG9zZSIsIGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICBkLnJlbW92ZUV2ZW50TGlzdGVuZXIoInJlbW92ZXRyYWNrIiwgZSk7DQogICAgICAgICAgICAgICAgZC5yZW1vdmVFdmVudExpc3RlbmVyKCJhZGR0cmFjayIsIGUpDQogICAgICAgICAgICB9KSkNCiAgICAgICAgfQ0KICAgIH0pOw0KICAgIHQuUS5wcm90b3R5cGUuTGEgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHZhciBhID0gW10sDQogICAgICAgICAgICBjLCBkOw0KICAgICAgICB0aGlzIGluc3RhbmNlb2YgdC5wYSAmJiAoIXRoaXMuaygpLmggfHwgIXRoaXMuaygpLmguZmVhdHVyZXNOYXRpdmVUZXh0VHJhY2tzKSAmJiBhLnB1c2gobmV3IHQudmIodGhpcy5kLCB7DQogICAgICAgICAgICBraW5kOiB0aGlzLmZhDQogICAgICAgIH0pKTsNCiAgICAgICAgYS5wdXNoKG5ldyB0LkNiKHRoaXMuZCwgew0KICAgICAgICAgICAga2luZDogdGhpcy5mYQ0KICAgICAgICB9KSk7DQogICAgICAgIGQgPSB0aGlzLmQudGV4dFRyYWNrcygpOw0KICAgICAgICBpZiAoIWQpIHJldHVybiBhOw0KICAgICAgICBmb3IgKHZhciBlID0gMDsgZSA8IGQubGVuZ3RoOyBlKyspIGMgPSBkW2VdLCBjLmtpbmQgPT09IHRoaXMuZmEgJiYgYS5wdXNoKG5ldyB0LmFhKHRoaXMuZCwgew0KICAgICAgICAgICAgdHJhY2s6IGMNCiAgICAgICAgfSkpOw0KICAgICAgICByZXR1cm4gYQ0KICAgIH07DQogICAgdC5wYSA9IHQuUS5leHRlbmQoew0KICAgICAgICBsOiBmdW5jdGlvbiAoYSwgYywgZCkgew0KICAgICAgICAgICAgdC5RLmNhbGwodGhpcywgYSwgYywgZCk7DQogICAgICAgICAgICB0aGlzLmMuc2V0QXR0cmlidXRlKCJhcmlhLWxhYmVsIiwgIkNhcHRpb25zIE1lbnUiKQ0KICAgICAgICB9DQogICAgfSk7DQogICAgdC5wYS5wcm90b3R5cGUuZmEgPSAiY2FwdGlvbnMiOw0KICAgIHQucGEucHJvdG90eXBlLnVhID0gIkNhcHRpb25zIjsNCiAgICB0LnBhLnByb3RvdHlwZS5jbGFzc05hbWUgPSAidmpzLWNhcHRpb25zLWJ1dHRvbiI7DQogICAgdC5wYS5wcm90b3R5cGUudXBkYXRlID0gZnVuY3Rpb24gKCkgew0KICAgICAgICB2YXIgYSA9IDI7DQogICAgICAgIHQuUS5wcm90b3R5cGUudXBkYXRlLmNhbGwodGhpcyk7DQogICAgICAgIHRoaXMuaygpLmggJiYgdGhpcy5rKCkuaC5mZWF0dXJlc05hdGl2ZVRleHRUcmFja3MgJiYgKGEgPSAxKTsNCiAgICAgICAgdGhpcy5IICYmIHRoaXMuSC5sZW5ndGggPiBhID8gdGhpcy5zaG93KCkgOiB0aGlzLlkoKQ0KICAgIH07DQogICAgdC5iYiA9IHQuUS5leHRlbmQoew0KICAgICAgICBsOiBmdW5jdGlvbiAoYSwgYywgZCkgew0KICAgICAgICAgICAgdC5RLmNhbGwodGhpcywgYSwgYywgZCk7DQogICAgICAgICAgICB0aGlzLmMuc2V0QXR0cmlidXRlKCJhcmlhLWxhYmVsIiwgIlN1YnRpdGxlcyBNZW51IikNCiAgICAgICAgfQ0KICAgIH0pOw0KICAgIHQuYmIucHJvdG90eXBlLmZhID0gInN1YnRpdGxlcyI7DQogICAgdC5iYi5wcm90b3R5cGUudWEgPSAiU3VidGl0bGVzIjsNCiAgICB0LmJiLnByb3RvdHlwZS5jbGFzc05hbWUgPSAidmpzLXN1YnRpdGxlcy1idXR0b24iOw0KICAgIHQuWWEgPSB0LlEuZXh0ZW5kKHsNCiAgICAgICAgbDogZnVuY3Rpb24gKGEsIGMsIGQpIHsNCiAgICAgICAgICAgIHQuUS5jYWxsKHRoaXMsIGEsIGMsIGQpOw0KICAgICAgICAgICAgdGhpcy5jLnNldEF0dHJpYnV0ZSgiYXJpYS1sYWJlbCIsICJDaGFwdGVycyBNZW51IikNCiAgICAgICAgfQ0KICAgIH0pOw0KICAgIHMgPSB0LllhLnByb3RvdHlwZTsNCiAgICBzLmZhID0gImNoYXB0ZXJzIjsNCiAgICBzLnVhID0gIkNoYXB0ZXJzIjsNCiAgICBzLmNsYXNzTmFtZSA9ICJ2anMtY2hhcHRlcnMtYnV0dG9uIjsNCiAgICBzLkxhID0gZnVuY3Rpb24gKCkgew0KICAgICAgICB2YXIgYSA9IFtdLA0KICAgICAgICAgICAgYywgZDsNCiAgICAgICAgZCA9IHRoaXMuZC50ZXh0VHJhY2tzKCk7DQogICAgICAgIGlmICghZCkgcmV0dXJuIGE7DQogICAgICAgIGZvciAodmFyIGUgPSAwOyBlIDwgZC5sZW5ndGg7IGUrKykgYyA9IGRbZV0sIGMua2luZCA9PT0gdGhpcy5mYSAmJiBhLnB1c2gobmV3IHQuYWEodGhpcy5kLCB7DQogICAgICAgICAgICB0cmFjazogYw0KICAgICAgICB9KSk7DQogICAgICAgIHJldHVybiBhDQogICAgfTsNCiAgICBzLk1hID0gZnVuY3Rpb24gKCkgew0KICAgICAgICBmb3IgKHZhciBhID0gdGhpcy5kLnRleHRUcmFja3MoKSB8fCBbXSwgYyA9IDAsIGQgPSBhLmxlbmd0aCwgZSwgZywgaCA9IHRoaXMuSCA9IFtdOyBjIDwgZDsgYysrKQ0KICAgICAgICAgICAgaWYgKGUgPSBhW2NdLCBlLmtpbmQgPT0gdGhpcy5mYSkNCiAgICAgICAgICAgICAgICBpZiAoZS5FYykgew0KICAgICAgICAgICAgICAgICAgICBnID0gZTsNCiAgICAgICAgICAgICAgICAgICAgYnJlYWsNCiAgICAgICAgICAgICAgICB9IGVsc2UgZS5tb2RlID0gImhpZGRlbiIsIHdpbmRvdy5zZXRUaW1lb3V0KHQuYmluZCh0aGlzLCBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuTWEoKQ0KICAgICAgICAgICAgICAgIH0pLCAxMDApOw0KICAgICAgICBhID0gdGhpcy5BYTsNCiAgICAgICAgYSA9PT0gYiAmJiAoYSA9IG5ldyB0LnJhKHRoaXMuZCksIGEueGEoKS5hcHBlbmRDaGlsZCh0LmYoImxpIiwgew0KICAgICAgICAgICAgY2xhc3NOYW1lOiAidmpzLW1lbnUtdGl0bGUiLA0KICAgICAgICAgICAgaW5uZXJIVE1MOiB0LndhKHRoaXMuZmEpLA0KICAgICAgICAgICAgWGU6IC0xDQogICAgICAgIH0pKSk7DQogICAgICAgIGlmIChnKSB7DQogICAgICAgICAgICBlID0gZy5jdWVzOw0KICAgICAgICAgICAgZm9yICh2YXIgaywgYyA9IDAsIGQgPSBlLmxlbmd0aDsgYyA8IGQ7IGMrKykgayA9IGVbY10sIGsgPSBuZXcgdC5aYSh0aGlzLmQsIHsNCiAgICAgICAgICAgICAgICB0cmFjazogZywNCiAgICAgICAgICAgICAgICBjdWU6IGsNCiAgICAgICAgICAgIH0pLCBoLnB1c2goayksIGEuYmEoayk7DQogICAgICAgICAgICB0aGlzLmJhKGEpDQogICAgICAgIH0NCiAgICAgICAgMCA8IHRoaXMuSC5sZW5ndGggJiYgdGhpcy5zaG93KCk7DQogICAgICAgIHJldHVybiBhDQogICAgfTsNCiAgICB0LlphID0gdC5NLmV4dGVuZCh7DQogICAgICAgIGw6IGZ1bmN0aW9uIChhLCBjKSB7DQogICAgICAgICAgICB2YXIgZCA9IHRoaXMuVCA9IGMudHJhY2ssDQogICAgICAgICAgICAgICAgZSA9IHRoaXMuY3VlID0gYy5jdWUsDQogICAgICAgICAgICAgICAgZyA9IGEuY3VycmVudFRpbWUoKTsNCiAgICAgICAgICAgIGMubGFiZWwgPSBlLnRleHQ7DQogICAgICAgICAgICBjLnNlbGVjdGVkID0gZS5zdGFydFRpbWUgPD0gZyAmJiBnIDwgZS5lbmRUaW1lOw0KICAgICAgICAgICAgdC5NLmNhbGwodGhpcywgYSwgYyk7DQogICAgICAgICAgICBkLmFkZEV2ZW50TGlzdGVuZXIoImN1ZWNoYW5nZSIsIHQuYmluZCh0aGlzLCB0aGlzLnVwZGF0ZSkpDQogICAgICAgIH0NCiAgICB9KTsNCiAgICB0LlphLnByb3RvdHlwZS51ID0gZnVuY3Rpb24gKCkgew0KICAgICAgICB0Lk0ucHJvdG90eXBlLnUuY2FsbCh0aGlzKTsNCiAgICAgICAgdGhpcy5kLmN1cnJlbnRUaW1lKHRoaXMuY3VlLnN0YXJ0VGltZSk7DQogICAgICAgIHRoaXMudXBkYXRlKHRoaXMuY3VlLnN0YXJ0VGltZSkNCiAgICB9Ow0KICAgIHQuWmEucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgdmFyIGEgPSB0aGlzLmN1ZSwNCiAgICAgICAgICAgIGMgPSB0aGlzLmQuY3VycmVudFRpbWUoKTsNCiAgICAgICAgdGhpcy5zZWxlY3RlZChhLnN0YXJ0VGltZSA8PSBjICYmIGMgPCBhLmVuZFRpbWUpDQogICAgfTsNCg0KICAgIGZ1bmN0aW9uIFgoYSkgew0KICAgICAgICB2YXIgYzsNCiAgICAgICAgYS5MZSA/IGMgPSBhLkxlWzBdIDogYS5vcHRpb25zICYmIChjID0gYS5vcHRpb25zW2Eub3B0aW9ucy5zZWxlY3RlZEluZGV4XSk7DQogICAgICAgIHJldHVybiBjLnZhbHVlDQogICAgfQ0KDQogICAgZnVuY3Rpb24gWShhLCBjKSB7DQogICAgICAgIHZhciBkLCBlOw0KICAgICAgICBpZiAoYykgew0KICAgICAgICAgICAgZm9yIChkID0gMDsgZCA8IGEub3B0aW9ucy5sZW5ndGggJiYgIShlID0gYS5vcHRpb25zW2RdLCBlLnZhbHVlID09PSBjKSA7IGQrKyk7DQogICAgICAgICAgICBhLnNlbGVjdGVkSW5kZXggPSBkDQogICAgICAgIH0NCiAgICB9DQogICAgdC50YyA9IHQuYS5leHRlbmQoew0KICAgICAgICBsOiBmdW5jdGlvbiAoYSwgYykgew0KICAgICAgICAgICAgdC5hLmNhbGwodGhpcywgYSwgYyk7DQogICAgICAgICAgICB0aGlzLlkoKTsNCiAgICAgICAgICAgIHQuYih0aGlzLm0oKS5xdWVyeVNlbGVjdG9yKCIudmpzLWRvbmUtYnV0dG9uIiksICJjbGljayIsIHQuYmluZCh0aGlzLCBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgdGhpcy5LZSgpOw0KICAgICAgICAgICAgICAgIHRoaXMuWSgpDQogICAgICAgICAgICB9KSk7DQogICAgICAgICAgICB0LmIodGhpcy5tKCkucXVlcnlTZWxlY3RvcigiLnZqcy1kZWZhdWx0LWJ1dHRvbiIpLCAiY2xpY2siLCB0LmJpbmQodGhpcywgZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgIHRoaXMubSgpLnF1ZXJ5U2VsZWN0b3IoIi52anMtZmctY29sb3IgPiBzZWxlY3QiKS5zZWxlY3RlZEluZGV4ID0gMDsNCiAgICAgICAgICAgICAgICB0aGlzLm0oKS5xdWVyeVNlbGVjdG9yKCIudmpzLWJnLWNvbG9yID4gc2VsZWN0Iikuc2VsZWN0ZWRJbmRleCA9IDA7DQogICAgICAgICAgICAgICAgdGhpcy5tKCkucXVlcnlTZWxlY3RvcigiLndpbmRvdy1jb2xvciA+IHNlbGVjdCIpLnNlbGVjdGVkSW5kZXggPSAwOw0KICAgICAgICAgICAgICAgIHRoaXMubSgpLnF1ZXJ5U2VsZWN0b3IoIi52anMtdGV4dC1vcGFjaXR5ID4gc2VsZWN0Iikuc2VsZWN0ZWRJbmRleCA9DQogICAgICAgICAgICAgICAgICAgIDA7DQogICAgICAgICAgICAgICAgdGhpcy5tKCkucXVlcnlTZWxlY3RvcigiLnZqcy1iZy1vcGFjaXR5ID4gc2VsZWN0Iikuc2VsZWN0ZWRJbmRleCA9IDA7DQogICAgICAgICAgICAgICAgdGhpcy5tKCkucXVlcnlTZWxlY3RvcigiLnZqcy13aW5kb3ctb3BhY2l0eSA+IHNlbGVjdCIpLnNlbGVjdGVkSW5kZXggPSAwOw0KICAgICAgICAgICAgICAgIHRoaXMubSgpLnF1ZXJ5U2VsZWN0b3IoIi52anMtZWRnZS1zdHlsZSBzZWxlY3QiKS5zZWxlY3RlZEluZGV4ID0gMDsNCiAgICAgICAgICAgICAgICB0aGlzLm0oKS5xdWVyeVNlbGVjdG9yKCIudmpzLWZvbnQtZmFtaWx5IHNlbGVjdCIpLnNlbGVjdGVkSW5kZXggPSAwOw0KICAgICAgICAgICAgICAgIHRoaXMubSgpLnF1ZXJ5U2VsZWN0b3IoIi52anMtZm9udC1wZXJjZW50IHNlbGVjdCIpLnNlbGVjdGVkSW5kZXggPSAyOw0KICAgICAgICAgICAgICAgIHRoaXMuQygpDQogICAgICAgICAgICB9KSk7DQogICAgICAgICAgICB0LmIodGhpcy5tKCkucXVlcnlTZWxlY3RvcigiLnZqcy1mZy1jb2xvciA+IHNlbGVjdCIpLCAiY2hhbmdlIiwgdC5iaW5kKHRoaXMsIHRoaXMuQykpOw0KICAgICAgICAgICAgdC5iKHRoaXMubSgpLnF1ZXJ5U2VsZWN0b3IoIi52anMtYmctY29sb3IgPiBzZWxlY3QiKSwgImNoYW5nZSIsIHQuYmluZCh0aGlzLA0KICAgICAgICAgICAgICAgIHRoaXMuQykpOw0KICAgICAgICAgICAgdC5iKHRoaXMubSgpLnF1ZXJ5U2VsZWN0b3IoIi53aW5kb3ctY29sb3IgPiBzZWxlY3QiKSwgImNoYW5nZSIsIHQuYmluZCh0aGlzLCB0aGlzLkMpKTsNCiAgICAgICAgICAgIHQuYih0aGlzLm0oKS5xdWVyeVNlbGVjdG9yKCIudmpzLXRleHQtb3BhY2l0eSA+IHNlbGVjdCIpLCAiY2hhbmdlIiwgdC5iaW5kKHRoaXMsIHRoaXMuQykpOw0KICAgICAgICAgICAgdC5iKHRoaXMubSgpLnF1ZXJ5U2VsZWN0b3IoIi52anMtYmctb3BhY2l0eSA+IHNlbGVjdCIpLCAiY2hhbmdlIiwgdC5iaW5kKHRoaXMsIHRoaXMuQykpOw0KICAgICAgICAgICAgdC5iKHRoaXMubSgpLnF1ZXJ5U2VsZWN0b3IoIi52anMtd2luZG93LW9wYWNpdHkgPiBzZWxlY3QiKSwgImNoYW5nZSIsIHQuYmluZCh0aGlzLCB0aGlzLkMpKTsNCiAgICAgICAgICAgIHQuYih0aGlzLm0oKS5xdWVyeVNlbGVjdG9yKCIudmpzLWZvbnQtcGVyY2VudCBzZWxlY3QiKSwgImNoYW5nZSIsIHQuYmluZCh0aGlzLCB0aGlzLkMpKTsNCiAgICAgICAgICAgIHQuYih0aGlzLm0oKS5xdWVyeVNlbGVjdG9yKCIudmpzLWVkZ2Utc3R5bGUgc2VsZWN0IiksICJjaGFuZ2UiLCB0LmJpbmQodGhpcywNCiAgICAgICAgICAgICAgICB0aGlzLkMpKTsNCiAgICAgICAgICAgIHQuYih0aGlzLm0oKS5xdWVyeVNlbGVjdG9yKCIudmpzLWZvbnQtZmFtaWx5IHNlbGVjdCIpLCAiY2hhbmdlIiwgdC5iaW5kKHRoaXMsIHRoaXMuQykpOw0KICAgICAgICAgICAgYS5vcHRpb25zKCkucGVyc2lzdFRleHRUcmFja1NldHRpbmdzICYmIHRoaXMuSmUoKQ0KICAgICAgICB9DQogICAgfSk7DQogICAgcyA9IHQudGMucHJvdG90eXBlOw0KICAgIHMuZiA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgcmV0dXJuIHQuYS5wcm90b3R5cGUuZi5jYWxsKHRoaXMsICJkaXYiLCB7DQogICAgICAgICAgICBjbGFzc05hbWU6ICJ2anMtY2FwdGlvbi1zZXR0aW5ncyB2anMtbW9kYWwtb3ZlcmxheSIsDQogICAgICAgICAgICBpbm5lckhUTUw6ICc8ZGl2IGNsYXNzPSJ2anMtdHJhY2tzZXR0aW5ncyI+PGRpdiBjbGFzcz0idmpzLXRyYWNrc2V0dGluZ3MtY29sb3JzIj48ZGl2IGNsYXNzPSJ2anMtZmctY29sb3IgdmpzLXRyYWNrc2V0dGluZyI+PGxhYmVsIGNsYXNzPSJ2anMtbGFiZWwiPkZvcmVncm91bmQ8L2xhYmVsPjxzZWxlY3Q+PG9wdGlvbiB2YWx1ZT0iIj4tLS08L29wdGlvbj48b3B0aW9uIHZhbHVlPSIjRkZGIj5XaGl0ZTwvb3B0aW9uPjxvcHRpb24gdmFsdWU9IiMwMDAiPkJsYWNrPC9vcHRpb24+PG9wdGlvbiB2YWx1ZT0iI0YwMCI+UmVkPC9vcHRpb24+PG9wdGlvbiB2YWx1ZT0iIzBGMCI+R3JlZW48L29wdGlvbj48b3B0aW9uIHZhbHVlPSIjMDBGIj5CbHVlPC9vcHRpb24+PG9wdGlvbiB2YWx1ZT0iI0ZGMCI+WWVsbG93PC9vcHRpb24+PG9wdGlvbiB2YWx1ZT0iI0YwRiI+TWFnZW50YTwvb3B0aW9uPjxvcHRpb24gdmFsdWU9IiMwRkYiPkN5YW48L29wdGlvbj48L3NlbGVjdD48c3BhbiBjbGFzcz0idmpzLXRleHQtb3BhY2l0eSB2anMtb3BhY2l0eSI+PHNlbGVjdD48b3B0aW9uIHZhbHVlPSIiPi0tLTwvb3B0aW9uPjxvcHRpb24gdmFsdWU9IjEiPk9wYXF1ZTwvb3B0aW9uPjxvcHRpb24gdmFsdWU9IjAuNSI+U2VtaS1PcGFxdWU8L29wdGlvbj48L3NlbGVjdD48L3NwYW4+PC9kaXY+PGRpdiBjbGFzcz0idmpzLWJnLWNvbG9yIHZqcy10cmFja3NldHRpbmciPjxsYWJlbCBjbGFzcz0idmpzLWxhYmVsIj5CYWNrZ3JvdW5kPC9sYWJlbD48c2VsZWN0PjxvcHRpb24gdmFsdWU9IiI+LS0tPC9vcHRpb24+PG9wdGlvbiB2YWx1ZT0iI0ZGRiI+V2hpdGU8L29wdGlvbj48b3B0aW9uIHZhbHVlPSIjMDAwIj5CbGFjazwvb3B0aW9uPjxvcHRpb24gdmFsdWU9IiNGMDAiPlJlZDwvb3B0aW9uPjxvcHRpb24gdmFsdWU9IiMwRjAiPkdyZWVuPC9vcHRpb24+PG9wdGlvbiB2YWx1ZT0iIzAwRiI+Qmx1ZTwvb3B0aW9uPjxvcHRpb24gdmFsdWU9IiNGRjAiPlllbGxvdzwvb3B0aW9uPjxvcHRpb24gdmFsdWU9IiNGMEYiPk1hZ2VudGE8L29wdGlvbj48b3B0aW9uIHZhbHVlPSIjMEZGIj5DeWFuPC9vcHRpb24+PC9zZWxlY3Q+PHNwYW4gY2xhc3M9InZqcy1iZy1vcGFjaXR5IHZqcy1vcGFjaXR5Ij48c2VsZWN0PjxvcHRpb24gdmFsdWU9IiI+LS0tPC9vcHRpb24+PG9wdGlvbiB2YWx1ZT0iMSI+T3BhcXVlPC9vcHRpb24+PG9wdGlvbiB2YWx1ZT0iMC41Ij5TZW1pLVRyYW5zcGFyZW50PC9vcHRpb24+PG9wdGlvbiB2YWx1ZT0iMCI+VHJhbnNwYXJlbnQ8L29wdGlvbj48L3NlbGVjdD48L3NwYW4+PC9kaXY+PGRpdiBjbGFzcz0id2luZG93LWNvbG9yIHZqcy10cmFja3NldHRpbmciPjxsYWJlbCBjbGFzcz0idmpzLWxhYmVsIj5XaW5kb3c8L2xhYmVsPjxzZWxlY3Q+PG9wdGlvbiB2YWx1ZT0iIj4tLS08L29wdGlvbj48b3B0aW9uIHZhbHVlPSIjRkZGIj5XaGl0ZTwvb3B0aW9uPjxvcHRpb24gdmFsdWU9IiMwMDAiPkJsYWNrPC9vcHRpb24+PG9wdGlvbiB2YWx1ZT0iI0YwMCI+UmVkPC9vcHRpb24+PG9wdGlvbiB2YWx1ZT0iIzBGMCI+R3JlZW48L29wdGlvbj48b3B0aW9uIHZhbHVlPSIjMDBGIj5CbHVlPC9vcHRpb24+PG9wdGlvbiB2YWx1ZT0iI0ZGMCI+WWVsbG93PC9vcHRpb24+PG9wdGlvbiB2YWx1ZT0iI0YwRiI+TWFnZW50YTwvb3B0aW9uPjxvcHRpb24gdmFsdWU9IiMwRkYiPkN5YW48L29wdGlvbj48L3NlbGVjdD48c3BhbiBjbGFzcz0idmpzLXdpbmRvdy1vcGFjaXR5IHZqcy1vcGFjaXR5Ij48c2VsZWN0PjxvcHRpb24gdmFsdWU9IiI+LS0tPC9vcHRpb24+PG9wdGlvbiB2YWx1ZT0iMSI+T3BhcXVlPC9vcHRpb24+PG9wdGlvbiB2YWx1ZT0iMC41Ij5TZW1pLVRyYW5zcGFyZW50PC9vcHRpb24+PG9wdGlvbiB2YWx1ZT0iMCI+VHJhbnNwYXJlbnQ8L29wdGlvbj48L3NlbGVjdD48L3NwYW4+PC9kaXY+PC9kaXY+PGRpdiBjbGFzcz0idmpzLXRyYWNrc2V0dGluZ3MtZm9udCI+PGRpdiBjbGFzcz0idmpzLWZvbnQtcGVyY2VudCB2anMtdHJhY2tzZXR0aW5nIj48bGFiZWwgY2xhc3M9InZqcy1sYWJlbCI+Rm9udCBTaXplPC9sYWJlbD48c2VsZWN0PjxvcHRpb24gdmFsdWU9IjAuNTAiPjUwJTwvb3B0aW9uPjxvcHRpb24gdmFsdWU9IjAuNzUiPjc1JTwvb3B0aW9uPjxvcHRpb24gdmFsdWU9IjEuMDAiIHNlbGVjdGVkPjEwMCU8L29wdGlvbj48b3B0aW9uIHZhbHVlPSIxLjI1Ij4xMjUlPC9vcHRpb24+PG9wdGlvbiB2YWx1ZT0iMS41MCI+MTUwJTwvb3B0aW9uPjxvcHRpb24gdmFsdWU9IjEuNzUiPjE3NSU8L29wdGlvbj48b3B0aW9uIHZhbHVlPSIyLjAwIj4yMDAlPC9vcHRpb24+PG9wdGlvbiB2YWx1ZT0iMy4wMCI+MzAwJTwvb3B0aW9uPjxvcHRpb24gdmFsdWU9IjQuMDAiPjQwMCU8L29wdGlvbj48L3NlbGVjdD48L2Rpdj48ZGl2IGNsYXNzPSJ2anMtZWRnZS1zdHlsZSB2anMtdHJhY2tzZXR0aW5nIj48bGFiZWwgY2xhc3M9InZqcy1sYWJlbCI+VGV4dCBFZGdlIFN0eWxlPC9sYWJlbD48c2VsZWN0PjxvcHRpb24gdmFsdWU9Im5vbmUiPk5vbmU8L29wdGlvbj48b3B0aW9uIHZhbHVlPSJyYWlzZWQiPlJhaXNlZDwvb3B0aW9uPjxvcHRpb24gdmFsdWU9ImRlcHJlc3NlZCI+RGVwcmVzc2VkPC9vcHRpb24+PG9wdGlvbiB2YWx1ZT0idW5pZm9ybSI+VW5pZm9ybTwvb3B0aW9uPjxvcHRpb24gdmFsdWU9ImRyb3BzaGFkb3ciPkRyb3BzaGFkb3c8L29wdGlvbj48L3NlbGVjdD48L2Rpdj48ZGl2IGNsYXNzPSJ2anMtZm9udC1mYW1pbHkgdmpzLXRyYWNrc2V0dGluZyI+PGxhYmVsIGNsYXNzPSJ2anMtbGFiZWwiPkZvbnQgRmFtaWx5PC9sYWJlbD48c2VsZWN0PjxvcHRpb24gdmFsdWU9IiI+RGVmYXVsdDwvb3B0aW9uPjxvcHRpb24gdmFsdWU9Im1vbm9zcGFjZVNlcmlmIj5Nb25vc3BhY2UgU2VyaWY8L29wdGlvbj48b3B0aW9uIHZhbHVlPSJwcm9wb3J0aW9uYWxTZXJpZiI+UHJvcG9ydGlvbmFsIFNlcmlmPC9vcHRpb24+PG9wdGlvbiB2YWx1ZT0ibW9ub3NwYWNlU2Fuc1NlcmlmIj5Nb25vc3BhY2UgU2Fucy1TZXJpZjwvb3B0aW9uPjxvcHRpb24gdmFsdWU9InByb3BvcnRpb25hbFNhbnNTZXJpZiI+UHJvcG9ydGlvbmFsIFNhbnMtU2VyaWY8L29wdGlvbj48b3B0aW9uIHZhbHVlPSJjYXN1YWwiPkNhc3VhbDwvb3B0aW9uPjxvcHRpb24gdmFsdWU9InNjcmlwdCI+U2NyaXB0PC9vcHRpb24+PG9wdGlvbiB2YWx1ZT0ic21hbGwtY2FwcyI+U21hbGwgQ2Fwczwvb3B0aW9uPjwvc2VsZWN0PjwvZGl2PjwvZGl2PjwvZGl2PjxkaXYgY2xhc3M9InZqcy10cmFja3NldHRpbmdzLWNvbnRyb2xzIj48YnV0dG9uIGNsYXNzPSJ2anMtZGVmYXVsdC1idXR0b24iPkRlZmF1bHRzPC9idXR0b24+PGJ1dHRvbiBjbGFzcz0idmpzLWRvbmUtYnV0dG9uIj5Eb25lPC9idXR0b24+PC9kaXY+Jw0KICAgICAgICB9KQ0KICAgIH07DQogICAgcy5MYyA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgdmFyIGEsIGMsIGQsIGUsIGcsIGgsIGssIHEsIHIsIHU7DQogICAgICAgIGEgPSB0aGlzLm0oKTsNCiAgICAgICAgZyA9IFgoYS5xdWVyeVNlbGVjdG9yKCIudmpzLWVkZ2Utc3R5bGUgc2VsZWN0IikpOw0KICAgICAgICBoID0gWChhLnF1ZXJ5U2VsZWN0b3IoIi52anMtZm9udC1mYW1pbHkgc2VsZWN0IikpOw0KICAgICAgICBrID0gWChhLnF1ZXJ5U2VsZWN0b3IoIi52anMtZmctY29sb3IgPiBzZWxlY3QiKSk7DQogICAgICAgIGQgPSBYKGEucXVlcnlTZWxlY3RvcigiLnZqcy10ZXh0LW9wYWNpdHkgPiBzZWxlY3QiKSk7DQogICAgICAgIHEgPSBYKGEucXVlcnlTZWxlY3RvcigiLnZqcy1iZy1jb2xvciA+IHNlbGVjdCIpKTsNCiAgICAgICAgYyA9IFgoYS5xdWVyeVNlbGVjdG9yKCIudmpzLWJnLW9wYWNpdHkgPiBzZWxlY3QiKSk7DQogICAgICAgIHIgPSBYKGEucXVlcnlTZWxlY3RvcigiLndpbmRvdy1jb2xvciA+IHNlbGVjdCIpKTsNCiAgICAgICAgZSA9IFgoYS5xdWVyeVNlbGVjdG9yKCIudmpzLXdpbmRvdy1vcGFjaXR5ID4gc2VsZWN0IikpOw0KICAgICAgICBhID0gd2luZG93LnBhcnNlRmxvYXQoWChhLnF1ZXJ5U2VsZWN0b3IoIi52anMtZm9udC1wZXJjZW50ID4gc2VsZWN0IikpKTsNCiAgICAgICAgYyA9IHsNCiAgICAgICAgICAgIGJhY2tncm91bmRPcGFjaXR5OiBjLA0KICAgICAgICAgICAgdGV4dE9wYWNpdHk6IGQsDQogICAgICAgICAgICB3aW5kb3dPcGFjaXR5OiBlLA0KICAgICAgICAgICAgZWRnZVN0eWxlOiBnLA0KICAgICAgICAgICAgZm9udEZhbWlseTogaCwNCiAgICAgICAgICAgIGNvbG9yOiBrLA0KICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiBxLA0KICAgICAgICAgICAgd2luZG93Q29sb3I6IHIsDQogICAgICAgICAgICBmb250UGVyY2VudDogYQ0KICAgICAgICB9Ow0KICAgICAgICBmb3IgKHUgaW4gYykgKCIiID09PSBjW3VdIHx8ICJub25lIiA9PT0gY1t1XSB8fCAiZm9udFBlcmNlbnQiID09PSB1ICYmIDEgPT09IGNbdV0pICYmIGRlbGV0ZSBjW3VdOw0KICAgICAgICByZXR1cm4gYw0KICAgIH07DQogICAgcy5TZSA9IGZ1bmN0aW9uIChhKSB7DQogICAgICAgIHZhciBjID0gdGhpcy5tKCk7DQogICAgICAgIFkoYy5xdWVyeVNlbGVjdG9yKCIudmpzLWVkZ2Utc3R5bGUgc2VsZWN0IiksIGEuTmEpOw0KICAgICAgICBZKGMucXVlcnlTZWxlY3RvcigiLnZqcy1mb250LWZhbWlseSBzZWxlY3QiKSwgYS5mb250RmFtaWx5KTsNCiAgICAgICAgWShjLnF1ZXJ5U2VsZWN0b3IoIi52anMtZmctY29sb3IgPiBzZWxlY3QiKSwgYS5jb2xvcik7DQogICAgICAgIFkoYy5xdWVyeVNlbGVjdG9yKCIudmpzLXRleHQtb3BhY2l0eSA+IHNlbGVjdCIpLCBhLm9kKTsNCiAgICAgICAgWShjLnF1ZXJ5U2VsZWN0b3IoIi52anMtYmctY29sb3IgPiBzZWxlY3QiKSwgYS5iYWNrZ3JvdW5kQ29sb3IpOw0KICAgICAgICBZKGMucXVlcnlTZWxlY3RvcigiLnZqcy1iZy1vcGFjaXR5ID4gc2VsZWN0IiksIGEuemMpOw0KICAgICAgICBZKGMucXVlcnlTZWxlY3RvcigiLndpbmRvdy1jb2xvciA+IHNlbGVjdCIpLCBhLmdjKTsNCiAgICAgICAgWShjLnF1ZXJ5U2VsZWN0b3IoIi52anMtd2luZG93LW9wYWNpdHkgPiBzZWxlY3QiKSwgYS52ZCk7DQogICAgICAgIChhID0gYS5SYikgJiYgKGEgPSBhLnRvRml4ZWQoMikpOw0KICAgICAgICBZKGMucXVlcnlTZWxlY3RvcigiLnZqcy1mb250LXBlcmNlbnQgPiBzZWxlY3QiKSwNCiAgICAgICAgICAgIGEpDQogICAgfTsNCiAgICBzLkplID0gZnVuY3Rpb24gKCkgew0KICAgICAgICB2YXIgYTsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIGEgPSBKU09OLnBhcnNlKHdpbmRvdy5sb2NhbFN0b3JhZ2UuZ2V0SXRlbSgidmpzLXRleHQtdHJhY2stc2V0dGluZ3MiKSkNCiAgICAgICAgfSBjYXRjaCAoYykgeyB9DQogICAgICAgIGEgJiYgdGhpcy5TZShhKQ0KICAgIH07DQogICAgcy5LZSA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgdmFyIGE7DQogICAgICAgIGlmICh0aGlzLmQub3B0aW9ucygpLnBlcnNpc3RUZXh0VHJhY2tTZXR0aW5ncykgew0KICAgICAgICAgICAgYSA9IHRoaXMuTGMoKTsNCiAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgdC5rYihhKSA/IHdpbmRvdy5sb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgidmpzLXRleHQtdHJhY2stc2V0dGluZ3MiKSA6IHdpbmRvdy5sb2NhbFN0b3JhZ2Uuc2V0SXRlbSgidmpzLXRleHQtdHJhY2stc2V0dGluZ3MiLCBKU09OLnN0cmluZ2lmeShhKSkNCiAgICAgICAgICAgIH0gY2F0Y2ggKGMpIHsgfQ0KICAgICAgICB9DQogICAgfTsNCiAgICBzLkMgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHZhciBhID0gdGhpcy5kLmVhKCJ0ZXh0VHJhY2tEaXNwbGF5Iik7DQogICAgICAgIGEgJiYgYS5DKCkNCiAgICB9Ow0KICAgIGlmICgidW5kZWZpbmVkIiAhPT0gdHlwZW9mIHdpbmRvdy5KU09OICYmICJmdW5jdGlvbiIgPT09IHR5cGVvZiB3aW5kb3cuSlNPTi5wYXJzZSkgdC5KU09OID0gd2luZG93LkpTT047DQogICAgZWxzZSB7DQogICAgICAgIHQuSlNPTiA9IHt9Ow0KICAgICAgICB2YXIgWiA9IC9bXHUwMDAwXHUwMGFkXHUwNjAwLVx1MDYwNFx1MDcwZlx1MTdiNFx1MTdiNVx1MjAwYy1cdTIwMGZcdTIwMjgtXHUyMDJmXHUyMDYwLVx1MjA2Zlx1ZmVmZlx1ZmZmMC1cdWZmZmZdL2c7DQogICAgICAgIHQuSlNPTi5wYXJzZSA9IGZ1bmN0aW9uIChhLCBjKSB7DQogICAgICAgICAgICBmdW5jdGlvbiBkKGEsIGUpIHsNCiAgICAgICAgICAgICAgICB2YXIgaywgcSwgciA9IGFbZV07DQogICAgICAgICAgICAgICAgaWYgKHIgJiYgIm9iamVjdCIgPT09IHR5cGVvZiByKQ0KICAgICAgICAgICAgICAgICAgICBmb3IgKGsgaW4gcikgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHIsIGspICYmIChxID0gZChyLCBrKSwgcSAhPT0gYiA/IHJba10gPSBxIDogZGVsZXRlIHJba10pOw0KICAgICAgICAgICAgICAgIHJldHVybiBjLmNhbGwoYSwgZSwgcikNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHZhciBlOw0KICAgICAgICAgICAgYSA9IFN0cmluZyhhKTsNCiAgICAgICAgICAgIFoubGFzdEluZGV4ID0gMDsNCiAgICAgICAgICAgIFoudGVzdChhKSAmJiAoYSA9IGEucmVwbGFjZShaLCBmdW5jdGlvbiAoYSkgew0KICAgICAgICAgICAgICAgIHJldHVybiAiXFx1IiArICgiMDAwMCIgKw0KICAgICAgICAgICAgICAgICAgICBhLmNoYXJDb2RlQXQoMCkudG9TdHJpbmcoMTYpKS5zbGljZSgtNCkNCiAgICAgICAgICAgIH0pKTsNCiAgICAgICAgICAgIGlmICgvXltcXSw6e31cc10qJC8udGVzdChhLnJlcGxhY2UoL1xcKD86WyJcXFwvYmZucnRdfHVbMC05YS1mQS1GXXs0fSkvZywgIkAiKS5yZXBsYWNlKC8iW14iXFxcblxyXSoifHRydWV8ZmFsc2V8bnVsbHwtP1xkKyg/OlwuXGQqKT8oPzpbZUVdWytcLV0/XGQrKT8vZywgIl0iKS5yZXBsYWNlKC8oPzpefDp8LCkoPzpccypcWykrL2csICIiKSkpIHJldHVybiBlID0gZXZhbCgiKCIgKyBhICsgIikiKSwgImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGMgPyBkKHsNCiAgICAgICAgICAgICAgICAiIjogZQ0KICAgICAgICAgICAgfSwgIiIpIDogZTsNCiAgICAgICAgICAgIHRocm93IG5ldyBTeW50YXhFcnJvcigiSlNPTi5wYXJzZSgpOiBpbnZhbGlkIG9yIG1hbGZvcm1lZCBKU09OIGRhdGEiKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICB0LnljID0gZnVuY3Rpb24gKCkgew0KICAgICAgICB2YXIgYSwgYywgZCwgZTsNCiAgICAgICAgYSA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCJ2aWRlbyIpOw0KICAgICAgICBjID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImF1ZGlvIik7DQogICAgICAgIHZhciBnID0gW107DQogICAgICAgIGlmIChhICYmIDAgPCBhLmxlbmd0aCkgew0KICAgICAgICAgICAgZCA9IDA7DQogICAgICAgICAgICBmb3IgKGUgPSBhLmxlbmd0aDsgZCA8IGU7IGQrKykgZy5wdXNoKGFbZF0pDQogICAgICAgIH0NCiAgICAgICAgaWYgKGMgJiYgMCA8IGMubGVuZ3RoKSB7DQogICAgICAgICAgICBkID0gMDsNCiAgICAgICAgICAgIGZvciAoZSA9IGMubGVuZ3RoOyBkIDwgZTsgZCsrKSBnLnB1c2goY1tkXSkNCiAgICAgICAgfQ0KICAgICAgICBpZiAoZyAmJiAwIDwgZy5sZW5ndGgpIHsNCiAgICAgICAgICAgIGQgPSAwOw0KICAgICAgICAgICAgZm9yIChlID0gZy5sZW5ndGg7IGQgPCBlOyBkKyspDQogICAgICAgICAgICAgICAgaWYgKChjID0gZ1tkXSkgJiYgYy5nZXRBdHRyaWJ1dGUpIGMucGxheWVyID09PSBiICYmIChhID0gYy5nZXRBdHRyaWJ1dGUoImRhdGEtc2V0dXAiKSwgYSAhPT0gaiAmJiB2aWRlb2pzKGMpKTsNCiAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgdC5LYigpOw0KICAgICAgICAgICAgICAgICAgICBicmVhaw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgfSBlbHNlIHQudWQgfHwgdC5LYigpDQogICAgfTsNCiAgICB0LktiID0gZnVuY3Rpb24gKCkgew0KICAgICAgICBzZXRUaW1lb3V0KHQueWMsIDEpDQogICAgfTsNCiAgICAiY29tcGxldGUiID09PSBkb2N1bWVudC5yZWFkeVN0YXRlID8gdC51ZCA9IGYgOiB0Lk4od2luZG93LCAibG9hZCIsIGZ1bmN0aW9uICgpIHsNCiAgICAgICAgdC51ZCA9IGYNCiAgICB9KTsNCiAgICB0LktiKCk7DQogICAgdC5HZSA9IGZ1bmN0aW9uIChhLCBjKSB7DQogICAgICAgIHQuUGxheWVyLnByb3RvdHlwZVthXSA9IGMNCiAgICB9Ow0KICAgIHZhciBCYSA9IHRoaXM7DQoNCiAgICBmdW5jdGlvbiAkKGEsIGMpIHsNCiAgICAgICAgdmFyIGQgPSBhLnNwbGl0KCIuIiksDQogICAgICAgICAgICBlID0gQmE7DQogICAgICAgICEoZFswXSBpbiBlKSAmJiBlLmV4ZWNTY3JpcHQgJiYgZS5leGVjU2NyaXB0KCJ2YXIgIiArIGRbMF0pOw0KICAgICAgICBmb3IgKHZhciBnOyBkLmxlbmd0aCAmJiAoZyA9IGQuc2hpZnQoKSkgOykgIWQubGVuZ3RoICYmIGMgIT09IGIgPyBlW2ddID0gYyA6IGUgPSBlW2ddID8gZVtnXSA6IGVbZ10gPSB7fQ0KICAgIH07DQogICAgJCgidmlkZW9qcyIsIHQpOw0KICAgICQoIl9WXyIsIHQpOw0KICAgICQoInZpZGVvanMub3B0aW9ucyIsIHQub3B0aW9ucyk7DQogICAgJCgidmlkZW9qcy5wbGF5ZXJzIiwgdC5EYSk7DQogICAgJCgidmlkZW9qcy5UT1VDSF9FTkFCTEVEIiwgdC5HYik7DQogICAgJCgidmlkZW9qcy5jYWNoZSIsIHQudmEpOw0KICAgICQoInZpZGVvanMuQ29tcG9uZW50IiwgdC5hKTsNCiAgICB0LmEucHJvdG90eXBlLnBsYXllciA9IHQuYS5wcm90b3R5cGUuazsNCiAgICB0LmEucHJvdG90eXBlLm9wdGlvbnMgPSB0LmEucHJvdG90eXBlLm9wdGlvbnM7DQogICAgdC5hLnByb3RvdHlwZS5pbml0ID0gdC5hLnByb3RvdHlwZS5sOw0KICAgIHQuYS5wcm90b3R5cGUuZGlzcG9zZSA9IHQuYS5wcm90b3R5cGUuZGlzcG9zZTsNCiAgICB0LmEucHJvdG90eXBlLmNyZWF0ZUVsID0gdC5hLnByb3RvdHlwZS5mOw0KICAgIHQuYS5wcm90b3R5cGUuY29udGVudEVsID0gdC5hLnByb3RvdHlwZS54YTsNCiAgICB0LmEucHJvdG90eXBlLmVsID0gdC5hLnByb3RvdHlwZS5tOw0KICAgIHQuYS5wcm90b3R5cGUuYWRkQ2hpbGQgPSB0LmEucHJvdG90eXBlLmJhOw0KICAgIHQuYS5wcm90b3R5cGUuZ2V0Q2hpbGQgPSB0LmEucHJvdG90eXBlLmVhOw0KICAgIHQuYS5wcm90b3R5cGUuZ2V0Q2hpbGRCeUlkID0gdC5hLnByb3RvdHlwZS5iZTsNCiAgICB0LmEucHJvdG90eXBlLmNoaWxkcmVuID0gdC5hLnByb3RvdHlwZS5jaGlsZHJlbjsNCiAgICB0LmEucHJvdG90eXBlLmluaXRDaGlsZHJlbiA9IHQuYS5wcm90b3R5cGUuT2M7DQogICAgdC5hLnByb3RvdHlwZS5yZW1vdmVDaGlsZCA9IHQuYS5wcm90b3R5cGUucmVtb3ZlQ2hpbGQ7DQogICAgdC5hLnByb3RvdHlwZS5vbiA9IHQuYS5wcm90b3R5cGUuYjsNCiAgICB0LmEucHJvdG90eXBlLm9mZiA9IHQuYS5wcm90b3R5cGUubjsNCiAgICB0LmEucHJvdG90eXBlLm9uZSA9IHQuYS5wcm90b3R5cGUuTjsNCiAgICB0LmEucHJvdG90eXBlLnRyaWdnZXIgPSB0LmEucHJvdG90eXBlLm87DQogICAgdC5hLnByb3RvdHlwZS50cmlnZ2VyUmVhZHkgPSB0LmEucHJvdG90eXBlLlhhOw0KICAgIHQuYS5wcm90b3R5cGUuc2hvdyA9IHQuYS5wcm90b3R5cGUuc2hvdzsNCiAgICB0LmEucHJvdG90eXBlLmhpZGUgPSB0LmEucHJvdG90eXBlLlk7DQogICAgdC5hLnByb3RvdHlwZS53aWR0aCA9IHQuYS5wcm90b3R5cGUud2lkdGg7DQogICAgdC5hLnByb3RvdHlwZS5oZWlnaHQgPSB0LmEucHJvdG90eXBlLmhlaWdodDsNCiAgICB0LmEucHJvdG90eXBlLmRpbWVuc2lvbnMgPSB0LmEucHJvdG90eXBlLlVkOw0KICAgIHQuYS5wcm90b3R5cGUucmVhZHkgPSB0LmEucHJvdG90eXBlLkk7DQogICAgdC5hLnByb3RvdHlwZS5hZGRDbGFzcyA9IHQuYS5wcm90b3R5cGUucDsNCiAgICB0LmEucHJvdG90eXBlLnJlbW92ZUNsYXNzID0gdC5hLnByb3RvdHlwZS5yOw0KICAgIHQuYS5wcm90b3R5cGUuaGFzQ2xhc3MgPSB0LmEucHJvdG90eXBlLlFhOw0KICAgIHQuYS5wcm90b3R5cGUuYnVpbGRDU1NDbGFzcyA9IHQuYS5wcm90b3R5cGUuVjsNCiAgICB0LmEucHJvdG90eXBlLmxvY2FsaXplID0gdC5hLnByb3RvdHlwZS52Ow0KICAgIHQuYS5wcm90b3R5cGUuc2V0SW50ZXJ2YWwgPSB0LmEucHJvdG90eXBlLnNldEludGVydmFsOw0KICAgIHQuYS5wcm90b3R5cGUuc2V0VGltZW91dCA9IHQuYS5wcm90b3R5cGUuc2V0VGltZW91dDsNCiAgICAkKCJ2aWRlb2pzLkV2ZW50RW1pdHRlciIsIHQueik7DQogICAgdC56LnByb3RvdHlwZS5vbiA9IHQuei5wcm90b3R5cGUuYjsNCiAgICB0LnoucHJvdG90eXBlLmFkZEV2ZW50TGlzdGVuZXIgPSB0LnoucHJvdG90eXBlLmFkZEV2ZW50TGlzdGVuZXI7DQogICAgdC56LnByb3RvdHlwZS5vZmYgPSB0LnoucHJvdG90eXBlLm47DQogICAgdC56LnByb3RvdHlwZS5yZW1vdmVFdmVudExpc3RlbmVyID0gdC56LnByb3RvdHlwZS5yZW1vdmVFdmVudExpc3RlbmVyOw0KICAgIHQuei5wcm90b3R5cGUub25lID0gdC56LnByb3RvdHlwZS5OOw0KICAgIHQuei5wcm90b3R5cGUudHJpZ2dlciA9IHQuei5wcm90b3R5cGUubzsNCiAgICB0LnoucHJvdG90eXBlLmRpc3BhdGNoRXZlbnQgPSB0LnoucHJvdG90eXBlLmRpc3BhdGNoRXZlbnQ7DQogICAgdC5QbGF5ZXIucHJvdG90eXBlLmVuZGVkID0gdC5QbGF5ZXIucHJvdG90eXBlLmVuZGVkOw0KICAgIHQuUGxheWVyLnByb3RvdHlwZS5lbnRlckZ1bGxXaW5kb3cgPSB0LlBsYXllci5wcm90b3R5cGUuSmM7DQogICAgdC5QbGF5ZXIucHJvdG90eXBlLmV4aXRGdWxsV2luZG93ID0gdC5QbGF5ZXIucHJvdG90eXBlLk9iOw0KICAgIHQuUGxheWVyLnByb3RvdHlwZS5wcmVsb2FkID0gdC5QbGF5ZXIucHJvdG90eXBlLlNhOw0KICAgIHQuUGxheWVyLnByb3RvdHlwZS5yZW1haW5pbmdUaW1lID0gdC5QbGF5ZXIucHJvdG90eXBlLnJlbWFpbmluZ1RpbWU7DQogICAgdC5QbGF5ZXIucHJvdG90eXBlLnN1cHBvcnRzRnVsbFNjcmVlbiA9IHQuUGxheWVyLnByb3RvdHlwZS5VYTsNCiAgICB0LlBsYXllci5wcm90b3R5cGUuY3VycmVudFR5cGUgPSB0LlBsYXllci5wcm90b3R5cGUuUmQ7DQogICAgdC5QbGF5ZXIucHJvdG90eXBlLnJlcXVlc3RGdWxsU2NyZWVuID0gdC5QbGF5ZXIucHJvdG90eXBlLnJlcXVlc3RGdWxsU2NyZWVuOw0KICAgIHQuUGxheWVyLnByb3RvdHlwZS5yZXF1ZXN0RnVsbHNjcmVlbiA9IHQuUGxheWVyLnByb3RvdHlwZS5yZXF1ZXN0RnVsbHNjcmVlbjsNCiAgICB0LlBsYXllci5wcm90b3R5cGUuY2FuY2VsRnVsbFNjcmVlbiA9IHQuUGxheWVyLnByb3RvdHlwZS5jYW5jZWxGdWxsU2NyZWVuOw0KICAgIHQuUGxheWVyLnByb3RvdHlwZS5leGl0RnVsbHNjcmVlbiA9IHQuUGxheWVyLnByb3RvdHlwZS5leGl0RnVsbHNjcmVlbjsNCiAgICB0LlBsYXllci5wcm90b3R5cGUuaXNGdWxsU2NyZWVuID0gdC5QbGF5ZXIucHJvdG90eXBlLmlzRnVsbFNjcmVlbjsNCiAgICB0LlBsYXllci5wcm90b3R5cGUuaXNGdWxsc2NyZWVuID0gdC5QbGF5ZXIucHJvdG90eXBlLmlzRnVsbHNjcmVlbjsNCiAgICB0LlBsYXllci5wcm90b3R5cGUudGV4dFRyYWNrcyA9IHQuUGxheWVyLnByb3RvdHlwZS50ZXh0VHJhY2tzOw0KICAgIHQuUGxheWVyLnByb3RvdHlwZS5yZW1vdGVUZXh0VHJhY2tzID0gdC5QbGF5ZXIucHJvdG90eXBlLlo7DQogICAgdC5QbGF5ZXIucHJvdG90eXBlLmFkZFRleHRUcmFjayA9IHQuUGxheWVyLnByb3RvdHlwZS5hZGRUZXh0VHJhY2s7DQogICAgdC5QbGF5ZXIucHJvdG90eXBlLmFkZFJlbW90ZVRleHRUcmFjayA9IHQuUGxheWVyLnByb3RvdHlwZS5pYTsNCiAgICB0LlBsYXllci5wcm90b3R5cGUucmVtb3ZlUmVtb3RlVGV4dFRyYWNrID0gdC5QbGF5ZXIucHJvdG90eXBlLkVhOw0KICAgIHQuUGxheWVyLnByb3RvdHlwZS5zZWVrYWJsZSA9IHQuUGxheWVyLnByb3RvdHlwZS5zZWVrYWJsZTsNCiAgICAkKCJ2aWRlb2pzLk1lZGlhTG9hZGVyIiwgdC5HZCk7DQogICAgJCgidmlkZW9qcy5UZXh0VHJhY2tEaXNwbGF5IiwgdC50YSk7DQogICAgJCgidmlkZW9qcy5Db250cm9sQmFyIiwgdC53Yik7DQogICAgJCgidmlkZW9qcy5CdXR0b24iLCB0LncpOw0KICAgICQoInZpZGVvanMuUGxheVRvZ2dsZSIsIHQub2MpOw0KICAgICQoInZpZGVvanMuRnVsbHNjcmVlblRvZ2dsZSIsIHQuJGEpOw0KICAgICQoInZpZGVvanMuQmlnUGxheUJ1dHRvbiIsIHQudWIpOw0KICAgICQoInZpZGVvanMuTG9hZGluZ1NwaW5uZXIiLCB0Lm1jKTsNCiAgICAkKCJ2aWRlb2pzLkN1cnJlbnRUaW1lRGlzcGxheSIsIHQueGIpOw0KICAgICQoInZpZGVvanMuRHVyYXRpb25EaXNwbGF5IiwgdC55Yik7DQogICAgJCgidmlkZW9qcy5UaW1lRGl2aWRlciIsIHQudWMpOw0KICAgICQoInZpZGVvanMuUmVtYWluaW5nVGltZURpc3BsYXkiLCB0LkZiKTsNCiAgICAkKCJ2aWRlb2pzLkxpdmVEaXNwbGF5IiwgdC5sYyk7DQogICAgJCgidmlkZW9qcy5FcnJvckRpc3BsYXkiLCB0LnpiKTsNCiAgICAkKCJ2aWRlb2pzLlNsaWRlciIsIHQuVSk7DQogICAgJCgidmlkZW9qcy5Qcm9ncmVzc0NvbnRyb2wiLCB0LkViKTsNCiAgICAkKCJ2aWRlb2pzLlNlZWtCYXIiLCB0LnJjKTsNCiAgICAkKCJ2aWRlb2pzLkxvYWRQcm9ncmVzc0JhciIsIHQuQmIpOw0KICAgICQoInZpZGVvanMuUGxheVByb2dyZXNzQmFyIiwgdC5uYyk7DQogICAgJCgidmlkZW9qcy5TZWVrSGFuZGxlIiwgdC5hYik7DQogICAgJCgidmlkZW9qcy5Wb2x1bWVDb250cm9sIiwgdC5JYik7DQogICAgJCgidmlkZW9qcy5Wb2x1bWVCYXIiLCB0LkhiKTsNCiAgICAkKCJ2aWRlb2pzLlZvbHVtZUxldmVsIiwgdC52Yyk7DQogICAgJCgidmlkZW9qcy5Wb2x1bWVNZW51QnV0dG9uIiwgdC5JYSk7DQogICAgJCgidmlkZW9qcy5Wb2x1bWVIYW5kbGUiLCB0LkpiKTsNCiAgICAkKCJ2aWRlb2pzLk11dGVUb2dnbGUiLCB0LnNhKTsNCiAgICAkKCJ2aWRlb2pzLlBvc3RlckltYWdlIiwgdC5xYyk7DQogICAgJCgidmlkZW9qcy5NZW51IiwgdC5yYSk7DQogICAgJCgidmlkZW9qcy5NZW51SXRlbSIsIHQuTSk7DQogICAgJCgidmlkZW9qcy5NZW51QnV0dG9uIiwgdC5PKTsNCiAgICAkKCJ2aWRlb2pzLlBsYXliYWNrUmF0ZU1lbnVCdXR0b24iLCB0LnBjKTsNCiAgICAkKCJ2aWRlb2pzLkNoYXB0ZXJzVHJhY2tNZW51SXRlbSIsIHQuWmEpOw0KICAgICQoInZpZGVvanMuVGV4dFRyYWNrQnV0dG9uIiwgdC5RKTsNCiAgICAkKCJ2aWRlb2pzLlRleHRUcmFja01lbnVJdGVtIiwgdC5hYSk7DQogICAgJCgidmlkZW9qcy5PZmZUZXh0VHJhY2tNZW51SXRlbSIsIHQuQ2IpOw0KICAgICQoInZpZGVvanMuQ2FwdGlvblNldHRpbmdzTWVudUl0ZW0iLCB0LnZiKTsNCiAgICB0Lk8ucHJvdG90eXBlLmNyZWF0ZUl0ZW1zID0gdC5PLnByb3RvdHlwZS5MYTsNCiAgICB0LlEucHJvdG90eXBlLmNyZWF0ZUl0ZW1zID0gdC5RLnByb3RvdHlwZS5MYTsNCiAgICB0LllhLnByb3RvdHlwZS5jcmVhdGVJdGVtcyA9IHQuWWEucHJvdG90eXBlLkxhOw0KICAgICQoInZpZGVvanMuU3VidGl0bGVzQnV0dG9uIiwgdC5iYik7DQogICAgJCgidmlkZW9qcy5DYXB0aW9uc0J1dHRvbiIsIHQucGEpOw0KICAgICQoInZpZGVvanMuQ2hhcHRlcnNCdXR0b24iLCB0LllhKTsNCiAgICAkKCJ2aWRlb2pzLk1lZGlhVGVjaENvbnRyb2xsZXIiLCB0LmopOw0KICAgIHQuai53aXRoU291cmNlSGFuZGxlcnMgPSB0LmouaGM7DQogICAgdC5qLnByb3RvdHlwZS5mZWF0dXJlc1ZvbHVtZUNvbnRyb2wgPSB0LmoucHJvdG90eXBlLnZmOw0KICAgIHQuai5wcm90b3R5cGUuZmVhdHVyZXNGdWxsc2NyZWVuUmVzaXplID0gdC5qLnByb3RvdHlwZS5yZjsNCiAgICB0LmoucHJvdG90eXBlLmZlYXR1cmVzUGxheWJhY2tSYXRlID0gdC5qLnByb3RvdHlwZS5zZjsNCiAgICB0LmoucHJvdG90eXBlLmZlYXR1cmVzUHJvZ3Jlc3NFdmVudHMgPSB0LmoucHJvdG90eXBlLnRmOw0KICAgIHQuai5wcm90b3R5cGUuZmVhdHVyZXNUaW1ldXBkYXRlRXZlbnRzID0gdC5qLnByb3RvdHlwZS51ZjsNCiAgICB0LmoucHJvdG90eXBlLnNldFBvc3RlciA9IHQuai5wcm90b3R5cGUuZmQ7DQogICAgdC5qLnByb3RvdHlwZS50ZXh0VHJhY2tzID0gdC5qLnByb3RvdHlwZS50ZXh0VHJhY2tzOw0KICAgIHQuai5wcm90b3R5cGUucmVtb3RlVGV4dFRyYWNrcyA9IHQuai5wcm90b3R5cGUuWjsNCiAgICB0LmoucHJvdG90eXBlLmFkZFRleHRUcmFjayA9IHQuai5wcm90b3R5cGUuYWRkVGV4dFRyYWNrOw0KICAgIHQuai5wcm90b3R5cGUuYWRkUmVtb3RlVGV4dFRyYWNrID0gdC5qLnByb3RvdHlwZS5pYTsNCiAgICB0LmoucHJvdG90eXBlLnJlbW92ZVJlbW90ZVRleHRUcmFjayA9IHQuai5wcm90b3R5cGUuRWE7DQogICAgJCgidmlkZW9qcy5IdG1sNSIsIHQuZSk7DQogICAgdC5lLkV2ZW50cyA9IHQuZS5BYjsNCiAgICB0LmUuaXNTdXBwb3J0ZWQgPSB0LmUuaXNTdXBwb3J0ZWQ7DQogICAgdC5lLmNhblBsYXlTb3VyY2UgPSB0LmUuQWM7DQogICAgdC5lLnBhdGNoQ2FuUGxheVR5cGUgPSB0LmUuWGM7DQogICAgdC5lLnVucGF0Y2hDYW5QbGF5VHlwZSA9IHQuZS5jZjsNCiAgICB0LmUucHJvdG90eXBlLnNldEN1cnJlbnRUaW1lID0gdC5lLnByb3RvdHlwZS5jYzsNCiAgICB0LmUucHJvdG90eXBlLnNldFZvbHVtZSA9IHQuZS5wcm90b3R5cGUuVGU7DQogICAgdC5lLnByb3RvdHlwZS5zZXRNdXRlZCA9IHQuZS5wcm90b3R5cGUuUGU7DQogICAgdC5lLnByb3RvdHlwZS5zZXRQcmVsb2FkID0gdC5lLnByb3RvdHlwZS5SZTsNCiAgICB0LmUucHJvdG90eXBlLnNldEF1dG9wbGF5ID0gdC5lLnByb3RvdHlwZS5NZTsNCiAgICB0LmUucHJvdG90eXBlLnNldExvb3AgPSB0LmUucHJvdG90eXBlLk9lOw0KICAgIHQuZS5wcm90b3R5cGUuZW50ZXJGdWxsU2NyZWVuID0gdC5lLnByb3RvdHlwZS5JYzsNCiAgICB0LmUucHJvdG90eXBlLmV4aXRGdWxsU2NyZWVuID0gdC5lLnByb3RvdHlwZS5ZZDsNCiAgICB0LmUucHJvdG90eXBlLnBsYXliYWNrUmF0ZSA9IHQuZS5wcm90b3R5cGUucGxheWJhY2tSYXRlOw0KICAgIHQuZS5wcm90b3R5cGUuc2V0UGxheWJhY2tSYXRlID0gdC5lLnByb3RvdHlwZS5RZTsNCiAgICB0LmUucmVnaXN0ZXJTb3VyY2VIYW5kbGVyID0gdC5lLlRhOw0KICAgIHQuZS5zZWxlY3RTb3VyY2VIYW5kbGVyID0gdC5lLnJiOw0KICAgIHQuZS5wcm90b3R5cGUuc2V0U291cmNlID0gdC5lLnByb3RvdHlwZS5uYTsNCiAgICB0LmUucHJvdG90eXBlLmRpc3Bvc2VTb3VyY2VIYW5kbGVyID0gdC5lLnByb3RvdHlwZS5qYTsNCiAgICB0LmUucHJvdG90eXBlLnRleHRUcmFja3MgPSB0LmUucHJvdG90eXBlLnRleHRUcmFja3M7DQogICAgdC5lLnByb3RvdHlwZS5yZW1vdGVUZXh0VHJhY2tzID0gdC5lLnByb3RvdHlwZS5aOw0KICAgIHQuZS5wcm90b3R5cGUuYWRkVGV4dFRyYWNrID0gdC5lLnByb3RvdHlwZS5hZGRUZXh0VHJhY2s7DQogICAgdC5lLnByb3RvdHlwZS5hZGRSZW1vdGVUZXh0VHJhY2sgPSB0LmUucHJvdG90eXBlLmlhOw0KICAgIHQuZS5wcm90b3R5cGUucmVtb3ZlUmVtb3RlVGV4dFRyYWNrID0gdC5lLnByb3RvdHlwZS5FYTsNCiAgICAkKCJ2aWRlb2pzLkZsYXNoIiwgdC5nKTsNCiAgICB0LmcuaXNTdXBwb3J0ZWQgPSB0LmcuaXNTdXBwb3J0ZWQ7DQogICAgdC5nLmNhblBsYXlTb3VyY2UgPSB0LmcuQWM7DQogICAgdC5nLm9uUmVhZHkgPSB0Lmcub25SZWFkeTsNCiAgICB0LmcuZW1iZWQgPSB0LmcuSGM7DQogICAgdC5nLnZlcnNpb24gPSB0LmcudmVyc2lvbjsNCiAgICB0LmcucHJvdG90eXBlLnNldFNvdXJjZSA9IHQuZy5wcm90b3R5cGUubmE7DQogICAgdC5nLnJlZ2lzdGVyU291cmNlSGFuZGxlciA9IHQuZy5UYTsNCiAgICB0Lmcuc2VsZWN0U291cmNlSGFuZGxlciA9IHQuZy5yYjsNCiAgICB0LmcucHJvdG90eXBlLnNldFNvdXJjZSA9IHQuZy5wcm90b3R5cGUubmE7DQogICAgdC5nLnByb3RvdHlwZS5kaXNwb3NlU291cmNlSGFuZGxlciA9IHQuZy5wcm90b3R5cGUuamE7DQogICAgJCgidmlkZW9qcy5UZXh0VHJhY2siLCB0LnQpOw0KICAgICQoInZpZGVvanMuVGV4dFRyYWNrTGlzdCIsIHQuRik7DQogICAgJCgidmlkZW9qcy5UZXh0VHJhY2tDdWVMaXN0IiwgdC5XKTsNCiAgICAkKCJ2aWRlb2pzLlRleHRUcmFja1NldHRpbmdzIiwgdC50Yyk7DQogICAgdC50LnByb3RvdHlwZS5pZCA9IHQudC5wcm90b3R5cGUuaWQ7DQogICAgdC50LnByb3RvdHlwZS5sYWJlbCA9IHQudC5wcm90b3R5cGUubGFiZWw7DQogICAgdC50LnByb3RvdHlwZS5raW5kID0gdC50LnByb3RvdHlwZS5YYjsNCiAgICB0LnQucHJvdG90eXBlLm1vZGUgPSB0LnQucHJvdG90eXBlLm1vZGU7DQogICAgdC50LnByb3RvdHlwZS5jdWVzID0gdC50LnByb3RvdHlwZS5FYzsNCiAgICB0LnQucHJvdG90eXBlLmFjdGl2ZUN1ZXMgPSB0LnQucHJvdG90eXBlLm9mOw0KICAgIHQudC5wcm90b3R5cGUuYWRkQ3VlID0gdC50LnByb3RvdHlwZS53YzsNCiAgICB0LnQucHJvdG90eXBlLnJlbW92ZUN1ZSA9IHQudC5wcm90b3R5cGUuYmQ7DQogICAgdC5GLnByb3RvdHlwZS5nZXRUcmFja0J5SWQgPSB0LkYucHJvdG90eXBlLmVlOw0KICAgIHQuVy5wcm90b3R5cGUuZ2V0Q3VlQnlJZCA9IHQuRi5wcm90b3R5cGUuY2U7DQogICAgJCgidmlkZW9qcy5DYXB0aW9uc1RyYWNrIiwgdC5oZik7DQogICAgJCgidmlkZW9qcy5TdWJ0aXRsZXNUcmFjayIsIHQubmYpOw0KICAgICQoInZpZGVvanMuQ2hhcHRlcnNUcmFjayIsIHQuamYpOw0KICAgICQoInZpZGVvanMuYXV0b1NldHVwIiwgdC55Yyk7DQogICAgJCgidmlkZW9qcy5wbHVnaW4iLCB0LkdlKTsNCiAgICAkKCJ2aWRlb2pzLmNyZWF0ZVRpbWVSYW5nZSIsIHQueWEpOw0KICAgICQoInZpZGVvanMudXRpbCIsIHQuJCk7DQogICAgdC4kLm1lcmdlT3B0aW9ucyA9IHQuJC5CYTsNCiAgICB0LmFkZExhbmd1YWdlID0gdC5LZDsNCn0pKCk7DQoNCi8qIHZ0dC5qcyAtIHYwLjEyLjEgKGh0dHBzOi8vZ2l0aHViLmNvbS9tb3ppbGxhL3Z0dC5qcykgYnVpbHQgb24gMDgtMDctMjAxNSAqLw0KISBmdW5jdGlvbiAoYSkgew0KICAgIHZhciBiID0gYS52dHRqcyA9IHt9LA0KICAgICAgICBjID0gYi5WVFRDdWUsDQogICAgICAgIGQgPSBiLlZUVFJlZ2lvbiwNCiAgICAgICAgZSA9IGEuVlRUQ3VlLA0KICAgICAgICBmID0gYS5WVFRSZWdpb247DQogICAgYi5zaGltID0gZnVuY3Rpb24gKCkgew0KICAgICAgICBiLlZUVEN1ZSA9IGMsIGIuVlRUUmVnaW9uID0gZA0KICAgIH0sIGIucmVzdG9yZSA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgYi5WVFRDdWUgPSBlLCBiLlZUVFJlZ2lvbiA9IGYNCiAgICB9DQp9KHRoaXMpLA0KZnVuY3Rpb24gKGEsIGIpIHsNCiAgICBmdW5jdGlvbiBjKGEpIHsNCiAgICAgICAgaWYgKCJzdHJpbmciICE9IHR5cGVvZiBhKSByZXR1cm4gITE7DQogICAgICAgIHZhciBiID0gaFthLnRvTG93ZXJDYXNlKCldOw0KICAgICAgICByZXR1cm4gYiA/IGEudG9Mb3dlckNhc2UoKSA6ICExDQogICAgfQ0KDQogICAgZnVuY3Rpb24gZChhKSB7DQogICAgICAgIGlmICgic3RyaW5nIiAhPSB0eXBlb2YgYSkgcmV0dXJuICExOw0KICAgICAgICB2YXIgYiA9IGlbYS50b0xvd2VyQ2FzZSgpXTsNCiAgICAgICAgcmV0dXJuIGIgPyBhLnRvTG93ZXJDYXNlKCkgOiAhMQ0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGUoYSkgew0KICAgICAgICBmb3IgKHZhciBiID0gMTsgYiA8IGFyZ3VtZW50cy5sZW5ndGg7IGIrKykgew0KICAgICAgICAgICAgdmFyIGMgPSBhcmd1bWVudHNbYl07DQogICAgICAgICAgICBmb3IgKHZhciBkIGluIGMpIGFbZF0gPSBjW2RdDQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIGENCiAgICB9DQoNCiAgICBmdW5jdGlvbiBmKGEsIGIsIGYpIHsNCiAgICAgICAgdmFyIGggPSB0aGlzLA0KICAgICAgICAgICAgaSA9IC9NU0lFXHM4XC4wLy50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpLA0KICAgICAgICAgICAgaiA9IHt9Ow0KICAgICAgICBpID8gaCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImN1c3RvbSIpIDogai5lbnVtZXJhYmxlID0gITAsIGguaGFzQmVlblJlc2V0ID0gITE7DQogICAgICAgIHZhciBrID0gIiIsDQogICAgICAgICAgICBsID0gITEsDQogICAgICAgICAgICBtID0gYSwNCiAgICAgICAgICAgIG4gPSBiLA0KICAgICAgICAgICAgbyA9IGYsDQogICAgICAgICAgICBwID0gbnVsbCwNCiAgICAgICAgICAgIHEgPSAiIiwNCiAgICAgICAgICAgIHIgPSAhMCwNCiAgICAgICAgICAgIHMgPSAiYXV0byIsDQogICAgICAgICAgICB0ID0gInN0YXJ0IiwNCiAgICAgICAgICAgIHUgPSA1MCwNCiAgICAgICAgICAgIHYgPSAibWlkZGxlIiwNCiAgICAgICAgICAgIHcgPSA1MCwNCiAgICAgICAgICAgIHggPSAibWlkZGxlIjsNCiAgICAgICAgcmV0dXJuIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShoLCAiaWQiLCBlKHt9LCBqLCB7DQogICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gaw0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIHNldDogZnVuY3Rpb24gKGEpIHsNCiAgICAgICAgICAgICAgICBrID0gIiIgKyBhDQogICAgICAgICAgICB9DQogICAgICAgIH0pKSwgT2JqZWN0LmRlZmluZVByb3BlcnR5KGgsICJwYXVzZU9uRXhpdCIsIGUoe30sIGosIHsNCiAgICAgICAgICAgIGdldDogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgIHJldHVybiBsDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgc2V0OiBmdW5jdGlvbiAoYSkgew0KICAgICAgICAgICAgICAgIGwgPSAhIWENCiAgICAgICAgICAgIH0NCiAgICAgICAgfSkpLCBPYmplY3QuZGVmaW5lUHJvcGVydHkoaCwgInN0YXJ0VGltZSIsIGUoe30sIGosIHsNCiAgICAgICAgICAgIGdldDogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgIHJldHVybiBtDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgc2V0OiBmdW5jdGlvbiAoYSkgew0KICAgICAgICAgICAgICAgIGlmICgibnVtYmVyIiAhPSB0eXBlb2YgYSkgdGhyb3cgbmV3IFR5cGVFcnJvcigiU3RhcnQgdGltZSBtdXN0IGJlIHNldCB0byBhIG51bWJlci4iKTsNCiAgICAgICAgICAgICAgICBtID0gYSwgdGhpcy5oYXNCZWVuUmVzZXQgPSAhMA0KICAgICAgICAgICAgfQ0KICAgICAgICB9KSksIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShoLCAiZW5kVGltZSIsIGUoe30sIGosIHsNCiAgICAgICAgICAgIGdldDogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgIHJldHVybiBuDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgc2V0OiBmdW5jdGlvbiAoYSkgew0KICAgICAgICAgICAgICAgIGlmICgibnVtYmVyIiAhPSB0eXBlb2YgYSkgdGhyb3cgbmV3IFR5cGVFcnJvcigiRW5kIHRpbWUgbXVzdCBiZSBzZXQgdG8gYSBudW1iZXIuIik7DQogICAgICAgICAgICAgICAgbiA9IGEsIHRoaXMuaGFzQmVlblJlc2V0ID0gITANCiAgICAgICAgICAgIH0NCiAgICAgICAgfSkpLCBPYmplY3QuZGVmaW5lUHJvcGVydHkoaCwgInRleHQiLCBlKHt9LCBqLCB7DQogICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gbw0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIHNldDogZnVuY3Rpb24gKGEpIHsNCiAgICAgICAgICAgICAgICBvID0gIiIgKyBhLCB0aGlzLmhhc0JlZW5SZXNldCA9ICEwDQogICAgICAgICAgICB9DQogICAgICAgIH0pKSwgT2JqZWN0LmRlZmluZVByb3BlcnR5KGgsICJyZWdpb24iLCBlKHt9LCBqLCB7DQogICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gcA0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIHNldDogZnVuY3Rpb24gKGEpIHsNCiAgICAgICAgICAgICAgICBwID0gYSwgdGhpcy5oYXNCZWVuUmVzZXQgPSAhMA0KICAgICAgICAgICAgfQ0KICAgICAgICB9KSksIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShoLCAidmVydGljYWwiLCBlKHt9LCBqLCB7DQogICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gcQ0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIHNldDogZnVuY3Rpb24gKGEpIHsNCiAgICAgICAgICAgICAgICB2YXIgYiA9IGMoYSk7DQogICAgICAgICAgICAgICAgaWYgKGIgPT09ICExKSB0aHJvdyBuZXcgU3ludGF4RXJyb3IoIkFuIGludmFsaWQgb3IgaWxsZWdhbCBzdHJpbmcgd2FzIHNwZWNpZmllZC4iKTsNCiAgICAgICAgICAgICAgICBxID0gYiwgdGhpcy5oYXNCZWVuUmVzZXQgPSAhMA0KICAgICAgICAgICAgfQ0KICAgICAgICB9KSksIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShoLCAic25hcFRvTGluZXMiLCBlKHt9LCBqLCB7DQogICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gcg0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIHNldDogZnVuY3Rpb24gKGEpIHsNCiAgICAgICAgICAgICAgICByID0gISFhLCB0aGlzLmhhc0JlZW5SZXNldCA9ICEwDQogICAgICAgICAgICB9DQogICAgICAgIH0pKSwgT2JqZWN0LmRlZmluZVByb3BlcnR5KGgsICJsaW5lIiwgZSh7fSwgaiwgew0KICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIHMNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBzZXQ6IGZ1bmN0aW9uIChhKSB7DQogICAgICAgICAgICAgICAgaWYgKCJudW1iZXIiICE9IHR5cGVvZiBhICYmIGEgIT09IGcpIHRocm93IG5ldyBTeW50YXhFcnJvcigiQW4gaW52YWxpZCBudW1iZXIgb3IgaWxsZWdhbCBzdHJpbmcgd2FzIHNwZWNpZmllZC4iKTsNCiAgICAgICAgICAgICAgICBzID0gYSwgdGhpcy5oYXNCZWVuUmVzZXQgPSAhMA0KICAgICAgICAgICAgfQ0KICAgICAgICB9KSksIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShoLCAibGluZUFsaWduIiwgZSh7fSwgaiwgew0KICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIHQNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBzZXQ6IGZ1bmN0aW9uIChhKSB7DQogICAgICAgICAgICAgICAgdmFyIGIgPSBkKGEpOw0KICAgICAgICAgICAgICAgIGlmICghYikgdGhyb3cgbmV3IFN5bnRheEVycm9yKCJBbiBpbnZhbGlkIG9yIGlsbGVnYWwgc3RyaW5nIHdhcyBzcGVjaWZpZWQuIik7DQogICAgICAgICAgICAgICAgdCA9IGIsIHRoaXMuaGFzQmVlblJlc2V0ID0gITANCiAgICAgICAgICAgIH0NCiAgICAgICAgfSkpLCBPYmplY3QuZGVmaW5lUHJvcGVydHkoaCwgInBvc2l0aW9uIiwgZSh7fSwgaiwgew0KICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIHUNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBzZXQ6IGZ1bmN0aW9uIChhKSB7DQogICAgICAgICAgICAgICAgaWYgKDAgPiBhIHx8IGEgPiAxMDApIHRocm93IG5ldyBFcnJvcigiUG9zaXRpb24gbXVzdCBiZSBiZXR3ZWVuIDAgYW5kIDEwMC4iKTsNCiAgICAgICAgICAgICAgICB1ID0gYSwgdGhpcy5oYXNCZWVuUmVzZXQgPSAhMA0KICAgICAgICAgICAgfQ0KICAgICAgICB9KSksIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShoLCAicG9zaXRpb25BbGlnbiIsIGUoe30sIGosIHsNCiAgICAgICAgICAgIGdldDogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgIHJldHVybiB2DQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgc2V0OiBmdW5jdGlvbiAoYSkgew0KICAgICAgICAgICAgICAgIHZhciBiID0gZChhKTsNCiAgICAgICAgICAgICAgICBpZiAoIWIpIHRocm93IG5ldyBTeW50YXhFcnJvcigiQW4gaW52YWxpZCBvciBpbGxlZ2FsIHN0cmluZyB3YXMgc3BlY2lmaWVkLiIpOw0KICAgICAgICAgICAgICAgIHYgPSBiLCB0aGlzLmhhc0JlZW5SZXNldCA9ICEwDQogICAgICAgICAgICB9DQogICAgICAgIH0pKSwgT2JqZWN0LmRlZmluZVByb3BlcnR5KGgsICJzaXplIiwgZSh7fSwgaiwgew0KICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIHcNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBzZXQ6IGZ1bmN0aW9uIChhKSB7DQogICAgICAgICAgICAgICAgaWYgKDAgPiBhIHx8IGEgPiAxMDApIHRocm93IG5ldyBFcnJvcigiU2l6ZSBtdXN0IGJlIGJldHdlZW4gMCBhbmQgMTAwLiIpOw0KICAgICAgICAgICAgICAgIHcgPSBhLCB0aGlzLmhhc0JlZW5SZXNldCA9ICEwDQogICAgICAgICAgICB9DQogICAgICAgIH0pKSwgT2JqZWN0LmRlZmluZVByb3BlcnR5KGgsICJhbGlnbiIsIGUoe30sIGosIHsNCiAgICAgICAgICAgIGdldDogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgIHJldHVybiB4DQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgc2V0OiBmdW5jdGlvbiAoYSkgew0KICAgICAgICAgICAgICAgIHZhciBiID0gZChhKTsNCiAgICAgICAgICAgICAgICBpZiAoIWIpIHRocm93IG5ldyBTeW50YXhFcnJvcigiQW4gaW52YWxpZCBvciBpbGxlZ2FsIHN0cmluZyB3YXMgc3BlY2lmaWVkLiIpOw0KICAgICAgICAgICAgICAgIHggPSBiLCB0aGlzLmhhc0JlZW5SZXNldCA9ICEwDQogICAgICAgICAgICB9DQogICAgICAgIH0pKSwgaC5kaXNwbGF5U3RhdGUgPSB2b2lkIDAsIGkgPyBoIDogdm9pZCAwDQogICAgfQ0KICAgIHZhciBnID0gImF1dG8iLA0KICAgICAgICBoID0gew0KICAgICAgICAgICAgIiI6ICEwLA0KICAgICAgICAgICAgbHI6ICEwLA0KICAgICAgICAgICAgcmw6ICEwDQogICAgICAgIH0sDQogICAgICAgIGkgPSB7DQogICAgICAgICAgICBzdGFydDogITAsDQogICAgICAgICAgICBtaWRkbGU6ICEwLA0KICAgICAgICAgICAgZW5kOiAhMCwNCiAgICAgICAgICAgIGxlZnQ6ICEwLA0KICAgICAgICAgICAgcmlnaHQ6ICEwDQogICAgICAgIH07DQogICAgZi5wcm90b3R5cGUuZ2V0Q3VlQXNIVE1MID0gZnVuY3Rpb24gKCkgew0KICAgICAgICByZXR1cm4gV2ViVlRULmNvbnZlcnRDdWVUb0RPTVRyZWUod2luZG93LCB0aGlzLnRleHQpDQogICAgfSwgYS5WVFRDdWUgPSBhLlZUVEN1ZSB8fCBmLCBiLlZUVEN1ZSA9IGYNCn0odGhpcywgdGhpcy52dHRqcyB8fCB7fSksDQpmdW5jdGlvbiAoYSwgYikgew0KICAgIGZ1bmN0aW9uIGMoYSkgew0KICAgICAgICBpZiAoInN0cmluZyIgIT0gdHlwZW9mIGEpIHJldHVybiAhMTsNCiAgICAgICAgdmFyIGIgPSBmW2EudG9Mb3dlckNhc2UoKV07DQogICAgICAgIHJldHVybiBiID8gYS50b0xvd2VyQ2FzZSgpIDogITENCiAgICB9DQoNCiAgICBmdW5jdGlvbiBkKGEpIHsNCiAgICAgICAgcmV0dXJuICJudW1iZXIiID09IHR5cGVvZiBhICYmIGEgPj0gMCAmJiAxMDAgPj0gYQ0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGUoKSB7DQogICAgICAgIHZhciBhID0gMTAwLA0KICAgICAgICAgICAgYiA9IDMsDQogICAgICAgICAgICBlID0gMCwNCiAgICAgICAgICAgIGYgPSAxMDAsDQogICAgICAgICAgICBnID0gMCwNCiAgICAgICAgICAgIGggPSAxMDAsDQogICAgICAgICAgICBpID0gIiI7DQogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKHRoaXMsIHsNCiAgICAgICAgICAgIHdpZHRoOiB7DQogICAgICAgICAgICAgICAgZW51bWVyYWJsZTogITAsDQogICAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBhDQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICBzZXQ6IGZ1bmN0aW9uIChiKSB7DQogICAgICAgICAgICAgICAgICAgIGlmICghZChiKSkgdGhyb3cgbmV3IEVycm9yKCJXaWR0aCBtdXN0IGJlIGJldHdlZW4gMCBhbmQgMTAwLiIpOw0KICAgICAgICAgICAgICAgICAgICBhID0gYg0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBsaW5lczogew0KICAgICAgICAgICAgICAgIGVudW1lcmFibGU6ICEwLA0KICAgICAgICAgICAgICAgIGdldDogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gYg0KICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgc2V0OiBmdW5jdGlvbiAoYSkgew0KICAgICAgICAgICAgICAgICAgICBpZiAoIm51bWJlciIgIT0gdHlwZW9mIGEpIHRocm93IG5ldyBUeXBlRXJyb3IoIkxpbmVzIG11c3QgYmUgc2V0IHRvIGEgbnVtYmVyLiIpOw0KICAgICAgICAgICAgICAgICAgICBiID0gYQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICByZWdpb25BbmNob3JZOiB7DQogICAgICAgICAgICAgICAgZW51bWVyYWJsZTogITAsDQogICAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmDQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICBzZXQ6IGZ1bmN0aW9uIChhKSB7DQogICAgICAgICAgICAgICAgICAgIGlmICghZChhKSkgdGhyb3cgbmV3IEVycm9yKCJSZWdpb25BbmNob3JYIG11c3QgYmUgYmV0d2VlbiAwIGFuZCAxMDAuIik7DQogICAgICAgICAgICAgICAgICAgIGYgPSBhDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIHJlZ2lvbkFuY2hvclg6IHsNCiAgICAgICAgICAgICAgICBlbnVtZXJhYmxlOiAhMCwNCiAgICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGUNCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgIHNldDogZnVuY3Rpb24gKGEpIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCFkKGEpKSB0aHJvdyBuZXcgRXJyb3IoIlJlZ2lvbkFuY2hvclkgbXVzdCBiZSBiZXR3ZWVuIDAgYW5kIDEwMC4iKTsNCiAgICAgICAgICAgICAgICAgICAgZSA9IGENCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgdmlld3BvcnRBbmNob3JZOiB7DQogICAgICAgICAgICAgICAgZW51bWVyYWJsZTogITAsDQogICAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBoDQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICBzZXQ6IGZ1bmN0aW9uIChhKSB7DQogICAgICAgICAgICAgICAgICAgIGlmICghZChhKSkgdGhyb3cgbmV3IEVycm9yKCJWaWV3cG9ydEFuY2hvclkgbXVzdCBiZSBiZXR3ZWVuIDAgYW5kIDEwMC4iKTsNCiAgICAgICAgICAgICAgICAgICAgaCA9IGENCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgdmlld3BvcnRBbmNob3JYOiB7DQogICAgICAgICAgICAgICAgZW51bWVyYWJsZTogITAsDQogICAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBnDQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICBzZXQ6IGZ1bmN0aW9uIChhKSB7DQogICAgICAgICAgICAgICAgICAgIGlmICghZChhKSkgdGhyb3cgbmV3IEVycm9yKCJWaWV3cG9ydEFuY2hvclggbXVzdCBiZSBiZXR3ZWVuIDAgYW5kIDEwMC4iKTsNCiAgICAgICAgICAgICAgICAgICAgZyA9IGENCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgc2Nyb2xsOiB7DQogICAgICAgICAgICAgICAgZW51bWVyYWJsZTogITAsDQogICAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBpDQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICBzZXQ6IGZ1bmN0aW9uIChhKSB7DQogICAgICAgICAgICAgICAgICAgIHZhciBiID0gYyhhKTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGIgPT09ICExKSB0aHJvdyBuZXcgU3ludGF4RXJyb3IoIkFuIGludmFsaWQgb3IgaWxsZWdhbCBzdHJpbmcgd2FzIHNwZWNpZmllZC4iKTsNCiAgICAgICAgICAgICAgICAgICAgaSA9IGINCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0pDQogICAgfQ0KICAgIHZhciBmID0gew0KICAgICAgICAiIjogITAsDQogICAgICAgIHVwOiAhMA0KICAgIH07DQogICAgYS5WVFRSZWdpb24gPSBhLlZUVFJlZ2lvbiB8fCBlLCBiLlZUVFJlZ2lvbiA9IGUNCn0odGhpcywgdGhpcy52dHRqcyB8fCB7fSksDQpmdW5jdGlvbiAoYSkgew0KICAgIGZ1bmN0aW9uIGIoYSwgYikgew0KICAgICAgICB0aGlzLm5hbWUgPSAiUGFyc2luZ0Vycm9yIiwgdGhpcy5jb2RlID0gYS5jb2RlLCB0aGlzLm1lc3NhZ2UgPSBiIHx8IGEubWVzc2FnZQ0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGMoYSkgew0KICAgICAgICBmdW5jdGlvbiBiKGEsIGIsIGMsIGQpIHsNCiAgICAgICAgICAgIHJldHVybiAzNjAwICogKDAgfCBhKSArIDYwICogKDAgfCBiKSArICgwIHwgYykgKyAoMCB8IGQpIC8gMWUzDQogICAgICAgIH0NCiAgICAgICAgdmFyIGMgPSBhLm1hdGNoKC9eKFxkKyk6KFxkezJ9KSg6XGR7Mn0pP1wuKFxkezN9KS8pOw0KICAgICAgICByZXR1cm4gYyA/IGNbM10gPyBiKGNbMV0sIGNbMl0sIGNbM10ucmVwbGFjZSgiOiIsICIiKSwgY1s0XSkgOiBjWzFdID4gNTkgPyBiKGNbMV0sIGNbMl0sIDAsIGNbNF0pIDogYigwLCBjWzFdLCBjWzJdLCBjWzRdKSA6IG51bGwNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBkKCkgew0KICAgICAgICB0aGlzLnZhbHVlcyA9IG8obnVsbCkNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBlKGEsIGIsIGMsIGQpIHsNCiAgICAgICAgdmFyIGUgPSBkID8gYS5zcGxpdChkKSA6IFthXTsNCiAgICAgICAgZm9yICh2YXIgZiBpbiBlKQ0KICAgICAgICAgICAgaWYgKCJzdHJpbmciID09IHR5cGVvZiBlW2ZdKSB7DQogICAgICAgICAgICAgICAgdmFyIGcgPSBlW2ZdLnNwbGl0KGMpOw0KICAgICAgICAgICAgICAgIGlmICgyID09PSBnLmxlbmd0aCkgew0KICAgICAgICAgICAgICAgICAgICB2YXIgaCA9IGdbMF0sDQogICAgICAgICAgICAgICAgICAgICAgICBpID0gZ1sxXTsNCiAgICAgICAgICAgICAgICAgICAgYihoLCBpKQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICB9DQoNCiAgICBmdW5jdGlvbiBmKGEsIGYsIGcpIHsNCiAgICAgICAgZnVuY3Rpb24gaCgpIHsNCiAgICAgICAgICAgIHZhciBkID0gYyhhKTsNCiAgICAgICAgICAgIGlmIChudWxsID09PSBkKSB0aHJvdyBuZXcgYihiLkVycm9ycy5CYWRUaW1lU3RhbXAsICJNYWxmb3JtZWQgdGltZXN0YW1wOiAiICsgayk7DQogICAgICAgICAgICByZXR1cm4gYSA9IGEucmVwbGFjZSgvXlteXHNhLXpBLVotXSsvLCAiIiksIGQNCiAgICAgICAgfQ0KDQogICAgICAgIGZ1bmN0aW9uIGkoYSwgYikgew0KICAgICAgICAgICAgdmFyIGMgPSBuZXcgZDsNCiAgICAgICAgICAgIGUoYSwgZnVuY3Rpb24gKGEsIGIpIHsNCiAgICAgICAgICAgICAgICBzd2l0Y2ggKGEpIHsNCiAgICAgICAgICAgICAgICAgICAgY2FzZSAicmVnaW9uIjoNCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGQgPSBnLmxlbmd0aCAtIDE7IGQgPj0gMDsgZC0tKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChnW2RdLmlkID09PSBiKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMuc2V0KGEsIGdbZF0ucmVnaW9uKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgY2FzZSAidmVydGljYWwiOg0KICAgICAgICAgICAgICAgICAgICAgICAgYy5hbHQoYSwgYiwgWyJybCIsICJsciJdKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICBjYXNlICJsaW5lIjoNCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlID0gYi5zcGxpdCgiLCIpLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYgPSBlWzBdOw0KICAgICAgICAgICAgICAgICAgICAgICAgYy5pbnRlZ2VyKGEsIGYpLCBjLnBlcmNlbnQoYSwgZikgPyBjLnNldCgic25hcFRvTGluZXMiLCAhMSkgOiBudWxsLCBjLmFsdChhLCBmLCBbImF1dG8iXSksIDIgPT09IGUubGVuZ3RoICYmIGMuYWx0KCJsaW5lQWxpZ24iLCBlWzFdLCBbInN0YXJ0IiwgIm1pZGRsZSIsICJlbmQiXSk7DQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgY2FzZSAicG9zaXRpb24iOg0KICAgICAgICAgICAgICAgICAgICAgICAgZSA9IGIuc3BsaXQoIiwiKSwgYy5wZXJjZW50KGEsIGVbMF0pLCAyID09PSBlLmxlbmd0aCAmJiBjLmFsdCgicG9zaXRpb25BbGlnbiIsIGVbMV0sIFsic3RhcnQiLCAibWlkZGxlIiwgImVuZCJdKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICBjYXNlICJzaXplIjoNCiAgICAgICAgICAgICAgICAgICAgICAgIGMucGVyY2VudChhLCBiKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICBjYXNlICJhbGlnbiI6DQogICAgICAgICAgICAgICAgICAgICAgICBjLmFsdChhLCBiLCBbInN0YXJ0IiwgIm1pZGRsZSIsICJlbmQiLCAibGVmdCIsICJyaWdodCJdKQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0sIC86LywgL1xzLyksIGIucmVnaW9uID0gYy5nZXQoInJlZ2lvbiIsIG51bGwpLCBiLnZlcnRpY2FsID0gYy5nZXQoInZlcnRpY2FsIiwgIiIpLCBiLmxpbmUgPSBjLmdldCgibGluZSIsICJhdXRvIiksIGIubGluZUFsaWduID0gYy5nZXQoImxpbmVBbGlnbiIsICJzdGFydCIpLCBiLnNuYXBUb0xpbmVzID0gYy5nZXQoInNuYXBUb0xpbmVzIiwgITApLCBiLnNpemUgPSBjLmdldCgic2l6ZSIsIDEwMCksIGIuYWxpZ24gPSBjLmdldCgiYWxpZ24iLCAibWlkZGxlIiksIGIucG9zaXRpb24gPSBjLmdldCgicG9zaXRpb24iLCB7DQogICAgICAgICAgICAgICAgc3RhcnQ6IDAsDQogICAgICAgICAgICAgICAgbGVmdDogMCwNCiAgICAgICAgICAgICAgICBtaWRkbGU6IDUwLA0KICAgICAgICAgICAgICAgIGVuZDogMTAwLA0KICAgICAgICAgICAgICAgIHJpZ2h0OiAxMDANCiAgICAgICAgICAgIH0sIGIuYWxpZ24pLCBiLnBvc2l0aW9uQWxpZ24gPSBjLmdldCgicG9zaXRpb25BbGlnbiIsIHsNCiAgICAgICAgICAgICAgICBzdGFydDogInN0YXJ0IiwNCiAgICAgICAgICAgICAgICBsZWZ0OiAic3RhcnQiLA0KICAgICAgICAgICAgICAgIG1pZGRsZTogIm1pZGRsZSIsDQogICAgICAgICAgICAgICAgZW5kOiAiZW5kIiwNCiAgICAgICAgICAgICAgICByaWdodDogImVuZCINCiAgICAgICAgICAgIH0sIGIuYWxpZ24pDQogICAgICAgIH0NCg0KICAgICAgICBmdW5jdGlvbiBqKCkgew0KICAgICAgICAgICAgYSA9IGEucmVwbGFjZSgvXlxzKy8sICIiKQ0KICAgICAgICB9DQogICAgICAgIHZhciBrID0gYTsNCiAgICAgICAgaWYgKGooKSwgZi5zdGFydFRpbWUgPSBoKCksIGooKSwgIi0tPiIgIT09IGEuc3Vic3RyKDAsIDMpKSB0aHJvdyBuZXcgYihiLkVycm9ycy5CYWRUaW1lU3RhbXAsICJNYWxmb3JtZWQgdGltZSBzdGFtcCAodGltZSBzdGFtcHMgbXVzdCBiZSBzZXBhcmF0ZWQgYnkgJy0tPicpOiAiICsgayk7DQogICAgICAgIGEgPSBhLnN1YnN0cigzKSwgaigpLCBmLmVuZFRpbWUgPSBoKCksIGooKSwgaShhLCBmKQ0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGcoYSwgYikgew0KICAgICAgICBmdW5jdGlvbiBkKCkgew0KICAgICAgICAgICAgZnVuY3Rpb24gYShhKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGIgPSBiLnN1YnN0cihhLmxlbmd0aCksIGENCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmICghYikgcmV0dXJuIG51bGw7DQogICAgICAgICAgICB2YXIgYyA9IGIubWF0Y2goL14oW148XSopKDxbXj5dKz4/KT8vKTsNCiAgICAgICAgICAgIHJldHVybiBhKGNbMV0gPyBjWzFdIDogY1syXSkNCiAgICAgICAgfQ0KDQogICAgICAgIGZ1bmN0aW9uIGUoYSkgew0KICAgICAgICAgICAgcmV0dXJuIHBbYV0NCiAgICAgICAgfQ0KDQogICAgICAgIGZ1bmN0aW9uIGYoYSkgew0KICAgICAgICAgICAgZm9yICg7IG8gPSBhLm1hdGNoKC8mKGFtcHxsdHxndHxscm18cmxtfG5ic3ApOy8pIDspIGEgPSBhLnJlcGxhY2Uob1swXSwgZSk7DQogICAgICAgICAgICByZXR1cm4gYQ0KICAgICAgICB9DQoNCiAgICAgICAgZnVuY3Rpb24gZyhhLCBiKSB7DQogICAgICAgICAgICByZXR1cm4gIXNbYi5sb2NhbE5hbWVdIHx8IHNbYi5sb2NhbE5hbWVdID09PSBhLmxvY2FsTmFtZQ0KICAgICAgICB9DQoNCiAgICAgICAgZnVuY3Rpb24gaChiLCBjKSB7DQogICAgICAgICAgICB2YXIgZCA9IHFbYl07DQogICAgICAgICAgICBpZiAoIWQpIHJldHVybiBudWxsOw0KICAgICAgICAgICAgdmFyIGUgPSBhLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoZCk7DQogICAgICAgICAgICBlLmxvY2FsTmFtZSA9IGQ7DQogICAgICAgICAgICB2YXIgZiA9IHJbYl07DQogICAgICAgICAgICByZXR1cm4gZiAmJiBjICYmIChlW2ZdID0gYy50cmltKCkpLCBlDQogICAgICAgIH0NCiAgICAgICAgZm9yICh2YXIgaSwgaiA9IGEuZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IiksIGsgPSBqLCBsID0gW107IG51bGwgIT09IChpID0gZCgpKSA7KQ0KICAgICAgICAgICAgaWYgKCI8IiAhPT0gaVswXSkgay5hcHBlbmRDaGlsZChhLmRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGYoaSkpKTsNCiAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgIGlmICgiLyIgPT09IGlbMV0pIHsNCiAgICAgICAgICAgICAgICAgICAgbC5sZW5ndGggJiYgbFtsLmxlbmd0aCAtIDFdID09PSBpLnN1YnN0cigyKS5yZXBsYWNlKCI+IiwgIiIpICYmIChsLnBvcCgpLCBrID0gay5wYXJlbnROb2RlKTsNCiAgICAgICAgICAgICAgICAgICAgY29udGludWUNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgdmFyIG0sIG4gPSBjKGkuc3Vic3RyKDEsIGkubGVuZ3RoIC0gMikpOw0KICAgICAgICAgICAgICAgIGlmIChuKSB7DQogICAgICAgICAgICAgICAgICAgIG0gPSBhLmRvY3VtZW50LmNyZWF0ZVByb2Nlc3NpbmdJbnN0cnVjdGlvbigidGltZXN0YW1wIiwgbiksIGsuYXBwZW5kQ2hpbGQobSk7DQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHZhciBvID0gaS5tYXRjaCgvXjwoW14uXHMvMC05Pl0rKShcLlteXHNcXD5dKyk/KFtePlxcXSspPyhcXD8pPj8kLyk7DQogICAgICAgICAgICAgICAgaWYgKCFvKSBjb250aW51ZTsNCiAgICAgICAgICAgICAgICBpZiAobSA9IGgob1sxXSwgb1szXSksICFtKSBjb250aW51ZTsNCiAgICAgICAgICAgICAgICBpZiAoIWcoaywgbSkpIGNvbnRpbnVlOw0KICAgICAgICAgICAgICAgIG9bMl0gJiYgKG0uY2xhc3NOYW1lID0gb1syXS5zdWJzdHIoMSkucmVwbGFjZSgiLiIsICIgIikpLCBsLnB1c2gob1sxXSksIGsuYXBwZW5kQ2hpbGQobSksIGsgPSBtDQogICAgICAgICAgICB9DQogICAgICAgIHJldHVybiBqDQogICAgfQ0KDQogICAgZnVuY3Rpb24gaChhKSB7DQogICAgICAgIGZ1bmN0aW9uIGIoYSwgYikgew0KICAgICAgICAgICAgZm9yICh2YXIgYyA9IGIuY2hpbGROb2Rlcy5sZW5ndGggLSAxOyBjID49IDA7IGMtLSkgYS5wdXNoKGIuY2hpbGROb2Rlc1tjXSkNCiAgICAgICAgfQ0KDQogICAgICAgIGZ1bmN0aW9uIGMoYSkgew0KICAgICAgICAgICAgaWYgKCFhIHx8ICFhLmxlbmd0aCkgcmV0dXJuIG51bGw7DQogICAgICAgICAgICB2YXIgZCA9IGEucG9wKCksDQogICAgICAgICAgICAgICAgZSA9IGQudGV4dENvbnRlbnQgfHwgZC5pbm5lclRleHQ7DQogICAgICAgICAgICBpZiAoZSkgew0KICAgICAgICAgICAgICAgIHZhciBmID0gZS5tYXRjaCgvXi4qKFxufFxyKS8pOw0KICAgICAgICAgICAgICAgIHJldHVybiBmID8gKGEubGVuZ3RoID0gMCwgZlswXSkgOiBlDQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gInJ1YnkiID09PSBkLnRhZ05hbWUgPyBjKGEpIDogZC5jaGlsZE5vZGVzID8gKGIoYSwgZCksIGMoYSkpIDogdm9pZCAwDQogICAgICAgIH0NCiAgICAgICAgdmFyIGQsIGUgPSBbXSwNCiAgICAgICAgICAgIGYgPSAiIjsNCiAgICAgICAgaWYgKCFhIHx8ICFhLmNoaWxkTm9kZXMpIHJldHVybiAibHRyIjsNCiAgICAgICAgZm9yIChiKGUsIGEpIDsgZiA9IGMoZSkgOykNCiAgICAgICAgICAgIGZvciAodmFyIGcgPSAwOyBnIDwgZi5sZW5ndGg7IGcrKykgew0KICAgICAgICAgICAgICAgIGQgPSBmLmNoYXJDb2RlQXQoZyk7DQogICAgICAgICAgICAgICAgZm9yICh2YXIgaCA9IDA7IGggPCB0Lmxlbmd0aDsgaCsrKQ0KICAgICAgICAgICAgICAgICAgICBpZiAodFtoXSA9PT0gZCkgcmV0dXJuICJydGwiDQogICAgICAgICAgICB9DQogICAgICAgIHJldHVybiAibHRyIg0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIGkoYSkgew0KICAgICAgICBpZiAoIm51bWJlciIgPT0gdHlwZW9mIGEubGluZSAmJiAoYS5zbmFwVG9MaW5lcyB8fCBhLmxpbmUgPj0gMCAmJiBhLmxpbmUgPD0gMTAwKSkgcmV0dXJuIGEubGluZTsNCiAgICAgICAgaWYgKCFhLnRyYWNrIHx8ICFhLnRyYWNrLnRleHRUcmFja0xpc3QgfHwgIWEudHJhY2sudGV4dFRyYWNrTGlzdC5tZWRpYUVsZW1lbnQpIHJldHVybiAtMTsNCiAgICAgICAgZm9yICh2YXIgYiA9IGEudHJhY2ssIGMgPSBiLnRleHRUcmFja0xpc3QsIGQgPSAwLCBlID0gMDsgZSA8IGMubGVuZ3RoICYmIGNbZV0gIT09IGI7IGUrKykgInNob3dpbmciID09PSBjW2VdLm1vZGUgJiYgZCsrOw0KICAgICAgICByZXR1cm4gLTEgKiArK2QNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBqKCkgeyB9DQoNCiAgICBmdW5jdGlvbiBrKGEsIGIsIGMpIHsNCiAgICAgICAgdmFyIGQgPSAvTVNJRVxzOFwuMC8udGVzdChuYXZpZ2F0b3IudXNlckFnZW50KSwNCiAgICAgICAgICAgIGUgPSAicmdiYSgyNTUsIDI1NSwgMjU1LCAxKSIsDQogICAgICAgICAgICBmID0gInJnYmEoMCwgMCwgMCwgMC44KSI7DQogICAgICAgIGQgJiYgKGUgPSAicmdiKDI1NSwgMjU1LCAyNTUpIiwgZiA9ICJyZ2IoMCwgMCwgMCkiKSwgai5jYWxsKHRoaXMpLCB0aGlzLmN1ZSA9IGIsIHRoaXMuY3VlRGl2ID0gZyhhLCBiLnRleHQpOw0KICAgICAgICB2YXIgaSA9IHsNCiAgICAgICAgICAgIGNvbG9yOiBlLA0KICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiBmLA0KICAgICAgICAgICAgcG9zaXRpb246ICJyZWxhdGl2ZSIsDQogICAgICAgICAgICBsZWZ0OiAwLA0KICAgICAgICAgICAgcmlnaHQ6IDAsDQogICAgICAgICAgICB0b3A6IDAsDQogICAgICAgICAgICBib3R0b206IDAsDQogICAgICAgICAgICBkaXNwbGF5OiAiaW5saW5lIg0KICAgICAgICB9Ow0KICAgICAgICBkIHx8IChpLndyaXRpbmdNb2RlID0gIiIgPT09IGIudmVydGljYWwgPyAiaG9yaXpvbnRhbC10YiIgOiAibHIiID09PSBiLnZlcnRpY2FsID8gInZlcnRpY2FsLWxyIiA6ICJ2ZXJ0aWNhbC1ybCIsIGkudW5pY29kZUJpZGkgPSAicGxhaW50ZXh0IiksIHRoaXMuYXBwbHlTdHlsZXMoaSwgdGhpcy5jdWVEaXYpLCB0aGlzLmRpdiA9IGEuZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IiksIGkgPSB7DQogICAgICAgICAgICB0ZXh0QWxpZ246ICJtaWRkbGUiID09PSBiLmFsaWduID8gImNlbnRlciIgOiBiLmFsaWduLA0KICAgICAgICAgICAgZm9udDogYy5mb250LA0KICAgICAgICAgICAgd2hpdGVTcGFjZTogInByZS1saW5lIiwNCiAgICAgICAgICAgIHBvc2l0aW9uOiAiYWJzb2x1dGUiDQogICAgICAgIH0sIGQgfHwgKGkuZGlyZWN0aW9uID0gaCh0aGlzLmN1ZURpdiksIGkud3JpdGluZ01vZGUgPSAiIiA9PT0gYi52ZXJ0aWNhbCA/ICJob3Jpem9udGFsLXRiIiA6ICJsciIgPT09IGIudmVydGljYWwgPyAidmVydGljYWwtbHIiIDogInZlcnRpY2FsLXJsIi5zdHlsZXN1bmljb2RlQmlkaSA9ICJwbGFpbnRleHQiKSwgdGhpcy5hcHBseVN0eWxlcyhpKSwgdGhpcy5kaXYuYXBwZW5kQ2hpbGQodGhpcy5jdWVEaXYpOw0KICAgICAgICB2YXIgayA9IDA7DQogICAgICAgIHN3aXRjaCAoYi5wb3NpdGlvbkFsaWduKSB7DQogICAgICAgICAgICBjYXNlICJzdGFydCI6DQogICAgICAgICAgICAgICAgayA9IGIucG9zaXRpb247DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICBjYXNlICJtaWRkbGUiOg0KICAgICAgICAgICAgICAgIGsgPSBiLnBvc2l0aW9uIC0gYi5zaXplIC8gMjsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGNhc2UgImVuZCI6DQogICAgICAgICAgICAgICAgayA9IGIucG9zaXRpb24gLSBiLnNpemUNCiAgICAgICAgfQ0KICAgICAgICB0aGlzLmFwcGx5U3R5bGVzKCIiID09PSBiLnZlcnRpY2FsID8gew0KICAgICAgICAgICAgbGVmdDogdGhpcy5mb3JtYXRTdHlsZShrLCAiJSIpLA0KICAgICAgICAgICAgd2lkdGg6IHRoaXMuZm9ybWF0U3R5bGUoYi5zaXplLCAiJSIpDQogICAgICAgIH0gOiB7DQogICAgICAgICAgICB0b3A6IHRoaXMuZm9ybWF0U3R5bGUoaywgIiUiKSwNCiAgICAgICAgICAgIGhlaWdodDogdGhpcy5mb3JtYXRTdHlsZShiLnNpemUsICIlIikNCiAgICAgICAgfSksIHRoaXMubW92ZSA9IGZ1bmN0aW9uIChhKSB7DQogICAgICAgICAgICB0aGlzLmFwcGx5U3R5bGVzKHsNCiAgICAgICAgICAgICAgICB0b3A6IHRoaXMuZm9ybWF0U3R5bGUoYS50b3AsICJweCIpLA0KICAgICAgICAgICAgICAgIGJvdHRvbTogdGhpcy5mb3JtYXRTdHlsZShhLmJvdHRvbSwgInB4IiksDQogICAgICAgICAgICAgICAgbGVmdDogdGhpcy5mb3JtYXRTdHlsZShhLmxlZnQsICJweCIpLA0KICAgICAgICAgICAgICAgIHJpZ2h0OiB0aGlzLmZvcm1hdFN0eWxlKGEucmlnaHQsICJweCIpLA0KICAgICAgICAgICAgICAgIGhlaWdodDogdGhpcy5mb3JtYXRTdHlsZShhLmhlaWdodCwgInB4IiksDQogICAgICAgICAgICAgICAgd2lkdGg6IHRoaXMuZm9ybWF0U3R5bGUoYS53aWR0aCwgInB4IikNCiAgICAgICAgICAgIH0pDQogICAgICAgIH0NCiAgICB9DQoNCiAgICBmdW5jdGlvbiBsKGEpIHsNCiAgICAgICAgdmFyIGIsIGMsIGQsIGUsIGYgPSAvTVNJRVxzOFwuMC8udGVzdChuYXZpZ2F0b3IudXNlckFnZW50KTsNCiAgICAgICAgaWYgKGEuZGl2KSB7DQogICAgICAgICAgICBjID0gYS5kaXYub2Zmc2V0SGVpZ2h0LCBkID0gYS5kaXYub2Zmc2V0V2lkdGgsIGUgPSBhLmRpdi5vZmZzZXRUb3A7DQogICAgICAgICAgICB2YXIgZyA9IChnID0gYS5kaXYuY2hpbGROb2RlcykgJiYgKGcgPSBnWzBdKSAmJiBnLmdldENsaWVudFJlY3RzICYmIGcuZ2V0Q2xpZW50UmVjdHMoKTsNCiAgICAgICAgICAgIGEgPSBhLmRpdi5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSwgYiA9IGcgPyBNYXRoLm1heChnWzBdICYmIGdbMF0uaGVpZ2h0IHx8IDAsIGEuaGVpZ2h0IC8gZy5sZW5ndGgpIDogMA0KICAgICAgICB9DQogICAgICAgIHRoaXMubGVmdCA9IGEubGVmdCwgdGhpcy5yaWdodCA9IGEucmlnaHQsIHRoaXMudG9wID0gYS50b3AgfHwgZSwgdGhpcy5oZWlnaHQgPSBhLmhlaWdodCB8fCBjLCB0aGlzLmJvdHRvbSA9IGEuYm90dG9tIHx8IGUgKyAoYS5oZWlnaHQgfHwgYyksIHRoaXMud2lkdGggPSBhLndpZHRoIHx8IGQsIHRoaXMubGluZUhlaWdodCA9IHZvaWQgMCAhPT0gYiA/IGIgOiBhLmxpbmVIZWlnaHQsIGYgJiYgIXRoaXMubGluZUhlaWdodCAmJiAodGhpcy5saW5lSGVpZ2h0ID0gMTMpDQogICAgfQ0KDQogICAgZnVuY3Rpb24gbShhLCBiLCBjLCBkKSB7DQogICAgICAgIGZ1bmN0aW9uIGUoYSwgYikgew0KICAgICAgICAgICAgZm9yICh2YXIgZSwgZiA9IG5ldyBsKGEpLCBnID0gMSwgaCA9IDA7IGggPCBiLmxlbmd0aDsgaCsrKSB7DQogICAgICAgICAgICAgICAgZm9yICg7IGEub3ZlcmxhcHNPcHBvc2l0ZUF4aXMoYywgYltoXSkgfHwgYS53aXRoaW4oYykgJiYgYS5vdmVybGFwc0FueShkKSA7KSBhLm1vdmUoYltoXSk7DQogICAgICAgICAgICAgICAgaWYgKGEud2l0aGluKGMpKSByZXR1cm4gYTsNCiAgICAgICAgICAgICAgICB2YXIgaSA9IGEuaW50ZXJzZWN0UGVyY2VudGFnZShjKTsNCiAgICAgICAgICAgICAgICBnID4gaSAmJiAoZSA9IG5ldyBsKGEpLCBnID0gaSksIGEgPSBuZXcgbChmKQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIGUgfHwgZg0KICAgICAgICB9DQogICAgICAgIHZhciBmID0gbmV3IGwoYiksDQogICAgICAgICAgICBnID0gYi5jdWUsDQogICAgICAgICAgICBoID0gaShnKSwNCiAgICAgICAgICAgIGogPSBbXTsNCiAgICAgICAgaWYgKGcuc25hcFRvTGluZXMpIHsNCiAgICAgICAgICAgIHZhciBrOw0KICAgICAgICAgICAgc3dpdGNoIChnLnZlcnRpY2FsKSB7DQogICAgICAgICAgICAgICAgY2FzZSAiIjoNCiAgICAgICAgICAgICAgICAgICAgaiA9IFsiK3kiLCAiLXkiXSwgayA9ICJoZWlnaHQiOw0KICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICBjYXNlICJybCI6DQogICAgICAgICAgICAgICAgICAgIGogPSBbIit4IiwgIi14Il0sIGsgPSAid2lkdGgiOw0KICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICBjYXNlICJsciI6DQogICAgICAgICAgICAgICAgICAgIGogPSBbIi14IiwgIit4Il0sIGsgPSAid2lkdGgiDQogICAgICAgICAgICB9DQogICAgICAgICAgICB2YXIgbSA9IGYubGluZUhlaWdodCwNCiAgICAgICAgICAgICAgICBuID0gbSAqIE1hdGgucm91bmQoaCksDQogICAgICAgICAgICAgICAgbyA9IGNba10gKyBtLA0KICAgICAgICAgICAgICAgIHAgPSBqWzBdOw0KICAgICAgICAgICAgTWF0aC5hYnMobikgPiBvICYmIChuID0gMCA+IG4gPyAtMSA6IDEsIG4gKj0gTWF0aC5jZWlsKG8gLyBtKSAqIG0pLCAwID4gaCAmJiAobiArPSAiIiA9PT0gZy52ZXJ0aWNhbCA/IGMuaGVpZ2h0IDogYy53aWR0aCwgaiA9IGoucmV2ZXJzZSgpKSwgZi5tb3ZlKHAsIG4pDQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICB2YXIgcSA9IGYubGluZUhlaWdodCAvIGMuaGVpZ2h0ICogMTAwOw0KICAgICAgICAgICAgc3dpdGNoIChnLmxpbmVBbGlnbikgew0KICAgICAgICAgICAgICAgIGNhc2UgIm1pZGRsZSI6DQogICAgICAgICAgICAgICAgICAgIGggLT0gcSAvIDI7DQogICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6DQogICAgICAgICAgICAgICAgICAgIGggLT0gcQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgc3dpdGNoIChnLnZlcnRpY2FsKSB7DQogICAgICAgICAgICAgICAgY2FzZSAiIjoNCiAgICAgICAgICAgICAgICAgICAgYi5hcHBseVN0eWxlcyh7DQogICAgICAgICAgICAgICAgICAgICAgICB0b3A6IGIuZm9ybWF0U3R5bGUoaCwgIiUiKQ0KICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgY2FzZSAicmwiOg0KICAgICAgICAgICAgICAgICAgICBiLmFwcGx5U3R5bGVzKHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGxlZnQ6IGIuZm9ybWF0U3R5bGUoaCwgIiUiKQ0KICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgY2FzZSAibHIiOg0KICAgICAgICAgICAgICAgICAgICBiLmFwcGx5U3R5bGVzKHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJpZ2h0OiBiLmZvcm1hdFN0eWxlKGgsICIlIikNCiAgICAgICAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGogPSBbIit5IiwgIi14IiwgIit4IiwgIi15Il0sIGYgPSBuZXcgbChiKQ0KICAgICAgICB9DQogICAgICAgIHZhciByID0gZShmLCBqKTsNCiAgICAgICAgYi5tb3ZlKHIudG9DU1NDb21wYXRWYWx1ZXMoYykpDQogICAgfQ0KDQogICAgZnVuY3Rpb24gbigpIHsgfQ0KICAgIHZhciBvID0gT2JqZWN0LmNyZWF0ZSB8fCBmdW5jdGlvbiAoKSB7DQogICAgICAgIGZ1bmN0aW9uIGEoKSB7IH0NCiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChiKSB7DQogICAgICAgICAgICBpZiAoMSAhPT0gYXJndW1lbnRzLmxlbmd0aCkgdGhyb3cgbmV3IEVycm9yKCJPYmplY3QuY3JlYXRlIHNoaW0gb25seSBhY2NlcHRzIG9uZSBwYXJhbWV0ZXIuIik7DQogICAgICAgICAgICByZXR1cm4gYS5wcm90b3R5cGUgPSBiLCBuZXcgYQ0KICAgICAgICB9DQogICAgfSgpOw0KICAgIGIucHJvdG90eXBlID0gbyhFcnJvci5wcm90b3R5cGUpLCBiLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IGIsIGIuRXJyb3JzID0gew0KICAgICAgICBCYWRTaWduYXR1cmU6IHsNCiAgICAgICAgICAgIGNvZGU6IDAsDQogICAgICAgICAgICBtZXNzYWdlOiAiTWFsZm9ybWVkIFdlYlZUVCBzaWduYXR1cmUuIg0KICAgICAgICB9LA0KICAgICAgICBCYWRUaW1lU3RhbXA6IHsNCiAgICAgICAgICAgIGNvZGU6IDEsDQogICAgICAgICAgICBtZXNzYWdlOiAiTWFsZm9ybWVkIHRpbWUgc3RhbXAuIg0KICAgICAgICB9DQogICAgfSwgZC5wcm90b3R5cGUgPSB7DQogICAgICAgIHNldDogZnVuY3Rpb24gKGEsIGIpIHsNCiAgICAgICAgICAgIHRoaXMuZ2V0KGEpIHx8ICIiID09PSBiIHx8ICh0aGlzLnZhbHVlc1thXSA9IGIpDQogICAgICAgIH0sDQogICAgICAgIGdldDogZnVuY3Rpb24gKGEsIGIsIGMpIHsNCiAgICAgICAgICAgIHJldHVybiBjID8gdGhpcy5oYXMoYSkgPyB0aGlzLnZhbHVlc1thXSA6IGJbY10gOiB0aGlzLmhhcyhhKSA/IHRoaXMudmFsdWVzW2FdIDogYg0KICAgICAgICB9LA0KICAgICAgICBoYXM6IGZ1bmN0aW9uIChhKSB7DQogICAgICAgICAgICByZXR1cm4gYSBpbiB0aGlzLnZhbHVlcw0KICAgICAgICB9LA0KICAgICAgICBhbHQ6IGZ1bmN0aW9uIChhLCBiLCBjKSB7DQogICAgICAgICAgICBmb3IgKHZhciBkID0gMDsgZCA8IGMubGVuZ3RoOyArK2QpDQogICAgICAgICAgICAgICAgaWYgKGIgPT09IGNbZF0pIHsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXQoYSwgYik7DQogICAgICAgICAgICAgICAgICAgIGJyZWFrDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICB9LA0KICAgICAgICBpbnRlZ2VyOiBmdW5jdGlvbiAoYSwgYikgew0KICAgICAgICAgICAgL14tP1xkKyQvLnRlc3QoYikgJiYgdGhpcy5zZXQoYSwgcGFyc2VJbnQoYiwgMTApKQ0KICAgICAgICB9LA0KICAgICAgICBwZXJjZW50OiBmdW5jdGlvbiAoYSwgYikgew0KICAgICAgICAgICAgdmFyIGM7DQogICAgICAgICAgICByZXR1cm4gKGMgPSBiLm1hdGNoKC9eKFtcZF17MSwzfSkoXC5bXGRdKik/JSQvKSkgJiYgKGIgPSBwYXJzZUZsb2F0KGIpLCBiID49IDAgJiYgMTAwID49IGIpID8gKHRoaXMuc2V0KGEsIGIpLCAhMCkgOiAhMQ0KICAgICAgICB9DQogICAgfTsNCiAgICB2YXIgcCA9IHsNCiAgICAgICAgIiZhbXA7IjogIiYiLA0KICAgICAgICAiJmx0OyI6ICI8IiwNCiAgICAgICAgIiZndDsiOiAiPiIsDQogICAgICAgICImbHJtOyI6ICLigI4iLA0KICAgICAgICAiJnJsbTsiOiAi4oCPIiwNCiAgICAgICAgIiZuYnNwOyI6ICLCoCINCiAgICB9LA0KICAgICAgICBxID0gew0KICAgICAgICAgICAgYzogInNwYW4iLA0KICAgICAgICAgICAgaTogImkiLA0KICAgICAgICAgICAgYjogImIiLA0KICAgICAgICAgICAgdTogInUiLA0KICAgICAgICAgICAgcnVieTogInJ1YnkiLA0KICAgICAgICAgICAgcnQ6ICJydCIsDQogICAgICAgICAgICB2OiAic3BhbiIsDQogICAgICAgICAgICBsYW5nOiAic3BhbiINCiAgICAgICAgfSwNCiAgICAgICAgciA9IHsNCiAgICAgICAgICAgIHY6ICJ0aXRsZSIsDQogICAgICAgICAgICBsYW5nOiAibGFuZyINCiAgICAgICAgfSwNCiAgICAgICAgcyA9IHsNCiAgICAgICAgICAgIHJ0OiAicnVieSINCiAgICAgICAgfSwNCiAgICAgICAgdCA9IFsxNDcwLCAxNDcyLCAxNDc1LCAxNDc4LCAxNDg4LCAxNDg5LCAxNDkwLCAxNDkxLCAxNDkyLCAxNDkzLCAxNDk0LCAxNDk1LCAxNDk2LCAxNDk3LCAxNDk4LCAxNDk5LCAxNTAwLCAxNTAxLCAxNTAyLCAxNTAzLCAxNTA0LCAxNTA1LCAxNTA2LCAxNTA3LCAxNTA4LCAxNTA5LCAxNTEwLCAxNTExLCAxNTEyLCAxNTEzLCAxNTE0LCAxNTIwLCAxNTIxLCAxNTIyLCAxNTIzLCAxNTI0LCAxNTQ0LCAxNTQ3LCAxNTQ5LCAxNTYzLCAxNTY2LCAxNTY3LCAxNTY4LCAxNTY5LCAxNTcwLCAxNTcxLCAxNTcyLCAxNTczLCAxNTc0LCAxNTc1LCAxNTc2LCAxNTc3LCAxNTc4LCAxNTc5LCAxNTgwLCAxNTgxLCAxNTgyLCAxNTgzLCAxNTg0LCAxNTg1LCAxNTg2LCAxNTg3LCAxNTg4LCAxNTg5LCAxNTkwLCAxNTkxLCAxNTkyLCAxNTkzLCAxNTk0LCAxNTk1LCAxNTk2LCAxNTk3LCAxNTk4LCAxNTk5LCAxNjAwLCAxNjAxLCAxNjAyLCAxNjAzLCAxNjA0LCAxNjA1LCAxNjA2LCAxNjA3LCAxNjA4LCAxNjA5LCAxNjEwLCAxNjQ1LCAxNjQ2LCAxNjQ3LCAxNjQ5LCAxNjUwLCAxNjUxLCAxNjUyLCAxNjUzLCAxNjU0LCAxNjU1LCAxNjU2LCAxNjU3LCAxNjU4LCAxNjU5LCAxNjYwLCAxNjYxLCAxNjYyLCAxNjYzLCAxNjY0LCAxNjY1LCAxNjY2LCAxNjY3LCAxNjY4LCAxNjY5LCAxNjcwLCAxNjcxLCAxNjcyLCAxNjczLCAxNjc0LCAxNjc1LCAxNjc2LCAxNjc3LCAxNjc4LCAxNjc5LCAxNjgwLCAxNjgxLCAxNjgyLCAxNjgzLCAxNjg0LCAxNjg1LCAxNjg2LCAxNjg3LCAxNjg4LCAxNjg5LCAxNjkwLCAxNjkxLCAxNjkyLCAxNjkzLCAxNjk0LCAxNjk1LCAxNjk2LCAxNjk3LCAxNjk4LCAxNjk5LCAxNzAwLCAxNzAxLCAxNzAyLCAxNzAzLCAxNzA0LCAxNzA1LCAxNzA2LCAxNzA3LCAxNzA4LCAxNzA5LCAxNzEwLCAxNzExLCAxNzEyLCAxNzEzLCAxNzE0LCAxNzE1LCAxNzE2LCAxNzE3LCAxNzE4LCAxNzE5LCAxNzIwLCAxNzIxLCAxNzIyLCAxNzIzLCAxNzI0LCAxNzI1LCAxNzI2LCAxNzI3LCAxNzI4LCAxNzI5LCAxNzMwLCAxNzMxLCAxNzMyLCAxNzMzLCAxNzM0LCAxNzM1LCAxNzM2LCAxNzM3LCAxNzM4LCAxNzM5LCAxNzQwLCAxNzQxLCAxNzQyLCAxNzQzLCAxNzQ0LCAxNzQ1LCAxNzQ2LCAxNzQ3LCAxNzQ4LCAxNzQ5LCAxNzY1LCAxNzY2LCAxNzc0LCAxNzc1LCAxNzg2LCAxNzg3LCAxNzg4LCAxNzg5LCAxNzkwLCAxNzkxLCAxNzkyLCAxNzkzLCAxNzk0LCAxNzk1LCAxNzk2LCAxNzk3LCAxNzk4LCAxNzk5LCAxODAwLCAxODAxLCAxODAyLCAxODAzLCAxODA0LCAxODA1LCAxODA3LCAxODA4LCAxODEwLCAxODExLCAxODEyLCAxODEzLCAxODE0LCAxODE1LCAxODE2LCAxODE3LCAxODE4LCAxODE5LCAxODIwLCAxODIxLCAxODIyLCAxODIzLCAxODI0LCAxODI1LCAxODI2LCAxODI3LCAxODI4LCAxODI5LCAxODMwLCAxODMxLCAxODMyLCAxODMzLCAxODM0LCAxODM1LCAxODM2LCAxODM3LCAxODM4LCAxODM5LCAxODY5LCAxODcwLCAxODcxLCAxODcyLCAxODczLCAxODc0LCAxODc1LCAxODc2LCAxODc3LCAxODc4LCAxODc5LCAxODgwLCAxODgxLCAxODgyLCAxODgzLCAxODg0LCAxODg1LCAxODg2LCAxODg3LCAxODg4LCAxODg5LCAxODkwLCAxODkxLCAxODkyLCAxODkzLCAxODk0LCAxODk1LCAxODk2LCAxODk3LCAxODk4LCAxODk5LCAxOTAwLCAxOTAxLCAxOTAyLCAxOTAzLCAxOTA0LCAxOTA1LCAxOTA2LCAxOTA3LCAxOTA4LCAxOTA5LCAxOTEwLCAxOTExLCAxOTEyLCAxOTEzLCAxOTE0LCAxOTE1LCAxOTE2LCAxOTE3LCAxOTE4LCAxOTE5LCAxOTIwLCAxOTIxLCAxOTIyLCAxOTIzLCAxOTI0LCAxOTI1LCAxOTI2LCAxOTI3LCAxOTI4LCAxOTI5LCAxOTMwLCAxOTMxLCAxOTMyLCAxOTMzLCAxOTM0LCAxOTM1LCAxOTM2LCAxOTM3LCAxOTM4LCAxOTM5LCAxOTQwLCAxOTQxLCAxOTQyLCAxOTQzLCAxOTQ0LCAxOTQ1LCAxOTQ2LCAxOTQ3LCAxOTQ4LCAxOTQ5LCAxOTUwLCAxOTUxLCAxOTUyLCAxOTUzLCAxOTU0LCAxOTU1LCAxOTU2LCAxOTU3LCAxOTY5LCAxOTg0LCAxOTg1LCAxOTg2LCAxOTg3LCAxOTg4LCAxOTg5LCAxOTkwLCAxOTkxLCAxOTkyLCAxOTkzLCAxOTk0LCAxOTk1LCAxOTk2LCAxOTk3LCAxOTk4LCAxOTk5LCAyZTMsIDIwMDEsIDIwMDIsIDIwMDMsIDIwMDQsIDIwMDUsIDIwMDYsIDIwMDcsIDIwMDgsIDIwMDksIDIwMTAsIDIwMTEsIDIwMTIsIDIwMTMsIDIwMTQsIDIwMTUsIDIwMTYsIDIwMTcsIDIwMTgsIDIwMTksIDIwMjAsIDIwMjEsIDIwMjIsIDIwMjMsIDIwMjQsIDIwMjUsIDIwMjYsIDIwMzYsIDIwMzcsIDIwNDIsIDIwNDgsIDIwNDksIDIwNTAsIDIwNTEsIDIwNTIsIDIwNTMsIDIwNTQsIDIwNTUsIDIwNTYsIDIwNTcsIDIwNTgsIDIwNTksIDIwNjAsIDIwNjEsIDIwNjIsIDIwNjMsIDIwNjQsIDIwNjUsIDIwNjYsIDIwNjcsIDIwNjgsIDIwNjksIDIwNzQsIDIwODQsIDIwODgsIDIwOTYsIDIwOTcsIDIwOTgsIDIwOTksIDIxMDAsIDIxMDEsIDIxMDIsIDIxMDMsIDIxMDQsIDIxMDUsIDIxMDYsIDIxMDcsIDIxMDgsIDIxMDksIDIxMTAsIDIxMTIsIDIxMTMsIDIxMTQsIDIxMTUsIDIxMTYsIDIxMTcsIDIxMTgsIDIxMTksIDIxMjAsIDIxMjEsIDIxMjIsIDIxMjMsIDIxMjQsIDIxMjUsIDIxMjYsIDIxMjcsIDIxMjgsIDIxMjksIDIxMzAsIDIxMzEsIDIxMzIsIDIxMzMsIDIxMzQsIDIxMzUsIDIxMzYsIDIxNDIsIDIyMDgsIDIyMTAsIDIyMTEsIDIyMTIsIDIyMTMsIDIyMTQsIDIyMTUsIDIyMTYsIDIyMTcsIDIyMTgsIDIyMTksIDIyMjAsIDgyMDcsIDY0Mjg1LCA2NDI4NywgNjQyODgsIDY0Mjg5LCA2NDI5MCwgNjQyOTEsIDY0MjkyLCA2NDI5MywgNjQyOTQsIDY0Mjk1LCA2NDI5NiwgNjQyOTgsIDY0Mjk5LCA2NDMwMCwgNjQzMDEsIDY0MzAyLCA2NDMwMywgNjQzMDQsIDY0MzA1LCA2NDMwNiwgNjQzMDcsIDY0MzA4LCA2NDMwOSwgNjQzMTAsIDY0MzEyLCA2NDMxMywgNjQzMTQsIDY0MzE1LCA2NDMxNiwgNjQzMTgsIDY0MzIwLCA2NDMyMSwgNjQzMjMsIDY0MzI0LCA2NDMyNiwgNjQzMjcsIDY0MzI4LCA2NDMyOSwgNjQzMzAsIDY0MzMxLCA2NDMzMiwgNjQzMzMsIDY0MzM0LCA2NDMzNSwgNjQzMzYsIDY0MzM3LCA2NDMzOCwgNjQzMzksIDY0MzQwLCA2NDM0MSwgNjQzNDIsIDY0MzQzLCA2NDM0NCwgNjQzNDUsIDY0MzQ2LCA2NDM0NywgNjQzNDgsIDY0MzQ5LCA2NDM1MCwgNjQzNTEsIDY0MzUyLCA2NDM1MywgNjQzNTQsIDY0MzU1LCA2NDM1NiwgNjQzNTcsIDY0MzU4LCA2NDM1OSwgNjQzNjAsIDY0MzYxLCA2NDM2MiwgNjQzNjMsIDY0MzY0LCA2NDM2NSwgNjQzNjYsIDY0MzY3LCA2NDM2OCwgNjQzNjksIDY0MzcwLCA2NDM3MSwgNjQzNzIsIDY0MzczLCA2NDM3NCwgNjQzNzUsIDY0Mzc2LCA2NDM3NywgNjQzNzgsIDY0Mzc5LCA2NDM4MCwgNjQzODEsIDY0MzgyLCA2NDM4MywgNjQzODQsIDY0Mzg1LCA2NDM4NiwgNjQzODcsIDY0Mzg4LCA2NDM4OSwgNjQzOTAsIDY0MzkxLCA2NDM5MiwgNjQzOTMsIDY0Mzk0LCA2NDM5NSwgNjQzOTYsIDY0Mzk3LCA2NDM5OCwgNjQzOTksIDY0NDAwLCA2NDQwMSwgNjQ0MDIsIDY0NDAzLCA2NDQwNCwgNjQ0MDUsIDY0NDA2LCA2NDQwNywgNjQ0MDgsIDY0NDA5LCA2NDQxMCwgNjQ0MTEsIDY0NDEyLCA2NDQxMywgNjQ0MTQsIDY0NDE1LCA2NDQxNiwgNjQ0MTcsIDY0NDE4LCA2NDQxOSwgNjQ0MjAsIDY0NDIxLCA2NDQyMiwgNjQ0MjMsIDY0NDI0LCA2NDQyNSwgNjQ0MjYsIDY0NDI3LCA2NDQyOCwgNjQ0MjksIDY0NDMwLCA2NDQzMSwgNjQ0MzIsIDY0NDMzLCA2NDQzNCwgNjQ0MzUsIDY0NDM2LCA2NDQzNywgNjQ0MzgsIDY0NDM5LCA2NDQ0MCwgNjQ0NDEsIDY0NDQyLCA2NDQ0MywgNjQ0NDQsIDY0NDQ1LCA2NDQ0NiwgNjQ0NDcsIDY0NDQ4LCA2NDQ0OSwgNjQ0NjcsIDY0NDY4LCA2NDQ2OSwgNjQ0NzAsIDY0NDcxLCA2NDQ3MiwgNjQ0NzMsIDY0NDc0LCA2NDQ3NSwgNjQ0NzYsIDY0NDc3LCA2NDQ3OCwgNjQ0NzksIDY0NDgwLCA2NDQ4MSwgNjQ0ODIsIDY0NDgzLCA2NDQ4NCwgNjQ0ODUsIDY0NDg2LCA2NDQ4NywgNjQ0ODgsIDY0NDg5LCA2NDQ5MCwgNjQ0OTEsIDY0NDkyLCA2NDQ5MywgNjQ0OTQsIDY0NDk1LCA2NDQ5NiwgNjQ0OTcsIDY0NDk4LCA2NDQ5OSwgNjQ1MDAsIDY0NTAxLCA2NDUwMiwgNjQ1MDMsIDY0NTA0LCA2NDUwNSwgNjQ1MDYsIDY0NTA3LCA2NDUwOCwgNjQ1MDksIDY0NTEwLCA2NDUxMSwgNjQ1MTIsIDY0NTEzLCA2NDUxNCwgNjQ1MTUsIDY0NTE2LCA2NDUxNywgNjQ1MTgsIDY0NTE5LCA2NDUyMCwgNjQ1MjEsIDY0NTIyLCA2NDUyMywgNjQ1MjQsIDY0NTI1LCA2NDUyNiwgNjQ1MjcsIDY0NTI4LCA2NDUyOSwgNjQ1MzAsIDY0NTMxLCA2NDUzMiwgNjQ1MzMsIDY0NTM0LCA2NDUzNSwgNjQ1MzYsIDY0NTM3LCA2NDUzOCwgNjQ1MzksIDY0NTQwLCA2NDU0MSwgNjQ1NDIsIDY0NTQzLCA2NDU0NCwgNjQ1NDUsIDY0NTQ2LCA2NDU0NywgNjQ1NDgsIDY0NTQ5LCA2NDU1MCwgNjQ1NTEsIDY0NTUyLCA2NDU1MywgNjQ1NTQsIDY0NTU1LCA2NDU1NiwgNjQ1NTcsIDY0NTU4LCA2NDU1OSwgNjQ1NjAsIDY0NTYxLCA2NDU2MiwgNjQ1NjMsIDY0NTY0LCA2NDU2NSwgNjQ1NjYsIDY0NTY3LCA2NDU2OCwgNjQ1NjksIDY0NTcwLCA2NDU3MSwgNjQ1NzIsIDY0NTczLCA2NDU3NCwgNjQ1NzUsIDY0NTc2LCA2NDU3NywgNjQ1NzgsIDY0NTc5LCA2NDU4MCwgNjQ1ODEsIDY0NTgyLCA2NDU4MywgNjQ1ODQsIDY0NTg1LCA2NDU4NiwgNjQ1ODcsIDY0NTg4LCA2NDU4OSwgNjQ1OTAsIDY0NTkxLCA2NDU5MiwgNjQ1OTMsIDY0NTk0LCA2NDU5NSwgNjQ1OTYsIDY0NTk3LCA2NDU5OCwgNjQ1OTksIDY0NjAwLCA2NDYwMSwgNjQ2MDIsIDY0NjAzLCA2NDYwNCwgNjQ2MDUsIDY0NjA2LCA2NDYwNywgNjQ2MDgsIDY0NjA5LCA2NDYxMCwgNjQ2MTEsIDY0NjEyLCA2NDYxMywgNjQ2MTQsIDY0NjE1LCA2NDYxNiwgNjQ2MTcsIDY0NjE4LCA2NDYxOSwgNjQ2MjAsIDY0NjIxLCA2NDYyMiwgNjQ2MjMsIDY0NjI0LCA2NDYyNSwgNjQ2MjYsIDY0NjI3LCA2NDYyOCwgNjQ2MjksIDY0NjMwLCA2NDYzMSwgNjQ2MzIsIDY0NjMzLCA2NDYzNCwgNjQ2MzUsIDY0NjM2LCA2NDYzNywgNjQ2MzgsIDY0NjM5LCA2NDY0MCwgNjQ2NDEsIDY0NjQyLCA2NDY0MywgNjQ2NDQsIDY0NjQ1LCA2NDY0NiwgNjQ2NDcsIDY0NjQ4LCA2NDY0OSwgNjQ2NTAsIDY0NjUxLCA2NDY1MiwgNjQ2NTMsIDY0NjU0LCA2NDY1NSwgNjQ2NTYsIDY0NjU3LCA2NDY1OCwgNjQ2NTksIDY0NjYwLCA2NDY2MSwgNjQ2NjIsIDY0NjYzLCA2NDY2NCwgNjQ2NjUsIDY0NjY2LCA2NDY2NywgNjQ2NjgsIDY0NjY5LCA2NDY3MCwgNjQ2NzEsIDY0NjcyLCA2NDY3MywgNjQ2NzQsIDY0Njc1LCA2NDY3NiwgNjQ2NzcsIDY0Njc4LCA2NDY3OSwgNjQ2ODAsIDY0NjgxLCA2NDY4MiwgNjQ2ODMsIDY0Njg0LCA2NDY4NSwgNjQ2ODYsIDY0Njg3LCA2NDY4OCwgNjQ2ODksIDY0NjkwLCA2NDY5MSwgNjQ2OTIsIDY0NjkzLCA2NDY5NCwgNjQ2OTUsIDY0Njk2LCA2NDY5NywgNjQ2OTgsIDY0Njk5LCA2NDcwMCwgNjQ3MDEsIDY0NzAyLCA2NDcwMywgNjQ3MDQsIDY0NzA1LCA2NDcwNiwgNjQ3MDcsIDY0NzA4LCA2NDcwOSwgNjQ3MTAsIDY0NzExLCA2NDcxMiwgNjQ3MTMsIDY0NzE0LCA2NDcxNSwgNjQ3MTYsIDY0NzE3LCA2NDcxOCwgNjQ3MTksIDY0NzIwLCA2NDcyMSwgNjQ3MjIsIDY0NzIzLCA2NDcyNCwgNjQ3MjUsIDY0NzI2LCA2NDcyNywgNjQ3MjgsIDY0NzI5LCA2NDczMCwgNjQ3MzEsIDY0NzMyLCA2NDczMywgNjQ3MzQsIDY0NzM1LCA2NDczNiwgNjQ3MzcsIDY0NzM4LCA2NDczOSwgNjQ3NDAsIDY0NzQxLCA2NDc0MiwgNjQ3NDMsIDY0NzQ0LCA2NDc0NSwgNjQ3NDYsIDY0NzQ3LCA2NDc0OCwgNjQ3NDksIDY0NzUwLCA2NDc1MSwgNjQ3NTIsIDY0NzUzLCA2NDc1NCwgNjQ3NTUsIDY0NzU2LCA2NDc1NywgNjQ3NTgsIDY0NzU5LCA2NDc2MCwgNjQ3NjEsIDY0NzYyLCA2NDc2MywgNjQ3NjQsIDY0NzY1LCA2NDc2NiwgNjQ3NjcsIDY0NzY4LCA2NDc2OSwgNjQ3NzAsIDY0NzcxLCA2NDc3MiwgNjQ3NzMsIDY0Nzc0LCA2NDc3NSwgNjQ3NzYsIDY0Nzc3LCA2NDc3OCwgNjQ3NzksIDY0NzgwLCA2NDc4MSwgNjQ3ODIsIDY0NzgzLCA2NDc4NCwgNjQ3ODUsIDY0Nzg2LCA2NDc4NywgNjQ3ODgsIDY0Nzg5LCA2NDc5MCwgNjQ3OTEsIDY0NzkyLCA2NDc5MywgNjQ3OTQsIDY0Nzk1LCA2NDc5NiwgNjQ3OTcsIDY0Nzk4LCA2NDc5OSwgNjQ4MDAsIDY0ODAxLCA2NDgwMiwgNjQ4MDMsIDY0ODA0LCA2NDgwNSwgNjQ4MDYsIDY0ODA3LCA2NDgwOCwgNjQ4MDksIDY0ODEwLCA2NDgxMSwgNjQ4MTIsIDY0ODEzLCA2NDgxNCwgNjQ4MTUsIDY0ODE2LCA2NDgxNywgNjQ4MTgsIDY0ODE5LCA2NDgyMCwgNjQ4MjEsIDY0ODIyLCA2NDgyMywgNjQ4MjQsIDY0ODI1LCA2NDgyNiwgNjQ4MjcsIDY0ODI4LCA2NDgyOSwgNjQ4NDgsIDY0ODQ5LCA2NDg1MCwgNjQ4NTEsIDY0ODUyLCA2NDg1MywgNjQ4NTQsIDY0ODU1LCA2NDg1NiwgNjQ4NTcsIDY0ODU4LCA2NDg1OSwgNjQ4NjAsIDY0ODYxLCA2NDg2MiwgNjQ4NjMsIDY0ODY0LCA2NDg2NSwgNjQ4NjYsIDY0ODY3LCA2NDg2OCwgNjQ4NjksIDY0ODcwLCA2NDg3MSwgNjQ4NzIsIDY0ODczLCA2NDg3NCwgNjQ4NzUsIDY0ODc2LCA2NDg3NywgNjQ4NzgsIDY0ODc5LCA2NDg4MCwgNjQ4ODEsIDY0ODgyLCA2NDg4MywgNjQ4ODQsIDY0ODg1LCA2NDg4NiwgNjQ4ODcsIDY0ODg4LCA2NDg4OSwgNjQ4OTAsIDY0ODkxLCA2NDg5MiwgNjQ4OTMsIDY0ODk0LCA2NDg5NSwgNjQ4OTYsIDY0ODk3LCA2NDg5OCwgNjQ4OTksIDY0OTAwLCA2NDkwMSwgNjQ5MDIsIDY0OTAzLCA2NDkwNCwgNjQ5MDUsIDY0OTA2LCA2NDkwNywgNjQ5MDgsIDY0OTA5LCA2NDkxMCwgNjQ5MTEsIDY0OTE0LCA2NDkxNSwgNjQ5MTYsIDY0OTE3LCA2NDkxOCwgNjQ5MTksIDY0OTIwLCA2NDkyMSwgNjQ5MjIsIDY0OTIzLCA2NDkyNCwgNjQ5MjUsIDY0OTI2LCA2NDkyNywgNjQ5MjgsIDY0OTI5LCA2NDkzMCwgNjQ5MzEsIDY0OTMyLCA2NDkzMywgNjQ5MzQsIDY0OTM1LCA2NDkzNiwgNjQ5MzcsIDY0OTM4LCA2NDkzOSwgNjQ5NDAsIDY0OTQxLCA2NDk0MiwgNjQ5NDMsIDY0OTQ0LCA2NDk0NSwgNjQ5NDYsIDY0OTQ3LCA2NDk0OCwgNjQ5NDksIDY0OTUwLCA2NDk1MSwgNjQ5NTIsIDY0OTUzLCA2NDk1NCwgNjQ5NTUsIDY0OTU2LCA2NDk1NywgNjQ5NTgsIDY0OTU5LCA2NDk2MCwgNjQ5NjEsIDY0OTYyLCA2NDk2MywgNjQ5NjQsIDY0OTY1LCA2NDk2NiwgNjQ5NjcsIDY1MDA4LCA2NTAwOSwgNjUwMTAsIDY1MDExLCA2NTAxMiwgNjUwMTMsIDY1MDE0LCA2NTAxNSwgNjUwMTYsIDY1MDE3LCA2NTAxOCwgNjUwMTksIDY1MDIwLCA2NTEzNiwgNjUxMzcsIDY1MTM4LCA2NTEzOSwgNjUxNDAsIDY1MTQyLCA2NTE0MywgNjUxNDQsIDY1MTQ1LCA2NTE0NiwgNjUxNDcsIDY1MTQ4LCA2NTE0OSwgNjUxNTAsIDY1MTUxLCA2NTE1MiwgNjUxNTMsIDY1MTU0LCA2NTE1NSwgNjUxNTYsIDY1MTU3LCA2NTE1OCwgNjUxNTksIDY1MTYwLCA2NTE2MSwgNjUxNjIsIDY1MTYzLCA2NTE2NCwgNjUxNjUsIDY1MTY2LCA2NTE2NywgNjUxNjgsIDY1MTY5LCA2NTE3MCwgNjUxNzEsIDY1MTcyLCA2NTE3MywgNjUxNzQsIDY1MTc1LCA2NTE3NiwgNjUxNzcsIDY1MTc4LCA2NTE3OSwgNjUxODAsIDY1MTgxLCA2NTE4MiwgNjUxODMsIDY1MTg0LCA2NTE4NSwgNjUxODYsIDY1MTg3LCA2NTE4OCwgNjUxODksIDY1MTkwLCA2NTE5MSwgNjUxOTIsIDY1MTkzLCA2NTE5NCwgNjUxOTUsIDY1MTk2LCA2NTE5NywgNjUxOTgsIDY1MTk5LCA2NTIwMCwgNjUyMDEsIDY1MjAyLCA2NTIwMywgNjUyMDQsIDY1MjA1LCA2NTIwNiwgNjUyMDcsIDY1MjA4LCA2NTIwOSwgNjUyMTAsIDY1MjExLCA2NTIxMiwgNjUyMTMsIDY1MjE0LCA2NTIxNSwgNjUyMTYsIDY1MjE3LCA2NTIxOCwgNjUyMTksIDY1MjIwLCA2NTIyMSwgNjUyMjIsIDY1MjIzLCA2NTIyNCwgNjUyMjUsIDY1MjI2LCA2NTIyNywgNjUyMjgsIDY1MjI5LCA2NTIzMCwgNjUyMzEsIDY1MjMyLCA2NTIzMywgNjUyMzQsIDY1MjM1LCA2NTIzNiwgNjUyMzcsIDY1MjM4LCA2NTIzOSwgNjUyNDAsIDY1MjQxLCA2NTI0MiwgNjUyNDMsIDY1MjQ0LCA2NTI0NSwgNjUyNDYsIDY1MjQ3LCA2NTI0OCwgNjUyNDksIDY1MjUwLCA2NTI1MSwgNjUyNTIsIDY1MjUzLCA2NTI1NCwgNjUyNTUsIDY1MjU2LCA2NTI1NywgNjUyNTgsIDY1MjU5LCA2NTI2MCwgNjUyNjEsIDY1MjYyLCA2NTI2MywgNjUyNjQsIDY1MjY1LCA2NTI2NiwgNjUyNjcsIDY1MjY4LCA2NTI2OSwgNjUyNzAsIDY1MjcxLCA2NTI3MiwgNjUyNzMsIDY1Mjc0LCA2NTI3NSwgNjUyNzYsIDY3NTg0LCA2NzU4NSwgNjc1ODYsIDY3NTg3LCA2NzU4OCwgNjc1ODksIDY3NTkyLCA2NzU5NCwgNjc1OTUsIDY3NTk2LCA2NzU5NywgNjc1OTgsIDY3NTk5LCA2NzYwMCwgNjc2MDEsIDY3NjAyLCA2NzYwMywgNjc2MDQsIDY3NjA1LCA2NzYwNiwgNjc2MDcsIDY3NjA4LCA2NzYwOSwgNjc2MTAsIDY3NjExLCA2NzYxMiwgNjc2MTMsIDY3NjE0LCA2NzYxNSwgNjc2MTYsIDY3NjE3LCA2NzYxOCwgNjc2MTksIDY3NjIwLCA2NzYyMSwgNjc2MjIsIDY3NjIzLCA2NzYyNCwgNjc2MjUsIDY3NjI2LCA2NzYyNywgNjc2MjgsIDY3NjI5LCA2NzYzMCwgNjc2MzEsIDY3NjMyLCA2NzYzMywgNjc2MzQsIDY3NjM1LCA2NzYzNiwgNjc2MzcsIDY3NjM5LCA2NzY0MCwgNjc2NDQsIDY3NjQ3LCA2NzY0OCwgNjc2NDksIDY3NjUwLCA2NzY1MSwgNjc2NTIsIDY3NjUzLCA2NzY1NCwgNjc2NTUsIDY3NjU2LCA2NzY1NywgNjc2NTgsIDY3NjU5LCA2NzY2MCwgNjc2NjEsIDY3NjYyLCA2NzY2MywgNjc2NjQsIDY3NjY1LCA2NzY2NiwgNjc2NjcsIDY3NjY4LCA2NzY2OSwgNjc2NzEsIDY3NjcyLCA2NzY3MywgNjc2NzQsIDY3Njc1LCA2NzY3NiwgNjc2NzcsIDY3Njc4LCA2NzY3OSwgNjc4NDAsIDY3ODQxLCA2Nzg0MiwgNjc4NDMsIDY3ODQ0LCA2Nzg0NSwgNjc4NDYsIDY3ODQ3LCA2Nzg0OCwgNjc4NDksIDY3ODUwLCA2Nzg1MSwgNjc4NTIsIDY3ODUzLCA2Nzg1NCwgNjc4NTUsIDY3ODU2LCA2Nzg1NywgNjc4NTgsIDY3ODU5LCA2Nzg2MCwgNjc4NjEsIDY3ODYyLCA2Nzg2MywgNjc4NjQsIDY3ODY1LCA2Nzg2NiwgNjc4NjcsIDY3ODcyLCA2Nzg3MywgNjc4NzQsIDY3ODc1LCA2Nzg3NiwgNjc4NzcsIDY3ODc4LCA2Nzg3OSwgNjc4ODAsIDY3ODgxLCA2Nzg4MiwgNjc4ODMsIDY3ODg0LCA2Nzg4NSwgNjc4ODYsIDY3ODg3LCA2Nzg4OCwgNjc4ODksIDY3ODkwLCA2Nzg5MSwgNjc4OTIsIDY3ODkzLCA2Nzg5NCwgNjc4OTUsIDY3ODk2LCA2Nzg5NywgNjc5MDMsIDY3OTY4LCA2Nzk2OSwgNjc5NzAsIDY3OTcxLCA2Nzk3MiwgNjc5NzMsIDY3OTc0LCA2Nzk3NSwgNjc5NzYsIDY3OTc3LCA2Nzk3OCwgNjc5NzksIDY3OTgwLCA2Nzk4MSwgNjc5ODIsIDY3OTgzLCA2Nzk4NCwgNjc5ODUsIDY3OTg2LCA2Nzk4NywgNjc5ODgsIDY3OTg5LCA2Nzk5MCwgNjc5OTEsIDY3OTkyLCA2Nzk5MywgNjc5OTQsIDY3OTk1LCA2Nzk5NiwgNjc5OTcsIDY3OTk4LCA2Nzk5OSwgNjhlMywgNjgwMDEsIDY4MDAyLCA2ODAwMywgNjgwMDQsIDY4MDA1LCA2ODAwNiwgNjgwMDcsIDY4MDA4LCA2ODAwOSwgNjgwMTAsIDY4MDExLCA2ODAxMiwgNjgwMTMsIDY4MDE0LCA2ODAxNSwgNjgwMTYsIDY4MDE3LCA2ODAxOCwgNjgwMTksIDY4MDIwLCA2ODAyMSwgNjgwMjIsIDY4MDIzLCA2ODAzMCwgNjgwMzEsIDY4MDk2LCA2ODExMiwgNjgxMTMsIDY4MTE0LCA2ODExNSwgNjgxMTcsIDY4MTE4LCA2ODExOSwgNjgxMjEsIDY4MTIyLCA2ODEyMywgNjgxMjQsIDY4MTI1LCA2ODEyNiwgNjgxMjcsIDY4MTI4LCA2ODEyOSwgNjgxMzAsIDY4MTMxLCA2ODEzMiwgNjgxMzMsIDY4MTM0LCA2ODEzNSwgNjgxMzYsIDY4MTM3LCA2ODEzOCwgNjgxMzksIDY4MTQwLCA2ODE0MSwgNjgxNDIsIDY4MTQzLCA2ODE0NCwgNjgxNDUsIDY4MTQ2LCA2ODE0NywgNjgxNjAsIDY4MTYxLCA2ODE2MiwgNjgxNjMsIDY4MTY0LCA2ODE2NSwgNjgxNjYsIDY4MTY3LCA2ODE3NiwgNjgxNzcsIDY4MTc4LCA2ODE3OSwgNjgxODAsIDY4MTgxLCA2ODE4MiwgNjgxODMsIDY4MTg0LCA2ODE5MiwgNjgxOTMsIDY4MTk0LCA2ODE5NSwgNjgxOTYsIDY4MTk3LCA2ODE5OCwgNjgxOTksIDY4MjAwLCA2ODIwMSwgNjgyMDIsIDY4MjAzLCA2ODIwNCwgNjgyMDUsIDY4MjA2LCA2ODIwNywgNjgyMDgsIDY4MjA5LCA2ODIxMCwgNjgyMTEsIDY4MjEyLCA2ODIxMywgNjgyMTQsIDY4MjE1LCA2ODIxNiwgNjgyMTcsIDY4MjE4LCA2ODIxOSwgNjgyMjAsIDY4MjIxLCA2ODIyMiwgNjgyMjMsIDY4MzUyLCA2ODM1MywgNjgzNTQsIDY4MzU1LCA2ODM1NiwgNjgzNTcsIDY4MzU4LCA2ODM1OSwgNjgzNjAsIDY4MzYxLCA2ODM2MiwgNjgzNjMsIDY4MzY0LCA2ODM2NSwgNjgzNjYsIDY4MzY3LCA2ODM2OCwgNjgzNjksIDY4MzcwLCA2ODM3MSwgNjgzNzIsIDY4MzczLCA2ODM3NCwgNjgzNzUsIDY4Mzc2LCA2ODM3NywgNjgzNzgsIDY4Mzc5LCA2ODM4MCwgNjgzODEsIDY4MzgyLCA2ODM4MywgNjgzODQsIDY4Mzg1LCA2ODM4NiwgNjgzODcsIDY4Mzg4LCA2ODM4OSwgNjgzOTAsIDY4MzkxLCA2ODM5MiwgNjgzOTMsIDY4Mzk0LCA2ODM5NSwgNjgzOTYsIDY4Mzk3LCA2ODM5OCwgNjgzOTksIDY4NDAwLCA2ODQwMSwgNjg0MDIsIDY4NDAzLCA2ODQwNCwgNjg0MDUsIDY4NDE2LCA2ODQxNywgNjg0MTgsIDY4NDE5LCA2ODQyMCwgNjg0MjEsIDY4NDIyLCA2ODQyMywgNjg0MjQsIDY4NDI1LCA2ODQyNiwgNjg0MjcsIDY4NDI4LCA2ODQyOSwgNjg0MzAsIDY4NDMxLCA2ODQzMiwgNjg0MzMsIDY4NDM0LCA2ODQzNSwgNjg0MzYsIDY4NDM3LCA2ODQ0MCwgNjg0NDEsIDY4NDQyLCA2ODQ0MywgNjg0NDQsIDY4NDQ1LCA2ODQ0NiwgNjg0NDcsIDY4NDQ4LCA2ODQ0OSwgNjg0NTAsIDY4NDUxLCA2ODQ1MiwgNjg0NTMsIDY4NDU0LCA2ODQ1NSwgNjg0NTYsIDY4NDU3LCA2ODQ1OCwgNjg0NTksIDY4NDYwLCA2ODQ2MSwgNjg0NjIsIDY4NDYzLCA2ODQ2NCwgNjg0NjUsIDY4NDY2LCA2ODQ3MiwgNjg0NzMsIDY4NDc0LCA2ODQ3NSwgNjg0NzYsIDY4NDc3LCA2ODQ3OCwgNjg0NzksIDY4NjA4LCA2ODYwOSwgNjg2MTAsIDY4NjExLCA2ODYxMiwgNjg2MTMsIDY4NjE0LCA2ODYxNSwgNjg2MTYsIDY4NjE3LCA2ODYxOCwgNjg2MTksIDY4NjIwLCA2ODYyMSwgNjg2MjIsIDY4NjIzLCA2ODYyNCwgNjg2MjUsIDY4NjI2LCA2ODYyNywgNjg2MjgsIDY4NjI5LCA2ODYzMCwgNjg2MzEsIDY4NjMyLCA2ODYzMywgNjg2MzQsIDY4NjM1LCA2ODYzNiwgNjg2MzcsIDY4NjM4LCA2ODYzOSwgNjg2NDAsIDY4NjQxLCA2ODY0MiwgNjg2NDMsIDY4NjQ0LCA2ODY0NSwgNjg2NDYsIDY4NjQ3LCA2ODY0OCwgNjg2NDksIDY4NjUwLCA2ODY1MSwgNjg2NTIsIDY4NjUzLCA2ODY1NCwgNjg2NTUsIDY4NjU2LCA2ODY1NywgNjg2NTgsIDY4NjU5LCA2ODY2MCwgNjg2NjEsIDY4NjYyLCA2ODY2MywgNjg2NjQsIDY4NjY1LCA2ODY2NiwgNjg2NjcsIDY4NjY4LCA2ODY2OSwgNjg2NzAsIDY4NjcxLCA2ODY3MiwgNjg2NzMsIDY4Njc0LCA2ODY3NSwgNjg2NzYsIDY4Njc3LCA2ODY3OCwgNjg2NzksIDY4NjgwLCAxMjY0NjQsIDEyNjQ2NSwgMTI2NDY2LCAxMjY0NjcsIDEyNjQ2OSwgMTI2NDcwLCAxMjY0NzEsIDEyNjQ3MiwgMTI2NDczLCAxMjY0NzQsIDEyNjQ3NSwgMTI2NDc2LCAxMjY0NzcsIDEyNjQ3OCwgMTI2NDc5LCAxMjY0ODAsIDEyNjQ4MSwgMTI2NDgyLCAxMjY0ODMsIDEyNjQ4NCwgMTI2NDg1LCAxMjY0ODYsIDEyNjQ4NywgMTI2NDg4LCAxMjY0ODksIDEyNjQ5MCwgMTI2NDkxLCAxMjY0OTIsIDEyNjQ5MywgMTI2NDk0LCAxMjY0OTUsIDEyNjQ5NywgMTI2NDk4LCAxMjY1MDAsIDEyNjUwMywgMTI2NTA1LCAxMjY1MDYsIDEyNjUwNywgMTI2NTA4LCAxMjY1MDksIDEyNjUxMCwgMTI2NTExLCAxMjY1MTIsIDEyNjUxMywgMTI2NTE0LCAxMjY1MTYsIDEyNjUxNywgMTI2NTE4LCAxMjY1MTksIDEyNjUyMSwgMTI2NTIzLCAxMjY1MzAsIDEyNjUzNSwgMTI2NTM3LCAxMjY1MzksIDEyNjU0MSwgMTI2NTQyLCAxMjY1NDMsIDEyNjU0NSwgMTI2NTQ2LCAxMjY1NDgsIDEyNjU1MSwgMTI2NTUzLCAxMjY1NTUsIDEyNjU1NywgMTI2NTU5LCAxMjY1NjEsIDEyNjU2MiwgMTI2NTY0LCAxMjY1NjcsIDEyNjU2OCwgMTI2NTY5LCAxMjY1NzAsIDEyNjU3MiwgMTI2NTczLCAxMjY1NzQsIDEyNjU3NSwgMTI2NTc2LCAxMjY1NzcsIDEyNjU3OCwgMTI2NTgwLCAxMjY1ODEsIDEyNjU4MiwgMTI2NTgzLCAxMjY1ODUsIDEyNjU4NiwgMTI2NTg3LCAxMjY1ODgsIDEyNjU5MCwgMTI2NTkyLCAxMjY1OTMsIDEyNjU5NCwgMTI2NTk1LCAxMjY1OTYsIDEyNjU5NywgMTI2NTk4LCAxMjY1OTksIDEyNjYwMCwgMTI2NjAxLCAxMjY2MDMsIDEyNjYwNCwgMTI2NjA1LCAxMjY2MDYsIDEyNjYwNywgMTI2NjA4LCAxMjY2MDksIDEyNjYxMCwgMTI2NjExLCAxMjY2MTIsIDEyNjYxMywgMTI2NjE0LCAxMjY2MTUsIDEyNjYxNiwgMTI2NjE3LCAxMjY2MTgsIDEyNjYxOSwgMTI2NjI1LCAxMjY2MjYsIDEyNjYyNywgMTI2NjI5LCAxMjY2MzAsIDEyNjYzMSwgMTI2NjMyLCAxMjY2MzMsIDEyNjYzNSwgMTI2NjM2LCAxMjY2MzcsIDEyNjYzOCwgMTI2NjM5LCAxMjY2NDAsIDEyNjY0MSwgMTI2NjQyLCAxMjY2NDMsIDEyNjY0NCwgMTI2NjQ1LCAxMjY2NDYsIDEyNjY0NywgMTI2NjQ4LCAxMjY2NDksIDEyNjY1MCwgMTI2NjUxLCAxMTE0MTA5XTsNCiAgICBqLnByb3RvdHlwZS5hcHBseVN0eWxlcyA9IGZ1bmN0aW9uIChhLCBiKSB7DQogICAgICAgIGIgPSBiIHx8IHRoaXMuZGl2Ow0KICAgICAgICBmb3IgKHZhciBjIGluIGEpIGEuaGFzT3duUHJvcGVydHkoYykgJiYgKGIuc3R5bGVbY10gPSBhW2NdKQ0KICAgIH0sIGoucHJvdG90eXBlLmZvcm1hdFN0eWxlID0gZnVuY3Rpb24gKGEsIGIpIHsNCiAgICAgICAgcmV0dXJuIDAgPT09IGEgPyAwIDogYSArIGINCiAgICB9LCBrLnByb3RvdHlwZSA9IG8oai5wcm90b3R5cGUpLCBrLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IGssIGwucHJvdG90eXBlLm1vdmUgPSBmdW5jdGlvbiAoYSwgYikgew0KICAgICAgICBzd2l0Y2ggKGIgPSB2b2lkIDAgIT09IGIgPyBiIDogdGhpcy5saW5lSGVpZ2h0LCBhKSB7DQogICAgICAgICAgICBjYXNlICIreCI6DQogICAgICAgICAgICAgICAgdGhpcy5sZWZ0ICs9IGIsIHRoaXMucmlnaHQgKz0gYjsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGNhc2UgIi14IjoNCiAgICAgICAgICAgICAgICB0aGlzLmxlZnQgLT0gYiwgdGhpcy5yaWdodCAtPSBiOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgY2FzZSAiK3kiOg0KICAgICAgICAgICAgICAgIHRoaXMudG9wICs9IGIsIHRoaXMuYm90dG9tICs9IGI7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICBjYXNlICIteSI6DQogICAgICAgICAgICAgICAgdGhpcy50b3AgLT0gYiwgdGhpcy5ib3R0b20gLT0gYg0KICAgICAgICB9DQogICAgfSwgbC5wcm90b3R5cGUub3ZlcmxhcHMgPSBmdW5jdGlvbiAoYSkgew0KICAgICAgICByZXR1cm4gdGhpcy5sZWZ0IDwgYS5yaWdodCAmJiB0aGlzLnJpZ2h0ID4gYS5sZWZ0ICYmIHRoaXMudG9wIDwgYS5ib3R0b20gJiYgdGhpcy5ib3R0b20gPiBhLnRvcA0KICAgIH0sIGwucHJvdG90eXBlLm92ZXJsYXBzQW55ID0gZnVuY3Rpb24gKGEpIHsNCiAgICAgICAgZm9yICh2YXIgYiA9IDA7IGIgPCBhLmxlbmd0aDsgYisrKQ0KICAgICAgICAgICAgaWYgKHRoaXMub3ZlcmxhcHMoYVtiXSkpIHJldHVybiAhMDsNCiAgICAgICAgcmV0dXJuICExDQogICAgfSwgbC5wcm90b3R5cGUud2l0aGluID0gZnVuY3Rpb24gKGEpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMudG9wID49IGEudG9wICYmIHRoaXMuYm90dG9tIDw9IGEuYm90dG9tICYmIHRoaXMubGVmdCA+PSBhLmxlZnQgJiYgdGhpcy5yaWdodCA8PSBhLnJpZ2h0DQogICAgfSwgbC5wcm90b3R5cGUub3ZlcmxhcHNPcHBvc2l0ZUF4aXMgPSBmdW5jdGlvbiAoYSwgYikgew0KICAgICAgICBzd2l0Y2ggKGIpIHsNCiAgICAgICAgICAgIGNhc2UgIit4IjoNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5sZWZ0IDwgYS5sZWZ0Ow0KICAgICAgICAgICAgY2FzZSAiLXgiOg0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnJpZ2h0ID4gYS5yaWdodDsNCiAgICAgICAgICAgIGNhc2UgIit5IjoNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy50b3AgPCBhLnRvcDsNCiAgICAgICAgICAgIGNhc2UgIi15IjoNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5ib3R0b20gPiBhLmJvdHRvbQ0KICAgICAgICB9DQogICAgfSwgbC5wcm90b3R5cGUuaW50ZXJzZWN0UGVyY2VudGFnZSA9IGZ1bmN0aW9uIChhKSB7DQogICAgICAgIHZhciBiID0gTWF0aC5tYXgoMCwgTWF0aC5taW4odGhpcy5yaWdodCwgYS5yaWdodCkgLSBNYXRoLm1heCh0aGlzLmxlZnQsIGEubGVmdCkpLA0KICAgICAgICAgICAgYyA9IE1hdGgubWF4KDAsIE1hdGgubWluKHRoaXMuYm90dG9tLCBhLmJvdHRvbSkgLSBNYXRoLm1heCh0aGlzLnRvcCwgYS50b3ApKSwNCiAgICAgICAgICAgIGQgPSBiICogYzsNCiAgICAgICAgcmV0dXJuIGQgLyAodGhpcy5oZWlnaHQgKiB0aGlzLndpZHRoKQ0KICAgIH0sIGwucHJvdG90eXBlLnRvQ1NTQ29tcGF0VmFsdWVzID0gZnVuY3Rpb24gKGEpIHsNCiAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICAgIHRvcDogdGhpcy50b3AgLSBhLnRvcCwNCiAgICAgICAgICAgIGJvdHRvbTogYS5ib3R0b20gLSB0aGlzLmJvdHRvbSwNCiAgICAgICAgICAgIGxlZnQ6IHRoaXMubGVmdCAtIGEubGVmdCwNCiAgICAgICAgICAgIHJpZ2h0OiBhLnJpZ2h0IC0gdGhpcy5yaWdodCwNCiAgICAgICAgICAgIGhlaWdodDogdGhpcy5oZWlnaHQsDQogICAgICAgICAgICB3aWR0aDogdGhpcy53aWR0aA0KICAgICAgICB9DQogICAgfSwgbC5nZXRTaW1wbGVCb3hQb3NpdGlvbiA9IGZ1bmN0aW9uIChhKSB7DQogICAgICAgIHZhciBiID0gYS5kaXYgPyBhLmRpdi5vZmZzZXRIZWlnaHQgOiBhLnRhZ05hbWUgPyBhLm9mZnNldEhlaWdodCA6IDAsDQogICAgICAgICAgICBjID0gYS5kaXYgPyBhLmRpdi5vZmZzZXRXaWR0aCA6IGEudGFnTmFtZSA/IGEub2Zmc2V0V2lkdGggOiAwLA0KICAgICAgICAgICAgZCA9IGEuZGl2ID8gYS5kaXYub2Zmc2V0VG9wIDogYS50YWdOYW1lID8gYS5vZmZzZXRUb3AgOiAwOw0KICAgICAgICBhID0gYS5kaXYgPyBhLmRpdi5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSA6IGEudGFnTmFtZSA/IGEuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkgOiBhOw0KICAgICAgICB2YXIgZSA9IHsNCiAgICAgICAgICAgIGxlZnQ6IGEubGVmdCwNCiAgICAgICAgICAgIHJpZ2h0OiBhLnJpZ2h0LA0KICAgICAgICAgICAgdG9wOiBhLnRvcCB8fCBkLA0KICAgICAgICAgICAgaGVpZ2h0OiBhLmhlaWdodCB8fCBiLA0KICAgICAgICAgICAgYm90dG9tOiBhLmJvdHRvbSB8fCBkICsgKGEuaGVpZ2h0IHx8IGIpLA0KICAgICAgICAgICAgd2lkdGg6IGEud2lkdGggfHwgYw0KICAgICAgICB9Ow0KICAgICAgICByZXR1cm4gZQ0KICAgIH0sIG4uU3RyaW5nRGVjb2RlciA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICAgIGRlY29kZTogZnVuY3Rpb24gKGEpIHsNCiAgICAgICAgICAgICAgICBpZiAoIWEpIHJldHVybiAiIjsNCiAgICAgICAgICAgICAgICBpZiAoInN0cmluZyIgIT0gdHlwZW9mIGEpIHRocm93IG5ldyBFcnJvcigiRXJyb3IgLSBleHBlY3RlZCBzdHJpbmcgZGF0YS4iKTsNCiAgICAgICAgICAgICAgICByZXR1cm4gZGVjb2RlVVJJQ29tcG9uZW50KGVuY29kZVVSSUNvbXBvbmVudChhKSkNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0sIG4uY29udmVydEN1ZVRvRE9NVHJlZSA9IGZ1bmN0aW9uIChhLCBiKSB7DQogICAgICAgIHJldHVybiBhICYmIGIgPyBnKGEsIGIpIDogbnVsbA0KICAgIH07DQogICAgdmFyIHUgPSAuMDUsDQogICAgICAgIHYgPSAic2Fucy1zZXJpZiIsDQogICAgICAgIHcgPSAiMS41JSI7DQogICAgbi5wcm9jZXNzQ3VlcyA9IGZ1bmN0aW9uIChhLCBiLCBjKSB7DQogICAgICAgIGZ1bmN0aW9uIGQoYSkgew0KICAgICAgICAgICAgZm9yICh2YXIgYiA9IDA7IGIgPCBhLmxlbmd0aDsgYisrKQ0KICAgICAgICAgICAgICAgIGlmIChhW2JdLmhhc0JlZW5SZXNldCB8fCAhYVtiXS5kaXNwbGF5U3RhdGUpIHJldHVybiAhMDsNCiAgICAgICAgICAgIHJldHVybiAhMQ0KICAgICAgICB9DQogICAgICAgIGlmICghYSB8fCAhYiB8fCAhYykgcmV0dXJuIG51bGw7DQogICAgICAgIGZvciAoOyBjLmZpcnN0Q2hpbGQ7KSBjLnJlbW92ZUNoaWxkKGMuZmlyc3RDaGlsZCk7DQogICAgICAgIHZhciBlID0gYS5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsNCiAgICAgICAgaWYgKGUuc3R5bGUucG9zaXRpb24gPSAiYWJzb2x1dGUiLCBlLnN0eWxlLmxlZnQgPSAiMCIsIGUuc3R5bGUucmlnaHQgPSAiMCIsIGUuc3R5bGUudG9wID0gIjAiLCBlLnN0eWxlLmJvdHRvbSA9ICIwIiwgZS5zdHlsZS5tYXJnaW4gPSB3LCBjLmFwcGVuZENoaWxkKGUpLCBkKGIpKSB7DQogICAgICAgICAgICB2YXIgZiA9IFtdLA0KICAgICAgICAgICAgICAgIGcgPSBsLmdldFNpbXBsZUJveFBvc2l0aW9uKGUpLA0KICAgICAgICAgICAgICAgIGggPSBNYXRoLnJvdW5kKGcuaGVpZ2h0ICogdSAqIDEwMCkgLyAxMDAsDQogICAgICAgICAgICAgICAgaSA9IHsNCiAgICAgICAgICAgICAgICAgICAgZm9udDogaCArICJweCAiICsgdg0KICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAhIGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICBmb3IgKHZhciBjLCBkLCBoID0gMDsgaCA8IGIubGVuZ3RoOyBoKyspIGQgPSBiW2hdLCBjID0gbmV3IGsoYSwgZCwgaSksIGUuYXBwZW5kQ2hpbGQoYy5kaXYpLCBtKGEsIGMsIGcsIGYpLCBkLmRpc3BsYXlTdGF0ZSA9IGMuZGl2LCBmLnB1c2gobC5nZXRTaW1wbGVCb3hQb3NpdGlvbihjKSkNCiAgICAgICAgICAgIH0oKQ0KICAgICAgICB9IGVsc2UNCiAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgYi5sZW5ndGg7IGorKykgZS5hcHBlbmRDaGlsZChiW2pdLmRpc3BsYXlTdGF0ZSkNCiAgICB9LCBuLlBhcnNlciA9IGZ1bmN0aW9uIChhLCBiLCBjKSB7DQogICAgICAgIGMgfHwgKGMgPSBiLCBiID0ge30pLCBiIHx8IChiID0ge30pLCB0aGlzLndpbmRvdyA9IGEsIHRoaXMudnR0anMgPSBiLCB0aGlzLnN0YXRlID0gIklOSVRJQUwiLCB0aGlzLmJ1ZmZlciA9ICIiLCB0aGlzLmRlY29kZXIgPSBjIHx8IG5ldyBUZXh0RGVjb2RlcigidXRmOCIpLCB0aGlzLnJlZ2lvbkxpc3QgPSBbXQ0KICAgIH0sIG4uUGFyc2VyLnByb3RvdHlwZSA9IHsNCiAgICAgICAgcmVwb3J0T3JUaHJvd0Vycm9yOiBmdW5jdGlvbiAoYSkgew0KICAgICAgICAgICAgaWYgKCEoYSBpbnN0YW5jZW9mIGIpKSB0aHJvdyBhOw0KICAgICAgICAgICAgdGhpcy5vbnBhcnNpbmdlcnJvciAmJiB0aGlzLm9ucGFyc2luZ2Vycm9yKGEpDQogICAgICAgIH0sDQogICAgICAgIHBhcnNlOiBmdW5jdGlvbiAoYSkgew0KICAgICAgICAgICAgZnVuY3Rpb24gYygpIHsNCiAgICAgICAgICAgICAgICBmb3IgKHZhciBhID0gaS5idWZmZXIsIGIgPSAwOyBiIDwgYS5sZW5ndGggJiYgIlxyIiAhPT0gYVtiXSAmJiAiXG4iICE9PSBhW2JdOykrK2I7DQogICAgICAgICAgICAgICAgdmFyIGMgPSBhLnN1YnN0cigwLCBiKTsNCiAgICAgICAgICAgICAgICByZXR1cm4gIlxyIiA9PT0gYVtiXSAmJiArK2IsICJcbiIgPT09IGFbYl0gJiYgKytiLCBpLmJ1ZmZlciA9IGEuc3Vic3RyKGIpLCBjDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGZ1bmN0aW9uIGcoYSkgew0KICAgICAgICAgICAgICAgIHZhciBiID0gbmV3IGQ7DQogICAgICAgICAgICAgICAgaWYgKGUoYSwgZnVuY3Rpb24gKGEsIGMpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoYSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImlkIjoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYi5zZXQoYSwgYyk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgIndpZHRoIjoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYi5wZXJjZW50KGEsIGMpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJsaW5lcyI6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIuaW50ZWdlcihhLCBjKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAicmVnaW9uYW5jaG9yIjoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJ2aWV3cG9ydGFuY2hvciI6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlID0gYy5zcGxpdCgiLCIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoMiAhPT0gZS5sZW5ndGgpIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZiA9IG5ldyBkOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZi5wZXJjZW50KCJ4IiwgZVswXSksIGYucGVyY2VudCgieSIsIGVbMV0pLCAhZi5oYXMoIngiKSB8fCAhZi5oYXMoInkiKSkgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIuc2V0KGEgKyAiWCIsIGYuZ2V0KCJ4IikpLCBiLnNldChhICsgIlkiLCBmLmdldCgieSIpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAic2Nyb2xsIjoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYi5hbHQoYSwgYywgWyJ1cCJdKQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9LCAvPS8sIC9ccy8pLCBiLmhhcygiaWQiKSkgew0KICAgICAgICAgICAgICAgICAgICB2YXIgYyA9IG5ldyAoaS52dHRqcy5WVFRSZWdpb24gfHwgaS53aW5kb3cuVlRUUmVnaW9uKTsNCiAgICAgICAgICAgICAgICAgICAgYy53aWR0aCA9IGIuZ2V0KCJ3aWR0aCIsIDEwMCksIGMubGluZXMgPSBiLmdldCgibGluZXMiLCAzKSwgYy5yZWdpb25BbmNob3JYID0gYi5nZXQoInJlZ2lvbmFuY2hvclgiLCAwKSwgYy5yZWdpb25BbmNob3JZID0gYi5nZXQoInJlZ2lvbmFuY2hvclkiLCAxMDApLCBjLnZpZXdwb3J0QW5jaG9yWCA9IGIuZ2V0KCJ2aWV3cG9ydGFuY2hvclgiLCAwKSwgYy52aWV3cG9ydEFuY2hvclkgPSBiLmdldCgidmlld3BvcnRhbmNob3JZIiwgMTAwKSwgYy5zY3JvbGwgPSBiLmdldCgic2Nyb2xsIiwgIiIpLCBpLm9ucmVnaW9uICYmIGkub25yZWdpb24oYyksIGkucmVnaW9uTGlzdC5wdXNoKHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBiLmdldCgiaWQiKSwNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2lvbjogYw0KICAgICAgICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgZnVuY3Rpb24gaChhKSB7DQogICAgICAgICAgICAgICAgZShhLCBmdW5jdGlvbiAoYSwgYikgew0KICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKGEpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgIlJlZ2lvbiI6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZyhiKQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSwgLzovKQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgdmFyIGkgPSB0aGlzOw0KICAgICAgICAgICAgYSAmJiAoaS5idWZmZXIgKz0gaS5kZWNvZGVyLmRlY29kZShhLCB7DQogICAgICAgICAgICAgICAgc3RyZWFtOiAhMA0KICAgICAgICAgICAgfSkpOw0KICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICB2YXIgajsNCiAgICAgICAgICAgICAgICBpZiAoIklOSVRJQUwiID09PSBpLnN0YXRlKSB7DQogICAgICAgICAgICAgICAgICAgIGlmICghL1xyXG58XG4vLnRlc3QoaS5idWZmZXIpKSByZXR1cm4gdGhpczsNCiAgICAgICAgICAgICAgICAgICAgaiA9IGMoKTsNCiAgICAgICAgICAgICAgICAgICAgdmFyIGsgPSBqLm1hdGNoKC9eV0VCVlRUKFsgXHRdLiopPyQvKTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCFrIHx8ICFrWzBdKSB0aHJvdyBuZXcgYihiLkVycm9ycy5CYWRTaWduYXR1cmUpOw0KICAgICAgICAgICAgICAgICAgICBpLnN0YXRlID0gIkhFQURFUiINCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZm9yICh2YXIgbCA9ICExOyBpLmJ1ZmZlcjspIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCEvXHJcbnxcbi8udGVzdChpLmJ1ZmZlcikpIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKGwgPyBsID0gITEgOiBqID0gYygpLCBpLnN0YXRlKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJIRUFERVIiOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC86Ly50ZXN0KGopID8gaChqKSA6IGogfHwgKGkuc3RhdGUgPSAiSUQiKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgIk5PVEUiOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGogfHwgKGkuc3RhdGUgPSAiSUQiKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgIklEIjoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoL15OT1RFKCR8WyBcdF0pLy50ZXN0KGopKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkuc3RhdGUgPSAiTk9URSI7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghaikgY29udGludWU7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGkuY3VlID0gbmV3IChpLnZ0dGpzLlZUVEN1ZSB8fCBpLndpbmRvdy5WVFRDdWUpKDAsIDAsICIiKSwgaS5zdGF0ZSA9ICJDVUUiLCAtMSA9PT0gai5pbmRleE9mKCItLT4iKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpLmN1ZS5pZCA9IGo7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiQ1VFIjoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmKGosIGkuY3VlLCBpLnJlZ2lvbkxpc3QpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAobSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpLnJlcG9ydE9yVGhyb3dFcnJvcihtKSwgaS5jdWUgPSBudWxsLCBpLnN0YXRlID0gIkJBRENVRSI7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkuc3RhdGUgPSAiQ1VFVEVYVCI7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7DQogICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJDVUVURVhUIjoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbiA9IC0xICE9PSBqLmluZGV4T2YoIi0tPiIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghaiB8fCBuICYmIChsID0gITApKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkub25jdWUgJiYgaS5vbmN1ZShpLmN1ZSksIGkuY3VlID0gbnVsbCwgaS5zdGF0ZSA9ICJJRCI7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkuY3VlLnRleHQgJiYgKGkuY3VlLnRleHQgKz0gIlxuIiksIGkuY3VlLnRleHQgKz0gajsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgIkJBRENVRSI6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaiB8fCAoaS5zdGF0ZSA9ICJJRCIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlDQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9IGNhdGNoIChtKSB7DQogICAgICAgICAgICAgICAgaS5yZXBvcnRPclRocm93RXJyb3IobSksICJDVUVURVhUIiA9PT0gaS5zdGF0ZSAmJiBpLmN1ZSAmJiBpLm9uY3VlICYmIGkub25jdWUoaS5jdWUpLCBpLmN1ZSA9IG51bGwsIGkuc3RhdGUgPSAiSU5JVElBTCIgPT09IGkuc3RhdGUgPyAiQkFEV0VCVlRUIiA6ICJCQURDVUUiDQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gdGhpcw0KICAgICAgICB9LA0KICAgICAgICBmbHVzaDogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgdmFyIGEgPSB0aGlzOw0KICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICBpZiAoYS5idWZmZXIgKz0gYS5kZWNvZGVyLmRlY29kZSgpLCAoYS5jdWUgfHwgIkhFQURFUiIgPT09IGEuc3RhdGUpICYmIChhLmJ1ZmZlciArPSAiXG5cbiIsIGEucGFyc2UoKSksICJJTklUSUFMIiA9PT0gYS5zdGF0ZSkgdGhyb3cgbmV3IGIoYi5FcnJvcnMuQmFkU2lnbmF0dXJlKQ0KICAgICAgICAgICAgfSBjYXRjaCAoYykgew0KICAgICAgICAgICAgICAgIGEucmVwb3J0T3JUaHJvd0Vycm9yKGMpDQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gYS5vbmZsdXNoICYmIGEub25mbHVzaCgpLCB0aGlzDQogICAgICAgIH0NCiAgICB9LCBhLldlYlZUVCA9IG4NCn0odGhpcywgdGhpcy52dHRqcyB8fCB7fSk7
- ID: "6954b7c7-2487-423f-8600-436cb3b6dc0e"
  Hint: Size
  Value: 183627
- ID: "6f47a0a5-9c94-4b48-abeb-42d38def6054"
  Hint: Mime Type
  Value: "application/x-javascript"
- ID: "c06867fe-9a43-4c7d-b739-48780492d06f"
  Hint: Extension
  Value: js
Languages:
- Language: en
  Versions:
  - Version: 1
    Fields:
    - ID: "25bed78c-4957-4165-998a-ca1b52f67497"
      Hint: __Created
      Value: 20180204T141521Z
